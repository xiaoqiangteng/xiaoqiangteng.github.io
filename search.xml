<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>空间数据结构（二）-OCTree</title>
      <link href="/2021/04/04/data_structure_algorithm/%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%8C%EF%BC%89-OCTree/"/>
      <url>/2021/04/04/data_structure_algorithm/%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%8C%EF%BC%89-OCTree/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>八叉树结构是由Hunter博士于1978年首次提出的一种数据模型。八叉树结构通过对三维空间的几何实体进行体元剖分，每个体元具有相同的时间和空间复杂度，通过循环递归的划分方法对大小为(2n∗2n∗2n的三维空间的几何对象进行剖分，从而构成一个具有根节点的方向图。在八叉树结构中如果被划分的体元具有相同的属性，则该体元构成一个叶节点；否则继续对该体元剖分成8个子立方体，依次递剖分，对于(2n∗2n∗2n)大小的空间对象，最多剖分n次，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-04-04-093038.png" alt="image-20210404173029797" style="zoom:50%;"></p><p>八叉树（Octree）是一种用于描述三维空间的树状数据结构。八叉树的每个节点表示一个正方体的体积元素，每个节点有八个子节点，这八个子节点所表示的体积元素加在一起就等于父节点的体积。一般中心点作为节点的分叉中心。八叉树若不为空树的话，树中任一节点的子节点恰好只会有八个，或零个，也就是子节点不会有0与8以外的数目。八叉树叶子节点代表了分辨率最高的情况。例如分辨率设成0.01m，那么每个叶子就是一个1cm见方的小方块。</p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><p>八叉树是将空间平均得分为8个部分，每个节点就是一个部分，我们假设三维空间是一个正立方体，每个节点就是一个小立方体。划分到最后，一个叶子结点代表一个最小的空间范围，我们称之为体素。八叉树的建立过程也就是空间划分的过程。</p><p>实现原理：</p><ul><li>设定最大递归深度</li><li>找出场景的最大尺寸，并以此尺寸建立第一个立方体</li><li>依序将单位元元素丢入能被包含且没有子节点的立方体</li><li>若没有达到最大递归深度，就进行细分八等份，再将该立方体所装的单位元元素全部分担给八个子立方体</li><li>若发现子立方体所分配到的单位元元素数量不为零且跟父立方体是一样的，则该子立方体停止细分，因为跟据空间分割理论，细分的空间所得到的分配必定较少，若是一样数目，则再怎么切数目还是一样，会造成无穷切割的情形。</li><li>重复，直到达到最大递归深度。</li></ul><p>基于八叉树的近邻搜索可以分为三种：</p><ul><li>范围搜索</li><li>k最近邻搜索</li><li>体素内搜索</li></ul><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point3D</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""A point in 3 dimensions"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y, z, data=None)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        self.z = z</span><br><span class="line">        self.data = data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, point)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Point3D(self.x + point.x, self.y + point.y, self.z + point.z)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__sub__</span><span class="params">(self, point)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Point3D(self.x - point.x, self.y - point.y, self.z - point.z)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> type(value) == tuple:</span><br><span class="line">            <span class="keyword">return</span> Point3D(self.x * value[<span class="number">0</span>], self.y * value[<span class="number">1</span>], self.z * value[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Point3D(self.x * value, self.y * value, self.z * value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__truediv__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> type(value) == Point3D:</span><br><span class="line">            <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Point3D(self.x / value, self.y / value, self.z / value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'Return a nicely formatted representation string'</span></span><br><span class="line">        <span class="keyword">return</span> self.__class__.__name__ + <span class="string">'(x='</span>+str(self.x)+<span class="string">', y='</span>+str(self.y)+<span class="string">', z='</span>+str(self.z)+<span class="string">')'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dist</span><span class="params">(self, point)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> sqrt(self.x**<span class="number">2</span> + self.y**<span class="number">2</span> + self.z**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index2mask</span><span class="params">(idx: int)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (idx &amp; <span class="number">1</span>, (idx &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>, (idx &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mask2index</span><span class="params">(idx: tuple)</span>:</span></span><br><span class="line">    x, y, z = [int(bool(idx[i])) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">    <span class="keyword">return</span> (z &lt;&lt; <span class="number">2</span>) + (y &lt;&lt; <span class="number">1</span>) + x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invMask</span><span class="params">(mask: tuple)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> tuple([mask[i] ^ <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Octree</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Representation of a Node in the Octree."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, lower_bound: Point3D, upper_bound: Point3D, max_levels=<span class="number">-1</span>, max_size=<span class="number">10</span>)</span>:</span></span><br><span class="line">        self.has_children = <span class="keyword">False</span></span><br><span class="line">        self.children: Octree = []</span><br><span class="line">        self.points: Point3D = []</span><br><span class="line">        self.lower_bound = lower_bound</span><br><span class="line">        self.upper_bound = upper_bound</span><br><span class="line">        self.max_levels = max_levels</span><br><span class="line">        self.max_size = max_size</span><br><span class="line">        self.center = (lower_bound + upper_bound) / <span class="number">2</span></span><br><span class="line">        self.numPoints = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extend</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (self.max_levels == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.has_children = <span class="keyword">True</span></span><br><span class="line">            self.children = list([self._generateChildTree(idx) <span class="keyword">for</span> idx <span class="keyword">in</span> range(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generateChildTree</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        mask = index2mask(idx)</span><br><span class="line">        imask = invMask(mask)</span><br><span class="line">        new_lower_bound = self.lower_bound * imask + self.center * mask</span><br><span class="line">        new_upper_bound = self.center * imask + self.upper_bound * mask</span><br><span class="line">        <span class="keyword">return</span> Octree(new_lower_bound, new_upper_bound, self.max_levels - <span class="number">1</span>, self.max_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addPoint</span><span class="params">(self, pt: Point3D)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.has_children:</span><br><span class="line">            self._addPointToChild(pt)</span><br><span class="line">        <span class="keyword">elif</span> len(self.points) &gt;= self.max_size:</span><br><span class="line">            self.extend()</span><br><span class="line">            <span class="keyword">for</span> point <span class="keyword">in</span> self.points:</span><br><span class="line">                self._addPointToChild(point)</span><br><span class="line">            self._addPointToChild(pt)</span><br><span class="line">            self.points = []</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.points.append(pt)</span><br><span class="line">        self.numPoints += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_addPointToChild</span><span class="params">(self, pt: Point3D)</span>:</span></span><br><span class="line">        x = int(pt.x &gt;= self.center.x)</span><br><span class="line">        y = int(pt.y &gt;= self.center.y)</span><br><span class="line">        z = int(pt.z &gt;= self.center.z)</span><br><span class="line">        self.children[mask2index((x, y, z))].addPoint(pt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    ot = Octree(Point3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), Point3D(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">        x, y, z = random(), random(), random()</span><br><span class="line">        ot.addPoint(Point3D(x, y, z))</span><br></pre></td></tr></table></figure><p>参考：<a href="https://github.com/LukasACH/Octree-Py/blob/master/Octree/Octree.py" target="_blank" rel="noopener">https://github.com/LukasACH/Octree-Py/blob/master/Octree/Octree.py</a></p><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://github.com/LukasACH/Octree-Py" target="_blank" rel="noopener">Octree-Py</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>空间数据结构（一）-KD-Tree</title>
      <link href="/2021/04/03/data_structure_algorithm/%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89-KD-Tree/"/>
      <url>/2021/04/03/data_structure_algorithm/%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%80%EF%BC%89-KD-Tree/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>空间索引在多维数据处理中已被广泛应用，常见空间索引一般是自顶向下逐级划分空间的各种空间索引结构，比较有代表性的包括 BSP树、 KD树、 KDB树、 R树、 R+树、 CELL树、四叉树和八叉树等索引结构，而在这些结构中KD树和八叉树在3D点云数据组织中应用较为广泛。KD-Tree简称k维树，是一种空间划分的数据结构，本质上是一种二叉树，常被用于高维空间中的搜索，比如范围搜索和最近邻搜索。KD-Tree用来组织表示K维空间中点集合，是一种带有其他约束条件的二分查找树。如果特征的维度是D，样本的数量是N，那么一般来讲kd树算法的复杂度是O(DlogN)，相比于穷算的O(DN)省去了非常多的计算量。</p><p>KD-Tree求解的问题如下所示：</p><p>给定一堆已有的样本数据，和一个被询问的数据点，如何找到离五角星最近的n个点？</p><ul><li>基本解法<ul><li>遍历，按照一定距离选取最近的n个点</li><li>计算复杂度为O(DN)</li></ul></li><li>高级解法<ul><li>KD-Tree，时间复杂度为O(DlogN)</li><li>…</li></ul></li></ul><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><p>KD-Tree数据结构主要分为两个步骤：KD-Tree的构建和查询。</p><h2 id="2-1-构建阶段"><a href="#2-1-构建阶段" class="headerlink" title="2.1 构建阶段"></a>2.1 构建阶段</h2><p>构建就是按照某种顺序将无序化的点云进行有序化排列，方便进行快捷高效的检索。</p><p>一些术语定义如下：</p><ul><li>分裂点（split_point）</li><li>分裂方式（split_method）</li><li>左儿子（left_son）</li><li>右儿子（right_son）</li></ul><p>数据结构如下所示：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kdtree</span>&#123;</span></span><br><span class="line">    Node-data - 数据矢量   数据集中某个数据点，是n维矢量（这里也就是k维）</span><br><span class="line">    Range     - 空间矢量   该节点所代表的空间范围</span><br><span class="line">    split     - 整数       垂直于分割超平面的方向轴序号</span><br><span class="line">    Left      - kd树       由位于该节点分割超平面左子空间内所有数据点所构成的k-d树</span><br><span class="line">    Right     - kd树       由位于该节点分割超平面右子空间内所有数据点所构成的k-d树</span><br><span class="line">    parent    - kd树       父节点  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>建树规则如下：</p><ul><li>针对空间的“维”的</li><li>节点的状态中的：分裂方式（split_method）</li><li>建树依据<ul><li>主要思想：先计算当前区间[L, R]中（这里的区间是点的序号区间，而不是我们实际上的坐标区间），每个点的坐标的每一维度上的方差，取方差最大的那一维，设为d，作为分裂方式（split_method ），把区间中的点按照在d上的大小，从小到大排序，取中间的点sorted_mid作为当前节点记录的分裂点，然后，再以[L, sorted_mid-1]为左子树建树 ， 以[sorted_mid+1, R]为右子树建树，迭代进行上述步骤</li><li>初始化分割轴<ul><li>取方差最大的轴为初始分割轴，例如X轴</li></ul></li><li>确定当前节点<ul><li>选取中位数为当前点</li></ul></li><li>划分双支数据<ul><li>在X轴维度上，比较和中位数的大小，进行划分左支和右支</li></ul></li><li>更新分割轴<ul><li>下一个维度为X轴</li></ul></li><li>迭代进行上述步骤，直到全部分支构建完毕</li></ul></li></ul><p>示例参考：<a href="https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97和https://blog.csdn.net/FAICULTY/article/details/79474627。" target="_blank" rel="noopener">https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97和https://blog.csdn.net/FAICULTY/article/details/79474627。</a></p><ul><li>给定如下数据<ul><li>(2, 3), (5, 4), (9, 6), (4, 7), (8, 1), (7, 2)</li></ul></li><li>数据维度只有2维，所以可以简单地给x，y两个方向轴编号为0,1，即split={0,1}</li><li>以X轴为切分轴，基于X轴对数据进行排序，选取中间数据(7, 2)作为根节点<ul><li>对于左侧数据，以Y轴为切分轴，对数据进行排序，选取中间数据(5, 4)作为左树的子节点</li><li>再对于左侧数据，迭代进行上一步，直到所有左侧数据均被划分完成</li></ul></li><li>对于右侧数据，以X轴为切分轴，选取中间数据(9, 6)作为根节点的左支<ul><li>对于右侧数据，迭代进行上一步，直到所有数据均被划分完成</li></ul></li></ul><p>上述数据的KD-Tree划分结果如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-04-04-053715.png" alt="image-20210404133715211" style="zoom:50%;"></p><p>即：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">'split'</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">'median'</span>: array([</span><br><span class="line">        <span class="number">7.</span>,</span><br><span class="line">        <span class="number">2.</span></span><br><span class="line">    ]),</span><br><span class="line">    <span class="string">'left'</span>: &#123;</span><br><span class="line">        <span class="string">'split'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'median'</span>: array([</span><br><span class="line">            <span class="number">5.</span>,</span><br><span class="line">            <span class="number">4.</span></span><br><span class="line">        ]),</span><br><span class="line">        <span class="string">'left'</span>: &#123;</span><br><span class="line">            <span class="string">'split'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'median'</span>: array([</span><br><span class="line">                <span class="number">2.</span>,</span><br><span class="line">                <span class="number">3.</span></span><br><span class="line">            ]),</span><br><span class="line">            <span class="string">'left'</span>: <span class="keyword">None</span>,</span><br><span class="line">            <span class="string">'right'</span>: <span class="keyword">None</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'right'</span>: &#123;</span><br><span class="line">            <span class="string">'split'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'median'</span>: array([</span><br><span class="line">                <span class="number">4.</span>,</span><br><span class="line">                <span class="number">7.</span></span><br><span class="line">            ]),</span><br><span class="line">            <span class="string">'left'</span>: <span class="keyword">None</span>,</span><br><span class="line">            <span class="string">'right'</span>: <span class="keyword">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'right'</span>: &#123;</span><br><span class="line">        <span class="string">'split'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'median'</span>: array([</span><br><span class="line">            <span class="number">9.</span>,</span><br><span class="line">            <span class="number">6.</span></span><br><span class="line">        ]),</span><br><span class="line">        <span class="string">'left'</span>: &#123;</span><br><span class="line">            <span class="string">'split'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'median'</span>: array([</span><br><span class="line">                <span class="number">8.</span>,</span><br><span class="line">                <span class="number">1.</span></span><br><span class="line">            ]),</span><br><span class="line">            <span class="string">'left'</span>: <span class="keyword">None</span>,</span><br><span class="line">            <span class="string">'right'</span>: <span class="keyword">None</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'right'</span>: <span class="keyword">None</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2-查询"><a href="#2-2-查询" class="headerlink" title="2.2 查询"></a>2.2 查询</h2><p>给定一个构建于一个样本集的kd树，下面的算法可以寻找距离某个点p最近的k个样本。</p><p>查询的示例参考：<a href="https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97。" target="_blank" rel="noopener">https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97。</a></p><p>步骤：</p><ul><li>第一步：假设搜索的节点为p，一个有k个空位的列表，用于保存已搜寻到的最近点</li><li>第二步：根据p的坐标值和每个节点的切分进行向下搜索，例如按照切分方向（向X轴或者Y轴）进行搜索，如果p的坐标小于切分节点坐标，则向左搜索，反之，向右搜索</li><li>第三步：当达到一个底部节点时，将其标记为访问过<ul><li>如果L里不足k个点，则将当前节点的特征坐标加入L</li><li>如果L不为空并且当前节点的特征与p的距离小于L里最长的距离，则用当前特征替换掉L中离p最远的点</li></ul></li><li>第四步：如果当前节点不是整棵树最顶端节点下述步骤；反之，输出L，算法完成<ul><li>向上爬一个节点<ul><li>如果当前（向上爬之后的）节点未曾被访问过，将其标记为被访问过，然后执行下述步骤<ul><li>如果此时L里不足k个点，则将节点特征加入L</li><li>如果L中已满k个点，且当前节点与p的距离小于L里最长的距离，则用节点特征替换掉L中离最远的点</li></ul></li><li>计算p和当前节点切分线的距离<ul><li>如果该距离大于等于L中距离p最远的距离并且L中已有k个点，则在切分线另一边不会有更近的点，执行第四步</li><li>如果该距离小于L中最远的距离或者L中不足k个点，则切分线另一边可能有更近的点，因此在当前节点的另一个枝从第二步开始执行</li></ul></li></ul></li></ul></li></ul><p>实际例子，参考：<a href="https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97。" target="_blank" rel="noopener">https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97。</a></p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><p>参考：<a href="https://github.com/guoswang/K-D-Tree和https://github.com/stefankoegl/kdtree。" target="_blank" rel="noopener">https://github.com/guoswang/K-D-Tree和https://github.com/stefankoegl/kdtree。</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_data</span><span class="params">(fileName)</span>:</span></span><br><span class="line">    dataMat = []</span><br><span class="line">    <span class="keyword">with</span> open(fileName) <span class="keyword">as</span> fd:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> fd.readlines():</span><br><span class="line">            data = line.strip().split()</span><br><span class="line">            data = [float(item) <span class="keyword">for</span> item <span class="keyword">in</span> data]</span><br><span class="line">            dataMat.append(data)</span><br><span class="line">    dataMat = np.array(dataMat)</span><br><span class="line">    label = dataMat[:, <span class="number">2</span>]</span><br><span class="line">    dataMat = dataMat[:, :<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">return</span> dataMat, label</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_KDTree</span><span class="params">(dataSet, depth)</span>:</span></span><br><span class="line">    n = np.shape(dataSet)[<span class="number">0</span>]</span><br><span class="line">    treeNode = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        n, m = np.shape(dataSet)</span><br><span class="line">        split_axis = depth % m</span><br><span class="line">        depth += <span class="number">1</span></span><br><span class="line">        treeNode[<span class="string">'split'</span>] = split_axis</span><br><span class="line">        dataSet = sorted(dataSet, key=<span class="keyword">lambda</span> a: a[split_axis])</span><br><span class="line">        num = n // <span class="number">2</span></span><br><span class="line">        treeNode[<span class="string">'median'</span>] = dataSet[num]</span><br><span class="line">        treeNode[<span class="string">'left'</span>] = create_KDTree(dataSet[:num], depth)</span><br><span class="line">        treeNode[<span class="string">'right'</span>] = create_KDTree(dataSet[num + <span class="number">1</span>:], depth)</span><br><span class="line">        <span class="keyword">return</span> treeNode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_KDTree</span><span class="params">(tree, data)</span>:</span></span><br><span class="line">    k = len(data)</span><br><span class="line">    <span class="keyword">if</span> tree <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>] * k, float(<span class="string">'inf'</span>)</span><br><span class="line"></span><br><span class="line">    split_axis = tree[<span class="string">'split'</span>]</span><br><span class="line">    median_point = tree[<span class="string">'median'</span>]</span><br><span class="line">    <span class="keyword">if</span> data[split_axis] &lt;= median_point[split_axis]:</span><br><span class="line">        point_nearest, distance_nearest = search_KDTree(tree[<span class="string">'left'</span>], data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        point_nearest, distance_nearest = search_KDTree(tree[<span class="string">'right'</span>], data)</span><br><span class="line"></span><br><span class="line">    distance = np.linalg.norm(data - median_point)</span><br><span class="line">    <span class="keyword">if</span> distance &lt; distance_nearest:</span><br><span class="line">        distance_nearest = distance</span><br><span class="line">        point_nearest = median_point.copy()</span><br><span class="line"></span><br><span class="line">    distance_split = abs(data[split_axis] - median_point[split_axis])</span><br><span class="line">    <span class="keyword">if</span> distance_split &gt; distance_nearest:</span><br><span class="line">        <span class="keyword">return</span> point_nearest, distance_nearest</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> data[split_axis] &lt;= median_point[split_axis]:</span><br><span class="line">            subtree = tree[<span class="string">'right'</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            subtree = tree[<span class="string">'left'</span>]</span><br><span class="line"></span><br><span class="line">        point_near, distance_neardistance = search_KDTree(subtree, data)</span><br><span class="line">        <span class="keyword">if</span> distance_neardistance &lt; distance_nearest:</span><br><span class="line">            distance_nearest = distance_neardistance</span><br><span class="line">            point_nearest = point_near.copy()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> point_nearest, distance_nearest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    dataMat, label = load_data(<span class="string">'test.txt'</span>)</span><br><span class="line">    fig = plt.figure(<span class="number">0</span>)</span><br><span class="line">    ax = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">    ax.scatter(dataMat[:, <span class="number">0</span>], dataMat[:, <span class="number">1</span>], c=label, cmap=plt.cm.Paired)</span><br><span class="line"></span><br><span class="line">    tree = create_KDTree(dataMat, <span class="number">0</span>)</span><br><span class="line">    print(tree)</span><br><span class="line"></span><br><span class="line">    point = [<span class="number">2</span>, <span class="number">4.5</span>]</span><br><span class="line">    nearpoint, neardis, = search_KDTree(tree, point)</span><br><span class="line">    ax.scatter(point[<span class="number">0</span>], point[<span class="number">1</span>], c=<span class="string">'g'</span>, s=<span class="number">50</span>)</span><br><span class="line">    ax.scatter(nearpoint[<span class="number">0</span>], nearpoint[<span class="number">1</span>], c=<span class="string">'r'</span>, s=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><p>Kd树在维度较小时（比如20、30），算法的查找效率很高，然而当数据维度增大（例如：K≥100），查找效率会随着维度的增加而迅速下降。假设数据集的维数为D，一般来说要求数据的规模N满足N&gt;&gt;2的D次方，才能达到高效的搜索。</p><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://www.joinquant.com/view/community/detail/c2c41c79657cebf8cd871b44ce4f5d97" target="_blank" rel="noopener">【量化课堂】kd 树算法之详细篇</a></li><li><a href="https://blog.csdn.net/FAICULTY/article/details/79474627" target="_blank" rel="noopener">K-D Tree 算法详解及Python实现</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（八）-RRT算法</title>
      <link href="/2021/03/28/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E5%85%AB%EF%BC%89-RRT%E7%AE%97%E6%B3%95/"/>
      <url>/2021/03/28/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E5%85%AB%EF%BC%89-RRT%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（七）-PRM算法</title>
      <link href="/2021/03/26/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%B8%83%EF%BC%89-PRM%E7%AE%97%E6%B3%95/"/>
      <url>/2021/03/26/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%B8%83%EF%BC%89-PRM%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>PRM (Probabilistic Roadmaps)是一种基于图搜索的方法，它将连续空间转换成离散空间，再利用A*等搜索算法在路线图上寻找路径的一种方法。其一共分为两个步骤：学习阶段和查询阶段。</p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h2 id="2-1-学习阶段"><a href="#2-1-学习阶段" class="headerlink" title="2.1 学习阶段"></a>2.1 学习阶段</h2><p>学习阶段的主要目标是在空间中按照一定分布（如均匀分布）采样N个点，利用碰撞检测等手段去除存在障碍物内的点，在利用线段将点与点进行连线，图下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-26-153732.png" alt="image-20210326233617280" style="zoom:50%;"></p><p>其中，蓝色的点为采样点，灰色区域为障碍物区域，红色框内的蓝色点为移除点。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-26-154006.png" alt="image-20210326233952178" style="zoom:50%;"></p><p>如下图所示，点与点的连接的准则：</p><ul><li>起始和终点节点要被连接到网络中</li><li>被连接的两个点之间满足一定距离约束，例如最近邻的几个点；此处，如果没有这个约束的话，最糟糕的情况是得到了全连通图，使得后期路径规划运行时间增加</li><li>如果两个点之间的连线经过障碍物，则这条线段不可连接</li></ul><h2 id="2-2-查询阶段"><a href="#2-2-查询阶段" class="headerlink" title="2.2 查询阶段"></a>2.2 查询阶段</h2><p>查询阶段的主要目标是在学习阶段构建的图中，基于起始和终点节点，寻找最短路径，常用的算法是采用A*等算法。此时，再利用A*算法，搜索过程会提升很大的性能。原因在于，PRM得到的图数据结构的复杂度远远低于直接将空间进行数据建模。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-26-154736.png" alt="image-20210326234736425" style="zoom:50%;"></p><p>其中，红色的线段就是寻找的路径。</p><h2 id="2-3-基于Lazy-collision-checking的PRM算法"><a href="#2-3-基于Lazy-collision-checking的PRM算法" class="headerlink" title="2.3 基于Lazy collision-checking的PRM算法"></a>2.3 基于Lazy collision-checking的PRM算法</h2><p>前文讲述的PRM算法，在学习阶段需要对所有的节点和节点之间的连线与障碍物进行碰撞检测，然后将碰撞的节点和边删除。当空间内采样点数量较大时，学习阶段很耗时。为了提升计算效率，基于Lazy collision-checking的PRM算法被提出来了。它的主要思想是在学习阶段，不进行碰撞检测，在查询阶段进行路径搜索时，将不可行的路段和节点再进行删除，重新进行规划。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-28-035508.png" alt="image-20210328115437368" style="zoom:50%;"></p><p>图中描述为在学习阶段随机采样点之后，对节点仅基于距离约束进行图的构建，此时不再考虑与障碍物的碰撞。图中蓝色的节点是不可行节点。基于该图结构，进行如下图所示的路径搜索，如下图红色线段所示。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-28-040708.png" alt="image-20210328115519680" style="zoom:50%;"></p><p>图中描述了基于上图中构建的图数据结构进行的路径搜索结果。很明显，红色的路径是不可通行路径，因为中间有节点落在障碍物区域内。此时，对图中与障碍物碰撞的节点和边进行删除，得到新的图数据结构，再运行路径搜索，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-28-044327.png" alt="image-20210328124322222" style="zoom:50%;"></p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">STAT_OBSTACLE = <span class="string">'#'</span></span><br><span class="line">STAT_NORMAL = <span class="string">'.'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoadMap</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, img_file)</span>:</span></span><br><span class="line">        test_map = []</span><br><span class="line">        img = Image.open(img_file)</span><br><span class="line">        img_gray = img.convert(<span class="string">'L'</span>)</span><br><span class="line">        img_arr = np.array(img_gray)</span><br><span class="line">        img_binary = np.where(img_arr &lt; <span class="number">127</span>, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(img_binary.shape[<span class="number">0</span>]):</span><br><span class="line">            temp_row = []</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(img_binary.shape[<span class="number">1</span>]):</span><br><span class="line">                status = STAT_OBSTACLE <span class="keyword">if</span> img_binary[x, y] == <span class="number">0</span> <span class="keyword">else</span> STAT_NORMAL</span><br><span class="line">                temp_row.append(status)</span><br><span class="line">            test_map.append(temp_row)</span><br><span class="line"></span><br><span class="line">        self.map = test_map</span><br><span class="line">        self.cols = len(self.map[<span class="number">0</span>])</span><br><span class="line">        self.rows = len(self.map)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_valid_xy</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt;= self.rows <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> y &gt;= self.cols:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">not_obstacle</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.map[x][y] != STAT_OBSTACLE</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">EuclidenDistance</span><span class="params">(self, xy1, xy2)</span>:</span></span><br><span class="line">        <span class="string">"""两个像素点之间的欧几里得距离"""</span></span><br><span class="line">        dis = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> (x1, x2) <span class="keyword">in</span> zip(xy1, xy2):</span><br><span class="line">            dis += (x1 - x2) ** <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> dis ** <span class="number">0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ManhattanDistance</span><span class="params">(self, xy1, xy2)</span>:</span></span><br><span class="line">        <span class="string">"""两个像素点之间的曼哈顿距离"""</span></span><br><span class="line">        dis = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> x1, x2 <span class="keyword">in</span> zip(xy1, xy2):</span><br><span class="line">            dis += abs(x1 - x2)</span><br><span class="line">        <span class="keyword">return</span> dis</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_path</span><span class="params">(self, xy1, xy2)</span>:</span></span><br><span class="line">        <span class="string">"""碰撞检测 两点之间的连线是否经过障碍物"""</span></span><br><span class="line">        steps = max(abs(xy1[<span class="number">0</span>] - xy2[<span class="number">0</span>]), abs(xy1[<span class="number">1</span>] - xy2[<span class="number">1</span>]))</span><br><span class="line">        xs = np.linspace(xy1[<span class="number">0</span>], xy2[<span class="number">0</span>], steps + <span class="number">1</span>)</span><br><span class="line">        ys = np.linspace(xy1[<span class="number">1</span>], xy2[<span class="number">1</span>], steps + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, steps):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.not_obstacle(math.ceil(xs[i]), math.ceil(ys[i])):</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plot</span><span class="params">(self, path)</span>:</span></span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(self.rows):</span><br><span class="line">            temp = []</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(self.cols):</span><br><span class="line">                <span class="keyword">if</span> self.map[x][y] == STAT_OBSTACLE:</span><br><span class="line">                    temp.append(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">elif</span> self.map[x][y] == STAT_NORMAL:</span><br><span class="line">                    temp.append(<span class="number">255</span>)</span><br><span class="line">                <span class="keyword">elif</span> self.map[x][y] == <span class="string">'*'</span>:</span><br><span class="line">                    temp.append(<span class="number">127</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    temp.append(<span class="number">255</span>)</span><br><span class="line">            out.append(temp)</span><br><span class="line">        <span class="keyword">for</span> x, y <span class="keyword">in</span> path:</span><br><span class="line">            out[x][y] = <span class="number">127</span></span><br><span class="line">        out = np.array(out)</span><br><span class="line">        img = Image.fromarray(np.uint8(out))</span><br><span class="line">        img.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">path_length</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="string">"""计算路径长度"""</span></span><br><span class="line">    l = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(path) - <span class="number">1</span>):</span><br><span class="line">        x1, y1 = path[i]</span><br><span class="line">        x2, y2 = path[i + <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> x1 == x2 <span class="keyword">or</span> y1 == y2:</span><br><span class="line">            l += <span class="number">1.0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l += <span class="number">1.4</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PRM</span><span class="params">(RoadMap)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, img_file, **param)</span>:</span></span><br><span class="line">        RoadMap.__init__(self, img_file)</span><br><span class="line"></span><br><span class="line">        self.num_sample = param[<span class="string">'num_sample'</span>] <span class="keyword">if</span> <span class="string">'num_sample'</span> <span class="keyword">in</span> param <span class="keyword">else</span> <span class="number">100</span></span><br><span class="line">        self.distance_neighbor = param[<span class="string">'distance_neighbor'</span>] <span class="keyword">if</span> <span class="string">'distance_neighbor'</span> <span class="keyword">in</span> param <span class="keyword">else</span> <span class="number">100</span></span><br><span class="line">        self.G = nx.Graph()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">learn</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> len(self.G.nodes) &lt; self.num_sample:</span><br><span class="line">            XY = (np.random.randint(<span class="number">0</span>, self.rows), np.random.randint(<span class="number">0</span>, self.cols))</span><br><span class="line">            <span class="keyword">if</span> self.is_valid_xy(XY[<span class="number">0</span>], XY[<span class="number">1</span>]) <span class="keyword">and</span> self.not_obstacle(XY[<span class="number">0</span>], XY[<span class="number">1</span>]):</span><br><span class="line">                self.G.add_node(XY)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> node1 <span class="keyword">in</span> self.G.nodes:</span><br><span class="line">            <span class="keyword">for</span> node2 <span class="keyword">in</span> self.G.nodes:</span><br><span class="line">                <span class="keyword">if</span> node1 == node2:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                dis = self.EuclidenDistance(node1, node2)</span><br><span class="line">                <span class="keyword">if</span> dis &lt; self.distance_neighbor <span class="keyword">and</span> self.check_path(node1, node2):</span><br><span class="line">                    self.G.add_edge(node1, node2, weight=dis)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_path</span><span class="params">(self, startXY=None, endXY=None)</span>:</span></span><br><span class="line">        temp_G = copy.deepcopy(self.G)</span><br><span class="line">        startXY = tuple(startXY) <span class="keyword">if</span> startXY <span class="keyword">else</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        endXY = tuple(endXY) <span class="keyword">if</span> endXY <span class="keyword">else</span> (self.rows - <span class="number">1</span>, self.cols - <span class="number">1</span>)</span><br><span class="line">        temp_G.add_node(startXY)</span><br><span class="line">        temp_G.add_node(endXY)</span><br><span class="line">        <span class="keyword">for</span> node1 <span class="keyword">in</span> [startXY, endXY]:</span><br><span class="line">            <span class="keyword">for</span> node2 <span class="keyword">in</span> temp_G.nodes:</span><br><span class="line">                dis = self.EuclidenDistance(node1, node2)</span><br><span class="line">                <span class="keyword">if</span> dis &lt; self.distance_neighbor <span class="keyword">and</span> self.check_path(node1, node2):</span><br><span class="line">                    temp_G.add_edge(node1, node2, weight=dis)</span><br><span class="line"></span><br><span class="line">        path = nx.shortest_path(temp_G, source=startXY, target=endXY)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.construct_path(path)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">construct_path</span><span class="params">(self, path)</span>:</span></span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(path) - <span class="number">1</span>):</span><br><span class="line">            xy1, xy2 = path[i], path[i + <span class="number">1</span>]</span><br><span class="line">            steps = max(abs(xy1[<span class="number">0</span>] - xy2[<span class="number">0</span>]), abs(xy1[<span class="number">1</span>] - xy2[<span class="number">1</span>]))</span><br><span class="line">            xs = np.linspace(xy1[<span class="number">0</span>], xy2[<span class="number">0</span>], steps + <span class="number">1</span>)</span><br><span class="line">            ys = np.linspace(xy1[<span class="number">1</span>], xy2[<span class="number">1</span>], steps + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, steps + <span class="number">1</span>):</span><br><span class="line">                out.append((math.ceil(xs[j]), math.ceil(ys[j])))</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    prm = PRM(<span class="string">'map_1.bmp'</span>, num_sample=<span class="number">200</span>, distance_neighbor=<span class="number">200</span>)</span><br><span class="line">    prm.learn()</span><br><span class="line">    path = prm.find_path()</span><br><span class="line">    prm.plot(path)</span><br><span class="line">    print(<span class="string">'Path length:'</span>, path_length(path))</span><br></pre></td></tr></table></figure><p>参考：<a href="https://github.com/chenjm1109/robotics_tutorial_for_zhihu" target="_blank" rel="noopener">https://github.com/chenjm1109/robotics_tutorial_for_zhihu</a></p><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><ul><li>优点<ul><li>概率完备的，即在空间中存在解，能够找到解</li><li>相对比于A*算法，更加高效</li></ul></li><li>缺点<ul><li>搜索到的路径是由两个点组成的线段，不利于机器人轨迹规划</li><li>阶段冗余，路径规划算法的目标是找到一条路径，PRM算法提出了基于学习和查询的两个阶段。其实，在学习阶段就已经构造除了路径</li></ul></li><li>参数影响<ul><li>对同一地图，采样点的数量越多，找到合理路径以及更优路径的概率就越大。但同时，采样点数量越多，计算与搜索时间也会更长</li><li>邻域的设置影响着连线的建立与检测。当邻域设置过小，由于连线路径太少，可能找不到解；当领域设置太大，会检测太多较远的点之间的连线，而增加耗时</li><li>抽样方法的完备性很弱，即使空间中存在合理的路径，由于抽样参数的设置问题，也可能无法找到路径；另外，由于抽样过程的随机性，该方法的稳定性也不好，对于同样的问题，前后两次的解也不一样，因此在严格要求稳定性的场合并不适用</li></ul></li></ul><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/65673502" target="_blank" rel="noopener">概率路线图(PRM)方法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（六）-JPS算法</title>
      <link href="/2021/03/22/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E5%85%AD%EF%BC%89-JPS%E7%AE%97%E6%B3%95/"/>
      <url>/2021/03/22/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E5%85%AD%EF%BC%89-JPS%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>JPS （Jump Point Search），又名跳点搜索算法，是由澳大利亚两位教授于 2011年提出的基于栅格的寻路算法。是对<a href="https://vslam.net/2021/03/20/route_planning/路径规划（五）-A-Star算法/" target="_blank" rel="noopener">A*算法</a>的一个改进。JSP优化了A/<em>搜索后继节点的操作。A\</em>的处理是把周边能搜索到的格子，加进OpenList，然后在OpenList中弹出最小值。JPS先用一种更高效的方法来搜索需要加进OpenList的点，然后在OpenList中弹出最小值。JPS完整地保留了A*的框架。</p><p>只针对于路径的对称性，在<a href="https://vslam.net/2021/03/20/route_planning/路径规划（五）-A-Star算法/" target="_blank" rel="noopener">A*算法</a>中，介绍了一些简单的优化方法，例如，通过人为地加入某些规则使原本对称的节点计算出的f(n)有微小的偏差，使A*有一定的倾向性。而 JPS 的本质也是打破平衡性，它是一个更系统的方法。</p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h2 id="2-1-数据结构"><a href="#2-1-数据结构" class="headerlink" title="2.1 数据结构"></a>2.1 数据结构</h2><p>寻路过程中需要保存有效点的集合，分为可探索点集合openList，已探索点集合closeList。同A*算法，g(n)为起点经过其他点到当前点的代价和，h(n)为到目标点的代价，f(n)为当前点的与起点终点间价值的和，即f(n)=g(n) + h(n)。</p><h2 id="2-2-强迫邻居"><a href="#2-2-强迫邻居" class="headerlink" title="2.2 强迫邻居"></a>2.2 强迫邻居</h2><p>JPS算法主要考虑当前节点需要考虑的下一个节点是否应该被考虑。例如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-22-160056.png" alt="image-20210322234857819" style="zoom:50%;"></p><p>假设x节点为当前节点，考虑x节点的8邻域节点且终点目标在x节点的右侧。那么，x节点要考虑的节点仅包含5号节点，其余节点不需要再被扩展。规则为：如果x的下一个节点能够从x的父节点扩展得到，那么x节点就不需要扩展该节点。例如，节点3，可以从x的父节点4，通过路径4 -&gt; 2 -&gt; 3到达，与路径4 -&gt; x -&gt; 5代价一样，因此，节点3不需要被考虑扩展。同理，节点1、2、3、4、6、7和8都不惜要再被扩展。</p><p>同理，对于斜对角线情况，对于当前节点x，其父节点为6，那么对于节点2, 5和3，需要被考虑进行扩展，因为坐着几个节点从x的父节点6到达的成本高于从x到达的成本。其余结点。例如1, 4, 7, 8就不需要再被扩展。</p><p>接下来，我们在考虑包含障碍物的空间。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-22-160103.png" alt="image-20210323000047515" style="zoom:50%;"></p><p>在上述图中，黑色为障碍物，节点x为当前节点，节点4为节点x的父节点，此时，除了节点5需要被考虑扩展以外，节点3也需要被考虑。原因在于节点3不能够通过节点4以低成本的方式绕过x到达。同理，对于右侧的图例，节点1也需要被扩展考虑。</p><h2 id="2-3-跳点"><a href="#2-3-跳点" class="headerlink" title="2.3 跳点"></a>2.3 跳点</h2><p>在路径上改变移动方向的点就是跳跃点。当前点x是跳跃点满足以下三个条件之一：</p><ul><li>节点 x 是起点/终点</li><li>节点 x 至少有一个强迫邻居</li><li>如果父节点在斜方向（意味着这是斜向搜索），节点x的水平或垂直方向上有满足条件a，b的点</li></ul><p>不是跳跃点的节点都可以在扩展时不被考虑。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-22-161241.png" alt="image-20210323001231568" style="zoom:50%;"></p><p>对于节点X和节点y，都是跳跃点，那么节点x和节点y之间的节点就不需要被扩展。</p><p>对于对角线情况，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-22-161445.png" alt="image-20210323001436747" style="zoom:50%;"></p><p>对于节点x和节点y，二者都是跳跃点。但是，在进行斜对角线跳跃前，都需要先进行竖直和水平方向的跳跃检测。从上图中可以看出，节点x和节点y之间的节点进行水平和竖直方向跳跃都失败了，没有找到跳跃点。直到运行到节点y。</p><h2 id="2-4-算法原理"><a href="#2-4-算法原理" class="headerlink" title="2.4 算法原理"></a>2.4 算法原理</h2><ul><li>第一步，open list取一个权值最低的节点，然后开始搜索</li><li>先进行直线搜索（4/8个方向，跳跃搜索），然后再斜向搜索（4个方向，只搜索一步）。如果期间某个方向搜索到跳点或者碰到障碍（或边界），则当前方向完成搜索，若有搜到跳点就添加进open list</li><li>若斜方向没完成搜索，则斜方向前进一步</li><li>若所有方向已完成搜索，则认为当前节点搜索完毕，将当前节点移除于open list，加入close list</li><li>重复取open list权值最低节点搜索，直到open list为空或者找到终点</li></ul><p>下面结合实际情况进行讲解。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-23-150151.png" alt="image-20210323230140921" style="zoom:50%;"></p><p>图中，绿色节点为当前节点，黑色节点为障碍物。首先，对于绿色节点，进行水平和竖直方向搜索，均没有找到跳点；那么进行斜向搜索，向前行进一步，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-23-150442.png" alt="image-20210323230427931" style="zoom:50%;"></p><p>此时，当前节点的情况类似于绿色节点，依然在水平和竖直方向没有找到跳点，那么沿着对角线方向移动，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-23-150722.png" alt="image-20210323230708886" style="zoom:50%;"></p><p>继续运行，当移动到下一个结点时，此时，水平方向发现一个跳跃点，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-23-151001.png" alt="image-20210323230943910" style="zoom:50%;"></p><p>此时，蓝色节点为关键节点，因为它能够找到一个跳跃点。此时，将蓝色结点放入open list中。斜方向结束，绿色节点的搜索过程也就此结束，被移除于open list，放入close list。</p><p>对open list下一个权值最低的节点，即蓝色节点，开启搜索。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-23-151449.png" alt="image-20210323231436306" style="zoom:50%;"></p><p>在直线方向上发现了黄色节点为跳点（依据是紫色节点为强迫邻居），类似地，放入open list。由于斜方向还没结束，继续前进一步。最后一次直线搜索和斜向搜索都碰到了边界，因此蓝色节点搜索完成，移除于open list，放入close list中。一次进行，直到到达终点为止。</p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><p>参考：<a href="https://github.com/sahibdhanjal/Path-Planning-Simulator" target="_blank" rel="noopener">https://github.com/sahibdhanjal/Path-Planning-Simulator</a></p><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://www.cnblogs.com/KillerAery/p/12242445.html" target="_blank" rel="noopener">JPS/JPS+ 寻路算法</a></li><li><a href="http://qiao.github.io/PathFinding.js/visual/" target="_blank" rel="noopener">Path Finding</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学术会议</title>
      <link href="/2021/03/20/science/%E5%AD%A6%E6%9C%AF%E4%BC%9A%E8%AE%AE/"/>
      <url>/2021/03/20/science/%E5%AD%A6%E6%9C%AF%E4%BC%9A%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-学术会议追踪"><a href="#2-学术会议追踪" class="headerlink" title="2. 学术会议追踪"></a>2. 学术会议追踪</h1><div class="table-container"><table><thead><tr><th>序号</th><th>会议名称</th><th>会议日期</th><th>截稿日期</th><th>会议地点</th><th>领域</th></tr></thead><tbody><tr><td>1</td><td><a href="http://cvpr2021.thecvf.com/" target="_blank" rel="noopener">IEEE CVPR</a></td><td>Jun 19 - Jun 25, 2021</td><td>Deadline: 2020-11-16<br>Abstract: 2020-11-16<br>Notification: 2021-02-28</td><td>Virtual</td><td>CV</td></tr><tr><td>2</td><td><a href="http://iccv2021.thecvf.com/" target="_blank" rel="noopener">IEEE ICCV</a></td><td>Oct 11 - Oct 17, 2021</td><td>Deadline: 2021-03-17<br>Abstract: 2021-03-10<br>Notification: 2021-07-22<br>Camera Ready: 2021-08-17</td><td>Montreal, Canada</td><td>CV</td></tr><tr><td>3</td><td><a href="https://iclr.cc/" target="_blank" rel="noopener">ICLR</a></td><td>May 04 - May 08, 2021</td><td>Deadline: 2020-10-02<br>Abstract: 2020-09-28<br>Notification: 2021-01-12</td><td>Virtual</td><td>AI</td></tr><tr><td>4</td><td><a href="https://nips.cc/" target="_blank" rel="noopener">NeurIPS</a></td><td>Dec 06 - Dec 14, 2021</td><td>Deadline: 2021-05-26<br>Abstract: 2021-05-19<br>Notification: 2021-09-28<br>Camera Ready: 2021-10-26</td><td>Virtual</td><td>AI</td></tr><tr><td>5</td><td><a href="https://icml.cc/" target="_blank" rel="noopener">ACM ICML</a></td><td>Jul 18 - Jul 24, 2021</td><td>Deadline: 2021-02-04<br>Abstract: 2021-01-28<br>Notification: 2021-05-08<br>Camera Ready: 2021-06-10</td><td>Virtual</td><td>AI</td></tr><tr><td>6</td><td><a href="https://eccv2020.eu/" target="_blank" rel="noopener">ECCV</a></td><td>Aug 23 - Aug 28, 2020</td><td>-</td><td>-</td><td>CV</td></tr><tr><td>7</td><td><a href="https://aaai.org/Conferences/AAAI-21/" target="_blank" rel="noopener">AAAI</a></td><td>Feb 2 - Feb 9, 2021</td><td>-</td><td>Vancouver, Canada</td><td>A</td></tr><tr><td>8</td><td><a href="https://ijcai-21.org/" target="_blank" rel="noopener">IJCAI</a></td><td>Jan 5 - Jan 11, 2021</td><td>Deadline: 2021-01-20<br>Abstract: 2021-01-13<br>Notification: 2021-04-30</td><td>Kyoto, Japan</td><td>AI</td></tr><tr><td>9</td><td><a href="http://ubicomp.org/ubicomp2021/" target="_blank" rel="noopener">ACM UbiComp</a></td><td>Sep 11 - Sep 15, 2021</td><td>Deadline: 2021-05-15<br>Abstract: 2021-05-15<br>Notification: 2021-07-04<br>Camera Ready: 2021-07-30</td><td>Cancun, Mexico</td><td>MC</td></tr><tr><td>10</td><td><a href="https://www.sigmobile.org/mobicom/2021/" target="_blank" rel="noopener">ACM MobiCom</a></td><td>Oct 25 - Oct 30, 2021</td><td>Deadline: 2021-03-26<br>Abstract: 2021-03-19<br>Notification: 2021-06-11</td><td>New Orleans, USA</td><td>MC</td></tr><tr><td>11</td><td><a href="https://www.kdd.org/kdd2021/" target="_blank" rel="noopener">ACM KDD</a></td><td>Aug 14 - Aug 18, 2021</td><td>Deadline: 2021-02-08<br>Abstract: 2021-02-08<br>Notification: 2021-05-17<br>Camera Ready: 2021-06-17</td><td>Singapore, Singapore</td><td>AI</td></tr><tr><td>12</td><td><a href="https://icml.cc/" target="_blank" rel="noopener">ACM ICML</a></td><td>Jul 18 - Jul 24, 2021</td><td>Deadline: 2021-02-04<br>Abstract: 2021-01-28<br>Notification: 2021-05-08<br>Camera Ready: 2021-06-10</td><td>Virtual</td><td>AI</td></tr><tr><td>13</td><td><a href="https://www.sigmobile.org/mobisys/2021/" target="_blank" rel="noopener">ACM MobiSys</a></td><td>Jun 15 - Jun 19, 2021</td><td>Deadline: 2021-01-15<br>Abstract: 2021-01-08<br>Notification: 2021-03-25</td><td>Virtual</td><td>MC</td></tr><tr><td>14</td><td><a href="http://www2021.thewebconf.org/" target="_blank" rel="noopener">Springer WWW</a></td><td>Apr 19 - Apr 23, 2021</td><td>Deadline: 2020-10-19<br>Abstract: 2020-10-12<br>Notification: 2021-01-15</td><td>Ljubljana, Slovenia</td><td>AI</td></tr><tr><td>15</td><td><a href="http://icra2021.org/" target="_blank" rel="noopener">IEEE ICRA</a></td><td>May 30 - June 5, 2021</td><td>Deadline: 2020-10-31<br>Notification: 2021-02-28</td><td>Xi’an, China</td><td>AI</td></tr><tr><td>16</td><td><a href="https://www.iros2021.org/" target="_blank" rel="noopener">IEEE/RSJ IROS</a></td><td>Sep 27 -OCT 1, 2021</td><td>Deadline: 2021-03-01<br>Notification: 2021-06-30</td><td>Prague, Czech Republic</td></tr></tbody></table></div><h1 id="3-总结和讨论"><a href="#3-总结和讨论" class="headerlink" title="3. 总结和讨论"></a>3. 总结和讨论</h1>]]></content>
      
      
      <categories>
          
          <category> 学术 </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学术 </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（五）-A-Star算法</title>
      <link href="/2021/03/20/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%BA%94%EF%BC%89-A-Star%E7%AE%97%E6%B3%95/"/>
      <url>/2021/03/20/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%BA%94%EF%BC%89-A-Star%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>回顾<a href="https://vslam.net/2020/10/08/route_planning/路径规划（三）-Dijkstra算法/" target="_blank" rel="noopener">Dijkstra算法</a>，基于广度优先搜索策略来遍历空间内所有节点，最终计算出全局最优的路径。那么它的计算量就会非常大。前面我们也介绍了基于启发式的<a href="https://vslam.net/2021/03/11/route_planning/路径规划（二）-贪婪最佳优先算法/" target="_blank" rel="noopener">贪婪最佳优先算法</a>，速度快，但是结果可能不是最优的。那么，如何将二者的优势结合呢，即在Dijkstra算法基础上，引入启发式策略。这就是A*算法。</p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><p>A*算法的代价函数表示方程式为：$f(n) = g(n) + h(n)$，$g(n)$表示从起始节点到当前节点所需要的代价，$h(n)$表示从当前节点到目标节点所需要的代价，$f(n)$取决于$g(n)$与$h(n)$。为了对这两个值进行相加，这两个值必须使用相同的衡量单位。如果$g(n)$用小时来衡量而$h(n)$用米来衡量，那么A*将会认为$g$或者$h$太大或者太小，因而将不能得到正确的路径，同时A*算法将运行得更慢。</p><h2 id="2-1-启发式函数"><a href="#2-1-启发式函数" class="headerlink" title="2.1 启发式函数"></a>2.1 启发式函数</h2><p>启发式函数可以控制A*的行为：</p><ul><li>一种极端情况，如果$h(n)$是0，则只有$g(n)$起作用，此时A*演变成Dijkstra算法，这保证能找到最短路径</li><li>如果$h(n)$经常都比从n移动到目标的实际代价小（或者相等），则A*保证能找到一条最短路径。$h(n)$越小，A*扩展的结点越多，运行就得越慢</li><li>如果$h(n)$精确地等于从n移动到目标的代价，则A*将会仅仅寻找最佳路径而不扩展别的任何结点，这会运行得非常快。尽管这不可能在所有情况下发生，你仍可以在一些特殊情况下让它们精确地相等</li><li>如果$h(n)$有时比从n移动到目标的实际代价高，则A*不能保证找到一条最短路径，但它运行得更快</li><li>另一种极端情况，如果$h(n)$比$g(n)$大很多，则只有$h(n)$起作用，A*演变成BFS算法</li></ul><p>如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-055251.png" alt="image-20210320135224845" style="zoom:50%;"></p><p>（参考：<a href="https://www.shenlanxueyuan.com/course/315" target="_blank" rel="noopener">《移动机器人运动规划》</a>）</p><p>从上述分析中得出，启发式函数$h(n)$对于A*算法的运行结合和计算速度起到关键作用。那么启发式函数的设计有如下几种：</p><ul><li><p>预计算的精确启发式函数</p><ul><li><p>构造精确启发函数的一种方法是预先计算任意一对结点之间最短路径的长度，启发式函数可以是：</p><p>  h(n) = h’(n, w1) + distance(w1, w2) + h’(w2, goal)</p></li></ul></li><li><p>线性精确启发式算法</p><ul><li>从初始点到目标的最短路径应该是一条直线</li></ul></li><li><p>网格地图中的启发式算法</p><ul><li>曼哈顿距离（Manhattan distance）<ul><li>两点在南北方向上的距离加上在东西方向上的距离，即D（I，J）=|XI-XJ|+|YI-YJ|，对于一个具有正南正北、正东正西方向规则布局的城镇街道，从一点到达另一点的距离正是在南北方向上旅行的距离加上在东西方向上旅行的距离因此曼哈顿距离又称为出租车距离，曼哈顿距离不是距离不变量，当坐标轴变动时，点间的距离就会不同</li><li>从一个位置移动到邻近位置的最小代价D，也可以是曼哈顿距离的D倍：H(n) = D * (abs ( n.x – goal.x ) + abs ( n.y – goal.y ) )</li></ul></li><li>欧几里得距离<ul><li>沿着任意角度移动（而不是网格方向），使用直线距离：h(n) = D * sqrt((n.x-goal.x)^2 + (n.y-goal.y)^2)</li></ul></li><li>Breaking ties<ul><li>导致低性能的一个原因来自于启发函数的ties，即当某些路径具有相同的f值的时候，它们都会被搜索（explored），尽管我们只需要搜索其中的一条</li><li>为了解决这个问题，可以为启发函数添加一个附加值，附加值对于结点必须是确定性的（也就是说，不能是随机的数），而且它必须让f值体现区别，即heuristic *= (1.0 + p)，选择因子p使得p &lt; 移动一步（step）的最小代价 / 期望的最长路径长度。假设你不希望你的路径超过1000步（step），你可以使p = 1 / 1000。添加这个附加值的结果是，A*比以前搜索的结点更少了</li></ul></li></ul></li></ul><h2 id="2-2-A-算法流程"><a href="#2-2-A-算法流程" class="headerlink" title="2.2 A*算法流程"></a>2.2 A*算法流程</h2><p>A*算法的流程与Dijkstra算法一样，只不过计算成本函数时，f(n)由g(n)和h(n)共同确定。算法伪代码如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-052841.png" alt="image-20210320132804095" style="zoom:50%;"></p><p>（参考：<a href="https://www.shenlanxueyuan.com/course/315" target="_blank" rel="noopener">《移动机器人运动规划》</a>）</p><p>A*算法实例如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-053438.png" alt="image-20210320133221193" style="zoom:50%;"></p><p>（参考：<a href="https://www.shenlanxueyuan.com/course/315" target="_blank" rel="noopener">《移动机器人运动规划》</a>）</p><ul><li>起点为S，终点为G</li><li>初始化优先队列，仅有一个元素S</li><li>扩展S，子节点为a，那么a的成本值为1，将a放入优先队列中</li><li>扩展a，子节点包括b, d, e，那么b的成本值为8=1+1+6，b的成本值为6=1+3+2，e的成本值为7=1+5+1，可以看出d的成本值最小，将d弹出并扩展d的子节点</li><li>扩展d，d只有1个子节点，G，成本值为6=2+4+0</li><li>G节点已是目标节点，算法结束</li></ul><h2 id="2-3-A-算法的最优性分析"><a href="#2-3-A-算法的最优性分析" class="headerlink" title="2.3 A*算法的最优性分析"></a>2.3 A*算法的最优性分析</h2><p>A*算法的最优性取决于启发式函数的设计。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-054141.png" alt="image-20210320134133490" style="zoom:50%;"></p><p>（参考：<a href="https://www.shenlanxueyuan.com/course/315" target="_blank" rel="noopener">《移动机器人运动规划》</a>）</p><p>按照A*算法的流程，我们得到路径为S-&gt;G。但是，很明显，我们发现中最有路径是S-&gt;G。那么，产生这种情况的原因是什么呢？就是在计算A节点的启发式函数值的时候，大于实际路径的数值，即6大于实际路径的数值。因此，如果启发式函数是admissible的，即$h(n) &lt; h^{<em>}(n)$，其中，$h_{</em>}(n)$表示实际路径的启发式值，那么A*算法能够找到最优路径。</p><h2 id="2-4-A-算法的优化分析"><a href="#2-4-A-算法的优化分析" class="headerlink" title="2.4 A*算法的优化分析"></a>2.4 A*算法的优化分析</h2><p>在A*算法中，如果存在多条相同f(n)的数值时，就会扩展很多节点，产生不必要的计算成本。为了解决这个问题，采用Breaking ties策略，即让多个本来具有相同的f(n)值的路径变得不同，核心思想就是对于具有相同f(n)值的路径，具有倾向性来选择其中一条。实现方法包括如下几种：</p><ul><li><p>对h进行扰动，如下图公式所示：</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-055303.png" alt="image-20210320135123263" style="zoom:50%;"></p><ul><li><p>效果图如下图所示，其中，左图表示多条路径具有相同f(n)值的路径所扩展的节点，右图表示对相同的f(n)添加扰动，所搜索的节点：</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-055351.png" alt="image-20210320135337713" style="zoom:50%;"></p></li><li><p>上述算法在工程应用中的优化，计算效率可提升20-50倍</p></li><li>此外，由于对f(n)增加了扰动，可能会导致h(n)不是精确等同于实际路径的h(n)值，打破了A*算法的最优性。但是，由于实际场景中存在大量的障碍物，这种小扰动并不会打破A*算法的最优性</li></ul></li><li><p>对f(n)排序后，再对h(n)进行排序</p></li><li><p>添加倾向性，对于靠近起点和终点之间的连线最近的路径，如下图所示：</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-060506.png" alt="image-20210320140458508" style="zoom:50%;"></p><ul><li><p>将倾向性的值，cross增加到h(n)中，效果如下图所示：</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-060606.png" alt="image-20210320140558958" style="zoom:50%;"></p></li></ul></li></ul><p>此外，Tie Breaker也具有如下的局限性，当含有障碍物时，找到的路径虽然也是最优的，但是对于后续应用可能不是最优的。如下图所示，找到的最优路径是折线段组成的路径，其他最优路径也包括红色曲线路径。对于后续的轨迹规划任务来说，红色曲线的路径更加具有优势，因为他更加平滑。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-20-061043.png" alt="image-20210320141031211" style="zoom:50%;"></p><p>（参考：<a href="https://www.shenlanxueyuan.com/course/315" target="_blank" rel="noopener">《移动机器人运动规划》</a>）</p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, seed</span><br><span class="line"></span><br><span class="line">seed(<span class="number">20000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchEntry</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x, y, g_cost, f_cost=<span class="number">0</span>, pre_entry=None)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line">        self.g_cost = g_cost</span><br><span class="line">        self.f_cost = f_cost</span><br><span class="line">        self.pre_entry = pre_entry</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPos</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'x = &#123;&#125;, y = &#123;&#125;, f = &#123;&#125;'</span>.format(str(self.x), str(self.y), str(self.f_cost))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Map</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, width, height)</span>:</span></span><br><span class="line">        self.width = width</span><br><span class="line">        self.height = height</span><br><span class="line">        self.map = [[<span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(self.width)] <span class="keyword">for</span> y <span class="keyword">in</span> range(self.height)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createBlock</span><span class="params">(self, block_num)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(block_num):</span><br><span class="line">            x, y = (randint(<span class="number">0</span>, self.width - <span class="number">1</span>), randint(<span class="number">0</span>, self.height - <span class="number">1</span>))</span><br><span class="line">            self.map[y][x] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generatePos</span><span class="params">(self, rangeX, rangeY)</span>:</span></span><br><span class="line">        x, y = (randint(rangeX[<span class="number">0</span>], rangeX[<span class="number">1</span>]), randint(rangeY[<span class="number">0</span>], rangeY[<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">while</span> self.map[y][x] == <span class="number">1</span>:</span><br><span class="line">            x, y = (randint(rangeX[<span class="number">0</span>], rangeX[<span class="number">1</span>]), randint(rangeY[<span class="number">0</span>], rangeY[<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">return</span> (x, y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">showMap</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"+"</span> * (<span class="number">3</span> * self.width + <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> self.map:</span><br><span class="line">            s = <span class="string">'+'</span></span><br><span class="line">            <span class="keyword">for</span> entry <span class="keyword">in</span> row:</span><br><span class="line">                s += <span class="string">' '</span> + str(entry) + <span class="string">' '</span></span><br><span class="line">            s += <span class="string">'+'</span></span><br><span class="line">            print(s)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"+"</span> * (<span class="number">3</span> * self.width + <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AStarSearch</span><span class="params">(map, source, dest)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getNewPosition</span><span class="params">(map, locatioin, offset)</span>:</span></span><br><span class="line">        x, y = (location.x + offset[<span class="number">0</span>], location.y + offset[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> x &gt;= map.width <span class="keyword">or</span> y &lt; <span class="number">0</span> <span class="keyword">or</span> y &gt;= map.height <span class="keyword">or</span> map.map[y][x] == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">return</span> (x, y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPositions</span><span class="params">(map, location)</span>:</span></span><br><span class="line">        offsets = [(<span class="number">-1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">-1</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">0</span>, <span class="number">1</span>)]</span><br><span class="line">        poslist = []</span><br><span class="line">        <span class="keyword">for</span> offset <span class="keyword">in</span> offsets:</span><br><span class="line">            pos = getNewPosition(map, location, offset)</span><br><span class="line">            <span class="keyword">if</span> pos <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">                poslist.append(pos)</span><br><span class="line">        <span class="keyword">return</span> poslist</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calHeuristic</span><span class="params">(pos, dest)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> abs(dest.x - pos[<span class="number">0</span>]) + abs(dest.y - pos[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getMoveCost</span><span class="params">(location, pos)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> location.x != pos[<span class="number">0</span>] <span class="keyword">and</span> location.y != pos[<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1.4</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isInList</span><span class="params">(list, pos)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> pos <span class="keyword">in</span> list:</span><br><span class="line">            <span class="keyword">return</span> list[pos]</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">addAdjacentPositions</span><span class="params">(map, location, dest, openlist, closedlist)</span>:</span></span><br><span class="line">        poslist = getPositions(map, location)</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> poslist:</span><br><span class="line">            <span class="keyword">if</span> isInList(closedlist, pos) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            findEntry = isInList(openlist, pos)</span><br><span class="line">            h_cost = calHeuristic(pos, dest)</span><br><span class="line">            g_cost = location.g_cost + getMoveCost(location, pos)</span><br><span class="line">            <span class="keyword">if</span> findEntry <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                openlist[pos] = SearchEntry(pos[<span class="number">0</span>], pos[<span class="number">1</span>], g_cost, g_cost + h_cost, location)</span><br><span class="line">            <span class="keyword">elif</span> findEntry.g_cost &gt; g_cost:</span><br><span class="line">                findEntry.g_cost = g_cost</span><br><span class="line">                findEntry.f_cost = g_cost + h_cost</span><br><span class="line">                findEntry.pre_entry = location</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getFastPosition</span><span class="params">(openlist)</span>:</span></span><br><span class="line">        fast = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">for</span> entry <span class="keyword">in</span> openlist.values():</span><br><span class="line">            <span class="keyword">if</span> fast <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                fast = entry</span><br><span class="line">            <span class="keyword">elif</span> fast.f_cost &gt; entry.f_cost:</span><br><span class="line">                fast = entry</span><br><span class="line">        <span class="keyword">return</span> fast</span><br><span class="line"></span><br><span class="line">    openlist, closedlist = &#123;&#125;, &#123;&#125;</span><br><span class="line">    location = SearchEntry(source[<span class="number">0</span>], source[<span class="number">1</span>], <span class="number">0.0</span>)</span><br><span class="line">    dest = SearchEntry(dest[<span class="number">0</span>], dest[<span class="number">1</span>], <span class="number">0.0</span>)</span><br><span class="line">    openlist[source] = location</span><br><span class="line">    print(openlist)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        location = getFastPosition(openlist)</span><br><span class="line">        <span class="keyword">if</span> location <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            print(<span class="string">"can't find valid path"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> location.x == dest.x <span class="keyword">and</span> location.y == dest.y:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        closedlist[location.getPos()] = location</span><br><span class="line">        openlist.pop(location.getPos())</span><br><span class="line">        addAdjacentPositions(map, location, dest, openlist, closedlist)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> location <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        map.map[location.y][location.x] = <span class="number">2</span></span><br><span class="line">        location = location.pre_entry</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    WIDTH = <span class="number">10</span></span><br><span class="line">    HEIGHT = <span class="number">10</span></span><br><span class="line">    BLOCK_NUM = <span class="number">15</span></span><br><span class="line">    map = Map(WIDTH, HEIGHT)</span><br><span class="line">    map.createBlock(BLOCK_NUM)</span><br><span class="line"></span><br><span class="line">    source = map.generatePos((<span class="number">0</span>, WIDTH // <span class="number">3</span>), (<span class="number">0</span>, HEIGHT // <span class="number">3</span>))</span><br><span class="line">    dest = map.generatePos((WIDTH // <span class="number">2</span>, WIDTH - <span class="number">1</span>), (HEIGHT // <span class="number">2</span>, HEIGHT - <span class="number">1</span>))</span><br><span class="line">    print(<span class="string">"source:"</span>, source)</span><br><span class="line">    print(<span class="string">"dest:"</span>, dest)</span><br><span class="line"></span><br><span class="line">    AStarSearch(map, source, dest)</span><br><span class="line"></span><br><span class="line">    map.showMap()</span><br></pre></td></tr></table></figure><p>（参考：<a href="https://blog.csdn.net/marble_xu/article/details/87882921" target="_blank" rel="noopener">python寻路算法：A* 算法实现</a>）</p><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><ul><li>局限性<ul><li>A*的时间复杂度是和节点数量以及起始点难度呈幂函数正相关的</li></ul></li></ul><ul><li>算法对比</li></ul><div class="table-container"><table><thead><tr><th>序号</th><th>算法</th><th>主要思想</th><th>优缺点</th></tr></thead><tbody><tr><td>1</td><td>BFS</td><td>按照宽度向外扩展节点</td><td>可以找到最优解，但计算复杂度高</td></tr><tr><td>2</td><td>DFS</td><td>按照深度向外扩展节点</td><td>可以找到最优解，计算复杂度高</td></tr><tr><td>3</td><td>GBFS</td><td>按照宽度以一定朝向扩展节点</td><td>计算复杂度相对较低，但可能无法找到最优解</td></tr><tr><td>4</td><td>Dijkstra</td><td>按照一定宽度以一定成本函数值向外扩展节点，f(n) = g(n)</td><td>完备的且最优的，但计算复杂度较高</td></tr><tr><td>5</td><td>A*</td><td>按照一定宽度以一定成本函数值向外扩展节点，f(n) = g(n) + h(n)</td><td>依赖于启发式函数的选取，可达到完备的且最优的，但计算复杂度较高</td></tr></tbody></table></div><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://blog.csdn.net/marble_xu/article/details/87882921" target="_blank" rel="noopener">python寻路算法：A* 算法实现</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（二）-贪婪最佳优先算法</title>
      <link href="/2021/03/11/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%BA%8C%EF%BC%89-%E8%B4%AA%E5%A9%AA%E6%9C%80%E4%BD%B3%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/"/>
      <url>/2021/03/11/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%BA%8C%EF%BC%89-%E8%B4%AA%E5%A9%AA%E6%9C%80%E4%BD%B3%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>本小节介绍基于启发式的搜索算法。前文我们介绍了BFS和DFS，他们的区别主要在于节点的弹出策略，根据弹出策略的区别，分别使用了队列和栈两种数据结构，而栈和队列作为两种相当基本的容器，只将节点进入容器的顺序作为弹出节点的依据，并未考虑目标位置等因素，这就使搜索过程变得漫无目的，导致效率低下。</p><p>启发式搜索算法 (Heuristic Algorithm) 就是用来解决搜索效率问题的。一个Heuristic的定义就是当前位置到终点有多远的猜测。在实际使用中，从当前位置到终点的最短路径是无法得知的，除非已经完成搜索。因此，在搜索过程中，只能够猜测当前位置到终点的距离。当前，这种猜测主要基于启发式函数来实现，例如欧氏距离，曼哈顿距离等。如下图所示，黄色线段表示欧氏距离的猜测，绿色线段表示曼哈顿距离的猜测。此外，这种启发式函数在实际应用中，应该是比较容易计算的。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-11-155024.png" alt="image-20210311235024192" style="zoom:50%;"></p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><p>最佳优先搜索算法在广度优先搜索的基础上，用启发估价函数对将要被遍历到的点进行估价，然后选择代价小的进行遍历，直到找到目标节点或者遍历完所有点，算法结束。</p><p>在图搜索算法中，$f(n)$使用代价函数来作为优先级判断的标准，$f(n)$越小，优先级越高，反之优先级越低。GBFS作为一种启发式搜索算法，使用启发评估函数$f(n)$来作为代价函数，即当前节点到终点的代价，它可以指引搜索算法往终点靠近，主要用欧氏距离(Euclidean Distance)或者曼哈顿距离(Manhattan Distance)来表示。有了该代价函数，GBFS在搜索过程中极具方向性，应用在二维地图路径规划中，它的指向性或者说目的非常明显，从起点直扑终点。但是，在实际的地图中，常常会有很多障碍物，它就很容易陷入局部最优的陷阱。</p><p>算法主要思想：要实现最佳优先搜索我们必须使用一个优先队列（priority queue）来实现，通常采用一个open优先队列和一个closed集，open优先队列用来储存还没有遍历将要遍历的节点，而closed集用来储存已经被遍历过的节点。</p><p>算法时间空间复杂度分析：时间复杂度：O(b^m )，空间复杂度：O(b^m ).<br>算法步骤：</p><ul><li>第一步：将开始结点压入优先队列中</li><li>第二步：从优先队列中取出优先级最高的节点为当前拓展结点，设置为已访问</li><li>第三步： 判断当前结点是否为目标结点，若是则输出路径搜索结束，否则进行下一步</li><li>第四步：访问当前结点的所有相邻子节点<ul><li>X的子节点Y不在open队列或者closed中，由估价函数计算出估价值，放入open队列中</li><li>X的子节点Y在open队列中，且估价值优于open队列中的子节点Y，将open队列中的子节点Y的估价值替换成新的估价值并按优先值排序</li><li>X的子节点Y在closed集中，且估价值优于closed集中的子节点Y，将closed集中的子节点Y移除，并将子节点Y加入open优先队列</li></ul></li><li>第五步：将节点X放入closed集中</li><li>重复过程第二、三、四、五步直到目标节点找到，或者open为空，程序结束</li></ul><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> Queue <span class="keyword">as</span> Q</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ordered_Node</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, priority, description)</span>:</span></span><br><span class="line">        self.priority = priority</span><br><span class="line">        self.description = description</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__cmp__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cmp(self.priority, other.priority)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.priority + <span class="string">' '</span> + self.description</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPriorityQueue</span><span class="params">(list)</span>:</span></span><br><span class="line">    q = Q.PriorityQueue()</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> list:</span><br><span class="line">        q.put(Ordered_Node(heuristics[node], node))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> q, len(list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greedyBFSUtil</span><span class="params">(G, v, visited, final_path, dest, goal)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> goal == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> goal</span><br><span class="line"></span><br><span class="line">    visited[v] = <span class="keyword">True</span></span><br><span class="line">    final_path.append(v)</span><br><span class="line">    <span class="keyword">if</span> v == dest:</span><br><span class="line">        goal = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pq_list = []</span><br><span class="line">        pq, size = getPriorityQueue(G[v])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(size):</span><br><span class="line">            pq_list.append(pq.get().description)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> pq_list:</span><br><span class="line">            <span class="keyword">if</span> goal != <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> visited[i] == <span class="keyword">False</span>:</span><br><span class="line">                    goal = greedyBFSUtil(G, i, visited, final_path, dest, goal)</span><br><span class="line">    <span class="keyword">return</span> goal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greedyBFS</span><span class="params">(G, source, dest, heuristics, pos)</span>:</span></span><br><span class="line">    visited = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> G.nodes():</span><br><span class="line">        visited[node] = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    final_path = []</span><br><span class="line">    goal = greedyBFSUtil(G, source, visited, final_path, dest, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    prev = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> final_path:</span><br><span class="line">        <span class="keyword">if</span> prev != <span class="number">-1</span>:</span><br><span class="line">            curr = var</span><br><span class="line">            nx.draw_networkx_edges(G, pos, edgelist=[(prev, curr)], width=<span class="number">2.5</span>, alpha=<span class="number">0.8</span>, edge_color=<span class="string">'black'</span>)</span><br><span class="line">            prev = curr</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev = var</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHeuristics</span><span class="params">(G)</span>:</span></span><br><span class="line">    heuristics = &#123;&#125;</span><br><span class="line">    f = open(<span class="string">'heuristics.txt'</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> G.nodes():</span><br><span class="line">        node_heuristic_val = f.readline().split()</span><br><span class="line">        heuristics[node_heuristic_val[<span class="number">0</span>]] = node_heuristic_val[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> heuristics</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CreateGraph</span><span class="params">()</span>:</span></span><br><span class="line">    G = nx.Graph()</span><br><span class="line">    f = open(<span class="string">'data.txt'</span>)</span><br><span class="line">    n = int(f.readline())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        graph_edge_list = f.readline().split()</span><br><span class="line">        G.add_edge(graph_edge_list[<span class="number">0</span>], graph_edge_list[<span class="number">1</span>], length=graph_edge_list[<span class="number">2</span>])</span><br><span class="line">    source, dest = f.read().splitlines()</span><br><span class="line">    <span class="keyword">return</span> G, source, dest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DrawPath</span><span class="params">(G, source, dest)</span>:</span></span><br><span class="line">    pos = nx.spring_layout(G)</span><br><span class="line">    val_map = &#123;&#125;</span><br><span class="line">    val_map[source] = <span class="string">'green'</span></span><br><span class="line">    val_map[dest] = <span class="string">'red'</span></span><br><span class="line">    values = [val_map.get(node, <span class="string">'blue'</span>) <span class="keyword">for</span> node <span class="keyword">in</span> G.nodes()]</span><br><span class="line">    nx.draw(G, pos, with_labels=<span class="keyword">True</span>, node_color=values, edge_color=<span class="string">'b'</span>, width=<span class="number">1</span>,</span><br><span class="line">            alpha=<span class="number">0.7</span>)</span><br><span class="line">    edge_labels = dict([((u, v,), d[<span class="string">'length'</span>]) <span class="keyword">for</span> u, v, d <span class="keyword">in</span> G.edges(data=<span class="keyword">True</span>)])</span><br><span class="line">    nx.draw_networkx_edge_labels(G, pos, edge_labels=edge_labels, label_pos=<span class="number">0.5</span>,</span><br><span class="line">                                 font_size=<span class="number">11</span>)</span><br><span class="line">    <span class="keyword">return</span> pos</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    G, source, dest = CreateGraph()</span><br><span class="line"></span><br><span class="line">    heuristics = getHeuristics(G)</span><br><span class="line"></span><br><span class="line">    pos = DrawPath(G, source, dest)</span><br><span class="line"></span><br><span class="line">    greedyBFS(G, source, dest, heuristics, pos)</span><br><span class="line"></span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><ul><li>GBFS优点<ul><li>搜索速度快</li></ul></li><li>GBFS的缺点<ul><li>不一定最优(不考虑总距离)</li><li>容易陷入死循环</li><li>有可能一直沿着一条道，但是这条道到不了终点… （不完备性)</li></ul></li></ul><ul><li>算法对比</li></ul><div class="table-container"><table><thead><tr><th>序号</th><th>算法</th><th>主要思想</th><th>优缺点</th></tr></thead><tbody><tr><td>1</td><td>BFS</td><td>按照宽度向外扩展节点</td><td>可以找到最优解，但计算复杂度高</td></tr><tr><td>2</td><td>DFS</td><td>按照深度向外扩展节点</td><td>可以找到最优解，计算复杂度高</td></tr><tr><td>3</td><td>GBFS</td><td>按照宽度以一定朝向扩展节点</td><td>计算复杂度相对较低，但可能无法找到最优解</td></tr></tbody></table></div><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/346666812" target="_blank" rel="noopener">路径规划 | 图搜索算法：DFS、BFS、GBFS、Dijkstra、A*</a></li><li><a href="https://zhuanlan.zhihu.com/p/110686645" target="_blank" rel="noopener">搜索算法(1)——启发式搜索1(GBFS)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（一）-BFS和DFS算法</title>
      <link href="/2021/03/08/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%B8%80%EF%BC%89-BFS%E5%92%8CDFS%E7%AE%97%E6%B3%95/"/>
      <url>/2021/03/08/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%B8%80%EF%BC%89-BFS%E5%92%8CDFS%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>DFS和BFS是两种搜索树和图的基本策略，一种往深处搜，一种往边上搜。 DFS常用于暴力搜索所有状态，BFS常用于搜索到达某一状态的最短路径。广度优先搜索在进一步遍历图中顶点之前，先访问当前顶点的所有邻接结点。深度优先搜索在搜索过程中访问某个顶点后，需要递归地访问此顶点的所有未访问过的相邻顶点。</p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h2 id="2-1-深度优先搜索"><a href="#2-1-深度优先搜索" class="headerlink" title="2.1 深度优先搜索"></a>2.1 深度优先搜索</h2><p>深度优先搜索策略是递归的访问此顶点的所有未访问过的相邻节点。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-10-153704.png" alt="image-20210310233648245" style="zoom:50%;"></p><p>（图片参考：<a href="https://developer.aliyun.com/article/756316）" target="_blank" rel="noopener">https://developer.aliyun.com/article/756316）</a></p><ul><li>从节点1开始遍历，相邻的节点有2，3，4，先遍历节点2，再遍历节点5，然后再节点9</li><li>上图中最右侧的一条路已经走到底了，此时从节点9开始回溯到上一个节点，如果上一个节点有子节点，则在该节点处继续遍历它的子节点；如果上一个节点，没有子节点，则继续回溯。如上图所示，遍历到节点9之后，回溯到节点5，节点5没有子节点，继续回退到节点2，再回溯到节点1；此时，节点1有其他的子节点3和4，那么继续遍历3的子节点</li><li>重复上一步，直到遍历到节点10，则进行回溯，直到节点3，发现节点3有子节点7还未被访问，那么遍历节点7及其子节点</li><li>从节点7往上回溯到3，1，发现1还有节点4未遍历，所以此时沿着4，8进行遍历，最后遍历结束</li></ul><h2 id="2-2-广度优先搜索"><a href="#2-2-广度优先搜索" class="headerlink" title="2.2 广度优先搜索"></a>2.2 广度优先搜索</h2><p>广度优先遍历从图的一个未遍历的节点出发，先遍历这个节点的相邻节点，再依次遍历每个相邻节点的相邻节点。所以广度优先遍历也叫层序遍历。正如上图所示，广度优先遍历先遍历第一层（节点1），再遍历第二层（节点2，3，4），第三层（5，6，7，8），第四层（9，10）。</p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><h2 id="3-1-深度优先搜索"><a href="#3-1-深度优先搜索" class="headerlink" title="3.1 深度优先搜索"></a>3.1 深度优先搜索</h2><ul><li>非递归实现</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_DFS_data</span><span class="params">(graph, start_node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(graph) == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"\tGraph error"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> start_node <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">        print(<span class="string">"\tStart node is not in graph, start node = "</span>, start_node)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    queue, seen_list = [], []</span><br><span class="line">    queue.append(start_node)</span><br><span class="line">    seen_list.append(start_node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (len(queue) &gt; <span class="number">0</span>):</span><br><span class="line">        node = queue.pop()</span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">            print(<span class="string">"\tNode is not in graph, node = "</span>, node)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">"\t"</span>, node)</span><br><span class="line">        subnodes = graph[node]</span><br><span class="line">        <span class="keyword">for</span> subnode <span class="keyword">in</span> subnodes:</span><br><span class="line">            <span class="keyword">if</span> subnode <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> subnode <span class="keyword">not</span> <span class="keyword">in</span> seen_list:</span><br><span class="line">                queue.append(subnode)</span><br><span class="line">                seen_list.append(subnode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    graph = &#123;</span><br><span class="line">        <span class="string">"A"</span>: [<span class="string">"B"</span>, <span class="string">"C"</span>],</span><br><span class="line">        <span class="string">"B"</span>: [<span class="string">"A"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>],</span><br><span class="line">        <span class="string">"C"</span>: [<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>],</span><br><span class="line">        <span class="string">"D"</span>: [<span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"E"</span>, <span class="string">"F"</span>],</span><br><span class="line">        <span class="string">"E"</span>: [<span class="string">"C"</span>, <span class="string">"D"</span>],</span><br><span class="line">        <span class="string">"F"</span>: [<span class="string">"D"</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_DFS_data(graph, <span class="string">"A"</span>)</span><br></pre></td></tr></table></figure><h2 id="3-2-广度优先搜索"><a href="#3-2-广度优先搜索" class="headerlink" title="3.2 广度优先搜索"></a>3.2 广度优先搜索</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_BFS_data</span><span class="params">(graph, start_node)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(graph) == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">"\tGraph error"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> start_node <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">        print(<span class="string">"\tStart node is not in graph, start node = "</span>, start_node)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    queue, seen_list = [], []</span><br><span class="line">    queue.append(start_node)</span><br><span class="line">    seen_list.append(start_node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (len(queue) &gt; <span class="number">0</span>):</span><br><span class="line">        node = queue.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">            print(<span class="string">"\tNode is not in graph, node = "</span>, node)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">"\t"</span>, node)</span><br><span class="line">        subnodes = graph[node]</span><br><span class="line">        <span class="keyword">for</span> subnode <span class="keyword">in</span> subnodes:</span><br><span class="line">            <span class="keyword">if</span> subnode <span class="keyword">not</span> <span class="keyword">in</span> graph:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> subnode <span class="keyword">not</span> <span class="keyword">in</span> seen_list:</span><br><span class="line">                queue.append(subnode)</span><br><span class="line">                seen_list.append(subnode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    graph = &#123;</span><br><span class="line">        <span class="string">"A"</span>: [<span class="string">"B"</span>, <span class="string">"C"</span>],</span><br><span class="line">        <span class="string">"B"</span>: [<span class="string">"A"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>],</span><br><span class="line">        <span class="string">"C"</span>: [<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>],</span><br><span class="line">        <span class="string">"D"</span>: [<span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"E"</span>, <span class="string">"F"</span>],</span><br><span class="line">        <span class="string">"E"</span>: [<span class="string">"C"</span>, <span class="string">"D"</span>],</span><br><span class="line">        <span class="string">"F"</span>: [<span class="string">"D"</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get_BFS_data(graph, <span class="string">'A'</span>)</span><br></pre></td></tr></table></figure><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><p>BFS和DFS可应用于最短路径问题的求解中。在一棵树中，一个结点到另一个结点的路径是唯一的，但在图中，结点之间可能有多条路径，其中哪条路最近呢？这一类问题称为最短路径问题。在图数据结构中，BFS和DFS从源点出发，一次遍历，直到遍历到目标节点结束，此时就能找到到某个点的最短路径了。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-10-155355.png" alt="image-20210310235340552" style="zoom:50%;"></p><p>（图片参考：<a href="https://zhuanlan.zhihu.com/p/136183284）" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/136183284）</a></p><ul><li>算法对比</li></ul><div class="table-container"><table><thead><tr><th>序号</th><th>算法</th><th>主要思想</th><th>优缺点</th></tr></thead><tbody><tr><td>1</td><td>BFS</td><td>按照宽度向外扩展节点</td><td>计算复杂度高</td></tr><tr><td>2</td><td>DFS</td><td>按照深度向外扩展节点</td><td>计算复杂度高</td></tr></tbody></table></div><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://developer.aliyun.com/article/756316" target="_blank" rel="noopener">图文详解 DFS 和 BFS | 算法必看系列知识二十四</a></li><li><a href="https://zhuanlan.zhihu.com/p/136183284" target="_blank" rel="noopener">BFS 的使用场景：层序遍历、最短路径问题</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（四）-双向Dijkstra算法</title>
      <link href="/2020/10/15/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E5%9B%9B%EF%BC%89-%E5%8F%8C%E5%90%91Dijkstra%E7%AE%97%E6%B3%95/"/>
      <url>/2020/10/15/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E5%9B%9B%EF%BC%89-%E5%8F%8C%E5%90%91Dijkstra%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>Dijkstra算法是一种单向的最短路径算法，其搜索范围如下图所示。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-15-144324.png" alt="image-20201015224311183" style="zoom:50%;"></p><p>有研究者就提出了一种优化方法，即双向Dijkstra算法。其主要思想就是从起点和终点同时开始搜索，这样应该能够提升算法效率。事实证明，在大部分情况下，双向Dijkstra算法还是要优于单向的Dijkstra算法，其搜索范围如下图所示。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-15-144401.png" alt="image-20201015224354382" style="zoom:50%;"></p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><ul><li>主要思想<ul><li>分别从路径搜索的起点s和路径搜索的终点t同时执行前向的Dijkstra算法和后向的Dijkstra算法</li><li>当前向Dijkstra算法和后向Dijkstra算法相遇时，搜索结束。假设二者相遇时的节点为u，起点s到u节点的Dijkstra路径为D(s, u)，终点t到u节点的Dijkstra路径为D(t, u)，则起点s到终点t的最短路径为: D(s, u) + D(u, t)</li></ul></li><li>算法流程<ul><li>从heap中弹出节点  </li><li>更新当前的候选最优路径cost  </li><li>从当前节点广度搜索展开，更新相邻节点的权重，加入heap中</li><li>最短路径搜索时我们会用到两个容器，一个堆(Heap)：维护着已经reach到的候选节点集合；一个Map:维护已经从heap中弹出的节点集合</li><li>PSet和PRelaxed分别表示正向搜索的Map和Heap,NSet和NRelaxed分别表示反向搜索的Map和Heap</li><li>终止条件：当PSet和NSet初次相遇节点时，获得了第一条候选最优路径时，继续进行双向搜索，但这时停止向heap放入新的节点，仅用弹出当前的PRelaxed和NRelaxed的集合，最优meet节点肯定在红色背景的节点集合中。  </li></ul></li></ul><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="https://blog.csdn.net/qq_25102303/article/details/99692570" target="_blank" rel="noopener">最短路径算法—双向Dijkstra算法Python实现</a></li><li><a href="https://www.cnblogs.com/gisorange/p/3632958.html" target="_blank" rel="noopener">路网最优路径算法之一单向和双向搜索</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>路径规划（三）-Dijkstra算法</title>
      <link href="/2020/10/08/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%B8%89%EF%BC%89-Dijkstra%E7%AE%97%E6%B3%95/"/>
      <url>/2020/10/08/route_planning/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%EF%BC%88%E4%B8%89%EF%BC%89-Dijkstra%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>Dijkstra算法是由计算机科学家Edsger W. Dijkstra在1956年提出的，用来寻找图形中节点之间的最短路径。从图中的某个顶点出发到达另外一个顶点的所经过的边的权重和最小的一条路径，称为最短路径。</p><p>它的主要特点是以起始点为中心向外层层扩展(广度优先搜索思想)，直到扩展到终点为止。如下图所示，扩展和访问下一个节点最主要考虑累计成本$g(n)$的大小。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2021-03-14-131737.png" alt="image-20210314211737154" style="zoom:50%;"></p><p>核心思想：设G=(V,E)是一个带权有向图，把图中顶点集合V分成两组，第一组为已求出最短路径的顶点集合（用S表示，初始时S中只有一个源点，以后每求得一条最短路径 , 就将加入到集合S中，直到全部顶点都加入到S中，算法就结束了），第二组为其余未确定最短路径的顶点集合（用U表示），按最短路径长度的递增次序依次把第二组的顶点加入S中。在加入的过程中，总保持从源点v到S中各顶点的最短路径长度不大于从源点v到U中任何顶点的最短路径长度。此外，每个顶点对应一个距离，S中的顶点的距离就是从v到此顶点的最短路径长度，U中的顶点的距离，是从v到此顶点只包括S中的顶点为中间顶点的当前最短路径长度。</p><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><p>给定一个有权图，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-14-140844.png" alt="image-20201014220830574" style="zoom:50%;"></p><p>（1）指定一个节点，例如我们要计算 ‘A’ 到其他节点的最短路径。</p><p>（2）引入两个集合（S、U），S集合包含已求出的最短路径的点（以及相应的最短长度），U集合包含未求出最短路径的点（以及A到该点的路径，如上图所示，A-&gt;C由于没有直接相连 初始时为∞）。</p><p>（3）初始化两个集合，S集合初始时，只有当前要计算的节点，A-&gt;A = 0，U集合初始时为 A-&gt;B = 4, A-&gt;C = ∞, A-&gt;D = 2, A-&gt;E = ∞。直接连接的定义长度，其他认为不可达。</p><p>（4）从U集合中找出路径最短的点，加入S集合，例如 A-&gt;D = 2。</p><p>（5）更新U集合路径，如果D到B,C,E的距离与AD距离之和小于A到B,C,E的距离，则更新U。</p><p>（6）循环执行（4）和（5）两步骤，直至遍历结束，得到A到其他节点的最短路径。</p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><p>给定如下有向加权图：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph_list = [</span><br><span class="line">    [<span class="number">0</span>, <span class="number">30</span>, <span class="number">15</span>, M, M, M],</span><br><span class="line">    [<span class="number">5</span>, <span class="number">0</span>, M, M, <span class="number">20</span>, <span class="number">30</span>],</span><br><span class="line">    [M, <span class="number">10</span>, <span class="number">0</span>, M, M, <span class="number">15</span>],</span><br><span class="line">    [M, M, M, <span class="number">0</span>, M, M],</span><br><span class="line">    [M, M, M, <span class="number">10</span>, <span class="number">0</span>, M],</span><br><span class="line">    [M, M, M, <span class="number">30</span>, <span class="number">10</span>, <span class="number">0</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>任意节点到其余节点的最短路径实现代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra</span><span class="params">(graph_dict, from_node, to_node)</span>:</span></span><br><span class="line">    Shortest_path, cost = [], <span class="number">-1</span></span><br><span class="line">    q, seen = [(<span class="number">0</span>, from_node, ())], set()</span><br><span class="line">    <span class="keyword">while</span> q:</span><br><span class="line">        (cost, v1, path) = heappop(q)</span><br><span class="line">        <span class="keyword">if</span> v1 <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">            seen.add(v1)</span><br><span class="line">            path = (v1, path)</span><br><span class="line">            <span class="keyword">if</span> v1 == to_node:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> v2, c <span class="keyword">in</span> graph_dict.get(v1, ()):</span><br><span class="line">                <span class="keyword">if</span> v2 <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">                    heappush(q, (cost + c, v2, path))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> v1 != to_node:</span><br><span class="line">        cost = <span class="number">-1</span></span><br><span class="line">        Shortest_path = []</span><br><span class="line">        <span class="keyword">return</span> cost, Shortest_path</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        left = path[<span class="number">0</span>]</span><br><span class="line">        Shortest_path.append(left)</span><br><span class="line">        right = path[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">while</span> len(right) &gt; <span class="number">0</span>:</span><br><span class="line">            left = right[<span class="number">0</span>]</span><br><span class="line">            Shortest_path.append(left)</span><br><span class="line">            right = right[<span class="number">1</span>]</span><br><span class="line">        Shortest_path.reverse()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cost, Shortest_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dijkstra_all</span><span class="params">(graph_dict)</span>:</span></span><br><span class="line">    Shortest_path_dict = defaultdict(dict)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nodes:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> nodes:</span><br><span class="line">            <span class="keyword">if</span> i != j:</span><br><span class="line">                cost, Shortest_path = dijkstra(graph_dict, i, j)</span><br><span class="line">                Shortest_path_dict[i][j] = Shortest_path</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Shortest_path_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    nodes = [<span class="string">'s1'</span>, <span class="string">'s2'</span>, <span class="string">'s3'</span>, <span class="string">'s4'</span>, <span class="string">'s5'</span>, <span class="string">'s6'</span>]</span><br><span class="line">    M = float(<span class="string">"inf"</span>)</span><br><span class="line">    graph_list = [</span><br><span class="line">        [<span class="number">0</span>, <span class="number">30</span>, <span class="number">15</span>, M, M, M],</span><br><span class="line">        [<span class="number">5</span>, <span class="number">0</span>, M, M, <span class="number">20</span>, <span class="number">30</span>],</span><br><span class="line">        [M, <span class="number">10</span>, <span class="number">0</span>, M, M, <span class="number">15</span>],</span><br><span class="line">        [M, M, M, <span class="number">0</span>, M, M],</span><br><span class="line">        [M, M, M, <span class="number">10</span>, <span class="number">0</span>, M],</span><br><span class="line">        [M, M, M, <span class="number">30</span>, <span class="number">10</span>, <span class="number">0</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    graph_edges = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> nodes:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> nodes:</span><br><span class="line">            <span class="keyword">if</span> i != j <span class="keyword">and</span> graph_list[nodes.index(i)][nodes.index(j)] != M:</span><br><span class="line">                graph_edges.append((i, j, graph_list[nodes.index(i)][nodes.index(j)]))</span><br><span class="line"></span><br><span class="line">    graph_dict = defaultdict(list)</span><br><span class="line">    <span class="keyword">for</span> tail, head, cost <span class="keyword">in</span> graph_edges:</span><br><span class="line">        graph_dict[tail].append((head, cost))</span><br><span class="line"></span><br><span class="line">    Shortest_path_dict = dijkstra_all(graph_dict)</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> Shortest_path_dict:</span><br><span class="line">        print(<span class="string">"'%s': %s,"</span> % (key, Shortest_path_dict[key]))</span><br></pre></td></tr></table></figure><p>输出结果如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Shortest_path_dict = &#123;</span><br><span class="line"><span class="string">'s1'</span>: &#123;<span class="string">'s2'</span>: [<span class="string">'s1'</span>, <span class="string">'s3'</span>, <span class="string">'s2'</span>], <span class="string">'s3'</span>: [<span class="string">'s1'</span>, <span class="string">'s3'</span>], <span class="string">'s4'</span>: [<span class="string">'s1'</span>, <span class="string">'s3'</span>, <span class="string">'s6'</span>, <span class="string">'s5'</span>, <span class="string">'s4'</span>], <span class="string">'s5'</span>: [<span class="string">'s1'</span>, <span class="string">'s3'</span>, <span class="string">'s6'</span>, <span class="string">'s5'</span>], <span class="string">'s6'</span>: [<span class="string">'s1'</span>, <span class="string">'s3'</span>, <span class="string">'s6'</span>]&#125;,</span><br><span class="line"><span class="string">'s2'</span>: &#123;<span class="string">'s1'</span>: [<span class="string">'s2'</span>, <span class="string">'s1'</span>], <span class="string">'s3'</span>: [<span class="string">'s2'</span>, <span class="string">'s1'</span>, <span class="string">'s3'</span>], <span class="string">'s4'</span>: [<span class="string">'s2'</span>, <span class="string">'s5'</span>, <span class="string">'s4'</span>], <span class="string">'s5'</span>: [<span class="string">'s2'</span>, <span class="string">'s5'</span>], <span class="string">'s6'</span>: [<span class="string">'s2'</span>, <span class="string">'s6'</span>]&#125;,</span><br><span class="line"><span class="string">'s3'</span>: &#123;<span class="string">'s1'</span>: [<span class="string">'s3'</span>, <span class="string">'s2'</span>, <span class="string">'s1'</span>], <span class="string">'s2'</span>: [<span class="string">'s3'</span>, <span class="string">'s2'</span>], <span class="string">'s4'</span>: [<span class="string">'s3'</span>, <span class="string">'s6'</span>, <span class="string">'s5'</span>, <span class="string">'s4'</span>], <span class="string">'s5'</span>: [<span class="string">'s3'</span>, <span class="string">'s6'</span>, <span class="string">'s5'</span>], <span class="string">'s6'</span>: [<span class="string">'s3'</span>, <span class="string">'s6'</span>]&#125;,</span><br><span class="line"><span class="string">'s4'</span>: &#123;<span class="string">'s1'</span>: [], <span class="string">'s2'</span>: [], <span class="string">'s3'</span>: [], <span class="string">'s5'</span>: [], <span class="string">'s6'</span>: []&#125;,</span><br><span class="line"><span class="string">'s5'</span>: &#123;<span class="string">'s1'</span>: [], <span class="string">'s2'</span>: [], <span class="string">'s3'</span>: [], <span class="string">'s4'</span>: [<span class="string">'s5'</span>, <span class="string">'s4'</span>], <span class="string">'s6'</span>: []&#125;,</span><br><span class="line"><span class="string">'s6'</span>: &#123;<span class="string">'s1'</span>: [], <span class="string">'s2'</span>: [], <span class="string">'s3'</span>: [], <span class="string">'s4'</span>: [<span class="string">'s6'</span>, <span class="string">'s5'</span>, <span class="string">'s4'</span>], <span class="string">'s5'</span>: [<span class="string">'s6'</span>, <span class="string">'s5'</span>]&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-总结和讨论"><a href="#4-总结和讨论" class="headerlink" title="4. 总结和讨论"></a>4. 总结和讨论</h1><ul><li>优点<ul><li>完备的：只要有解，就能够找到解</li><li>最优的：找到的解是最优的</li></ul></li><li>局限性<ul><li>计算复杂度高：求解的过程中，是按照均匀的向外扩散的，类似于穷举搜索，类似于BFS</li></ul></li></ul><ul><li>算法对比</li></ul><div class="table-container"><table><thead><tr><th>序号</th><th>算法</th><th>主要思想</th><th>优缺点</th></tr></thead><tbody><tr><td>1</td><td>BFS</td><td>按照宽度向外扩展节点</td><td>可以找到最优解，但计算复杂度高</td></tr><tr><td>2</td><td>DFS</td><td>按照深度向外扩展节点</td><td>可以找到最优解，计算复杂度高</td></tr><tr><td>3</td><td>GBFS</td><td>按照宽度以一定朝向扩展节点</td><td>计算复杂度相对较低，但可能无法找到最优解</td></tr><tr><td>4</td><td>Dijkstra</td><td>按照一定宽度以一定成本函数值向外扩展节点</td><td>完备的且最优的，但计算复杂度较高</td></tr></tbody></table></div><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="http://theory.stanford.edu/~amitp/GameProgramming/AStarComparison.html#dijkstras-algorithm-and-best-first-search" target="_blank" rel="noopener">Introduction to A*</a></li><li><a href="https://houbb.github.io/2020/01/23/data-struct-learn-03-graph-dijkstra" target="_blank" rel="noopener">图最短路径算法之迪杰斯特拉算法（Dijkstra）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 路径规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 路径规划 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库教程（一）-MySQL的函数</title>
      <link href="/2020/10/06/programmings/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-MySQL%E7%9A%84%E5%87%BD%E6%95%B0/"/>
      <url>/2020/10/06/programmings/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-MySQL%E7%9A%84%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>在 SQL 语言中，同样也包括了内置函数和自定义函数。内置函数是系统内置的通用函数，而自定义函数是我们根据自己的需要编写的</li></ul><h1 id="2-内置函数"><a href="#2-内置函数" class="headerlink" title="2. 内置函数"></a>2. 内置函数</h1><ul><li><p>SQL 的内置函数的分类</p><ul><li><p>算术函数</p><ul><li>对数值类型的字段进行算术运算</li><li>例如，SELECT ABS(-2)，运行结果为 2</li></ul></li><li><p>字符串函数</p><ul><li><p>包括了字符串拼接，大小写转换，求长度以及字符串替换和截取等</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-06-124528.png" alt="image-20201006204527665" style="zoom:50%;"></p></li><li><p>例如，SELECT CONCAT(‘abc’, 123)，运行结果为 abc123</p></li></ul></li><li><p>日期函数</p><ul><li><p>日期函数是对数据表中的日期进行处理</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-06-125028.png" alt="image-20201006205027657" style="zoom:50%;"></p></li><li><p>例如，SELECT CURRENT_DATE()，运行结果为 2019-04-03</p></li></ul></li><li><p>转换函数</p><ul><li>转换函数可以转换数据之间的类型</li><li>例如，SELECT CAST(123.123 AS DECIMAL(8,2))，运行结果为 123.12</li></ul></li></ul></li></ul><h1 id="3-聚集函数"><a href="#3-聚集函数" class="headerlink" title="3. 聚集函数"></a>3. 聚集函数</h1><ul><li><p>对一组数据进行汇总的函数，输入的是一组数据的集合，输出的是单个值</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-06-140641.png" alt="image-20201006220640795" style="zoom:50%;"></p></li></ul><h1 id="4-子查询"><a href="#4-子查询" class="headerlink" title="4. 子查询"></a>4. 子查询</h1><ul><li>非关联子查询<ul><li>子查询从数据表中查询了数据结果，如果这个数据结果只执行一次，然后这个数据结果作为主查询的条件进行执行</li></ul></li><li>关联子查询<ul><li>如果子查询需要执行多次，即采用循环的方式，先从外部查询开始，每次都传入子查询进行查询，然后再将结果反馈给外部</li></ul></li><li>以 NBA 球员数据表为例，假设我们想要知道哪个球员的身高最高，最高身高是多少，就可以采用子查询的方式<ul><li>$ SQL: SELECT player_name, height FROM player WHERE height = (SELECT max(height) FROM player)</li><li>通过SELECT max(height) FROM player可以得到最高身高这个数值，结果为 2.16，然后我们再通过 player 这个表，看谁具有这个身高，再进行输出，这样的子查询就是非关联子查询</li><li>$ SELECT player_name, height, team_id FROM player AS a WHERE height &gt; (SELECT avg(height) FROM player AS b WHERE a.team_id = b.team_id)</li><li>将 player 表复制成了表 a 和表 b，每次计算的时候，需要将表 a 中的 team_id 传入从句，作为已知值。因为每次表 a 中的 team_id 可能是不同的，所以是关联子查询</li></ul></li><li>EXISTS 子查询<ul><li>EXISTS 子查询用来判断条件是否满足，满足的话为 True，不满足为 False</li><li>$ SQL: SELECT player_id, team_id, player_name FROM player WHERE NOT EXISTS (SELECT player_id FROM player_score WHERE player.player_id = player_score.player_id)</li></ul></li></ul><h1 id="10-参考"><a href="#10-参考" class="headerlink" title="10. 参考"></a>10. 参考</h1><ul><li><a href="https://time.geekbang.org/column/article/103349" target="_blank" rel="noopener">什么是SQL函数？为什么使用SQL函数可能会带来问题？</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库教程（一）-MySQL的DDL</title>
      <link href="/2020/10/03/programmings/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-MySQL%E7%9A%84DDL/"/>
      <url>/2020/10/03/programmings/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-MySQL%E7%9A%84DDL/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>DDL 的英文全称是 Data Definition Language，中文是数据定义语言。它定义了数据库的结构和数据表的结构。在 DDL 中，我们常用的功能是增删改，分别对应的命令是 CREATE、DROP 和 ALTER。</p><h1 id="2-操作数据库"><a href="#2-操作数据库" class="headerlink" title="2. 操作数据库"></a>2. 操作数据库</h1><ul><li>创建数据库<ul><li>创建一个名为 test的数据库。如果这个数据已经存在，那么会报错<ul><li>$ CREATE DATABASE test;</li></ul></li><li>如果不存在创建，存在就不创建<ul><li>$ create database if not exists test;</li></ul></li></ul></li><li>删除数据库<ul><li>删除一个名为test的数据库<ul><li>$ DROP DATABASE test;</li></ul></li><li>如果存在删除，不存在就不删除<ul><li>$ drop database if exists test;</li></ul></li></ul></li><li>修改数据库编码<ul><li>修改数据库test的编码为utf8。注意，在MySQL中所有的UTF-8编码都不能使用中间的“-”，即UTF-8要书写为UTF8<ul><li>$ alter database test character set utf8;</li></ul></li></ul></li></ul><h1 id="3-操作表"><a href="#3-操作表" class="headerlink" title="3. 操作表"></a>3. 操作表</h1><ul><li>创建表结构的语法<ul><li>$ CREATE TABLE [table_name](字段名 数据类型，……)</li><li>例如，我们想创建一个球员表，表名为 player，里面有两个字段，一个是 player_id，它是 int 类型，另一个 player_name 字段是varchar(255)类型。这两个字段都不为空，且 player_id 是递增的；数据类型中 int(11) 代表整数类型，显示长度为 11 位，括号中的参数 11 代表的是最大有效显示长度，与类型包含的数值范围大小无关。varchar(255)代表的是最大长度为 255 的可变字符串类型。NOT NULL表明整个字段不能是空值，是一种数据约束。AUTO_INCREMENT代表主键自动增长。</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE player (</span><br><span class="line">player_id int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">player_name varchar(255) NOT NULL</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li>查看当前数据库中所有表名称<ul><li>$ show tables;</li></ul></li><li>修改表结构<ul><li>添加列，比如我在数据表中添加一个 age 字段，类型为int(11)<ul><li>$ ALTER TABLE player ADD (age int(11));</li></ul></li><li>修改字段名，将 age 字段改成player_age<ul><li>$ ALTER TABLE player change age player_age int(11);</li></ul></li><li>修改字段的数据类型，将player_age的数据类型设置为float(3,1)<ul><li>$ ALTER TABLE player MODIFY player_age float(3,1);</li></ul></li><li>删除字段, 删除刚才添加的player_age字段<ul><li>$ ALTER TABLE player DROP player_age;</li></ul></li></ul></li><li>删除表<ul><li>$ dorp table test;</li></ul></li><li>查看表结构<ul><li>$ desc test;</li></ul></li></ul><h1 id="4-数据表的常见约束"><a href="#4-数据表的常见约束" class="headerlink" title="4. 数据表的常见约束"></a>4. 数据表的常见约束</h1><ul><li>主键约束<ul><li>主键起的作用是唯一标识一条记录，不能重复，不能为空</li></ul></li><li>外键约束<ul><li>外键确保了表与表之间引用的完整性。一个表中的外键对应另一张表的主键。外键可以是重复的，也可以为空。</li></ul></li><li>字段约束<ul><li>唯一性约束表明了字段在表中的数值是唯一的，即使我们已经有了主键，还可以对其他字段进行唯一性约束。</li><li>NOT NULL 约束。对字段定义了 NOT NULL，即表明该字段不应为空，必须有取值。</li><li>DEFAULT，表明了字段的默认值。</li><li>CHECK 约束，用来检查特定字段取值范围的有效性，CHECK 约束的结果不能为 FALSE，比如我们可以对身高 height 的数值进行 CHECK 约束，必须≥0，且＜3，即CHECK(height&gt;=0 AND height&lt;3)。</li></ul></li></ul><h1 id="5-检索数据"><a href="#5-检索数据" class="headerlink" title="5. 检索数据"></a>5. 检索数据</h1><ul><li>SELECT 的作用是从一个表或多个表中检索出想要的数据行。</li><li>查询列<ul><li>想要对数据表中的某一列进行检索，在 SELECT 后面加上这个列的字段名<ul><li>比如我们想要检索数据表中都有哪些英雄</li><li>$ SELECT name FROM heros</li></ul></li><li>也可以对多个列进行检索，在列名之间用逗号 (,) 分割<ul><li>比如我们想要检索有哪些英雄，他们的最大生命、最大法力、最大物攻和最大物防分别是多少</li><li>$ SELECT name, hp_max, mp_max, attack_max, defense_max FROM heros</li></ul></li><li>使用 SELECT * 帮我们检索出所有的列<ul><li>$ SELECT * FROM heros</li></ul></li></ul></li><li>起别名<ul><li>使用 SELECT 查询的时候，还有一些技巧可以使用，比如你可以给列名起别名<ul><li>例如，在进行检索的时候，可以给英雄名、最大生命、最大法力、最大物攻和最大物防等取别名</li><li>$ SELECT name AS n, hp_max AS hm, mp_max AS mm, attack_max AS am, defense_max AS dm FROM heros</li></ul></li></ul></li><li>查询常数<ul><li>SELECT 查询还可以对常数进行查询</li><li>比如说，我们想对 heros 数据表中的英雄名进行查询，同时增加一列字段platform，这个字段固定值为“王者荣耀”</li><li>$ SELECT ‘王者荣耀’ as platform, name FROM heros</li></ul></li><li>去除重复行<ul><li>从结果中去掉重复的行。使用的关键字是 DISTINCT。<ul><li>比如我们想要看下 heros 表中关于攻击范围的取值都有哪些</li><li>$ SELECT DISTINCT attack_range FROM heros</li></ul></li><li>DISTINCT 需要放到所有列名的前面，如果写成SELECT name, DISTINCT attack_range FROM heros会报错</li><li>DISTINCT 其实是对后面所有列名的组合进行去重</li></ul></li><li>排序检索数据<ul><li>当我们检索数据的时候，有时候需要按照某种顺序进行结果的返回，比如我们想要查询所有的英雄，按照最大生命从高到底的顺序进行排列，就需要使用 ORDER BY 子句</li><li>排序的列名：ORDER BY 后面可以有一个或多个列名，如果是多个列名进行排序，会按照后面第一个列先进行排序，当第一列的值相同的时候，再按照第二列进行排序，以此类推。</li><li>排序的顺序：ORDER BY 后面可以注明排序规则，ASC 代表递增排序，DESC 代表递减排序。如果没有注明排序规则，默认情况下是按照 ASC 递增排序。我们很容易理解 ORDER BY 对数值类型字段的排序规则，但如果排序字段类型为文本数据，就需要参考数据库的设置方式了</li><li>非选择列排序：ORDER BY 可以使用非选择列进行排序，所以即使在 SELECT 后面没有这个列名，你同样可以放到 ORDER BY 后面进行排序。</li><li>ORDER BY 的位置：ORDER BY 通常位于 SELECT 语句的最后一条子句，否则会报错。</li><li>假设我们想要显示英雄名称及最大生命值，按照最大生命值从高到低的方式进行排序<ul><li>$ SELECT name, hp_max FROM heros ORDER BY hp_max DESC</li></ul></li></ul></li><li>约束返回结果的数量<ul><li>约束返回结果的数量，使用 LIMIT 关键字<ul><li>比如我们想返回英雄名称及最大生命值，按照最大生命值从高到低排序，返回 5 条记录即可</li><li>$ SELECT name, hp_max FROM heros ORDER BY hp_max DESC LIMIT 5</li></ul></li></ul></li><li>执行顺序<ul><li>关键字的顺序是不能颠倒的<ul><li>$ SELECT … FROM … WHERE … GROUP BY … HAVING … ORDER BY …</li></ul></li><li>SELECT 语句的执行顺序（在 MySQL 和 Oracle 中，SELECT 执行顺序基本相同）<ul><li>$ ROM &gt; WHERE &gt; GROUP BY &gt; HAVING &gt; SELECT的字段 &gt; DISTINCT &gt; ORDER BY &gt; LIMIT</li></ul></li></ul></li></ul><h1 id="6-数据过滤"><a href="#6-数据过滤" class="headerlink" title="6. 数据过滤"></a>6. 数据过滤</h1><ul><li>WHERE 子句的基本格式是：SELECT ……(列名) FROM ……(表名) WHERE ……(子句条件)<ul><li>比如我们想要查询所有最大生命值大于 6000 的英雄<ul><li>$ SELECT name, hp_max FROM heros WHERE hp_max &gt; 6000</li></ul></li><li>想要查询所有最大生命值在 5399 到 6811 之间的英雄<ul><li>$ SELECT name, hp_max FROM heros WHERE hp_max BETWEEN 5399 AND 6811</li></ul></li><li>第一部分是关于主要定位和次要定位的条件过滤，使用的是role_main in (‘法师’, ‘射手’) OR role_assist in (‘法师’, ‘射手’)。这里用到了 IN 逻辑运算符，同时role_main和role_assist是 OR（或）的关系。第二部分是关于上线时间的条件过滤。NOT 代表否，因为我们要找到不在 2016-01-01 到 2017-01-01 之间的日期，因此用到了NOT BETWEEN ‘2016-01-01’ AND ‘2017-01-01’。同时我们是在对日期类型数据进行检索，所以使用到了 DATE 函数，将字段 birthdate 转化为日期类型再进行比较。<ul><li>$ SELECT name, role_main, role_assist, hp_max, mp_max, birthdate FROM heros WHERE (role_main IN (‘法师’, ‘射手’) OR role_assist IN (‘法师’, ‘射手’)) AND DATE(birthdate) NOT BETWEEN ‘2016-01-01’ AND ‘2017-01-01’ ORDER BY (hp_max + mp_max) DESC</li></ul></li><li>通配符就是我们用来匹配值的一部分的特殊字符<ul><li>如果我们想要匹配任意字符串出现的任意次数，需要使用（%）通配符。比如我们想要查找英雄名中包含“太”字的英雄</li><li>$ SELECT name FROM heros WHERE name LIKE ‘%太%’</li></ul></li></ul></li></ul><h1 id="7-参考"><a href="#7-参考" class="headerlink" title="7. 参考"></a>7. 参考</h1><ul><li><a href="https://time.geekbang.org/column/article/101697" target="_blank" rel="noopener">DDL 的基础语法及设计工具</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库教程（一）-MySQL配置</title>
      <link href="/2020/10/01/programmings/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-MySQL%E9%85%8D%E7%BD%AE/"/>
      <url>/2020/10/01/programmings/MySQL/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89-MySQL%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>操作系统：Ubuntu 18.04</li><li>MySQL版本：5.7.31</li></ul><h1 id="2-安装MySQL"><a href="#2-安装MySQL" class="headerlink" title="2. 安装MySQL"></a>2. 安装MySQL</h1><ul><li>查看有没有安装MySQL<ul><li>$ dpkg -l | grep mysql</li></ul></li><li>在<code>Ubuntu</code>中，默认情况下，只有最新版本的<code>MySQL</code>包含在<code>APT</code>软件包存储库中,要安装它，只需更新服务器上的包索引并安装默认包`apt-get<ul><li>$ sudo apt-get update</li><li>$ sudo apt-get install mysql-server</li></ul></li><li>安装完成之后可以使用如下命令来检查是否安装成功<ul><li>$ netstat -tap | grep mysql</li><li>通过上述命令检查之后，如果看到有 mysql 的socket处于 LISTEN 状态则表示安装成功。</li></ul></li></ul><h1 id="3-配置MySQL"><a href="#3-配置MySQL" class="headerlink" title="3. 配置MySQL"></a>3. 配置MySQL</h1><ul><li><p>登录mysql数据库可以通过如下命令</p><ul><li><p>$ mysql -u root -p</p></li><li><p>-u 表示选择登陆的用户名， -p 表示登陆的用户密码，现在是mysql数据库是没有密码的，Enter password:处直接回车，就能够进入mysql数据库，如下图所示</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-143939.png" alt="image-20201001223859944"></p></li></ul></li><li><p>show databases; 就可以查看当前的所有数据库</p></li><li><p>初始化配置</p><ul><li><p>为了确保数据库的安全性和正常运转，对数据库进行初始化操作</p><ul><li><p>$ sudo mysql_secure_installation</p></li><li><p>安装验证密码插件，此处我选择No</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-144627.png" alt="image-20201001224558207"></p></li><li><p>设置root管理员在数据库中的专有密码</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-144719.png" alt="image-20201001224718991" style="zoom:50%;"></p></li><li><p>随后删除匿名账户，并使用root管理员从远程登录数据库，以确保数据库上运行的业务的安全性，此处我选择删除匿名账户</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-144856.png" alt="image-20201001224856151" style="zoom:50%;"></p></li><li><p>删除默认的测试数据库，取消测试数据库的一系列访问权限，禁止root管理员从远程登录，这里我没有禁止；之后我选择删除test数据库并取消对它的访问权限</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-145303.png" alt="image-20201001225217641" style="zoom:50%;"></p></li><li><p>刷新授权列表，让初始化的设定立即生效</p><p>  <img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-145415.png" alt="image-20201001225415467" style="zoom:50%;"></p></li></ul></li></ul></li></ul><ul><li><p>检查mysql服务状态</p><ul><li>$ systemctl status mysql.service</li><li><p>显示如下表示MySQL服务正常</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-10-01-145650.png" alt="image-20201001225614816" style="zoom:50%;"></p></li></ul></li><li><p>再次用mysql -u root -p命令，Enter password:处输入刚设置的密码，回车，就能够进入mysql数据库</p></li></ul><h1 id="4-配置远程访问数据库"><a href="#4-配置远程访问数据库" class="headerlink" title="4. 配置远程访问数据库"></a>4. 配置远程访问数据库</h1><p>在Ubuntu下MySQL缺省是只允许本地访问的。如果你要其他机器也能够访问的话，需要进行配置。</p><ul><li>首先用根用户进入</li><li>$ GRANT ALL PRIVILEGES ON <em>.</em> TO root@localhost IDENTIFIED BY “123456”; </li><li>其中<code>root@localhos</code>，<code>localhost</code>就是本地访问，配置成<code>%</code>就是所有主机都可连接；第二个<code>&#39;123456&#39;</code>为你给新增权限用户设置的密码，<code>%</code>代表所有主机，也可以是具体的ip</li></ul><h1 id="5-数据库导入导出"><a href="#5-数据库导入导出" class="headerlink" title="5. 数据库导入导出"></a>5. 数据库导入导出</h1><ul><li><p>创建数据库</p><ul><li>$ create database test;</li></ul></li><li><p>使用数据库</p><ul><li>$ use test;</li></ul></li><li><p>导入数据</p><ul><li>$ source ./test.sql</li></ul></li><li><p>导出整个数据库</p><ul><li>mysqldump -u 用户名 -p 数据库名 &gt; 导出的文件名</li></ul></li><li><p>导出一个表</p><ul><li>mysqldump -u 用户名 -p 数据库名表名 &gt; 导出的文件名</li></ul></li><li><p>导出一个数据库结构</p><ul><li><p>mysqldump -u wcnc -p -d —add-drop-table smgp_apps_wcnc &gt;d:wcnc_db.sql</p><p>  -d 没有数据 —add-drop-table 在每个create语句之前增加一个drop table</p></li></ul></li></ul><h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h1><ul><li><a href="https://blog.csdn.net/weixx3/article/details/80782479" target="_blank" rel="noopener">Ubuntu18.04 安装MySQL</a></li><li><a href="https://www.cnblogs.com/opsprobe/p/9126864.html" target="_blank" rel="noopener">Ubuntu18.04下安装MySQL</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（八）-VINS-MSCKF算法</title>
      <link href="/2020/06/14/slam/vSLAMNet%EF%BC%88%E5%85%AB%EF%BC%89-VINS-MSCKF%E7%AE%97%E6%B3%95/"/>
      <url>/2020/06/14/slam/vSLAMNet%EF%BC%88%E5%85%AB%EF%BC%89-VINS-MSCKF%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>Mourikis A I, Roumeliotis S I. A multi-state constraint Kalman filter for vision-aided inertial navigation[C]//Proceedings 2007 IEEE International Conference on Robotics and Automation. IEEE, 2007: 3565-3572.</li><li>图像因为能够感知丰富的场景信息，因此能够提供高精度的定位结果；但是，其计算量相对较大，很难被应用于实时系统中。因此，需要从计算量和精度之间进行权衡</li></ul><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h2 id="2-1-EKF状态量"><a href="#2-1-EKF状态量" class="headerlink" title="2.1 EKF状态量"></a>2.1 EKF状态量</h2><p>坐标系定义：I表示IMU本体坐标系，G表示全局坐标系。</p><p>EKF的状态量定义如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-120331.png" alt="image-20200614195933723" style="zoom:80%;"></p><p>其中，$^I_G \bar{q}^T$表示G帧到I帧的旋转四元数，$^G p_I$和$^G v_I$分别表示在G帧下IMU的位置和速度，$b_g$和$b_a$分别表示陀螺仪和加速度计的bias。</p><p>IMU的误差状态定义如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-120335.png" alt="image-20200614200320359" style="zoom:80%;"></p><p>假设摄像头的姿态定义如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-120611.png" alt="image-20200614200601182" style="zoom:80%;"></p><p>其中，$^{G_i}_G \hat{\bar{q}}^T$和$^G\hat{p}_{C_i}$表示第i个摄像头的姿态和位置。那么EKF的误差状态为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-120802.png" alt="image-20200614200752977" style="zoom:80%;"></p><h2 id="2-2-预测"><a href="#2-2-预测" class="headerlink" title="2.2 预测"></a>2.2 预测</h2><h3 id="2-2-1-连续时间IMU运动学"><a href="#2-2-1-连续时间IMU运动学" class="headerlink" title="2.2.1 连续时间IMU运动学"></a>2.2.1 连续时间IMU运动学</h3><p>标称状态微分方程：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121332.png" alt="image-20200614201325061" style="zoom:80%;"></p><p>加速度计和陀螺仪传感器模型：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121617.png" alt="image-20200614201358114" style="zoom:80%;"></p><p>其中，考虑了科氏力对陀螺仪和加速度计的影响。</p><p>误差状态的微分方程为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121629.png" alt="image-20200614201546868" style="zoom:80%;"></p><p>简写为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121634.png" alt="image-20200614201610380" style="zoom:80%;"></p><p>其中，$n_{IMU}$指的是系统噪声，参数均可以通过离线标定。F和G分别如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121722.png" alt="image-20200614201714865" style="zoom:80%;"><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121729.png" alt="image-20200614201729792"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-121940.png" alt="image-20200614201729792"></p><h3 id="2-2-2-离散时间实现"><a href="#2-2-2-离散时间实现" class="headerlink" title="2.2.2 离散时间实现"></a>2.2.2 离散时间实现</h3><p>假设IMU的采样时间为$\Delta T$，那么采用5阶Runge-Kutta数值积分来求解。定义EKF的协方差矩阵如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-122223.png" alt="image-20200614202216839" style="zoom:80%;"></p><p>其中，$P_{II_{k|k}}$表示IMU状态的方差，维数为15x15，$P_{CC_{k|k}}$表示摄像头的姿态方差，维数为6x6，$P_{IC_{k|k}}$表示IMU和摄像头的协方差。协方差矩阵的广播方程如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-122442.png" alt="image-20200614202435400" style="zoom:80%;"></p><p>其中，$P_{II_{k+1|k}}$由下式计算：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-122544.png" alt="image-20200614202536101" style="zoom:80%;"></p><p>状态转移矩阵$\Phi(t_k+T, t_k)$由下式计算：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-122719.png" alt="image-20200614202711798" style="zoom:80%;"></p><p>初始状态$\Phi(t_k, t_k = I_{15}$。</p><h2 id="2-3-状态增强"><a href="#2-3-状态增强" class="headerlink" title="2.3 状态增强"></a>2.3 状态增强</h2><p>当图像帧到来时，需要对当前姿态进行增广。这个时刻的相机姿态是由上一时刻的IMU propagate的结果结合外参得到的：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-124628.png" alt="image-20200614204311509" style="zoom:80%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-124630.png" alt="image-20200614204326086"></p><p>此时协方差更新方程为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-124634.png" alt="image-20200614204557980" style="zoom:80%;"></p><p>其中，J为</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-06-14-124637.png" alt="image-20200614204617308" style="zoom:80%;"></p><h2 id="2-4-测量模型"><a href="#2-4-测量模型" class="headerlink" title="2.4 测量模型"></a>2.4 测量模型</h2>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> SLAM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> SLAM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习（一）-深度学习-卷积网络</title>
      <link href="/2020/06/01/machine_learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E5%8D%B7%E7%A7%AF%E7%BD%91%E7%BB%9C/"/>
      <url>/2020/06/01/machine_learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E5%8D%B7%E7%A7%AF%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>卷积运算</li></ul><p>$s(t) = \int x(a)w(t-a)dz = (x <em> w)(t)$，$</em>$表示卷积运算。函数x通常叫做输入，函数$w$称作核函数，输出有时被称作特征映射。</p><ul><li>重要属性<ul><li>稀疏交互<ul><li>使得和的大小远小于输入的大小，参数个数变小</li></ul></li><li>参数共享<ul><li>一个模型中多个函数使用相同的参数</li><li>使得神经网络具有平移等变性</li></ul></li><li>等变表示</li></ul></li></ul><h1 id="2-池化"><a href="#2-池化" class="headerlink" title="2. 池化"></a>2. 池化</h1><ul><li>使用某一位置的相邻输出的总体特征来代替网络在该位置的输出<ul><li>最大池化</li><li>平均池化</li></ul></li><li>池化能够帮助输入的表示近似不变。平移的不变性是指我们队输入进行少量平移时，经过池化函数后的大多数输出并不会发生改变</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 深度学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
            <tag> 理论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode算法（二）-探索初级算法-链表</title>
      <link href="/2020/06/01/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A2%E7%B4%A2%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95-%E9%93%BE%E8%A1%A8/"/>
      <url>/2020/06/01/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A2%E7%B4%A2%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95-%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-算法题"><a href="#2-算法题" class="headerlink" title="2. 算法题"></a>2. 算法题</h1><h2 id="2-1-删除链表中的节点"><a href="#2-1-删除链表中的节点" class="headerlink" title="2.1 删除链表中的节点"></a>2.1 删除链表中的节点</h2><ul><li>请编写一个函数，使其可以删除某个链表中给定的（非末尾）节点，你将只被给定要求被删除的节点</li><li>解题思路<ul><li>很简单，直接将待删除结点的上一个结点指向待删除结点的下一个结点即可</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">(ListNode* node)</span> </span>&#123;</span><br><span class="line">        node-&gt;val = node-&gt;next-&gt;val;</span><br><span class="line">        node-&gt;next = node-&gt;next-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-2-删除链表的倒数第N个节点"><a href="#2-2-删除链表的倒数第N个节点" class="headerlink" title="2.2 删除链表的倒数第N个节点"></a>2.2 删除链表的倒数第N个节点</h2><ul><li>给定一个链表，删除链表的倒数第 <em>n</em> 个节点，并且返回链表的头结点</li><li>解题思路<ul><li>双指针，一个提前走n+1步，第二个再与第一个一同前进，指导第一个走到尾，那么第二个指针所指向的结点的下一个结点就是要删除的节点</li><li>注意要新建立头结点，因为头结点也有可能被删除</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">removeNthFromEnd</span><span class="params">(ListNode* head, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!head)  <span class="keyword">return</span> head;</span><br><span class="line">        ListNode *newHead = <span class="keyword">new</span> ListNode(<span class="number">-1</span>);</span><br><span class="line">        newHead-&gt;next = head;</span><br><span class="line">        ListNode *p = newHead, *q = newHead, *temp;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (q-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            q = q-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= n) &#123;</span><br><span class="line">                p = p-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            i ++;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = p-&gt;next;</span><br><span class="line">        p-&gt;next = p-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">delete</span> temp;</span><br><span class="line">        <span class="keyword">return</span> newHead-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-3-反转链表"><a href="#2-3-反转链表" class="headerlink" title="2.3 反转链表"></a>2.3 反转链表</h2><ul><li>反转一个单链表</li><li>解题思路<ul><li>双指针思想</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        ListNode* q = <span class="literal">NULL</span>, *p = head;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            ListNode* m = p-&gt;next;</span><br><span class="line">            p-&gt;next = q;</span><br><span class="line">            q = p;</span><br><span class="line">            p = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-4-合并两个有序链表"><a href="#2-4-合并两个有序链表" class="headerlink" title="2.4 合并两个有序链表"></a>2.4 合并两个有序链表</h2><ul><li>将两个升序链表合并为一个新的 <strong>升序</strong> 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的</li><li>解题思路<ul><li>迭代</li><li>递归</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">        ListNode *newList = <span class="keyword">new</span> ListNode(<span class="number">-1</span>);</span><br><span class="line">        ListNode *p = newList;</span><br><span class="line">        <span class="keyword">while</span> (l1 != <span class="literal">NULL</span> &amp;&amp; l2 != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (l1-&gt;val &lt;= l2-&gt;val) &#123;</span><br><span class="line">                p-&gt;next = l1;</span><br><span class="line">                l1 = l1-&gt;next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                p-&gt;next = l2;</span><br><span class="line">                l2 = l2-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        p-&gt;next = l1 == <span class="literal">NULL</span> ? l2: l1;</span><br><span class="line">        <span class="keyword">return</span> newList-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">mergeTwoLists</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l1 == null) &#123;</span><br><span class="line">            <span class="keyword">return</span> l2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (l2 == null) &#123;</span><br><span class="line">            <span class="keyword">return</span> l1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (l1.val &lt; l2.val) &#123;</span><br><span class="line">            l1.next = mergeTwoLists(l1.next, l2);</span><br><span class="line">            <span class="keyword">return</span> l1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            l2.next = mergeTwoLists(l1, l2.next);</span><br><span class="line">            <span class="keyword">return</span> l2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5-回文链表"><a href="#2-5-回文链表" class="headerlink" title="2.5 回文链表"></a>2.5 回文链表</h2><ul><li>请判断一个链表是否为回文链表</li><li>解题思路<ul><li>双指针+反转</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">NULL</span> || head-&gt;next == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode *fast = head, *slow = head;</span><br><span class="line">        ListNode *p, *pre = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span> (fast &amp;&amp; fast-&gt;next) &#123;</span><br><span class="line">            p = slow;</span><br><span class="line">            fast = fast-&gt;next-&gt;next;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">            p-&gt;next = pre;</span><br><span class="line">            pre = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fast) &#123;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (p) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p-&gt;val != slow-&gt;val) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-6-环形链表"><a href="#2-6-环形链表" class="headerlink" title="2.6 环形链表"></a>2.6 环形链表</h2><ul><li>给定一个链表，判断链表中是否有环</li><li>为了表示给定链表中的环，我们使用整数 <code>pos</code> 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 <code>pos</code> 是 <code>-1</code>，则在该链表中没有环</li><li>解题思路<ul><li>双指针</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">hasCycle</span><span class="params">(ListNode *head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!head || !head-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode *fast = head, *slow = head;</span><br><span class="line">        <span class="keyword">while</span> (fast &amp;&amp; fast-&gt;next) &#123;</span><br><span class="line">            fast = fast-&gt;next-&gt;next;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (fast == slow) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-光流法-LK光流法</title>
      <link href="/2020/05/30/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E5%85%89%E6%B5%81%E6%B3%95-LK%E5%85%89%E6%B5%81%E6%B3%95/"/>
      <url>/2020/05/30/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E5%85%89%E6%B5%81%E6%B3%95-LK%E5%85%89%E6%B5%81%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>Lucas–Kanade光流算法是一种两帧差分的光流估计算法。它由Bruce D. Lucas 和 Takeo Kanade提出</li><li>Lucas B D, Kanade T. An iterative image registration technique with an application to stereo vision[J]. 1981.</li></ul><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h2 id="2-1-假设条件"><a href="#2-1-假设条件" class="headerlink" title="2.1 假设条件"></a>2.1 假设条件</h2><ul><li>亮度恒定，就是同一点随着时间的变化，其亮度不会发生改变。这是基本光流法的假定（所有光流法变种都必须满足），用于得到光流法基本方程</li><li>小运动，这个也必须满足，就是时间的变化不会引起位置的剧烈变化，这样灰度才能对位置求偏导（换句话说，小运动情况下我们才能用前后帧之间单位位置变化引起的灰度变化去近似灰度对位置的偏导数），这也是光流法不可或缺的假定</li><li>空间一致，一个场景上邻近的点投影到图像上也是邻近点，且邻近点速度一致。这是Lucas-Kanade光流法特有的假定，因为光流法基本方程约束只有一个，而要求x，y方向的速度，有两个未知变量。我们假定特征点邻域内做相似运动，就可以连立n多个方程求取x，y方向的速度（n为特征点邻域总点数，包括该特征点）</li></ul><h2 id="2-2-算法原理"><a href="#2-2-算法原理" class="headerlink" title="2.2 算法原理"></a>2.2 算法原理</h2><p>相机的图像是随时间变化的。图像可以看作时间的函数：I(t)。那么，一个在t 时刻，位于(x; y) 处的像素，它的灰度可以写成I(x, y, t)。</p><p>根据上述假设条件一，我们有：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-115232.png" alt="image-20200531195149352" style="zoom:50%;"></p><p>对左边进行泰勒展开，保留一阶项，得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-115806.png" alt="image-20200531195251384" style="zoom:50%;"></p><p>因为我们假设了灰度不变，于是下一个时刻的灰度等于之前的灰度，从而：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-115801.png" alt="image-20200531195311856" style="zoom:50%;"></p><p>其中$\frac{dx}{dt}$像素在x轴上运动速度，而$\frac{dy}{dt}$为y 轴速度，把它们记为u; v。同时$\frac{\partial{I}}{\partial{x}}$为图像在该点处x方向的梯度，另一项则是在y 方向的梯度，记为Ix; Iy。写成矩阵形式，有:</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-115758.png" alt="image-20200531195514216" style="zoom:50%;"></p><p>由于该方程有两个未知数，需要至少2个方程才能够解。因此，根据上述假设条件2和3，我们认为在该像素周围的一个窗口内w的像素与该像素具有相同的运动状态。因此，我们可以构建$w^2$个方程，即：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-115755.png" alt="image-20200531195748037" style="zoom:50%;"></p><p>基于最小二乘求解，我们得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-115836.png" alt="image-20200531195830489" style="zoom:50%;"></p><p>这个算法的不足在于它不能产生一个密度很高的流向量，例如在运动的边缘微小移动方面流信息会很快的褪去。它的优点在于有噪声存在的鲁棒性还是可以的。</p><h1 id="3-算法改进"><a href="#3-算法改进" class="headerlink" title="3. 算法改进"></a>3. 算法改进</h1><ul><li>LK算法的约束条件即：小速度，亮度不变以及区域一致性都是较强的假设，并不很容易得到满足。如当物体运动速度较快时，假设不成立，那么后续的假设就会有较大的偏差，使得最终求出的光流值有较大的误差</li><li>Jean-Yves Bouguet提出一种基于金字塔分层，针对仿射变换的改进Lucas-Kanade算法</li><li>构建图像金字塔可以解决大运动目标跟踪，也可以一定程度上解决孔径问题（相同大小的窗口能覆盖大尺度图片上尽量多的角点，而这些角点无法在原始图片上被覆盖）</li><li>主要思想<ul><li>考虑物体的运动速度较大时，算法会出现较大的误差。那么就希望能减少图像中物体的运动速度。一个直观的方法就是，缩小图像的尺寸。假设当图像为400×400时，物体速度为[16 16],那么图像缩小为200×200时，速度变为[8,8]。缩小为100*100时，速度减少到[4,4]。所以光流可以通过生成 原图像的金字塔图像，逐层求解，不断精确来求得</li><li>上层金字塔（低分辨率）中的一个像素可以代表下层的两个</li></ul></li><li>对于Lucas-Kanade改进算法来说，主要的步骤有三步：建立金字塔，基于金字塔跟踪，迭代过程</li><li>Bouguet J. Pyramidal Implementation of the AÆne Lucas Kanade Feature Tracker Description of the Algorithm, Intel Corporation–Microprocessor Research Labs, 2000[J].</li></ul><h2 id="3-1-建立金字塔"><a href="#3-1-建立金字塔" class="headerlink" title="3.1 建立金字塔"></a>3.1 建立金字塔</h2><p>首先需要对原始图像建立金字塔，其中原始图像位于底层，其上每一层均基于上一层进行计算。金字塔中每一层均是上一层的下采样，其计算公式为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-121105.png" alt="image-20200531201047130" style="zoom:50%;"></p><p>其中$I^L(x, y)$为 L 层图像中 x, y 位置所在像素点的灰度值，其相当于通过[0.25 0.5 0.25]的低通滤波器进行迭代计算。</p><h2 id="3-2-迭代追踪"><a href="#3-2-迭代追踪" class="headerlink" title="3.2 迭代追踪"></a>3.2 迭代追踪</h2><p>计算光流使用顶层（Lm）层开始，通过最小化每个点领域范围内的匹配误差和，得到每个顶层图像中每个点的光流，该步骤同LK光流法。假设图像的尺寸每次缩放为原来的一半，一共缩放了Lm层，则第0层为原始图像，设已知原图的位移为u,则每一层的位移可以表示为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-122504.png" alt="image-20200531202458857" style="zoom:50%;"></p><p>所以顶层的光流计算结果，也就是位移，反应到Lm-1层，作为该层初始时的光流值的估计g表示为：</p><p>$g^{L-1} = 2*(g^L + d^L)$.</p><p>沿着金字塔向下反馈，重复估计每一层的位移，直到最底层也就是原始图像计算像素的位移。可以理解为 准确值=估计值+残差，对于每一层L，每个点的光流的计算都是基于邻域内所有点的匹配误差和最小化。</p><p>由于顶层图像尺寸较小，其初始的光流估计量可以设置为0，即 gL = [0, 0] 。</p><h2 id="3-3-迭代过程"><a href="#3-3-迭代过程" class="headerlink" title="3.3 迭代过程"></a>3.3 迭代过程</h2><p>介绍了对于整个金字塔迭代过程，还需要提供对于每一层的残余光流计算方法。求解光流最重要的是最小化上文提到的残差方程：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-31-122840.png" alt="image-20200531202833256" style="zoom:50%;"></p>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习（一）-深度学习-深度模型中测优化</title>
      <link href="/2020/05/26/machine_learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E6%B7%B1%E5%BA%A6%E6%A8%A1%E5%9E%8B%E4%B8%AD%E6%B5%8B%E4%BC%98%E5%8C%96/"/>
      <url>/2020/05/26/machine_learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E6%B7%B1%E5%BA%A6%E6%A8%A1%E5%9E%8B%E4%B8%AD%E6%B5%8B%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-自适应学习率算法"><a href="#2-自适应学习率算法" class="headerlink" title="2. 自适应学习率算法"></a>2. 自适应学习率算法</h1><ul><li>学习率是比较难设置的超参数之一</li><li>自适应学习率是解决该问题的一种手段</li><li>算法包括<ul><li>AdaGrad</li></ul></li></ul><h2 id="2-1-AdaGrad算法"><a href="#2-1-AdaGrad算法" class="headerlink" title="2.1 AdaGrad算法"></a>2.1 AdaGrad算法</h2><ul><li>主要思想：独立地适应所有模型参数的学习率，缩放每个参数反比于其所有梯度历史平方值总和的平方根</li><li>具有损失最大偏导的参数相应地有一个快速下降的学习率，而具有小偏导的参数在学习率上有相对较小的下降净效果是在参数空间中更为平缓的倾斜方向会取得更大的进步</li><li>局限性<ul><li>从训练开始时积累梯度平方会导致有效学习率过早和过量的减小</li><li>只适用于凸问题</li></ul></li><li>算法实现<ul><li>输入：学习率$\epsilon$，小常数$\delta = 1e-7$，初始参数$\theta$</li><li>输出：迭代参数$\theta$</li><li>算法<ul><li>初始化梯度累计变量$r = 0$</li><li>while 没有达到停止条件 do<ul><li>从训练数据集中采样小批量数据</li><li>计算题都$g \leftarrow \frac{1}{m}\triangledown_{\theta}\sum_i L(x^{(i), \theta}, y^{(i)})$</li><li>累计平方梯度$r \leftarrow r + g \cdot g$</li><li>更新$\Delta \theta \leftarrow \frac{\epsilon}{\delta + \sqrt{r}} \cdot g$</li><li>更新$\theta \leftarrow \theta + \Delta \theta$</li></ul></li><li>End while</li></ul></li></ul></li></ul><h2 id="2-2-RMSProp算法"><a href="#2-2-RMSProp算法" class="headerlink" title="2.2 RMSProp算法"></a>2.2 RMSProp算法</h2><ul><li>针对于AdaGrad算法的局限性，RMSProp算法采用了指数加权的移动平均来计算累计梯度</li><li>主要思想：通过采用指数加权的移动平均以丢弃遥远过去的历史，使其能够在找到凸碗状结构后快速收敛</li><li>引入了另一个超参数$\rho$，表示移动平均的长度范围</li><li>算法实现<ul><li>输入：全局学习率$epsilon$，衰减速率$\rho$，初始参数$\theta$，小常数$\delta = 1e-7$</li><li>输出：更新的学习率$theta$</li><li>算法<ul><li>初始化梯度累计变量$r = 0$</li><li>while 没有达到停止条件 do<ul><li>从训练数据集中采样小批量数据</li><li>计算题都$g \leftarrow \frac{1}{m}\triangledown_{\theta}\sum_i L(x^{(i), \theta}, y^{(i)})$</li><li>累积平方梯度$r \leftarrow \rho r + (1 - \rho) g \cdot g$</li><li>更新$\Delta \theta \leftarrow \frac{\epsilon}{\sqrt{\delta + r}} \cdot g$</li><li>更新$\theta \leftarrow \theta + \Delta \theta$</li></ul></li><li>End while</li></ul></li></ul></li></ul><h2 id="2-3-Adam算法"><a href="#2-3-Adam算法" class="headerlink" title="2.3 Adam算法"></a>2.3 Adam算法</h2><ul><li>RMSProp算法与具有一些重要区别的动量的变种</li><li>引入偏置修正</li><li>算法实现<ul><li>输入：步长$\epsilon = 0.001$，矩估计指数衰减因子$\rho_1 = 0.9$和$\rho_2 = 0.999$，小常数$\delta = 1e-8$，初始参数$\theta$</li><li>输出：更新$\theta$</li><li>算法<ul><li>初始化一阶和二阶矩变量$s = 0$, $r = 0$</li><li>初始化时间步$t = 0$</li><li>while 没有达到停止条件 do<ul><li>从训练数据集中采样小批量数据</li><li>计算梯度$g \leftarrow \frac{1}{m}\triangledown_{\theta}\sum_i L(x^{(i), \theta}, y^{(i)})$</li><li>$t\leftarrow t + 1$</li><li>更新有偏一阶矩估计：$s \leftarrow \rho_1 s + (1-\rho_1)g$</li><li>更新有偏二阶矩估计：$r \leftarrow \rho_2 r + (1-\rho_2)g\cdot g$</li><li>修正一阶矩的偏差：$\hat{s} \leftarrow \frac{s}{1-\rho_1^t}$</li><li>修正二阶矩的偏差：$\hat{r} \leftarrow \frac{r}{1-\rho_2^t}$</li><li>计算更新：$\Delta \theta \leftarrow -\epsilon\frac{\hat{s}}{\sqrt{\hat{r} + \delta}}$</li><li>应用更新：$\theta \leftarrow \theta + \Delta \theta$</li></ul></li><li>end while</li></ul></li></ul></li></ul><h1 id="3-二阶近似方法"><a href="#3-二阶近似方法" class="headerlink" title="3. 二阶近似方法"></a>3. 二阶近似方法</h1><h2 id="3-1-牛顿法"><a href="#3-1-牛顿法" class="headerlink" title="3.1 牛顿法"></a>3.1 牛顿法</h2><ul><li>核心公式：$\theta^* = \theta_0 - H^{-1}\triangledown_{\theta}J(\theta_0)$</li><li>局限性<ul><li>只适用于H半正定的情况</li><li>H的求逆计算复杂度较高</li></ul></li></ul><h2 id="3-2-共轭梯度算法"><a href="#3-2-共轭梯度算法" class="headerlink" title="3.2 共轭梯度算法"></a>3.2 共轭梯度算法</h2><ul><li>主要思想：通过迭代下降的共轭方向以有效避免H矩阵求逆</li><li>寻求一个和先前线搜索方向共轭的搜索方向，即它不会撤销该方向上的进展；在训练迭代t时，下一步的搜索方向$d_t = \triangledown_{\theta}J(\theta) + \beta_td_{t-1}$，其中，$\beta$是应沿方向$d_{t-1}$加回多少方向</li><li>$\beta$的计算方法<ul><li>$\beta_t = \frac{\triangledown_{\theta}J(\theta_t)^T\triangledown_{\theta}J(\theta_t)}{\triangledown_{\theta}J(\theta_{t-1})^T\triangledown_{\theta}J(\theta_{t-1})}$</li></ul></li></ul><h1 id="4-优化策略和元算法"><a href="#4-优化策略和元算法" class="headerlink" title="4. 优化策略和元算法"></a>4. 优化策略和元算法</h1><h2 id="4-1-批标准化"><a href="#4-1-批标准化" class="headerlink" title="4.1 批标准化"></a>4.1 批标准化</h2><ul><li>是一个自适应的重参数化的方法，试图解决训练非常深的模型的困难</li><li>主要减小了多层之间权重参数协调更新的问题，可应用于网络的任何输入层或隐藏层</li><li>标准化方法<ul><li>设H是需要标准化的某层的小批量的激活函数，得到$H’ = \frac{H - \mu}{\sigma}$</li><li>在训练阶段，$\mu = \frac{1}{m}\sum_{i}H_{i, :}$，$\sigma = \sqrt{\delta + \frac{1}{m}\sum_{i}(H - \mu)_i^2}$</li></ul></li><li>影响<ul><li>使得低层的网络没有用。虽然，批标准化减少了低层网络有害的影响，也使得其对于参数学习没有用处；是因为标准化了一阶和二阶统计量，使得线性网络失效</li></ul></li></ul><h2 id="4-2-坐标下降"><a href="#4-2-坐标下降" class="headerlink" title="4.2 坐标下降"></a>4.2 坐标下降</h2><ul><li>主要思想：将一个优化问题拆解为几个部分以达到（局部）极小值</li><li>当优化问题中的不同变量能够清楚地分成相对独立的组，或是当优化一组变量明显比优化所有变量效率更高时，坐标下降最有意义</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 深度学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
            <tag> 理论 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（六）-滤波算法-粒子滤波</title>
      <link href="/2020/05/17/slam/vSLAMNet%EF%BC%88%E5%85%AD%EF%BC%89-%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95-%E7%B2%92%E5%AD%90%E6%BB%A4%E6%B3%A2/"/>
      <url>/2020/05/17/slam/vSLAMNet%EF%BC%88%E5%85%AD%EF%BC%89-%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95-%E7%B2%92%E5%AD%90%E6%BB%A4%E6%B3%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/heyijia0327/article/details/40899819" target="_blank" rel="noopener">Particle Filter Tutorial 粒子滤波：从推导到应用</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 滤波 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 滤波 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode算法（二）-探索初级算法-字符串</title>
      <link href="/2020/05/16/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A2%E7%B4%A2%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95-%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2020/05/16/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A2%E7%B4%A2%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95-%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-算法题"><a href="#2-算法题" class="headerlink" title="2. 算法题"></a>2. 算法题</h1><h2 id="2-1-反转字符串"><a href="#2-1-反转字符串" class="headerlink" title="2.1 反转字符串"></a>2.1 反转字符串</h2><ul><li>编写一个函数，其作用是将输入的字符串反转过来。输入字符串以字符数组 <code>char[]</code> 的形式给出</li><li>不要给另外的数组分配额外的空间，你必须<strong><a href="https://baike.baidu.com/item/原地算法" target="_blank" rel="noopener">原地</a>修改输入数组</strong>、使用 O(1) 的额外空间解决这一问题</li><li>你可以假设数组中的所有字符都是 <a href="https://baike.baidu.com/item/ASCII" target="_blank" rel="noopener">ASCII</a> 码表中的可打印字符</li><li>解题思路<ul><li>直接利用STL中的reverse函数</li><li>双指针思想</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverseString</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; s)</span> </span>&#123;</span><br><span class="line">        reverse(s.begin(), s.end());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverseString</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.size() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> j = s.size() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            swap(s[i], s[j]);</span><br><span class="line">            i ++;</span><br><span class="line">            j --;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-2-整数反转"><a href="#2-2-整数反转" class="headerlink" title="2.2 整数反转"></a>2.2 整数反转</h2><ul><li>给出一个 32 位的有符号整数，你需要将这个整数中每位上的数字进行反转</li><li>假设我们的环境只能存储得下 32 位的有符号整数，则其数值范围为 [−231, 231 − 1]。请根据这个假设，如果反转后整数溢出那么就返回 0</li><li>解题思路<ul><li>先转字符串，反转，再转整数</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reverse</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type x: int</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">-2e31</span> <span class="keyword">or</span> x &gt; <span class="number">2e31</span> - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        xStr = str(int(math.fabs(x)))[::<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">if</span> x &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> -int(xStr) &lt; <span class="number">-2147483648</span> <span class="keyword">or</span> -int(xStr) &gt; <span class="number">2147483647</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> -int(xStr)</span><br><span class="line">        <span class="keyword">elif</span> x &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> int(xStr) &lt; <span class="number">-2147483648</span> <span class="keyword">or</span> int(xStr) &gt; <span class="number">2147483647</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> int(xStr)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h2 id="2-3-字符串中的第一个唯一字符"><a href="#2-3-字符串中的第一个唯一字符" class="headerlink" title="2.3 字符串中的第一个唯一字符"></a>2.3 字符串中的第一个唯一字符</h2><ul><li><p>给定一个字符串，找到它的第一个不重复的字符，并返回它的索引。如果不存在，则返回 -1</p></li><li><p>解题思路</p><ul><li>构造一个26个字母的hash表，一次添加</li><li>返回字符串字符在hash表中为1的字符索引</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">firstUniqChar</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> s.size() == <span class="number">0</span> <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> s.size() == <span class="number">1</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">int</span> hash[<span class="number">26</span>] = &#123;<span class="number">0</span>&#125;;   </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> n:s)</span><br><span class="line">            hash[n-<span class="string">'a'</span>] ++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.size(); i ++)</span><br><span class="line">            <span class="keyword">if</span>(hash[s[i] - <span class="string">'a'</span>] == <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-4-有效的字母异位词"><a href="#2-4-有效的字母异位词" class="headerlink" title="2.4 有效的字母异位词"></a>2.4 有效的字母异位词</h2><ul><li>给定两个字符串 <em>s</em> 和 <em>t</em> ，编写一个函数来判断 <em>t</em> 是否是 <em>s</em> 的字母异位词</li><li>解题思路<ul><li>排序</li><li>Hash表方法，采用26个字母长度的vector设定初始数值为0，按照字母进行设置数值加1；再按照查询字符串进行数值相减，如果向量中所有字母的数值为0，那么就表示为字母异位词；否则，不是字母异位词</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isAnagram</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line">        sort(s.begin(), s.end());</span><br><span class="line">        sort(t.begin(), t.end());</span><br><span class="line">        <span class="keyword">return</span> s == t ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isAnagram</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.size() != t.size())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">int</span> hash[<span class="number">26</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> n : s)</span><br><span class="line">            hash[n - <span class="string">'a'</span>] ++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> n : t)</span><br><span class="line">            hash[n - <span class="string">'a'</span>] --;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i ++)</span><br><span class="line">            <span class="keyword">if</span>(hash[i] != <span class="number">0</span>)   <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-5-验证回文字符串"><a href="#2-5-验证回文字符串" class="headerlink" title="2.5 验证回文字符串"></a>2.5 验证回文字符串</h2><ul><li>给定一个字符串，验证它是否是回文串，只考虑字母和数字字符，可以忽略字母的大小写</li><li>我们将空字符串定义为有效的回文串</li><li>解题思路<ul><li>采用双指针思想，前后指针分别进行移动和比较</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isValidChar</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">tolower</span>(c) &gt;= <span class="string">'a'</span> &amp;&amp; <span class="built_in">tolower</span>(c) &lt;= <span class="string">'z'</span>) || (<span class="built_in">tolower</span>(c) &gt;= <span class="string">'0'</span> &amp;&amp; <span class="built_in">tolower</span>(c) &lt;= <span class="string">'9'</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = s.size() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isValidChar(s[i])) i ++;</span><br><span class="line">            <span class="keyword">if</span> (!isValidChar(s[j])) j --;</span><br><span class="line">            <span class="keyword">if</span> (isValidChar(s[i]) &amp;&amp; isValidChar(s[j])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">tolower</span>(s[i]) == <span class="built_in">tolower</span>(s[j])) &#123;</span><br><span class="line">                    i ++;</span><br><span class="line">                    j --;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-6-字符串转换整数-atoi"><a href="#2-6-字符串转换整数-atoi" class="headerlink" title="2.6 字符串转换整数 (atoi)"></a>2.6 字符串转换整数 (atoi)</h2><ul><li>实现一个 <code>atoi</code> 函数，使其能将字符串转换成整数</li><li>首先，该函数会根据需要丢弃无用的开头空格字符，直到寻找到第一个非空格的字符为止。接下来的转化规则如下<ul><li>如果第一个非空字符为正或者负号时，则将该符号与之后面尽可能多的连续数字字符组合起来，形成一个有符号整数。</li><li>假如第一个非空字符是数字，则直接将其与之后连续的数字字符组合起来，形成一个整数。</li><li>该字符串在有效的整数部分之后也可能会存在多余的字符，那么这些字符可以被忽略，它们对函数不应该造成影响</li><li>假如该字符串中的第一个非空格字符不是一个有效整数字符、字符串为空或字符串仅包含空白字符时，则你的函数不需要进行转换，即无法进行有效转换</li></ul></li><li>在任何情况下，若函数不能进行有效的转换时，请返回 0</li><li>本题中的空白字符只包括空格字符 <code>&#39; &#39;</code></li><li>假设我们的环境只能存储 32 位大小的有符号整数，那么其数值范围为 [−231, 231 − 1]。如果数值超过这个范围，请返回  INT_MAX (231 − 1) 或 INT_MIN (−231)</li><li>解题思路<ul><li>利用分支判断</li><li>官方给出了编译原理中的自动机解法，可以参考学习：<a href="https://leetcode-cn.com/problems/string-to-integer-atoi/solution/zi-fu-chuan-zhuan-huan-zheng-shu-atoi-by-leetcode-/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/string-to-integer-atoi/solution/zi-fu-chuan-zhuan-huan-zheng-shu-atoi-by-leetcode-/</a></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(<span class="built_in">string</span> str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, label = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">long</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (str[i] == <span class="string">' '</span>) i ++;</span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">'-'</span>) label = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> (str[i] == <span class="string">'-'</span> || str[i] == <span class="string">'+'</span>) i ++;</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; str.size() &amp;&amp; <span class="built_in">isdigit</span>(str[i]); i ++) &#123;</span><br><span class="line">            ans = ans * <span class="number">10</span> + (str[i] - <span class="string">'0'</span>);</span><br><span class="line">            <span class="keyword">if</span> (ans &gt; INT_MAX &amp;&amp; label == <span class="number">1</span>) <span class="keyword">return</span> INT_MAX;</span><br><span class="line">            <span class="keyword">if</span> (ans &gt; INT_MAX &amp;&amp; label == <span class="number">-1</span>) <span class="keyword">return</span> INT_MIN;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> label * ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-7-实现-strStr"><a href="#2-7-实现-strStr" class="headerlink" title="2.7 实现 strStr()"></a>2.7 实现 strStr()</h2><ul><li>给定一个 haystack 字符串和一个 needle 字符串，在 haystack 字符串中找出 needle 字符串出现的第一个位置 (从0开始)。如果不存在，则返回 <strong>-1</strong></li><li>解题思路<ul><li>遍历</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">strStr</span><span class="params">(<span class="built_in">string</span> haystack, <span class="built_in">string</span> needle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (needle == <span class="string">""</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (haystack.size() == <span class="number">0</span> &amp;&amp; needle.size() &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> (haystack.size() == <span class="number">0</span> &amp;&amp; needle.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (needle.size() &gt; haystack.size()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> n = needle.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; haystack.size() - n + <span class="number">1</span>; i ++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; i + n; j ++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (haystack[j] != needle[j - i]) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (j == i + n - <span class="number">1</span>) <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-8-外观数列"><a href="#2-8-外观数列" class="headerlink" title="2.8 外观数列"></a>2.8 外观数列</h2><ul><li><p>「外观数列」是一个整数序列，从数字 1 开始，序列中的每一项都是对前一项的描述。前五项如下：</p><ul><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.     1</span><br><span class="line">2.     11</span><br><span class="line">3.     21</span><br><span class="line">4.     1211</span><br><span class="line">5.     111221</span><br></pre></td></tr></table></figure></li><li><p><code>1</code> 被读作 <code>&quot;one 1&quot;</code> (<code>&quot;一个一&quot;</code>) , 即 <code>11</code>。<br>  <code>11</code> 被读作 <code>&quot;two 1s&quot;</code> (<code>&quot;两个一&quot;</code>）, 即 <code>21</code>。<br>  <code>21</code> 被读作 <code>&quot;one 2&quot;</code>,  “<code>one 1&quot;</code> （<code>&quot;一个二&quot;</code> , <code>&quot;一个一&quot;</code>) , 即 <code>1211</code></p></li><li><p>给定一个正整数 <em>n</em>（1 ≤ <em>n</em> ≤ 30），输出外观数列的第 <em>n</em> 项</p></li><li><p>整数序列中的每一项将表示为一个字符串</p></li></ul></li><li><p>解题思路</p><ul><li>递归+循环</li><li>从第一层开始递归，循环遍历字符串并计数</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">countAndSay</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="string">"1"</span>;</span><br><span class="line">        <span class="built_in">string</span> previous = countAndSay(n<span class="number">-1</span>), result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; previous.length(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (previous[i] == previous[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                count ++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result += to_string(count) + previous[i];</span><br><span class="line">                count = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-9-最长公共前缀"><a href="#2-9-最长公共前缀" class="headerlink" title="2.9 最长公共前缀"></a>2.9 最长公共前缀</h2><ul><li>编写一个函数来查找字符串数组中的最长公共前缀</li><li>如果不存在公共前缀，返回空字符串 <code>&quot;&quot;</code></li><li>解题思路<ul><li>循环遍历</li><li>后续的最长公共前缀由之前的最长公共前缀决定</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">longestCommonPrefix</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; strs)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">string</span> r = strs.size() ? strs[<span class="number">0</span>] : <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> s : strs) &#123;</span><br><span class="line">            <span class="keyword">while</span>(s.substr(<span class="number">0</span>, r.size()) != r) &#123;</span><br><span class="line">                r = r.substr(<span class="number">0</span>, r.size() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (r == <span class="string">""</span>) <span class="keyword">return</span> r;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（七）-vSLAM-BA算法</title>
      <link href="/2020/05/16/slam/vSLAMNet%EF%BC%88%E4%B8%83%EF%BC%89-vSLAM-BA%E7%AE%97%E6%B3%95/"/>
      <url>/2020/05/16/slam/vSLAMNet%EF%BC%88%E4%B8%83%EF%BC%89-vSLAM-BA%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>指从视觉重建中提炼出最优的3D 模型和相机参数（内参数和外参数）</li><li>从每一个特征点反射出来的几束光线（bundles of light rays），在我们把相机姿态和特征点空间位置做出最优的调整(adjustment) 之后，最后收束到相机光心的这个过程，简称为BA</li></ul><h1 id="2-投影模型"><a href="#2-投影模型" class="headerlink" title="2. 投影模型"></a>2. 投影模型</h1><ul><li>相机模型也有很多啦，这里我们同样是使用最简单的一种：针孔相机模型</li><li>首先，把世界坐标转换到相机坐标，这里将用到相机外参数(R; t)</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-124440.png" alt="image-20200516204432914" style="zoom:50%;"></p><ul><li>然后，将P′ 投至归一化平面，得到归一化坐标</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-124518.png" alt="image-20200516204512637" style="zoom:50%;"></p><ul><li>对归一化坐标去畸变，得到去畸变后的坐标。这里暂时只考虑径向畸变</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-124539.png" alt="image-20200516204534384" style="zoom:50%;"></p><ul><li>最后，根据内参模型，计算像素坐标</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-124602.png" alt="image-20200516204556670" style="zoom:50%;"></p><h1 id="3-观测方程参数化"><a href="#3-观测方程参数化" class="headerlink" title="3. 观测方程参数化"></a>3. 观测方程参数化</h1><p>观测方程为：$z = h(x, y)$，其中x表示相机的位姿，即外参R和t，李代数为$\xi$；y表示三维点p的坐标。</p><p>误差项即：$e = z - h(\xi, p)$。</p><p>对于每一个时刻进行误差计算，得到总体的代价函数为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-125257.png" alt="image-20200516205250615" style="zoom:50%;"></p><p>对这个最小二乘进行求解，相当于对位姿和路标同时作了调整，也就是所谓的BA。</p><p>上述式子进一步整理为如下公式：</p><p>$\arg \min \sum_{\{i, j, k\}\in X} \rho(e^T\Sigma^{-1}e)$.</p><p>其中，$\rho$为Huber函数。</p><p>为了便于计算，这里采用g2o方法，使得$e^T\Sigma^{-1}e = \rho(e^T\Sigma^{-1}e)$，</p><p>那么，$w = \frac{\rho(e^T\Sigma^{-1}e)}{e^T\Sigma^{-1}e}$.</p><p>因此，成本函数可以写成如下公式：</p><p>$\{T_i, X_j\} = \arg \min \sum_{\{i, j, k\}\in X}e^T(w\Sigma^{-1})e$.</p><p>代码实现：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CostFunction::ComputeInterVars(Eigen::Vector2d &amp;e, Eigen::Matrix2d &amp;weighted_info, <span class="keyword">double</span> &amp;weighted_e2) &#123;</span><br><span class="line">    <span class="keyword">const</span> Eigen::Vector3d ptc = _camera-&gt;GetPose() * _map_point-&gt;GetPosition();</span><br><span class="line">    <span class="keyword">const</span> Eigen::<span class="function">Vector2d <span class="title">u</span><span class="params">(m_Fx * ptc[<span class="number">0</span>] / ptc[<span class="number">2</span>] + m_Cx, m_Fy * ptc[<span class="number">1</span>] / ptc[<span class="number">2</span>] + m_Cy)</span></span>;</span><br><span class="line"></span><br><span class="line">    e = m_Ob_z - u;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> et_info_e = e.transpose() * m_Info_matrix * e;</span><br><span class="line">    <span class="keyword">double</span> weight = <span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">double</span> sqrt_ete = <span class="built_in">sqrt</span>(et_info_e);</span><br><span class="line">    <span class="keyword">if</span> (sqrt_ete &gt; m_Huber_b) &#123;</span><br><span class="line">      weight = <span class="number">2</span> * m_Huber_b * sqrt_ete - m_Huber_b * m_Huber_b;</span><br><span class="line">      weight = weight / et_info_e;</span><br><span class="line">    &#125;</span><br><span class="line">    weighted_info = weight * m_Info_matrix;</span><br><span class="line">    weighted_e2 = weight * et_info_e;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-BA的求解"><a href="#4-BA的求解" class="headerlink" title="4. BA的求解"></a>4. BA的求解</h1><p>状态量定义为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-125350.png" alt="image-20200516205345061" style="zoom:50%;"></p><p>相应的，增量方程中的$\Delta x$则是对整体自变量的增量。在这个意义下，当我们给自变量一个增量时，目标函数变为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-125526.png" alt="image-20200516205521081" style="zoom:50%;"></p><p>其中，$F_{ij}$和$E_{ij}$分别表示整个儿代价函数在当前状态下对相机姿态和路标坐标的偏导。详细推导如下。</p><p>（1）首先推导F</p><p>F是误差对相机姿态$\xi$的偏导矩阵。记变换到相机坐标系下的空间点坐标为P’，即：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130124.png" alt="image-20200516210118010" style="zoom:50%;"></p><p>根据相机投影模型，得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130149.png" alt="image-20200516210143244" style="zoom:50%;"></p><p>误差e可以通过u和v来求取。接下来，计算e对$\xi$的偏导。采用扰动形式求导，对$\xi$^左乘$\delta \xi$，根据导数定义可得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130510.png" alt="image-20200516210505251" style="zoom:50%;"></p><p>其中，第一项是误差关于投影点的导数，第二项为变换后的点关于李代数的导数。</p><p>根据投影模型，可得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130618.png" alt="image-20200516210605778" style="zoom:50%;"></p><p>根据SE(3)上的李代数求导可得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130704.png" alt="image-20200516210656368" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130813.png" alt="image-20200516210807403" style="zoom:50%;"></p><p>将这两项相乘，就得到了雅可比矩阵F，即：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-130842.png" alt="image-20200516210837626" style="zoom:50%;"></p><p>（2）推导E</p><p>根据链式法则，可得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-131040.png" alt="image-20200516211035091" style="zoom:50%;"></p><p>第一项已在前面推导了，第二项，按照定义</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-131138.png" alt="image-20200516211108221" style="zoom:50%;"></p><p>可得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-131133.png" alt="image-20200516211127266" style="zoom:50%;"></p><p>（3）代码实现</p><ul><li>定义Camera类<ul><li>位姿Sophus::SE3</li><li>ID</li><li>位姿更新</li><li>状态量中的索引</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Camera::Camera(<span class="keyword">const</span> Sophus::SE3 &amp;pose, <span class="keyword">int</span> id, <span class="keyword">bool</span> isFixed) : m_Pose(pose), m_ID(id), m_Fixed(isFixed), _state_index(<span class="number">-1</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Camera::UpdatePose(<span class="keyword">const</span> Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">6</span>, <span class="number">1</span>&gt; &amp;delta_pose) &#123;</span><br><span class="line">    Sophus::SE3 delta_SE3 = Sophus::SE3::<span class="built_in">exp</span>(delta_pose);</span><br><span class="line">    m_Pose = delta_SE3 * m_Pose;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Camera::UpdatePose(<span class="keyword">const</span> Sophus::SE3 &amp;delta_pose) &#123;</span><br><span class="line">    m_Pose = delta_pose * m_Pose;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义地图点类<ul><li>三维点坐标</li><li>ID</li><li>位置更新</li><li>状态量中的索引</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MapPoint::MapPoint(<span class="keyword">const</span> Eigen::Vector3d&amp; position, <span class="keyword">int</span> id) : m_Positon(position), m_ID(id), _state_index(<span class="number">-1</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> MapPoint::UpdatePosition(<span class="keyword">const</span> Eigen::Vector3d &amp;delta_position) &#123;</span><br><span class="line">    m_Positon += delta_position;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>定义损失函数类<ul><li>相机、地图点、相机内参、观测值、超参数（Hubor核参数b，信息矩阵）</li><li>误差对相机位姿的Jacobian矩阵JT</li><li>误差对地图点的Jacobian矩阵JX</li><li>基于Hubor核函数的成本函数计算</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">CostFunction::CostFunction(MapPoint *map_point, Camera *camera, <span class="keyword">double</span> fx, <span class="keyword">double</span> fy, <span class="keyword">double</span> cx, <span class="keyword">double</span> cy, <span class="keyword">const</span> Eigen::Vector2d &amp;ob_z)</span><br><span class="line">  : _map_point(map_point), _camera(camera), m_Fx(fx), m_Fy(fy), m_Cx(cx), m_Cy(cy), m_Ob_z(ob_z), m_Huber_b(<span class="number">1.0</span>), m_Info_matrix(Eigen::Matrix2d::Identity()) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CostFunction::ComputeJT(Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">6</span>&gt; &amp;JT) &#123;</span><br><span class="line">    <span class="keyword">const</span> Eigen::Vector3d pt = _camera-&gt;GetPose() * _map_point-&gt;GetPosition();</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> &amp;x = pt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> &amp;y = pt(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> &amp;z = pt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    JT.setZero();</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> z2 = z*z;</span><br><span class="line"></span><br><span class="line">    JT(<span class="number">0</span>, <span class="number">0</span>) = m_Fx / z;</span><br><span class="line">    JT(<span class="number">0</span>, <span class="number">2</span>) = -m_Fx * x / z2;</span><br><span class="line">    JT(<span class="number">0</span>, <span class="number">3</span>) = -m_Fx * x * y / z2;</span><br><span class="line">    JT(<span class="number">0</span>, <span class="number">4</span>) = m_Fx + m_Fx * x * x / z2;</span><br><span class="line">    JT(<span class="number">0</span>, <span class="number">5</span>) = -m_Fx * y / z;</span><br><span class="line"></span><br><span class="line">    JT(<span class="number">1</span>, <span class="number">1</span>) = m_Fy / z;</span><br><span class="line">    JT(<span class="number">1</span>, <span class="number">2</span>) = -m_Fy * y / z2;</span><br><span class="line">    JT(<span class="number">1</span>, <span class="number">3</span>) = -m_Fy - m_Fy * y * y / z2;</span><br><span class="line">    JT(<span class="number">1</span>, <span class="number">4</span>) = m_Fy * x * y / z2;</span><br><span class="line">    JT(<span class="number">1</span>, <span class="number">5</span>) = m_Fy * x / z;</span><br><span class="line"></span><br><span class="line">    JT = -JT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CostFunction::ComputeJX(Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">3</span>&gt; &amp;JX) &#123;</span><br><span class="line">    <span class="keyword">const</span> Eigen::Vector3d pt = _camera-&gt;GetPose() * _map_point-&gt;GetPosition();</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> &amp;x = pt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> &amp;y = pt(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> &amp;z = pt(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> z2 = z*z;</span><br><span class="line"></span><br><span class="line">    JX.setZero();</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">3</span>&gt; Jx;</span><br><span class="line">    Jx.setZero();</span><br><span class="line">    Jx(<span class="number">0</span>, <span class="number">0</span>) = m_Fx / z;</span><br><span class="line">    Jx(<span class="number">0</span>, <span class="number">2</span>) = -m_Fx * x / z2;</span><br><span class="line">    Jx(<span class="number">1</span>, <span class="number">1</span>) = m_Fy / z;</span><br><span class="line">    Jx(<span class="number">1</span>, <span class="number">2</span>) = -m_Fy * y / z2;</span><br><span class="line"></span><br><span class="line">    JX = -Jx * _camera-&gt;GetPose().rotation_matrix();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-增量线性方程"><a href="#5-增量线性方程" class="headerlink" title="5. 增量线性方程"></a>5. 增量线性方程</h1><p>无论使用Gauss-Netwon还是Levenburg-Marquadt方法求解最小二乘问题,都会求解一个关于增量的线性方程:</p><p>$H\delta x = g$.</p><p>G-N 和L-M 的主要差别在于，这里的H 是取$J^TJ$还是$J^TJ + \lambda I$的形式。由于我们把变量归类成了位姿和空间点两种，所以雅可比矩阵可以分块为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141253.png" alt="image-20200516221247122" style="zoom:50%;"></p><p>因此，我们得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141357.png" alt="image-20200516221352391" style="zoom:50%;"></p><p>Bundle Adjustment中的H矩阵，具有特殊的稀疏结构。利用这种稀疏结构可以加速求解过程。我们这里的实现使用了舒尔补的方法求解。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141613.png" alt="image-20200516221605391" style="zoom:50%;"></p><p>因此，线性方程组$H\delta x = g$可以写为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141755.png" alt="image-20200516221659506" style="zoom:50%;"></p><p>利用舒尔补消元，我们首先求解$\delta x$。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141757.png" alt="image-20200516221747769" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141812.png" alt="image-20200516221807112" style="zoom:50%;"></p><p>然后再去求解$\delta x_p$：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-16-141855.png" alt="image-20200516221850254" style="zoom:50%;"></p><p>由于C 为对角块，所以$C^{-1}$容易解得。</p><h1 id="6-固定部分状态"><a href="#6-固定部分状态" class="headerlink" title="6. 固定部分状态"></a>6. 固定部分状态</h1><p>对于一个Bundle Adjustment问题，我们必须固定一部分状态，或者给一部分状态一个先验。不然，就会有无穷多解。可以想象一下，一个网络的误差已经达到了最小后，可以整体在空间内任意移动，而不会对误差造成任何影响。我们只要固定这个网络中的任意1个以上的节点，其他的节点都会有确定的状态。（我们通常会把第一个位姿固定）</p><p>怎么固定呢？一种可以加一个先验约束，就是加一个先验cost function。另外一种就是直接把状态fix住，不让它参与优化就好了。 我们采用后一种方法。</p><h1 id="7-代码实现"><a href="#7-代码实现" class="headerlink" title="7. 代码实现"></a>7. 代码实现</h1><ul><li>实现思路如上所述</li><li>实现代码参考如下工程<ul><li><a href="https://github.com/ydsf16/vslam" target="_blank" rel="noopener">https://github.com/ydsf16/vslam</a></li><li><a href="https://github.com/raulmur/ORB_SLAM2" target="_blank" rel="noopener">https://github.com/raulmur/ORB_SLAM2</a></li><li><a href="https://github.com/meiroo/ORBSLAM2-OSX" target="_blank" rel="noopener">https://github.com/meiroo/ORBSLAM2-OSX</a></li></ul></li><li>简单介绍<ul><li>依赖库<ul><li>Eigen3</li><li>Sophus</li><li>OpenCV</li></ul></li><li>结构<ul><li>定义几个类，分别是地图点，相机位姿，CostFunction</li><li>地图点和相机位姿类用来存储需要优化的状态，通过id进行标识</li><li>CostFunction用来存储代价函数、观测，计算雅克比、残差等</li><li>BundleAdjustment类求解BA问题<ul><li>map结构存储地图点和相机，主要是为了方便快速查找；构造地图点、相机，加入到BundleAdjustment类</li><li>set结构存储cost function，构造cost function，加入到BundleAdjustment类</li><li>将所有cost function的雅克比、信息矩阵整合成大的雅克比、信息矩阵、Hassian矩阵等</li><li>采用LM优化算法求解最小二乘问题</li><li>根据id将结果取出</li></ul></li></ul></li></ul></li></ul><p>（1）初始化BundleAdjustment类</p><ul><li>设定优化算法迭代终止条件<ul><li>最大迭代次数20</li><li>误差阈值1e-10</li><li>设置min delta</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> BundleAjustment::Init(<span class="keyword">int</span> max_iters, <span class="keyword">double</span> min_delta, <span class="keyword">double</span> min_error, <span class="keyword">bool</span> verbose) &#123;</span><br><span class="line">    max_iters_ = max_iters;</span><br><span class="line">    min_delta_ = min_delta;</span><br><span class="line">    min_error_ = min_error;</span><br><span class="line">    verbose_ = verbose;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（2）将地图点、相机和成本函数添加到BundleAdjustment类</p><ul><li>ID就是添加到顺序索引</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::addMapPoint(MapPoint *mpt) &#123;</span><br><span class="line">    m_MapPoints[mpt-&gt;GetID()] = mpt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::addCamera(Camera *cam) &#123;</span><br><span class="line">    m_Cameras[cam-&gt;GetID()] = cam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::addCostFunction(CostFunction *cost_func) &#123;</span><br><span class="line">    m_CostFunstions.insert(cost_func);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）采用LM优化算法求解</p><ul><li>初始化<ul><li>确定各个矩阵的大小</li><li>定义状态量大小为$N_s$，相机个数为$N_c$，地图点个数为$N_m$，观测数量为$N_{cost}$，观测量大小为$N_o$</li><li>$N_s = N_c \times 6 + N_m \times 3$，其中，6表示相机的位姿维度，即se3，3表示地图点向量维度，即三维坐标</li><li>$N_o = N_{cost} \times 2$，其中，2表示每个Jacobian为2行</li><li>Jacobian大小为$N_o \times N_s$</li><li>H的大小为$N_s \times N_s$，$H = J^TJ$</li><li>r的大小为$N_o \times 1$</li><li>b的大小为$N_s \times 1$，$b = -J^Tr$</li><li>$\Delta x$的大小为$N_s \times 1$</li><li>信息矩阵大小为$N_o \times N_o$</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> BundleAjustment::optimizationInit() &#123;</span><br><span class="line">    <span class="keyword">int</span> state_size = n_cam_state_ * <span class="number">6</span> + n_mpt_state_ * <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">int</span> obs_size = m_CostFunstions.size() * <span class="number">2</span>;</span><br><span class="line">    J_.resize ( obs_size, state_size );</span><br><span class="line">    JTinfo_.resize ( state_size, obs_size );</span><br><span class="line">    H_.resize ( state_size, state_size );</span><br><span class="line">    r_.resize ( obs_size, <span class="number">1</span> );</span><br><span class="line">    b_.resize ( state_size, <span class="number">1</span> );</span><br><span class="line">    info_matrix_.resize ( obs_size, obs_size );</span><br><span class="line">    Delta_X_.resize ( state_size, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">    I_.resize ( state_size, state_size );</span><br><span class="line">    <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; state_size; i ++ ) &#123;</span><br><span class="line">      I_ ( i,i ) = <span class="number">1.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>求H、b和误差量<ul><li>H的大小为$N_s \times N_s$，$H = J^TJ$</li><li>r的大小为$N_o \times 1$</li><li>b的大小为$N_s \times 1$，$b = -J^Tr$</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::computeHAndbAndError() &#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    J_.setZero();</span><br><span class="line">    H_.setZero();</span><br><span class="line">    r_.setZero();</span><br><span class="line">    info_matrix_.setZero();</span><br><span class="line">    JTinfo_.setZero();</span><br><span class="line"></span><br><span class="line">    sum_error2_ = <span class="number">0.0</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">set</span>&lt;CostFunction*&gt;::iterator iter;</span><br><span class="line">    <span class="keyword">for</span> ( iter = m_CostFunstions.begin(); iter != m_CostFunstions.end(); iter ++ ) &#123;</span><br><span class="line">      CostFunction* cost_func = *iter;</span><br><span class="line">      Camera* cam = cost_func-&gt;_camera;</span><br><span class="line">      <span class="keyword">if</span> ( cam-&gt;IsFixed() == <span class="literal">false</span> ) &#123;</span><br><span class="line">        Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">6</span>&gt; JT;</span><br><span class="line">        cost_func-&gt;ComputeJT ( JT );</span><br><span class="line">        J_.block ( <span class="number">2</span>*cnt, cam-&gt;_state_index*<span class="number">6</span>, <span class="number">2</span>,<span class="number">6</span> ) = JT;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      MapPoint* mpt = cost_func-&gt;_map_point;</span><br><span class="line">      Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">3</span>&gt; JX;</span><br><span class="line">      cost_func-&gt;ComputeJX ( JX );</span><br><span class="line">      J_.block ( <span class="number">2</span>*cnt, n_cam_state_*<span class="number">6</span> + mpt-&gt;_state_index*<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span> ) = JX;</span><br><span class="line"></span><br><span class="line">      Eigen::Vector2d e;</span><br><span class="line">      Eigen::Matrix2d weighted_info;</span><br><span class="line">      <span class="keyword">double</span> weighted_e2;</span><br><span class="line">      cost_func-&gt;ComputeInterVars ( e, weighted_info, weighted_e2 );</span><br><span class="line"></span><br><span class="line">      r_.block ( <span class="number">2</span>*cnt, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span> ) = e;</span><br><span class="line">      info_matrix_.block ( <span class="number">2</span>*cnt, <span class="number">2</span>*cnt, <span class="number">2</span>, <span class="number">2</span> ) = weighted_info;</span><br><span class="line"></span><br><span class="line">      sum_error2_ += weighted_e2;</span><br><span class="line">      cnt ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    JTinfo_ = J_.transpose() * info_matrix_;</span><br><span class="line">    H_ = JTinfo_ * J_;</span><br><span class="line">    b_ = -JTinfo_ * r_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>LM求解<ul><li>计算$\mu$，首先令$\mu = \tau\max{H_{i, i}}$，其中，$\tau = 1e-8$</li><li>$H += \mu I$</li><li>利用舒尔补方法和QR分解求解正规方程</li><li>根据求解出来的$\Delta X$状态量更新相机和地图点状态</li><li>再次计算H、b和误差量</li><li>更新LM中的参数$\mu$<ul><li>计算超参数$\rho = \frac{F(x) - f(x + h)}{L(0) - L(h)}$</li><li>如果$\rho &gt; 0$，则接受$\mu$，更新$\mu = \mu\max(\frac{1}{3}, 1 - (2\rho - 1)^3)$，$v = v\times2$</li><li>如果$\rho \leq 0$，则拒绝本次更新，恢复前一步的相机和地图点状态并重新计算H、b和误差，$\mu = v\times\mu$，$v = v\times2$</li></ul></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> BundleAjustment::optimize() &#123;</span><br><span class="line">    optimizationInit();</span><br><span class="line">    <span class="keyword">int</span> niter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">double</span> upsilon = <span class="number">2.0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> tau = <span class="number">1e-8</span>;</span><br><span class="line"></span><br><span class="line">    computeHAndbAndError();</span><br><span class="line">    last_sum_error2_ = sum_error2_;</span><br><span class="line">    <span class="keyword">bool</span> found = ( ( -b_ ).lpNorm&lt;Eigen::Infinity&gt;() &lt; min_error_ );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; aa;</span><br><span class="line">    aa.reserve ( H_.rows() );</span><br><span class="line">    <span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; H_.rows(); i ++ ) &#123;</span><br><span class="line">      aa.push_back ( H_ ( i,i ) );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">auto</span> max_aa = <span class="built_in">std</span>::max_element ( aa.begin(), aa.end() );</span><br><span class="line">    <span class="keyword">double</span> mu = tau* ( *max_aa );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> total_time = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( !found &amp;&amp; niter &lt; max_iters_ ) &#123;</span><br><span class="line">      Runtimer t;</span><br><span class="line">      t.start();</span><br><span class="line"></span><br><span class="line">      niter ++;</span><br><span class="line"></span><br><span class="line">      H_ += mu * I_;</span><br><span class="line">      solveNormalEquation();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">double</span> delta = Delta_X_.norm();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( delta &lt; min_delta_ ) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      updateStates();</span><br><span class="line"></span><br><span class="line">      computeHAndbAndError();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">double</span> varrho = (last_sum_error2_ - sum_error2_) / (Delta_X_.transpose() * (mu * Delta_X_ + b_))(<span class="number">0</span>,<span class="number">0</span>) ;</span><br><span class="line">      <span class="keyword">if</span>(varrho &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        last_sum_error2_ = sum_error2_;</span><br><span class="line">        found = ( ( -b_ ).lpNorm&lt;Eigen::Infinity&gt;() &lt; min_error_ );</span><br><span class="line">        mu = mu * <span class="built_in">std</span>::max&lt;<span class="keyword">double</span>&gt;(<span class="number">0.3333</span>, <span class="number">1.0</span>-<span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="number">2.0</span>*varrho<span class="number">-1.0</span>, <span class="number">3</span>));</span><br><span class="line">        upsilon = <span class="number">2.0</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        recoverStates();</span><br><span class="line">        computeHAndbAndError();</span><br><span class="line">        mu = mu * upsilon;</span><br><span class="line">        upsilon *= <span class="number">2.0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      t.stop();</span><br><span class="line">      total_time += t.duration();</span><br><span class="line">      <span class="keyword">if</span>(verbose_) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="string">"Iter: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">4</span>) &lt;&lt; niter</span><br><span class="line">          &lt;&lt; <span class="string">" Cost: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">20</span>)  &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">10</span>) &lt;&lt; sum_error2_</span><br><span class="line">          &lt;&lt; <span class="string">" Step: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">10</span>) &lt;&lt; delta</span><br><span class="line">          &lt;&lt; <span class="string">" Time "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>) &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">3</span>) &lt;&lt; t.duration()</span><br><span class="line">          &lt;&lt; <span class="string">" Total_time "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>) &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">3</span>) &lt;&lt; total_time &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::computeHAndbAndError() &#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    J_.setZero();</span><br><span class="line">    H_.setZero();</span><br><span class="line">    r_.setZero();</span><br><span class="line">    info_matrix_.setZero();</span><br><span class="line">    JTinfo_.setZero();</span><br><span class="line"></span><br><span class="line">    sum_error2_ = <span class="number">0.0</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">set</span>&lt;CostFunction*&gt;::iterator iter;</span><br><span class="line">    <span class="keyword">for</span> ( iter = m_CostFunstions.begin(); iter != m_CostFunstions.end(); iter ++ ) &#123;</span><br><span class="line">      CostFunction* cost_func = *iter;</span><br><span class="line">      Camera* cam = cost_func-&gt;_camera;</span><br><span class="line">      <span class="keyword">if</span> ( cam-&gt;IsFixed() == <span class="literal">false</span> ) &#123;</span><br><span class="line">        Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">6</span>&gt; JT;</span><br><span class="line">        cost_func-&gt;ComputeJT ( JT );</span><br><span class="line">        J_.block ( <span class="number">2</span>*cnt, cam-&gt;_state_index*<span class="number">6</span>, <span class="number">2</span>,<span class="number">6</span> ) = JT;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      MapPoint* mpt = cost_func-&gt;_map_point;</span><br><span class="line">      Eigen::Matrix&lt;<span class="keyword">double</span>, <span class="number">2</span>, <span class="number">3</span>&gt; JX;</span><br><span class="line">      cost_func-&gt;ComputeJX ( JX );</span><br><span class="line">      J_.block ( <span class="number">2</span>*cnt, n_cam_state_*<span class="number">6</span> + mpt-&gt;_state_index*<span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span> ) = JX;</span><br><span class="line"></span><br><span class="line">      Eigen::Vector2d e;</span><br><span class="line">      Eigen::Matrix2d weighted_info;</span><br><span class="line">      <span class="keyword">double</span> weighted_e2;</span><br><span class="line">      cost_func-&gt;ComputeInterVars ( e, weighted_info, weighted_e2 );</span><br><span class="line"></span><br><span class="line">      r_.block ( <span class="number">2</span>*cnt, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span> ) = e;</span><br><span class="line">      info_matrix_.block ( <span class="number">2</span>*cnt, <span class="number">2</span>*cnt, <span class="number">2</span>, <span class="number">2</span> ) = weighted_info;</span><br><span class="line"></span><br><span class="line">      sum_error2_ += weighted_e2;</span><br><span class="line">      cnt ++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    JTinfo_ = J_.transpose() * info_matrix_;</span><br><span class="line">    H_ = JTinfo_ * J_;</span><br><span class="line">    b_ = -JTinfo_ * r_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::solveNormalEquation() &#123;</span><br><span class="line">    <span class="keyword">if</span> ( n_cam_state_ &gt;= <span class="number">1</span> &amp;&amp; n_mpt_state_ &gt;= <span class="number">1</span> ) &#123;</span><br><span class="line">      <span class="keyword">const</span> Eigen::MatrixXd&amp; C = H_.block ( <span class="number">0</span>, <span class="number">0</span>, n_cam_state_*<span class="number">6</span>, n_cam_state_*<span class="number">6</span> );</span><br><span class="line">      <span class="keyword">const</span> Eigen::MatrixXd&amp; M = H_.block ( n_cam_state_*<span class="number">6</span>, n_cam_state_*<span class="number">6</span>, n_mpt_state_*<span class="number">3</span>, n_mpt_state_*<span class="number">3</span> );</span><br><span class="line">      <span class="keyword">const</span> Eigen::MatrixXd&amp; Etrans = H_.block ( n_cam_state_*<span class="number">6</span>, <span class="number">0</span>, n_mpt_state_*<span class="number">3</span>, n_cam_state_*<span class="number">6</span>);</span><br><span class="line">      <span class="keyword">const</span> Eigen::MatrixXd&amp; E = H_.block ( <span class="number">0</span>, n_cam_state_*<span class="number">6</span>, n_cam_state_*<span class="number">6</span>, n_mpt_state_*<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> Eigen::MatrixXd&amp; bc = b_.block ( <span class="number">0</span>, <span class="number">0</span>, n_cam_state_*<span class="number">6</span>, <span class="number">1</span> );</span><br><span class="line">      <span class="keyword">const</span> Eigen::MatrixXd&amp; bm = b_.block ( n_cam_state_*<span class="number">6</span>, <span class="number">0</span>, n_mpt_state_*<span class="number">3</span>, <span class="number">1</span> );</span><br><span class="line"></span><br><span class="line">      Eigen::MatrixXd M_inv;</span><br><span class="line">      inverseM ( M, M_inv );</span><br><span class="line"></span><br><span class="line">      Delta_X_.block ( <span class="number">0</span>, <span class="number">0</span>, n_cam_state_*<span class="number">6</span>, <span class="number">1</span> ) =</span><br><span class="line">        ( C-E*M_inv*Etrans ).fullPivHouseholderQr().solve ( bc-E*M_inv*bm );</span><br><span class="line"></span><br><span class="line">      Delta_X_.block ( n_cam_state_*<span class="number">6</span>, <span class="number">0</span>, n_mpt_state_*<span class="number">3</span>, <span class="number">1</span> ) =</span><br><span class="line">        M_inv * ( bm - Etrans * Delta_X_.block ( <span class="number">0</span>, <span class="number">0</span>, n_cam_state_*<span class="number">6</span>, <span class="number">1</span> ) );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      Delta_X_ = H_.llt().solve ( b_ );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::updateStates() &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">int</span>, Camera*&gt;::iterator it_cam;</span><br><span class="line">    <span class="keyword">for</span> ( it_cam = m_Cameras.begin(); it_cam != m_Cameras.end(); it_cam ++ ) &#123;</span><br><span class="line">      Camera* cam = it_cam-&gt;second;</span><br><span class="line">      <span class="keyword">if</span> ( cam-&gt;IsFixed() == <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = cam-&gt;_state_index;</span><br><span class="line">        cam-&gt;UpdatePose ( Delta_X_.block ( index*<span class="number">6</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span> ) );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">int</span>, MapPoint*&gt;::iterator it_mpt;</span><br><span class="line">    <span class="keyword">for</span> ( it_mpt = m_MapPoints.begin(); it_mpt != m_MapPoints.end(); it_mpt++ ) &#123;</span><br><span class="line">      MapPoint* mpt = it_mpt-&gt;second;</span><br><span class="line">      <span class="keyword">int</span> index = mpt-&gt;_state_index;</span><br><span class="line">      mpt-&gt;UpdatePosition ( Delta_X_.block ( n_cam_state_*<span class="number">6</span> + index*<span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BundleAjustment::recoverStates() &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">int</span>, Camera*&gt;::iterator it_cam;</span><br><span class="line">    <span class="keyword">for</span> ( it_cam = m_Cameras.begin(); it_cam != m_Cameras.end(); it_cam ++ ) &#123;</span><br><span class="line">      Camera* cam = it_cam-&gt;second;</span><br><span class="line">      <span class="keyword">if</span> ( cam-&gt;IsFixed() == <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="keyword">int</span> index = cam-&gt;_state_index;</span><br><span class="line">        cam-&gt;UpdatePose ( -Delta_X_.block ( index*<span class="number">6</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">1</span> ) );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">map</span>&lt;<span class="keyword">int</span>, MapPoint*&gt;::iterator it_mpt;</span><br><span class="line">    <span class="keyword">for</span> ( it_mpt = m_MapPoints.begin(); it_mpt != m_MapPoints.end(); it_mpt++ ) &#123;</span><br><span class="line">      MapPoint* mpt = it_mpt-&gt;second;</span><br><span class="line">      <span class="keyword">int</span> index = mpt-&gt;_state_index;</span><br><span class="line">      mpt-&gt;UpdatePosition ( -Delta_X_.block ( n_cam_state_*<span class="number">6</span> + index*<span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="8-参考"><a href="#8-参考" class="headerlink" title="8. 参考"></a>8. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/64471565" target="_blank" rel="noopener">[V-SLAM] Bundle Adjustment 实现</a></li><li>《视觉SLAM十四讲》</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> SLAM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> SLAM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode算法（二）-算法-算法思想</title>
      <link href="/2020/05/13/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%AE%97%E6%B3%95-%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/"/>
      <url>/2020/05/13/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%AE%97%E6%B3%95-%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-思想"><a href="#2-思想" class="headerlink" title="2. 思想"></a>2. 思想</h1><div class="table-container"><table><thead><tr><th>思想</th><th>解释</th><th>应用</th></tr></thead><tbody><tr><td>双指针思想</td><td>快指针遍历数组，慢指针在一定条件下移动</td><td>- 删除排序数组</td></tr><tr><td>循环交换</td><td>整体旋转拆分为多个部分旋转后再旋转</td><td>- 旋转数组</td></tr><tr><td>位运算</td><td>异或</td><td>- 删除相同元素</td></tr><tr><td>哈希映射</td><td>存储键值，记录个数</td><td>- 两个数组的交集</td></tr><tr><td>桶思想</td><td>建立多个桶来实现相关操作</td><td>- 建立26个字母桶，实现对字符串的操作，例如字符串中的第一个唯一字符</td></tr><tr><td></td><td></td></tr></tbody></table></div>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Leetcode算法（二）-探索初级算法-数组</title>
      <link href="/2020/05/09/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A2%E7%B4%A2%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95-%E6%95%B0%E7%BB%84/"/>
      <url>/2020/05/09/data_structure_algorithm/Leetcode%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A2%E7%B4%A2%E5%88%9D%E7%BA%A7%E7%AE%97%E6%B3%95-%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><h1 id="2-算法题"><a href="#2-算法题" class="headerlink" title="2. 算法题"></a>2. 算法题</h1><h2 id="2-1-删除排序数组中的重复项"><a href="#2-1-删除排序数组中的重复项" class="headerlink" title="2.1 删除排序数组中的重复项"></a>2.1 删除排序数组中的重复项</h2><ul><li>给定一个排序数组，你需要在<strong><a href="http://baike.baidu.com/item/原地算法" target="_blank" rel="noopener"> 原地</a></strong> 删除重复出现的元素，使得每个元素只出现一次，返回移除后数组的新长度</li><li>不要使用额外的数组空间，你必须在 <strong><a href="https://baike.baidu.com/item/原地算法" target="_blank" rel="noopener">原地 </a>修改输入数组</strong> 并在使用 O(1) 额外空间的条件下完成</li><li>主要思想<ul><li>双指针思想</li><li>快指针遍历数组，慢指针在一定条件下移动，条件如下<ul><li>当遇到重复元素，位置不变</li><li>当遇到不同元素时，位置向前移动一位，并将元素赋值给当前位置</li></ul></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; nums.size()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] != nums[j]) &#123;</span><br><span class="line">                j ++;</span><br><span class="line">                nums[j] = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            i ++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> j + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-2-存在重复元素"><a href="#2-2-存在重复元素" class="headerlink" title="2.2 存在重复元素"></a>2.2 存在重复元素</h2><ul><li>给定一个整数数组，判断是否存在重复元素</li><li>如果任意一值在数组中出现至少两次，函数返回 <code>true</code> 。如果数组中每个元素都不相同，则返回 <code>false</code></li><li>解题思路<ul><li>利用set集合，过滤重复元素</li><li>如果set集合大小小于原数组大小，则证明有重复元素</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">containsDuplicate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nums.size() &gt; <span class="built_in">unordered_set</span>&lt;<span class="keyword">int</span>&gt;(nums.begin(), nums.end()).size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-3-加一"><a href="#2-3-加一" class="headerlink" title="2.3 加一"></a>2.3 加一</h2><ul><li>给定一个由<strong>整数</strong>组成的<strong>非空</strong>数组所表示的非负整数，在该数的基础上加一</li><li>最高位数字存放在数组的首位， 数组中每个元素只存储<strong>单个</strong>数字</li><li>你可以假设除了整数 0 之外，这个整数不会以零开头</li><li>主要思想<ul><li>缝9，置为0，高位加一</li><li>最后，如果最高位为9，加一，则需要在首位插入1</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; plusOne(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; digits) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nums;</span><br><span class="line">        <span class="keyword">bool</span> isLabel = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = digits.size() - <span class="number">1</span> ; i &gt;= <span class="number">0</span>; i --) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isLabel) &#123;</span><br><span class="line">                digits[i] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (digits[i] &gt; <span class="number">9</span>) &#123;</span><br><span class="line">                digits[i] = <span class="number">0</span>;</span><br><span class="line">                nums.push_back(digits[i]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                isLabel = <span class="literal">true</span>;</span><br><span class="line">                nums.insert(nums.begin(), digits[i]);</span><br><span class="line">            &#125;                   </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (digits[<span class="number">0</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">            nums.insert(nums.begin(), <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>优化<ul><li>不开辟新空间</li><li>从低位到高位遍历，遇到9，就置为0；不满9，加一，退出</li><li>如果最高位也是9，则置为1，最后压入0</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; plusOne(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; digits) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = digits.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; digits[i] == <span class="number">9</span>) &#123;</span><br><span class="line">                digits[i] = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &gt;= <span class="number">0</span> &amp;&amp; digits[i] &lt; <span class="number">9</span>) &#123;</span><br><span class="line">                digits[i] += <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; digits[i] == <span class="number">9</span>) &#123;</span><br><span class="line">                digits[i] = <span class="number">1</span>;</span><br><span class="line">                digits.push_back(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> digits;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-4-买卖股票的最佳时机-II"><a href="#2-4-买卖股票的最佳时机-II" class="headerlink" title="2.4 买卖股票的最佳时机 II"></a>2.4 买卖股票的最佳时机 II</h2><ul><li>给定一个数组，它的第 <em>i</em> 个元素是一支给定股票第 <em>i</em> 天的价格</li><li>设计一个算法来计算你所能获取的最大利润。你可以尽可能地完成更多的交易（多次买卖一支股票）</li><li>解题思路<ul><li>低买高卖</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> buy = <span class="number">0</span>, sell = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> price = <span class="number">0</span>, diff = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; prices.size(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (buy == <span class="number">0</span> &amp;&amp; sell != <span class="number">0</span> &amp;&amp; i &lt; prices.size() - <span class="number">1</span> &amp;&amp; prices[i] &lt; prices[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                price = prices[i];</span><br><span class="line">                buy = <span class="number">1</span>;</span><br><span class="line">                sell = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (buy != <span class="number">0</span> &amp;&amp; sell == <span class="number">0</span> &amp;&amp; i &lt; prices.size() - <span class="number">1</span> &amp;&amp; prices[i] &gt; prices[i - <span class="number">1</span>] &amp;&amp; prices[i] &gt;= prices[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                diff += prices[i] - price;</span><br><span class="line">                buy = <span class="number">0</span>;</span><br><span class="line">                sell = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i == prices.size() - <span class="number">1</span> &amp;&amp; buy != <span class="number">0</span>) &#123;</span><br><span class="line">                diff += prices[i] - price;</span><br><span class="line">                buy = <span class="number">0</span>;</span><br><span class="line">                sell = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> diff;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-5-旋转数组"><a href="#2-5-旋转数组" class="headerlink" title="2.5 旋转数组"></a>2.5 旋转数组</h2><ul><li>给定一个数组，将数组中的元素向右移动 <em>k</em> 个位置，其中 <em>k</em> 是非负数</li><li>解题思路<ul><li>使用一个数组保存k位，移动结束后，再将数组内的数据赋值给原数组前k位</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() &lt;= k) &#123;</span><br><span class="line">            k %= nums.size();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">array</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = nums.size() - <span class="number">1</span>; i &gt; nums.size() - k - <span class="number">1</span>; i --) &#123;</span><br><span class="line">            <span class="built_in">array</span>.push_back(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.size() - k - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --) &#123;</span><br><span class="line">            nums[i + k] = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i ++) &#123;</span><br><span class="line">            nums[i] = <span class="built_in">array</span>[k - i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>循环交换</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; nums, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = nums[i];</span><br><span class="line">        nums[i] = nums[j];</span><br><span class="line">        nums[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k &gt;= nums.size())</span><br><span class="line">            k %= nums.size();</span><br><span class="line">        <span class="keyword">if</span>(k != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> n=nums.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> start = <span class="number">0</span>; start &lt; nums.size() &amp;&amp; k != <span class="number">0</span>; n -= k, start += k, k %= n) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">                    swap(nums, start + i, nums.size() - k + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>库函数</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">std</span>::rotate(nums.begin(), nums.end() - k % nums.size(), nums.end());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>三次反转<ul><li>把左部分翻转</li><li>把右部分翻转</li><li>最后把整体翻转</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        reverse(nums.begin(), nums.end() - k % nums.size());</span><br><span class="line">        reverse(nums.end() - k % nums.size(), nums.end());</span><br><span class="line">        reverse(nums.begin(), nums.end());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-6-只出现一次的数字"><a href="#2-6-只出现一次的数字" class="headerlink" title="2.6 只出现一次的数字"></a>2.6 只出现一次的数字</h2><ul><li>给定一个<strong>非空</strong>整数数组，除了某个元素只出现一次以外，其余每个元素均出现两次。找出那个只出现了一次的元素</li><li>你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗</li><li>解题思路<ul><li>如果没有时间复杂度和空间复杂度的限制，这道题有很多种解法，可能的解法有如下几种<ul><li>使用集合存储数字。遍历数组中的每个数字，如果集合中没有该数字，则将该数字加入集合，如果集合中已经有该数字，则将该数字从集合中删除，最后剩下的数字就是只出现一次的数字</li><li>使用哈希表存储每个数字和该数字出现的次数。遍历数组即可得到每个数字出现的次数，并更新哈希表，最后遍历哈希表，得到只出现一次的数字</li><li>使用集合存储数组中出现的所有数字，并计算数组中的元素之和。由于集合保证元素无重复，因此计算集合中的所有元素之和的两倍，即为每个元素出现两次的情况下的元素之和。由于数组中只有一个元素出现一次，其余元素都出现两次，因此用集合中的元素之和的两倍减去数组中的元素之和，剩下的数就是数组中只出现一次的数字</li></ul></li><li>上述三种解法都需要额外使用 O(n)的空间，其中 n是数组长度。如果要求使用线性时间复杂度和常数空间复杂度</li><li>位运算</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        sort(nums.begin(), nums.end());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] != nums[i + <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> nums[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == nums.size() - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] != nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> nums[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[i] != nums[i + <span class="number">1</span>] &amp;&amp; nums[i] != nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">return</span> nums[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ret = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.size(); i ++) &#123;</span><br><span class="line">            ret ^= nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-7-两个数组的交集-II"><a href="#2-7-两个数组的交集-II" class="headerlink" title="2.7 两个数组的交集 II"></a>2.7 两个数组的交集 II</h2><ul><li>给定两个数组，编写一个函数来计算它们的交集</li><li>解题思路<ul><li>使用map，第一轮循环让map中的value值存储nums1中对应key值的元素数量，第二轮循环遍历num2中的元素，如果map中此时key为i对应的value大于等于1,即为交集元素，加入存储答案的vector中</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; intersect(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums1, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums2) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ret;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; m;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> num : nums1) &#123;</span><br><span class="line">            ++m[num];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> num : nums2) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m.find(num) != m.end() &amp;&amp; --m[num] &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                ret.push_back(num);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-8-移动零"><a href="#2-8-移动零" class="headerlink" title="2.8 移动零"></a>2.8 移动零</h2><ul><li>给定一个数组 <code>nums</code>，编写一个函数将所有 <code>0</code> 移动到数组的末尾，同时保持非零元素的相对顺序</li><li>解题思路<ul><li>双指针，第一个指针正常向后移动，第二个指针一直保持指向第一个零；如果，第一个指针指向非零元素，则交换两个指针的数据</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.size() &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] != <span class="number">0</span> &amp;&amp; j &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                swap(nums[i], nums[j]);</span><br><span class="line">                j ++;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[i] == <span class="number">0</span> &amp;&amp; j == <span class="number">-1</span>) &#123;</span><br><span class="line">                j = i;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">moveZeroes</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> lastNonZeroFoundAt = <span class="number">0</span>, cur = <span class="number">0</span>; cur &lt; nums.size(); cur++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums[cur] != <span class="number">0</span>) &#123;</span><br><span class="line">            swap(nums[lastNonZeroFoundAt++], nums[cur]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-9-两数之和"><a href="#2-9-两数之和" class="headerlink" title="2.9 两数之和"></a>2.9 两数之和</h2><ul><li>给定一个整数数组 <code>nums</code> 和一个目标值 <code>target</code>，请你在该数组中找出和为目标值的那 <strong>两个</strong> 整数，并返回他们的数组下标</li><li>你可以假设每种输入只会对应一个答案。但是，数组中同一个元素不能使用两遍</li><li>解题思路<ul><li>查找问题想到哈希表来实现</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; twoSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; results;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.size(); i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (m.find(target - nums[i]) != m.end()) &#123;</span><br><span class="line">                results.push_back(m[target - nums[i]]);</span><br><span class="line">                results.push_back(i);</span><br><span class="line">                <span class="keyword">return</span> results;</span><br><span class="line">            &#125;</span><br><span class="line">            m[nums[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="2-10-有效的数独"><a href="#2-10-有效的数独" class="headerlink" title="2.10 有效的数独"></a>2.10 有效的数独</h2><ul><li>判断一个 9x9 的数独是否有效。只需要<strong>根据以下规则</strong>，验证已经填入的数字是否有效即可<ul><li>数字 <code>1-9</code> 在每一行只能出现一次</li><li>数字 <code>1-9</code> 在每一列只能出现一次</li><li>数字 <code>1-9</code> 在每一个以粗实线分隔的 <code>3x3</code> 宫内只能出现一次</li></ul></li><li>解题思路<ul><li>遍历到每个数的时候，例如boar[i][j]，我们判断其是否满足三个条件<ul><li>在第 i 个行中是否出现过</li><li>在第 j 个列中是否出现过</li><li>第 <strong>j/3 + (i/3)*3</strong>个box中是否出现过</li></ul></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isValidSudoku</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&gt;&amp; board)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> row[<span class="number">9</span>][<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">// 哈希表存储每一行的每个数是否出现过，默认初始情况下，每一行每一个数都没有出现过</span></span><br><span class="line">        <span class="comment">// 整个board有9行，第二维的维数10是为了让下标有9，和数独中的数字9对应。</span></span><br><span class="line">        <span class="keyword">int</span> col[<span class="number">9</span>][<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">// 存储每一列的每个数是否出现过，默认初始情况下，每一列的每一个数都没有出现过</span></span><br><span class="line">        <span class="keyword">int</span> box[<span class="number">9</span>][<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">// 存储每一个box的每个数是否出现过，默认初始情况下，在每个box中，每个数都没有出现过。整个board有9个box。</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">9</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;<span class="number">9</span>; j++)&#123;</span><br><span class="line">                <span class="comment">// 遍历到第i行第j列的那个数,我们要判断这个数在其所在的行有没有出现过，</span></span><br><span class="line">                <span class="comment">// 同时判断这个数在其所在的列有没有出现过</span></span><br><span class="line">                <span class="comment">// 同时判断这个数在其所在的box中有没有出现过</span></span><br><span class="line">                <span class="keyword">if</span>(board[i][j] == <span class="string">'.'</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">int</span> curNumber = board[i][j]-<span class="string">'0'</span>;</span><br><span class="line">                <span class="keyword">if</span>(row[i][curNumber]) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">                <span class="keyword">if</span>(col[j][curNumber]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(box[j/<span class="number">3</span> + (i/<span class="number">3</span>)*<span class="number">3</span>][curNumber]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">                row[i][curNumber] = <span class="number">1</span>;<span class="comment">// 之前都没出现过，现在出现了，就给它置为1，下次再遇见就能够直接返回false了。</span></span><br><span class="line">                col[j][curNumber] = <span class="number">1</span>;</span><br><span class="line">                box[j/<span class="number">3</span> + (i/<span class="number">3</span>)*<span class="number">3</span>][curNumber] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>（以上代码参考：<a href="https://leetcode-cn.com/problems/valid-sudoku/solution/36-jiu-an-zhao-cong-zuo-wang-you-cong-shang-wang-x/）" target="_blank" rel="noopener">https://leetcode-cn.com/problems/valid-sudoku/solution/36-jiu-an-zhao-cong-zuo-wang-you-cong-shang-wang-x/）</a></p><h2 id="2-11-旋转图像"><a href="#2-11-旋转图像" class="headerlink" title="2.11 旋转图像"></a>2.11 旋转图像</h2><ul><li>给定一个 <em>n</em> × <em>n</em> 的二维矩阵表示一个图像，将图像顺时针旋转 90 度</li><li>解题思路<ul><li>转置加翻转</li><li>先转置矩阵，然后翻转每一行</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span><span class="params">(self, matrix)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type matrix: List[List[int]]</span></span><br><span class="line"><span class="string">        :rtype: None Do not return anything, modify matrix in-place instead.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        n = len(matrix[<span class="number">0</span>])        </span><br><span class="line">        <span class="comment"># transpose matrix</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i, n):</span><br><span class="line">                matrix[j][i], matrix[i][j] = matrix[i][j], matrix[j][i] </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># reverse each row</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">            matrix[i].reverse()</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; matrix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;matrix.size(); i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;i; j++) swap(matrix[i][j], matrix[j][i]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; row: matrix) reverse(row.begin(), row.end());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-描述子-BRIEF描述子</title>
      <link href="/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E6%8F%8F%E8%BF%B0%E5%AD%90-BRIEF%E6%8F%8F%E8%BF%B0%E5%AD%90/"/>
      <url>/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E6%8F%8F%E8%BF%B0%E5%AD%90-BRIEF%E6%8F%8F%E8%BF%B0%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>BRIEF(Binary Robust Independent Elementary Features)是一种对已检测到的特征点进行表示和描述的特征描述方法，和传统的利用图像局部邻域的灰度直方图或梯度直方图提取特征的方式不同，BRIEF是一种二进制编码的特征描述子，既降低了存储空间的需求，提升了特征描述子生成的速度，也减少了特征匹配时所需的时间</li><li>BRIEF正是这样一种基于二进制编码生成特征描述子，以及利用汉明距离进行特征匹配的算法</li><li>由于BRIEF只是一种特征描述子，因此事先得检测并定位特征点，可采用Harris、FAST或者是SIFT算法检测特征点，在此基础上利用BRIEF算法建立特征描述符，在特征点邻域Patch内随机选取若干点对(p,q)，并比较这些点对的灰度值，若I(p)&gt;I(q)，则编码为1，否则编码为0。这样便可得到一个特定长度的二进制编码串，即BRIEF特征描述子</li><li>算法特点<ul><li>BRIEF算法通过检测随机响应，并采用二进制编码方式建立特征描述子，减少了特征的存储空间需求，并提升了特征生成的速度；Hamming距离的度量方式便于进行特征点的快速匹配，而且大量实验数据表明，不匹配特征点的Hamming距离为128左右(特征维数为256)，而匹配点的Hamming距离则远小于128</li><li>BRIEF算法的缺点是不具备尺度不变性和旋转不变性，在图像的旋转角度超过30度时，特征点匹配的准确率快速下降</li></ul></li></ul><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><ul><li>利用Harris或者FAST等方法检测特征点</li><li>确定特征点的邻域窗口Patch，并对该邻域内像素点进行σ=2、窗口尺寸为9的高斯平滑，以滤除噪声(也可直接对整幅图像做高斯平滑)</li><li>在邻域窗口内随机选取n对(n可取128、256等)像素点，并根据灰度值大小编码成二进制串，生成n位(bit)的特征描述子</li></ul><h1 id="3-采样方式"><a href="#3-采样方式" class="headerlink" title="3. 采样方式"></a>3. 采样方式</h1><ul><li>论文原作者Calonder提供了5种在S×S的邻域Patch内随机选取点对(X,Y)的方法，如下图所示，一条线段的两个端点表示一个随机点对(xi,yi)<ul><li>X、Y为均匀分布[−S/2,S/2]</li><li>X、Y均为高斯分布[0, S2/25]，采样准则服从各向同性的同一高斯分布</li><li>XX 服从高斯分布[0,S2/25]，Y服从高斯分布(xi,S2/100)，即采样分为两步，首先在原点处为xi进行高斯采样，然后在中心为xi处为yi进行高斯采样</li><li>X、Y在空间量化极坐标下的离散位置处进行随机采样</li><li>X固定为(0,0)，Y在空间量化极坐标下的离散位置处进行随机从采样</li></ul></li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-065917.png" alt="image-20200503145906313" style="zoom:50%;"></p><h1 id="4-代码实现"><a href="#4-代码实现" class="headerlink" title="4. 代码实现"></a>4. 代码实现</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/features2d/features2d.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    Mat img_1 = imread(<span class="string">"box.png"</span>); </span><br><span class="line">    Mat img_2 = imread(<span class="string">"box_in_scene.png"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -- Step 1: Detect the keypoints using STAR Detector </span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;KeyPoint&gt; keypoints_1,keypoints_2; </span><br><span class="line">    StarDetector detector; </span><br><span class="line">    detector.detect(img_1, keypoints_1); </span><br><span class="line">    detector.detect(img_2, keypoints_2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -- Stpe 2: Calculate descriptors (feature vectors) </span></span><br><span class="line">    BriefDescriptorExtractor brief; </span><br><span class="line">    Mat descriptors_1, descriptors_2; </span><br><span class="line">    brief.compute(img_1, keypoints_1, descriptors_1); </span><br><span class="line">    brief.compute(img_2, keypoints_2, descriptors_2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-- Step 3: Matching descriptor vectors with a brute force matcher </span></span><br><span class="line">    <span class="function">BFMatcher <span class="title">matcher</span><span class="params">(NORM_HAMMING)</span></span>; </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;DMatch&gt; mathces; </span><br><span class="line">    matcher.match(descriptors_1, descriptors_2, mathces); </span><br><span class="line">    <span class="comment">// -- dwaw matches </span></span><br><span class="line">    Mat img_mathes; </span><br><span class="line">    drawMatches(img_1, keypoints_1, img_2, keypoints_2, mathces, img_mathes); </span><br><span class="line">    <span class="comment">// -- show </span></span><br><span class="line">    imshow(<span class="string">"Mathces"</span>, img_mathes);</span><br><span class="line"></span><br><span class="line">    waitKey(<span class="number">0</span>); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-特征点-FAST角点</title>
      <link href="/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-FAST%E8%A7%92%E7%82%B9/"/>
      <url>/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-FAST%E8%A7%92%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>若某像素点与周围邻域足够多的像素点处于不同区域，则该像素可能为角点。考虑灰度图像，即若某像素点的灰度值比周围邻域足够多的像素点的灰度值大或小，则该点可能为角点</li><li>Viswanathan D G. Features from accelerated segment test (fast)[J]. Homepages. Inf. Ed. Ac. Uk, 2009.</li><li>算法特点<ul><li>FAST算法比其他角点检测算法要快</li><li>受图像噪声以及设定阈值影响较大</li><li>当设置n&lt;12时，不能用快速方法过滤非角点</li><li>FAST不产生多尺度特征，不具备旋转不变性，而且检测到的角点不是最优</li></ul></li></ul><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><ul><li>对于图像中一个像素点p，其灰度值为Ip</li><li>以该像素点为中心考虑一个半径为3的离散化的Bresenham圆，圆边界上有16个像素(如下图所示)</li><li>设定一个合适的阈值tt，如果圆上有n个连续像素点的灰度值小于Ip−t或者大于Ip+t，那么这个点即可判断为角点(n的值可取12或9)</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-034649.png" alt="image-20200503114548034"></p><p>一种快速排除大部分非角点像素的方法就是检查周围1、5、9、13四个位置的像素，如果位置1和9与中心像素P点的灰度差小于给定阈值，则P点不可能是角点，直接排除；否则进一步判断位置5和13与中心像素的灰度差，如果四个像素中至少有3个像素与P点的灰度差超过阈值，则考察邻域圆上16个像素点与中心点的灰度差，如果有至少9个超过给定阈值则认为是角点。</p><h1 id="3-角点分类器"><a href="#3-角点分类器" class="headerlink" title="3. 角点分类器"></a>3. 角点分类器</h1><ul><li>选取需要检测的场景的多张图像进行FAST角点检测，选取合适的阈值n(n&lt;12)，提取多个特征点作为训练数据</li><li>对于特征点邻域圆上的16个像素x∈1,2,…,16x∈1,2,…,16，按下式将其划分为3类</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-035249.png" alt="image-20200503115145466" style="zoom:50%;"></p><ul><li>对每个特征点定义一个bool变量KpKp，如果pp是一个角点，则KpKp为真，否则为假</li><li>对提取的特征点集进行训练，使用ID3算法建立一颗决策树，通过第x个像素点进行决策树的划分，对集合P，得到熵值为</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-035301.png" alt="image-20200503115301139" style="zoom:50%;"></p><ul><li>选择信息增益最大位置进行划分，得到决策树</li><li>使用决策树对类似场景进行特征点的检测与分类</li></ul><h1 id="4-非极大值抑制"><a href="#4-非极大值抑制" class="headerlink" title="4. 非极大值抑制"></a>4. 非极大值抑制</h1><ul><li>对于邻近位置存在多个特征点的情况，需要进一步做非极大值抑制(Non-Maximal Suppression)。给每个已经检测到的角点一个量化的值V，然后比较相邻角点的V值，保留局部邻域内VV值最大的点。V值可定义为<ul><li>特征点与邻域16个像素点灰度绝对差值的和</li></ul></li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-035543.png" alt="image-20200503115522194" style="zoom:50%;"></p><h1 id="5-代码实现"><a href="#5-代码实现" class="headerlink" title="5. 代码实现"></a>5. 代码实现</h1><ul><li>OpenCV3中FAST方法以FastFeatureDetector类的形式封装，为Feature2D类的子类</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CV_EXPORTS_W</span> <span class="title">FastFeatureDetector</span> :</span> <span class="keyword">public</span> Feature2D</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span></span><br><span class="line">    &#123;</span><br><span class="line">        TYPE_5_8 = <span class="number">0</span>, TYPE_7_12 = <span class="number">1</span>, TYPE_9_16 = <span class="number">2</span>,</span><br><span class="line">        THRESHOLD = <span class="number">10000</span>, NONMAX_SUPPRESSION=<span class="number">10001</span>, FAST_N=<span class="number">10002</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    CV_WRAP <span class="keyword">static</span> Ptr&lt;FastFeatureDetector&gt; create( </span><br><span class="line"><span class="keyword">int</span> threshold=<span class="number">10</span>, </span><br><span class="line"><span class="keyword">bool</span> nonmaxSuppression=<span class="literal">true</span>,</span><br><span class="line"><span class="keyword">int</span> type=FastFeatureDetector::TYPE_9_16 );</span><br><span class="line">    <span class="function">CV_WRAP <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">setThreshold</span><span class="params">(<span class="keyword">int</span> threshold)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function">CV_WRAP <span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getThreshold</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function">CV_WRAP <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">setNonmaxSuppression</span><span class="params">(<span class="keyword">bool</span> f)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function">CV_WRAP <span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">getNonmaxSuppression</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function">CV_WRAP <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(<span class="keyword">int</span> type)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function">CV_WRAP <span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-特征点-SIFT算法</title>
      <link href="/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-SIFT%E7%AE%97%E6%B3%95/"/>
      <url>/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-SIFT%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>SIFT（Scale Invariant Feature Transform）算法由Lowe于1999年提出并于2004年得到了改善。其是一种局部特征描述算子，称为尺度不变特征变换。SIFT算子把图像中检测到的特征点用一个128维的特征向量进行描述。因此一幅图像经过SIFT算法后表示为一个128维的特征向量集。该特征向量集具有对图像缩放，平移，旋转不变的特征，对于光照、仿射和投影变换也有一定的不变性，是一种非常优秀的局部特征描述算法</li><li><p>文献</p><ul><li>Lowe D G. Distinctive image features from scale-invariant keypoints[J]. International journal of computer vision, 2004, 60(2): 91-110.</li></ul></li><li><p>主要思想</p><ul><li>实质是在不同的尺度空间上查找关键点(特征点)，并计算出关键点的方向。</li><li>SIFT所查找到的关键点是一些十分突出，不会因光照，仿射变换和噪音等因素而变化的点，如角点、边缘点、暗区的亮点及亮区的暗点等。</li></ul></li><li><p>主要步骤</p><ul><li>尺度空间极值检测：搜索所有尺度上的图像位置。通过高斯微分函数来识别潜在的对于尺度和旋转不变的兴趣点。</li><li>关键点定位：在每个候选的位置上，通过一个拟合精细的模型来确定位置和尺度。关键点的选择依据于它们的稳定程度。</li><li>方向确定：基于图像局部的梯度方向，分配给每个关键点位置一个或多个方向。所有后面的对图像数据的操作都相对于关键点的方向、尺度和位置进行变换，从而提供对于这些变换的不变性。</li><li>关键点描述：在每个关键点周围的邻域内，在选定的尺度上测量图像局部的梯度。这些梯度被变换成一种表示，这种表示允许比较大的局部形状的变形和光照变化。</li></ul></li></ul><h1 id="2-尺度空间理论"><a href="#2-尺度空间理论" class="headerlink" title="2. 尺度空间理论"></a>2. 尺度空间理论</h1><h2 id="2-1-尺度空间定义"><a href="#2-1-尺度空间定义" class="headerlink" title="2.1 尺度空间定义"></a>2.1 尺度空间定义</h2><ul><li><p>尺度空间(scale space)思想最早是由Iijima于1962年提出的，后经witkin和Koenderink等人的推广逐渐得到关注，在计算机视觉邻域使用广泛。</p></li><li><p>基本思想</p><ul><li>在图像信息处理模型中引入一个被视为尺度的参数，通过连续变化尺度参数获得多尺度下的尺度空间表示序列，对这些序列进行尺度空间主轮廓的提取，并以该主轮廓作为一种特征向量，实现边缘、角点检测和不同分辨率上的特征提取等。特征点就是要找到在连续的尺度空间下位置不发生改变的点。</li></ul></li></ul><p>尺度空间应满足视觉不变性：</p><ul><li>灰度不变性<ul><li>图像的亮度水平</li></ul></li><li>对比度不变性<ul><li>图像的对比度水平</li></ul></li><li>平移不变性、尺度不变性、欧几里德不变性以及仿射不变性<ul><li>相对于某一固定坐标系，当观察者和物体之间的相对位置变化时，视网膜所感知的图像的位置、大小、角度和形状是不同的，因此要求尺度空间算子对图像的分析和图像的位置、大小、角度以及仿射变换无关</li></ul></li></ul><h2 id="2-2-尺度空间的表示"><a href="#2-2-尺度空间的表示" class="headerlink" title="2.2 尺度空间的表示"></a>2.2 尺度空间的表示</h2><p>经过前人证明，尺度空间内核是高斯函数。</p><p>假设$I(x, y)$为原图像，$G(x, y, \sigma)$为尺度空间可变的高斯函数，那么该图像的尺度空间可由下式计算：</p><p><script type="math/tex">L(x, y) = G(x, y, \sigma) * I(x, y)</script>,</p><p>其中，$*$表示卷积运算，$\sigma$表示尺度空间的大小，越大表示越模糊，显示图像的概貌，越小图像越清晰，显示图像的细节，$(x, y)$表示图像的像素位置。高斯函数定义如下：</p><p><script type="math/tex">G(x, y, \sigma) = \frac{1}{2\pi \sigma^{2}}e^{-\frac{x^2 + y^2}{2\sigma^2}}</script>.</p><p>关于图像的高斯狙击操作参考XXX。</p><h1 id="3-关键点检测"><a href="#3-关键点检测" class="headerlink" title="3. 关键点检测"></a>3. 关键点检测</h1><ul><li>为了寻找尺度空间的极值点，每一个采样点要和它所有的相邻点比较，看其是否比它的图像域和尺度域的相邻点大或者小</li><li>中间的检测点和它同尺度的8个相邻点和上下相邻尺度对应的9×2个点共26个点比较，以确保在尺度空间和二维图像空间都检测到极值点</li><li>一个点如果在DOG尺度空间本层以及上下两层的26个领域中是最大或最小值时，就认为该点是图像在该尺度下的一个特征点，如图所示</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-013818.png" alt="image-20200328175119836" style="zoom:50%;"></p><ul><li>尺度变化的连续性<ul><li>假设s=3，也就是每个塔里有3层，则k=21/s=21/3，那么按照上图可得Gauss Space和DoG space 分别有3个（s个）和2个（s-1个）分量，在DoG space中，1st-octave两项分别是σ,kσ; 2nd-octave两项分别是2σ,2kσ;由于无法比较极值，我们必须在高斯空间继续添加高斯模糊项，使得形成σ,kσ,k2σ,k3σ,k4σ这样就可以选择DoG space中的中间三项kσ,k2σ,k3σ（只有左右都有才能有极值），那么下一octave中（由上一层降采样获得）所得三项即为2kσ,2k2σ,2k3σ，其首项2kσ=24/3。刚好与上一octave末项k3σ=23/3尺度变化连续起来，所以每次要在Gaussian space添加3项，每组（塔）共S+3层图像，相应的DoG金字塔有S+2层图像</li></ul></li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-013833.png" alt="image-20200328175459744" style="zoom:50%;"></p><p>（图片来源：<a href="https://cloud.tencent.com/developer/article/1081140）" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1081140）</a></p><h1 id="4-消除错配点"><a href="#4-消除错配点" class="headerlink" title="4. 消除错配点"></a>4. 消除错配点</h1><ul><li>由于DoG值对噪声和边缘较敏感，因此，在上面DoG尺度空间中检测到局部极值点还要经过进一步的检验才能精确定位为特征点</li><li>为了提高关键点的稳定性，需要对尺度空间DoG函数进行曲线拟合</li><li>利用DoG函数在尺度空间的Taylor展开式</li></ul><p>$D(X) = D + \frac{\partial D^T}{\partial X} + \frac{1}{2}X^T\frac{\partial^2 D}{\partial X^2}X$.</p><ul><li>对上式求导,并令其为0，得到精确的位置</li></ul><p>$\hat{x} = -\frac{\partial^2 D^{-1}}{\partial x^2}\frac{\partial D}{\partial x}$.</p><ul><li>在已经检测到的特征点中,要去掉低对比度的特征点和不稳定的边缘响应点。去除低对比度的点：把上式代入其中，即在DoG Space的极值点处D(x)取值，只取前两项可得</li></ul><p>$D(\hat{x}) = D + \frac{1}{2}\frac{\partial D^T}{\partial x}\hat{x}$.</p><ul><li>如果$|D(\hat{x})| \geq 0.03$，该特征点就保留下来，否则丢弃</li></ul><h1 id="5-边缘响应的去除"><a href="#5-边缘响应的去除" class="headerlink" title="5. 边缘响应的去除"></a>5. 边缘响应的去除</h1><ul><li>一个定义不好的高斯差分算子的极值在横跨边缘的地方有较大的主曲率，而在垂直边缘的方向有较小的主曲率。主曲率通过一个2×2 的Hessian矩阵H求出</li></ul><p>$H = \left[\begin{matrix} D_{xx} &amp; D_{xy} \\ D_{xy} &amp; D_{yy} \end{matrix}\right]$.</p><ul><li>导数由采样点相邻差估计得到</li><li>D的主曲率和H的特征值成正比，令α为较大特征值，β为较小的特征值</li></ul><h1 id="6-特征点的主方向"><a href="#6-特征点的主方向" class="headerlink" title="6. 特征点的主方向"></a>6. 特征点的主方向</h1><ul><li>上一步中确定了每幅图中的特征点，为每个特征点计算一个方向，依照这个方向做进一步的计算， 利用关键点邻域像素的梯度方向分布特性为每个关键点指定方向参数，使算子具备旋转不变性</li></ul><p>$m(x, y) = \sqrt{(L(x + 1, y) - L(x - 1, y)^2 + (L(x, y + 1) - L(x, y - 1))^2}$,</p><p>$\theta(x, y) = \tan^{-1}((L(x, y + 1) - L(x, y - 1)) / (L(x + 1, y) - L(x - 1, y)))$.</p><p>其中，$m(x, y)$表示梯度赋值，$\theta(x, y)$表示梯度朝向。</p><ul><li>其中<em>L</em>所用的尺度为每个关键点各自所在的尺度。</li><li>图像的关键点已经检测完毕，每个关键点有三个信息：位置，所处尺度、方向，由此可以确定一个SIFT特征区域</li><li>在实际计算时，我们在以关键点为中心的邻域窗口内采样，并用直方图统计邻域像素的梯度方向。梯度直方图的范围是0～360度，其中每45度一个柱，总共8个柱, 或者每10度一个柱，总共36个柱。Lowe论文中还提到要使用高斯函数对直方图进行平滑，减少突变的影响。直方图的峰值则代表了该关键点处邻域梯度的主方向，即作为该关键点的方向</li><li>直方图中的峰值就是主方向，其他的达到最大值80%的方向可作为辅助方向，通过对关键点周围图像区域分块，计算块内梯度直方图，生成具有独特性的向量，这个向量是该区域图像信息的一种抽象，具有唯一性。首先将坐标轴旋转为关键点的方向，以确保旋转不变性。以关键点为中心取8×8的窗口</li><li>得到特征点的主方向后，对于每个特征点可以得到三个信息$(x, y, \sigma, \theta)$，即位置、尺度和方向。由此可以确定一个SIFT特征区域，一个SIFT特征区域由三个值表示，中心表示特征点位置，半径表示关键点的尺度，箭头表示主方向。具有多个方向的关键点可以被复制成多份，然后将方向值分别赋给复制后的特征点，一个特征点就产生了多个坐标、尺度相等，但是方向不同的特征点</li></ul><h1 id="7-生成特征描述"><a href="#7-生成特征描述" class="headerlink" title="7. 生成特征描述"></a>7. 生成特征描述</h1><ul><li>这个描述符不只包含特征点，也含有特征点周围对其有贡献的像素点</li><li>描述子应具有较高的独立性，以保证匹配率</li><li>特征描述符的生成<ul><li>校正旋转主方向，确保旋转不变性</li><li>描述子，最终形成一个128维的特征向量</li><li>归一化处理，将特征向量长度进行归一化处理，进一步去除光照的影响</li></ul></li><li>为了保证特征矢量的旋转不变性，要以特征点为中心，在附近邻域内将坐标轴旋转θθ（特征点的主方向）角度，即将坐标轴旋转为特征点的主方向。旋转后邻域内像素的新坐标为</li></ul><p>$\left[\begin{matrix} x’ \\ y’ \end{matrix}\right]= \left[\begin{matrix} \cos\theta &amp; -\sin\theta \\ \sin\theta &amp; \cos\theta \end{matrix}\right]\left[\begin{matrix} x \\ y \end{matrix}\right] $.</p><ul><li>旋转后以主方向为中心取8×8的窗口。下图所示，左图的中央为当前关键点的位置，每个小格代表为关键点邻域所在尺度空间的一个像素，求取每个像素的梯度幅值与梯度方向，箭头方向代表该像素的梯度方向，长度代表梯度幅值，然后利用高斯窗口对其进行加权运算。最后在每个4×4的小块上绘制8个方向的梯度直方图，计算每个梯度方向的累加值，即可形成一个种子点，如右图所示。每个特征点由4个种子点组成，每个种子点有8个方向的向量信息。这种邻域方向性信息联合增强了算法的抗噪声能力，同时对于含有定位误差的特征匹配也提供了比较理性的容错性</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-013851.png" alt="image-20200328181819566" style="zoom:50%;"></p><ul><li>图中蓝色的圈代表高斯加权的范围（越靠近关键点的像素梯度方向信息贡献越大）。然后在每4×4的小块上计算8个方向的梯度方向直方图，绘制每个梯度方向的累加值，即可形成一个种子点，如图右部分示。此图中一个关键点由2×2共4个种子点组成，每个种子点有8个方向向量信息。这种邻域方向性信息联合的思想增强了算法抗噪声的能力，同时对于含有定位误差的特征匹配也提供了较好的容错性</li><li>通过对特征点周围的像素进行分块，计算块内梯度直方图，生成具有独特性的向量，这个向量是该区域图像信息的一种抽象，具有唯一性</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-013903.png" alt="image-20200328184403372" style="zoom:50%;"></p><ul><li>如上统计的4×4×8=128个梯度信息即为该关键点的特征向量。特征向量形成后，为了去除光照变化的影响，需要对它们进行归一化处理</li></ul><h1 id="8-匹配"><a href="#8-匹配" class="headerlink" title="8. 匹配"></a>8. 匹配</h1><ul><li>生成了A、B两幅图的描述子，（分别是k1∗128维和k2∗128维），就将两图中各个scale（所有scale）的描述子进行匹配，匹配上128维即可表示两个特征点match上了</li><li>实际计算过程中，为了增强匹配的稳健性，Lowe建议对每个关键点使用4×4共16个种子点来描述，这样对于一个关键点就可以产生128个数据，即最终形成128维的SIFT特征向量</li><li>此时SIFT特征向量已经去除了尺度变化、旋转等几何变形因素的影响，再继续将特征向量的长度归一化，则可以进一步去除光照变化的影响</li><li>当两幅图像的SIFT特征向量生成后，下一步我们采用关键点特征向量的欧式距离来作为两幅图像中关键点的相似性判定度量。取图像1中的某个关键点，并找出其与图像2中欧式距离最近的前两个关键点，在这两个关键点中，如果最近的距离除以次近的距离少于某个比例阈值，则接受这一对匹配点。降低这个比例阈值，SIFT匹配点数目会减少，但更加稳定</li><li>为了排除因为图像遮挡和背景混乱而产生的无匹配关系的关键点，Lowe提出了比较最近邻距离与次近邻距离的方法，距离比率ratio小于某个阈值的认为是正确匹配。因为对于错误匹配，由于特征空间的高维性，相似的距离可能有大量其他的错误匹配，从而它的ratio值比较高，Lowe推荐ratio的阈值为0.8</li></ul><h1 id="9-总结和讨论"><a href="#9-总结和讨论" class="headerlink" title="9. 总结和讨论"></a>9. 总结和讨论</h1><ul><li>DoG尺度空间的极值检测</li><li>删除不稳定的极值点</li><li>确定特征点的主方向</li><li>生成描述子</li></ul><h1 id="10-代码实现"><a href="#10-代码实现" class="headerlink" title="10. 代码实现"></a>10. 代码实现</h1><ul><li>OpenCV</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">'1.jpg'</span>)</span><br><span class="line">gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line">sift = cv2.xfeatures2d.SIFT_create()</span><br><span class="line"></span><br><span class="line">kp = sift.detect(gray,<span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">img = cv2.drawKeypoints(gray, kp, img)</span><br><span class="line"></span><br><span class="line">cv2.imshow(<span class="string">'Image'</span>, img)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h1 id="11-参考"><a href="#11-参考" class="headerlink" title="11. 参考"></a>11. 参考</h1><ul><li><a href="https://blog.csdn.net/lhanchao/article/details/52345845" target="_blank" rel="noopener">特征点匹配——SIFT算法详解</a></li><li><a href="https://blog.csdn.net/zddblog/article/details/7521424" target="_blank" rel="noopener">SIFT算法详解</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-特征点-尺度空间理论</title>
      <link href="/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-%E5%B0%BA%E5%BA%A6%E7%A9%BA%E9%97%B4%E7%90%86%E8%AE%BA/"/>
      <url>/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-%E5%B0%BA%E5%BA%A6%E7%A9%BA%E9%97%B4%E7%90%86%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>将一幅图像表示为一系列的平滑图像，称为尺度空间表示，这些平滑图像可参数化表示为平滑核（用于抑制细尺度结构）的尺寸</li><li>当用一个机器视觉系统分析未知场景时，计算机没有办法预先知识图像中物体尺度，因此，我们需要同时考虑图像在多尺度下的描述，获知感兴趣物体的最佳尺度。所以在很多时候，我们会在将图像构建为一系列不同尺度的图像集，在不同的尺度中去检测我们感兴趣的特征</li><li>尺度空间的其中一个主要类型，就是线性（高斯）尺度空间。高斯尺度空间因其良好的性质而被广泛地应用</li></ul><h1 id="2-尺度空间"><a href="#2-尺度空间" class="headerlink" title="2. 尺度空间"></a>2. 尺度空间</h1><ul><li>对于给定的一幅二维图像$f(x, y)$，线性尺度空间表示是由一系列的派生信号$L(x, y; t)$组成，其中$L(x, y; t)$为$f(x, y)$与一个二维高斯核卷积而成，其中高斯核定义如下</li></ul><p>$g(x, y; t) = \frac{1}{w\pi t}e^{-\frac{(x^2 + y^2)}{2t}}$.</p><p>因此有，</p><p>$L(x, y; t) = g(x, y; t) * f(x, y)$,</p><p>其中，$*$表示卷积操作，$t$是指定义好的尺度级别。</p><ul><li>尺度参数$t = \sigma^2$是高斯filter的方差。当t趋于零时，g就成为了一个脉冲函数（除了零点，别处的函数值都为零），则有$L(x, y; 0) = f(x, y)$, 也就是说，位于尺度级别 t = 0 的尺度空间表示（scale-space representation）就是原图本身</li><li>随着t的增大，越来越大的filter被作用于图像f，形成平滑度越来越高的L，以至于原图中越来越多的细节被丢弃</li><li>由于每个filter的标准差为$\sigma = \sqrt{t}$, 对于位于尺度等级t的图像，远小于$\sqrt{t}$的细节很大程度上会被丢弃</li><li>并非任何低通filter都可用于生成尺度空间。可用于生成尺度空间的filter必须满足以下一点：由该平滑filter生成的粗尺度图像（高层图像）不会引入不存在于细尺度图像（低层图像）中的杂散结构。换言之，给定粗尺度图像中的任何一个区域，细尺度图像上总能找到相应的区域。这两个区域相比，粗尺度图像区域不能够有新的结构</li><li>受制于尺度空间公理，高斯卷积核是实现尺度变换的唯一线性核</li></ul><h1 id="3-高斯金字塔"><a href="#3-高斯金字塔" class="headerlink" title="3. 高斯金字塔"></a>3. 高斯金字塔</h1><ul><li>为了让尺度体现其连续性，高斯金字塔在简单降采样的基础上加上了高斯滤波</li><li>图像金字塔每层的一张图像使用不同参数做高斯模糊，使得金字塔的每层含有多张高斯模糊图像，将金字塔每层多张图像合称为一组(Octave)，金字塔每层只有一组图像，组数和金字塔层数相等，每组含有多张(也叫层Interval)图像</li><li>降采样时，高斯金字塔上一组图像的初始图像(底层图像)是由前一组图像的倒数第三张图像隔点采样得到的</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-013201.png" alt="image-20200328172824723" style="zoom:50%;"></p><h1 id="4-高斯差分金字塔"><a href="#4-高斯差分金字塔" class="headerlink" title="4. 高斯差分金字塔"></a>4. 高斯差分金字塔</h1><ul><li>使用高斯金字塔每组中相邻上下两层图像相减，得到高斯差分图像，如图所示，进行极值检测</li><li>高斯金字塔有多组，每组又有多层。一组中的多个层之间的尺度是不一样的（也就是使用的高斯参数σσ是不同的），相邻两层之间的尺度相差一个比例因子k</li><li>如果每组有S层，则$k = 2^{\frac{1}{S}}$。上一组图像的最底层图像是由下一组中尺度为2σ的图像进行因子为2的降采样得到的（高斯金字塔先从底层建立），当相乘了s次时，将会成为下一次的比例因子2k</li><li>高斯金字塔的组数一般是</li></ul><p>$o = [\log_2\min(m, n)] - a$,</p><p>其中，$o$为高斯金字塔的层数。</p><ul><li>高斯模糊参数σσ（尺度空间），可由下面关系式得到</li></ul><p>$\sigma(o, s) = \sigma_02^{\frac{o + s}{S}}$,</p><p>其中，$o$为所在组，$s$为所在的层，$\sigma_0$为初始尺度，$S$为每组的层数。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-03-013222.png" alt="image-20200328173025164" style="zoom:50%;"></p><ul><li>构建实例<ul><li>以一幅512*512的图像I为例</li><li>金字塔的组数为$\log_2 512 = 9$，减去因子3，那么构建的金字塔组数为6，取每组的鞥书为3</li><li>构建第0组，将图像的高和宽增加一倍，为1024*1024。第0层$I_0 \times G(x, y, \sigma_0)$，第1层为$I_0 \times G(x, y, k\sigma_0)$，第2层为$I_0\times G(x, y, k^2\sigma_0)$</li><li>构建第1组，对$I_0$降采样为512*512，第0层为$I_1\times G(x, y, 2\sigma_0)$，第1层为$I_1\times G(x, y, 2k\sigma_0)$</li><li>…</li><li>第o组，第s层为$I_o\times G(x, y, 2^ok^s\sigma_0)$</li></ul></li></ul><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li><a href="[http://blog.rexking6.top/2018/09/22/SIFT%E7%89%B9%E5%BE%81%E8%AF%A6%E8%AF%A6%E8%A7%A3/](http://blog.rexking6.top/2018/09/22/SIFT特征详详解/">SIFT特征详详解</a>)</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-特征点-Harris角点</title>
      <link href="/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-Harris%E8%A7%92%E7%82%B9/"/>
      <url>/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-Harris%E8%A7%92%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>因为角点在现实生活场景中非常常见，因此，角点检测算法也是一种非常受欢迎的检测算法，尤其本文要讲的Harris角点检测，可以说传统检测算法中的经典之作</li><li>目前角点检测算法主要可归纳为3类<ul><li>基于灰度图像的角点检测</li><li>基于二值图像的角点检测</li><li>基于轮廓的角点检测</li></ul></li></ul><h1 id="2-角点"><a href="#2-角点" class="headerlink" title="2. 角点"></a>2. 角点</h1><ul><li>角点就是轮廓之间的交点</li><li>像素点附近区域像素无论是在梯度方向、还是在梯度幅值上都发生较大的变化</li><li>角点可以是两个边缘的角点<ul><li>需要对图像边缘进行编码，这在很大程度上依赖于图像的分割与边缘提取，具有相当大的难度和计算量，且一旦待检测目标局部发生变化，很可能导致操作的失败。早期主要有Rosenfeld和Freeman等人的方法，后期有CSS等方法</li></ul></li><li>角点是邻域内具有两个主方向的特征点<ul><li>基于图像灰度的方法通过计算点的曲率及梯度来检测角点，避免了第一类方法存在的缺陷，此类方法主要有Moravec算子、Forstner算子、Harris算子、SUSAN算子等</li></ul></li></ul><h1 id="3-Harris角点"><a href="#3-Harris角点" class="headerlink" title="3. Harris角点"></a>3. Harris角点</h1><h2 id="3-1-算法思想"><a href="#3-1-算法思想" class="headerlink" title="3.1 算法思想"></a>3.1 算法思想</h2><ul><li>选取一个固定的窗口在图像上以任意方向的滑动，如果灰度都有较大的变化，那么认为这个窗口内部存在角点</li><li>如果这个特定的窗口在图像各个方向上移动时，窗口内图像的灰度没有发生变化，那么窗口内就不存在角点</li><li>如果窗口在某一个方向移动时，窗口内图像的灰度发生了较大的变化，而在另一些方向上没有发生变化，那么，窗口内的图像可能就是一条直线的线段</li></ul><h2 id="3-2-数学推导"><a href="#3-2-数学推导" class="headerlink" title="3.2 数学推导"></a>3.2 数学推导</h2><ul><li>对于图像$I(x, y)$，当在点$(x, y)$处平移$(\Delta x, \Delta y)$后的自相似性由自相关函数计算：</li></ul><p>$c(x, y; \Delta x, \Delta y) = \sum_{(u, v)\in W(x, y)}w(u, v)(I(u, v) - I(u + \Delta x, v + \Delta y))^2$,</p><p>其中，$W(x, y)$是以点$(x, y)$为中心的窗口，$w(u, v)$为加权函数，可以为常数，也可以是高斯加权函数。</p><ul><li>根据泰勒展开，对图像$I(x, y)$在平移$(\Delta x, \Delta y)$后进行一阶近似：</li></ul><p>$I(u + \Delta x, v + \Delta y) = I(u, v) + I_x(u, v)\Delta x + I_y(u, v)\Delta y + O(\Delta x^2, \Delta y^2) \approx I(u, v) + I_x(u, v)\Delta x + I_y(u, v)\Delta y$,</p><p>其中，$I_x$和$I_y$是图像$I(x, y)$的偏导数。</p><ul><li>进一步地，自相关函数简化为</li></ul><p>$c(x, y; \Delta x, \Delta y) \approx \sum_{w}(I_x(u, v)\Delta x + I_y(u, v)\Delta y)^2 = [\Delta x, \Delta y]M(x, y) \left[\begin{matrix} \Delta x \\ \Delta y \end{matrix} \right]$,</p><p>其中，</p><p>$M(x, y) = \sum_{w}\left[\begin{matrix} I_x(x, y)^2 &amp; I_x(x, y)I_y(x, y) \\ I_x(x, y)I_y(x, y) &amp; I_y(x, y)^2 \end{matrix} \right] = \left[\begin{matrix} A &amp; C \\ C &amp; B \end{matrix} \right]$.</p><ul><li>根据主成分分析(PCA)的原理可知，如果对矩阵$M(x, y)$对角化，那么，特征值就是主分量上的方差，矩阵是二维的方阵，有两个主分量，如果在窗口区域内是角点，那么梯度变化会较大，像素点的梯度分布比较离散，这体现在特征值上就是特征值比较大<ul><li>如果矩阵对应的两个特征值都较大，那么窗口内含有角点</li><li>如果特征值一个大一个小，那么窗口内含有线性边缘</li><li>如果两个特征值都很小，那么窗口内为平坦区域</li></ul></li><li>角点的检测转化为数学模型，就是求解窗口内矩阵的特征值并且判断特征值的大小</li><li>Harris给出的角点差别方法并不需要计算具体的特征值，而是计算一个角点响应值$R$来判断角点</li></ul><p>$R = det M - \alpha(trace M)^2$,</p><p>其中，$det M$为矩阵$M$的行列式，$trance M$为矩阵$M$的迹，$\alpha$为常数，取值范围为$0.04\sim0.06$。回头来看，特征值包含在$R$的计算公式中，即</p><p>$det M = \lambda_1\lambda_2 = AC - B^2$,</p><p>$trace M = \lambda_1 + \lambda_2 = A + C$.</p><h2 id="3-3-算法实现"><a href="#3-3-算法实现" class="headerlink" title="3.3 算法实现"></a>3.3 算法实现</h2><ul><li>因为Harris角点检测算法非常经典，因此，一些成熟的图像处理或视觉库都会直接提供Harris角点检测的算法</li><li>以OpenCV为例，代码如下</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">gray为灰度图像，</span></span><br><span class="line"><span class="string">blockSize为邻域窗口的大小，</span></span><br><span class="line"><span class="string">ksize是用于Soble算子的参数，</span></span><br><span class="line"><span class="string">k是一个常量，取值为0.04~0.06</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">filename = <span class="string">'test.jpg'</span></span><br><span class="line"></span><br><span class="line">img = cv2.imread(filename)</span><br><span class="line">gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line">gray = np.float32(gray)</span><br><span class="line">dst = cv2.cornerHarris(gray, blockSize, ksize, k)</span><br></pre></td></tr></table></figure><ul><li>Harris角点检测算法实现流程<ul><li>计算图像$I(x, y)$在X和Y两个方向上的梯度$I_x$和$I_y$</li><li>计算图像两个方向梯度的乘积</li><li>使用高斯函数对$I_x^2$、$I_y^2$和$I_{xy}$进行高斯加权，生成矩阵$M$</li><li>计算Harris响应值R</li><li>给定阈值，当一个位置的强度大于阈值则认为是角点</li><li>在3×3或5×5的邻域内进行非最大值抑制，局部最大值点即为图像中的角点<ul><li>在一个窗口内，如果有多个角点则用值最大的那个角点，其他的角点都删除</li></ul></li></ul></li><li>实现代码</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.ndimage <span class="keyword">import</span> filters</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> matplotlib.pylab <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Harris</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, img_path)</span>:</span></span><br><span class="line">        self.img = cv2.imread(img_path, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calculate_corner_strength</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 计算图像在x、y方向的梯度</span></span><br><span class="line">        <span class="comment"># 用滤波器采用差分求梯度的方式</span></span><br><span class="line">        scale = self.scale</span><br><span class="line">        k = self.k</span><br><span class="line">        img = self.img</span><br><span class="line">        gradient_imx, gradient_imy = zeros(img.shape), zeros(img.shape)</span><br><span class="line">        filters.gaussian_filter(img, (scale, scale), (<span class="number">0</span>, <span class="number">1</span>), gradient_imx)</span><br><span class="line">        filters.gaussian_filter(img, (scale, scale), (<span class="number">1</span>, <span class="number">0</span>), gradient_imy)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算矩阵M的每个分量</span></span><br><span class="line">        I_xx = filters.gaussian_filter(gradient_imx*gradient_imx, scale)</span><br><span class="line">        I_xy = filters.gaussian_filter(gradient_imx*gradient_imy, scale)</span><br><span class="line">        I_yy = filters.gaussian_filter(gradient_imy*gradient_imy, scale)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 计算矩阵的迹、特征值和响应强度</span></span><br><span class="line">        det_M = I_xx * I_yy - I_xy ** <span class="number">2</span></span><br><span class="line">        trace_M = I_xx + I_yy</span><br><span class="line">        <span class="keyword">return</span> det_M + k * trace_M ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">corner_detect</span><span class="params">(self, img)</span>:</span></span><br><span class="line">        <span class="comment"># 首先对图像进行阈值处理</span></span><br><span class="line">        _threshold = img.max() * self.threshold</span><br><span class="line">        threshold_img = (img &gt; _threshold) * <span class="number">1</span></span><br><span class="line">        coords = array(threshold_img.nonzero()).T</span><br><span class="line">        candidate_values = [img[c[<span class="number">0</span>], c[<span class="number">1</span>]] <span class="keyword">for</span> c <span class="keyword">in</span> coords]</span><br><span class="line">        index = argsort(candidate_values)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 选取领域空间，如果邻域空间距离小于min的则只选取一个角点</span></span><br><span class="line">        <span class="comment"># 防止角点过于密集</span></span><br><span class="line">        neighbor = zeros(img.shape)</span><br><span class="line">        neighbor[self.min:-self.min, self.min:-self.min] = <span class="number">1</span></span><br><span class="line">        filtered_coords = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> index:</span><br><span class="line">            <span class="keyword">if</span> neighbor[coords[i, <span class="number">0</span>], coords[i, <span class="number">1</span>]] == <span class="number">1</span>:</span><br><span class="line">                filtered_coords.append(coords[i])</span><br><span class="line">                neighbor[(coords[i, <span class="number">0</span>] - self.min):(coords[i, <span class="number">0</span>] + self.min),</span><br><span class="line">                (coords[i, <span class="number">1</span>] - self.min):(coords[i, <span class="number">1</span>] + self.min)] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> filtered_coords</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">corner_plot</span><span class="params">(self, img, corner_img)</span>:</span></span><br><span class="line">        figure()</span><br><span class="line">        gray()</span><br><span class="line">        imshow(img)</span><br><span class="line">        plot([p[<span class="number">1</span>] <span class="keyword">for</span> p <span class="keyword">in</span> corner_img], [p[<span class="number">0</span>] <span class="keyword">for</span> p <span class="keyword">in</span> corner_img], <span class="string">'ro'</span>)</span><br><span class="line">        axis(<span class="string">'off'</span>)</span><br><span class="line">        show()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, k=<span class="number">0.04</span>, scale=<span class="number">3</span>, min=<span class="number">15</span>, threshold=<span class="number">0.03</span>)</span>:</span></span><br><span class="line">        self.k = k</span><br><span class="line">        self.scale = scale</span><br><span class="line">        self.min = min</span><br><span class="line">        self.threshold = threshold</span><br><span class="line">        strength_img = self.calculate_corner_strength()</span><br><span class="line">        corner_img = self.corner_detect(strength_img)</span><br><span class="line">        self.corner_plot(self.img, corner_img)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    harris = Harris(<span class="string">"2007_002619.jpg"</span>)</span><br><span class="line">    harris()</span><br></pre></td></tr></table></figure><h1 id="4-特性分析"><a href="#4-特性分析" class="headerlink" title="4. 特性分析"></a>4. 特性分析</h1><ul><li>Harris角点检测算子对亮度和对比度的变化不敏感<ul><li>在进行Harris角点检测时，使用了微分算子对图像进行微分运算，而微分运算对图像密度的拉升或收缩和对亮度的抬高或下降不敏感，由于阈值的选择，可能会影响角点检测的数量</li></ul></li><li>Harris角点检测算子具有旋转不变性<ul><li>Harris角点检测算子使用的是角点附近的区域灰度二阶矩矩阵。而二阶矩矩阵可以表示成一个椭圆，椭圆的长短轴正是二阶矩矩阵特征值平方根的倒数。当特征椭圆转动时，特征值并不发生变化，所以判断角点响应值𝑅R也不发生变化，由此说明Harris角点检测算子具有旋转不变性</li></ul></li><li>Harris角点检测算子不具有尺度不变性<ul><li>后续介绍Harris角点解决尺度变换场景</li></ul></li></ul><h1 id="5-多尺度Harris角点"><a href="#5-多尺度Harris角点" class="headerlink" title="5. 多尺度Harris角点"></a>5. 多尺度Harris角点</h1><ul><li>Harris角点检测算子与高斯尺度空间表示相结合，使用Harris角点检测算子具有尺度的不变性</li></ul><h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/67770305" target="_blank" rel="noopener">传统目标检测之Harris角点检测</a></li><li><a href="https://www.cnblogs.com/ronny/p/4009425.html" target="_blank" rel="noopener">Harris角点</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-特征点-ORB特征</title>
      <link href="/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-ORB%E7%89%B9%E5%BE%81/"/>
      <url>/2020/05/03/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E7%89%B9%E5%BE%81%E7%82%B9-ORB%E7%89%B9%E5%BE%81/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>ORB特征由关键点和描述子两部分组成。它的关键点称为“Oriented Fast”，是一种改进的FAST角点。描述子称为“BRIEF(Binary Robust Independent Elementary Feature)”</li><li>提取FAST角点(相较于原版FAST角点，ORB中计算了特征点的主方向，为后续的BRIEF描述子增加了旋转不变性)</li><li>计算BRIEF描述子</li></ul><h1 id="2-FAST角点"><a href="#2-FAST角点" class="headerlink" title="2. FAST角点"></a>2. FAST角点</h1><ul><li>只比较像素亮度的大小，只进行比较操作，所以很快</li><li>核心思想是如果一个像素与领域的像素差别较大(过亮或过暗)，那么它更可能是角点<ul><li>在图像中选取像素p，假设它的亮度为Ip</li><li>设置一个阈值T，如Ip的20%</li><li>以p为中心，选取半径为3的圆上的16个像素点</li><li>若圆上有连续的N个点的亮度大于Ip+T或小于Ip-T，那么像素p被认为是特征点。N通常取12,叫做FAST-12。也可以是9或11</li><li>循环上述步骤，对每个像素执行相同操作</li></ul></li><li>为了使FAST-12算法更高效，可以增加一项预测试操作，以快速地排除绝大多数不是角点的像素。即对每个像素，先判断领域圆上的1,5,9,13像素(也即四个边界点)的亮度。如果这四个像素中有3个同时大于Ip+T或小于Ip-T，当前像素才有可能是个角点，否则直接剔除</li><li>此外，FAST角点经常出现扎堆现象。所以在第一遍检测之后，还需要用非极大值抑制(Non-maximal suppression)，在一定区域内仅保留响应极大值的角点。非极大值抑制思想类似于卷积网络中的最大池化操作。选取一定范围内的最大值作为“代表”</li></ul><p>首先在一小块图像B中，定义图像块的矩为：</p><p>$m_{pq} = \sum_{x, y\in B}x^py^qI(x, y)$,</p><p>其中$p, q = \{0, 1\}$。</p><p>由此得到：</p><p>$m_{00} = \sum_{x, y \in B}I(x, y)$,</p><p>$m_{01} = \sum_{x, y \in B}yI(x, y)$,</p><p>$m_{10} = \sum_{x, y \in B}xI(x, y)$。</p><p>图像块B的质心为：</p><p>$C = (\frac{m_{10}}{m_{00}}, \frac{m_{01}}{m_{00}})$。</p><p>连接图像块的几何中心O和质心C，即可得到一个方向向量OC，因此特征点的方向可以定义为:</p><p>$\theta = \arctan(\frac{m_{01}}{m_{10}})$.</p><p>通过以上方法FAST角点便具有了尺度与旋转的描述，在ORB中，把这种改进后的FAST叫做Oriented FAST。</p><h1 id="3-BRIEF描述子"><a href="#3-BRIEF描述子" class="headerlink" title="3. BRIEF描述子"></a>3. BRIEF描述子</h1><ul><li>BRIEF是一种二进制描述子，用来描述两个二进制串之间的距离，其描述向量由很多0、1组成。这里的0、1表示关键点附近两个像素(如p、q)的大小关系，若p比q大，取1,反之取0。如果选取128对点比较，最后即可得到128维由0、1组成的特征向量</li></ul><p>现在我们有2n个点，组成一个矩阵S：</p><p>$S = (x_1 x_2 \cdots x_{2n})$，</p><p>使用邻域方向$\theta$和对应的旋转矩阵$R_{\theta}$，构建S的一个校正版本$S_{\theta}$：</p><p>$S_{\theta} = R_{\theta}S$,</p><p>其中，$R_{\theta} = \left[\begin{matrix} \cos\theta &amp; \sin\theta \\ -\sin\theta &amp; \cos\theta \end{matrix}\right]$，$\theta$为特征点求得的主方向。</p><h1 id="4-代码实现"><a href="#4-代码实现" class="headerlink" title="4. 代码实现"></a>4. 代码实现</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/features2d/features2d.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/calib3d/calib3d.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> DIST_THRESHOLD = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">int</span> NUM_MATCH_POINTS = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ORB特征提取</span></span><br><span class="line"><span class="comment">//1.读取图像</span></span><br><span class="line"><span class="comment">//2.初始化KeyPoint、Descriptor、ORB对象</span></span><br><span class="line"><span class="comment">//3.检测FAST角点</span></span><br><span class="line"><span class="comment">//4.由角点位置计算BRIEF描述子</span></span><br><span class="line"><span class="comment">//5.新建匹配对象及vector用于存放点对，对两幅图中的BRIEF描述子进行匹配，使用Hamming距离</span></span><br><span class="line"><span class="comment">//6.筛选匹配点对（距离小于最小值的两倍）</span></span><br><span class="line"><span class="comment">//7.绘制匹配结果</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point2f&gt;&gt; orb_match(<span class="built_in">string</span> path1,<span class="built_in">string</span> path2,<span class="built_in">string</span> outPath)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//Step1</span></span><br><span class="line">  Mat img1 = imread(path1);</span><br><span class="line">  Mat img2 = imread(path2);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Step2</span></span><br><span class="line">  <span class="built_in">vector</span>&lt;KeyPoint&gt; keyPoint1,keyPoint2;</span><br><span class="line">  Mat descriptor1,descriptor2;</span><br><span class="line">  <span class="comment">//!!!新建一个ORB对象，注意create的参数!!!</span></span><br><span class="line">  Ptr&lt;ORB&gt; orb = ORB::create(NUM_MATCH_POINTS,<span class="number">1.2f</span>,<span class="number">8</span>,<span class="number">31</span>,<span class="number">0</span>,<span class="number">2</span>,ORB::HARRIS_SCORE,<span class="number">31</span>,<span class="number">20</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Step3</span></span><br><span class="line">  orb-&gt;detect(img1,keyPoint1);</span><br><span class="line">  orb-&gt;detect(img2,keyPoint2);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Step4</span></span><br><span class="line">  orb-&gt;compute(img1,keyPoint1,descriptor1);</span><br><span class="line">  orb-&gt;compute(img2,keyPoint2,descriptor2);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Step5</span></span><br><span class="line">  <span class="comment">//!!!注意表示匹配点对用DMatch类型，以及匹配对象的新建方法!!!</span></span><br><span class="line">  <span class="built_in">vector</span>&lt;DMatch&gt; matches;</span><br><span class="line">  BFMatcher matcher = BFMatcher(NORM_HAMMING);</span><br><span class="line">  matcher.match(descriptor1,descriptor2,matches);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Step6</span></span><br><span class="line">  <span class="keyword">double</span> min_dist = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;matches.size();i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span>(matches[i].distance&lt;min_dist)</span><br><span class="line">    &#123;</span><br><span class="line">      min_dist = matches[i].distance;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">vector</span>&lt;Point2f&gt; points1;</span><br><span class="line">  <span class="built_in">vector</span>&lt;Point2f&gt; points2;</span><br><span class="line">  <span class="built_in">vector</span>&lt;DMatch&gt; good_matches;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;matches.size();i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span>(matches[i].distance&lt;max(<span class="number">2</span>*min_dist,DIST_THRESHOLD))</span><br><span class="line">    &#123;</span><br><span class="line">      good_matches.push_back(matches[i]);</span><br><span class="line">      <span class="comment">//注意这两个Idx是不一样的</span></span><br><span class="line">      points1.push_back(keyPoint1[matches[i].queryIdx].pt);</span><br><span class="line">      points2.push_back(keyPoint2[matches[i].trainIdx].pt);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point2f&gt;&gt; result;</span><br><span class="line">  result.push_back(points1);</span><br><span class="line">  result.push_back(points2);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Step7</span></span><br><span class="line">  Mat outImg;</span><br><span class="line">  drawMatches(img1,keyPoint1,img2,keyPoint2,good_matches,outImg);</span><br><span class="line">  imwrite(outPath,outImg);</span><br><span class="line">  <span class="built_in">cout</span>&lt;&lt;<span class="string">"保留的匹配点对："</span>&lt;&lt;good_matches.size()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">string</span> img1 = <span class="string">"1.jpg"</span>;</span><br><span class="line">  <span class="built_in">string</span> img2 = <span class="string">"2.jpg"</span>;</span><br><span class="line">  <span class="built_in">string</span> outpath = <span class="string">"3.jpg"</span>;</span><br><span class="line">  <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;Point2f&gt;&gt; points;</span><br><span class="line">  <span class="built_in">vector</span>&lt;Point2f&gt; points1;</span><br><span class="line">  <span class="built_in">vector</span>&lt;Point2f&gt; points2;</span><br><span class="line">  points = orb_match(img1,img2,outpath);</span><br><span class="line">  points1 = points[<span class="number">0</span>];</span><br><span class="line">  points2 = points[<span class="number">1</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;points1.size();i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"第"</span>&lt;&lt;(i+<span class="number">1</span>)&lt;&lt;<span class="string">"对点："</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"("</span>&lt;&lt;points1[i].x&lt;&lt;<span class="string">","</span>&lt;&lt;points1[i].y&lt;&lt;<span class="string">")"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">" - "</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"("</span>&lt;&lt;points2[i].x&lt;&lt;<span class="string">","</span>&lt;&lt;points2[i].y&lt;&lt;<span class="string">")"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（以上代码参考：<a href="[http://zhaoxuhui.top/blog/2018/01/29/ORB%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96-%E5%8C%B9%E9%85%8D%E5%8F%8A%E5%AE%9E%E7%8E%B0.html](http://zhaoxuhui.top/blog/2018/01/29/ORB特征提取-匹配及实现.html">ORB特征提取、匹配及实现</a>)）</p>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构（六）-图</title>
      <link href="/2020/05/02/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E5%85%AD%EF%BC%89-%E5%9B%BE/"/>
      <url>/2020/05/02/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E5%85%AD%EF%BC%89-%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>在图中，数据元素通常称作顶点</li><li>有向图中，无箭头一端的顶点通常被称为”初始点”或”弧尾”，箭头直线的顶点被称为”终端点”或”弧头”</li><li>对于有向图中的一个顶点 V 来说，箭头指向 V 的弧的数量为 V 的入度（InDegree，记为 ID(V)）；箭头远离 V 的弧的数量为 V 的出度（OutDegree，记为OD(V)）</li><li>无论是无向图还是有向图，从一个顶点到另一顶点途径的所有顶点组成的序列（包含这两个顶点），称为一条路径。如果路径中第一个顶点和最后一个顶点相同，则此路径称为”回路”（或”环”）</li><li>在某些实际场景中，图中的每条边（或弧）会赋予一个实数来表示一定的含义，这种与边（或弧）相匹配的实数被称为”权”，而带权的图通常称为网</li><li>子图：指的是由图中一部分顶点和边构成的图，称为原图的子图</li><li>图又可分为完全图，连通图、稀疏图和稠密图<ul><li>完全图：若图中各个顶点都与除自身外的其他顶点有关系，这样的无向图称为完全图。同时，满足此条件的有向图则称为有向完全图</li><li>稀疏图和稠密图：这两种图是相对存在的，即如果图中具有很少的边（或弧），此图就称为”稀疏图”；反之，则称此图为”稠密图”</li><li>图中从一个顶点到达另一顶点，若存在至少一条路径，则称这两个顶点是连通着的；无向图中，如果任意两个顶点之间都能够连通，则称此无向图为连通图<ul><li>有向图中，若任意两个顶点 Vi 和 Vj，满足从 Vi 到 Vj 以及从 Vj 到 Vi 都连通，也就是都含有至少一条通路，则称此有向图为强连通图</li><li>与此同时，若有向图本身不是强连通图，但其包含的最大连通子图具有强连通图的性质，则称该子图为强连通分量</li></ul></li></ul></li><li>生成树<ul><li>对连通图进行遍历，过程中所经过的边和顶点的组合可看做是一棵普通树</li><li>包含连通图中所有的顶点</li><li>任意两顶点之间有且仅有一条通路</li></ul></li><li>生成森林<ul><li>生成树是对应连通图来说，而生成森林是对应非连通图来说的</li><li>非连通图可分解为多个连通分量，而每个连通分量又各自对应多个生成树（至少是 1 棵），因此与整个非连通图相对应的，是由多棵生成树组成的生成森林</li></ul></li></ul><h1 id="2-图的顺序存储结构"><a href="#2-图的顺序存储结构" class="headerlink" title="2. 图的顺序存储结构"></a>2. 图的顺序存储结构</h1><ul><li>使用数组存储图时，需要使用两个数组，一个数组存放图中顶点本身的数据（一维数组），另外一个数组用于存储各顶点之间的关系（二维数组）</li><li><p>代码实现</p></li><li><p>ArrayGraph.hpp</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ArrayGraph.hpp</span></span><br><span class="line"><span class="comment">//  Graph</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ArrayGraph_hpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ArrayGraph_hpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_VERTEX_NUM 20</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VRType int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> InfoType char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VertexType int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">    DG,</span><br><span class="line">    DN,</span><br><span class="line">    UDG,</span><br><span class="line">    UDN</span><br><span class="line">&#125; GraphKind;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    VRType adj;</span><br><span class="line">    InfoType *info;</span><br><span class="line">&#125; ArcCell, AdjMatrix[MAX_VERTEX_NUM][MAX_VERTEX_NUM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    VertexType vexs[MAX_VERTEX_NUM];</span><br><span class="line">    AdjMatrix arcs;</span><br><span class="line">    <span class="keyword">int</span> vexnum, arcnum;</span><br><span class="line">    GraphKind kind;</span><br><span class="line">&#125; MGraph;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayGraph</span> &#123;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ArrayGraph();</span><br><span class="line">    ~ArrayGraph();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">LocateVex</span><span class="params">(MGraph *G, VertexType v)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">MGraph * <span class="title">CreateDG</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">MGraph * <span class="title">CreateDN</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    MGraph *G &#123;<span class="literal">NULL</span>&#125;;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* ArrayGraph_hpp */</span></span></span><br></pre></td></tr></table></figure><ul><li>ArrayGraph.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  ArrayGraph.cpp</span></span><br><span class="line"><span class="comment">//  Graph</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ArrayGraph.hpp"</span></span></span><br><span class="line"></span><br><span class="line">ArrayGraph::ArrayGraph() &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ArrayGraph::~ArrayGraph() &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> ArrayGraph::LocateVex(MGraph *G, <span class="keyword">int</span> v) &#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; G-&gt;vexnum; i ++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (G-&gt;vexs[i] == v) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; G-&gt;vexnum) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"No vertex\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MGraph * ArrayGraph::CreateDG() &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d, %d"</span>, &amp;(G-&gt;vexnum), &amp;(G-&gt;arcnum));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;vexnum; i ++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;(G-&gt;vexs[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;vexnum; i ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G-&gt;arcnum; j ++) &#123;</span><br><span class="line">            G-&gt;arcs[i][j].adj = <span class="number">0</span>;</span><br><span class="line">            G-&gt;arcs[i][j].info = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;arcnum; i ++) &#123;</span><br><span class="line">        <span class="keyword">int</span> v1, v2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d, %d"</span>, &amp;v1, &amp;v2);</span><br><span class="line">        <span class="keyword">int</span> n = LocateVex(G, v1);</span><br><span class="line">        <span class="keyword">int</span> m = LocateVex(G, v2);</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">-1</span> || m == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"No vertex\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> G;</span><br><span class="line">        &#125;</span><br><span class="line">        G-&gt;arcs[n][m].adj = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> G;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MGraph * ArrayGraph::CreateDN() &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d, %d"</span>, &amp;(G-&gt;vexnum), &amp;(G-&gt;arcnum));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;vexnum; i ++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;(G-&gt;vexs[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;vexnum; i ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; G-&gt;arcnum; j ++) &#123;</span><br><span class="line">            G-&gt;arcs[i][j].adj = <span class="number">0</span>;</span><br><span class="line">            G-&gt;arcs[i][j].info = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G-&gt;arcnum; i ++) &#123;</span><br><span class="line">        <span class="keyword">int</span> v1, v2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d, %d"</span>, &amp;v1, &amp;v2);</span><br><span class="line">        <span class="keyword">int</span> n = LocateVex(G, v1);</span><br><span class="line">        <span class="keyword">int</span> m = LocateVex(G, v2);</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">-1</span> || m == <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"No vertex\n"</span>);</span><br><span class="line">            <span class="keyword">return</span> G;</span><br><span class="line">        &#125;</span><br><span class="line">        G-&gt;arcs[n][m].adj = <span class="number">1</span>;</span><br><span class="line">        G-&gt;arcs[m][n].adj = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> G;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构（五）-树和二叉树</title>
      <link href="/2020/04/30/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%94%EF%BC%89-%E6%A0%91%E5%92%8C%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
      <url>/2020/04/30/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%94%EF%BC%89-%E6%A0%91%E5%92%8C%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>树是n个结点的有限集</li><li>有且仅有一个特定的根，称为根结点</li><li>当$n &gt; 1$时，其余结点可分为m个互不相交的有限集，其中每一个集合本身又是一棵树，称为子树</li><li>结点拥有的子树称之为度，度为0的节点称为叶子结点</li><li>结点的层次是从根开始定义起的，根为第一层，根的孩子为第二层</li><li>树中结点最大的层次称为深度</li><li>森林是m棵互不相交的数的集合</li></ul><h1 id="2-二叉树"><a href="#2-二叉树" class="headerlink" title="2. 二叉树"></a>2. 二叉树</h1><ul><li>每个结点至多只有两棵子树，有左右之分，其次序不能随意颠倒</li><li>性质<ul><li>在二叉树的第i层上至多有$2^{i-1}$个结点（$i\geq 1$）</li><li>深度为k的二叉树至多有$2^k - 1$个结点（$k \geq 1$）</li><li>对任何一颗二叉树T，如果其终端结点数为n，度为2的结点数为$n_2$，那么$n = n_2 + 1$</li><li>具有n个结点的完全二叉树的深度为$[\log_2 n] + 1$</li><li>如果对一棵有n个结点的完全二叉树</li></ul></li></ul><h1 id="3-二叉树代码实现"><a href="#3-二叉树代码实现" class="headerlink" title="3. 二叉树代码实现"></a>3. 二叉树代码实现</h1><ul><li>BinaryTree.hpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  BinaryTree.hpp</span></span><br><span class="line"><span class="comment">//  Tree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> BinaryTree_hpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BinaryTree_hpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> dataType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> m = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tree</span> &#123;</span></span><br><span class="line">    dataType data;</span><br><span class="line">    Tree *left, *right;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span> &#123;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    BinaryTree() &#123;</span><br><span class="line">        root = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    ~BinaryTree() &#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    Tree *root;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Create</span><span class="params">(dataType data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PreOrder</span><span class="params">(Tree *, <span class="built_in">string</span> name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InOrder</span><span class="params">(Tree *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PostOrder</span><span class="params">(Tree *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetCount</span><span class="params">(Tree *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">FindLeaf</span><span class="params">(Tree *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">FindNode</span><span class="params">(Tree *)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintPreOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PreOrder(root, <span class="string">"Root"</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintInOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        InOrder(root);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PrintPostOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PostOrder(root);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* BinaryTree_hpp */</span></span></span><br></pre></td></tr></table></figure><ul><li>BinaryTree.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  BinaryTree.cpp</span></span><br><span class="line"><span class="comment">//  Tree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"BinaryTree.hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BinaryTree::Create(dataType data) &#123;</span><br><span class="line">    Tree *newNode = <span class="keyword">new</span> Tree;</span><br><span class="line">    newNode-&gt;data = data;</span><br><span class="line">    newNode-&gt;left = <span class="literal">NULL</span>;</span><br><span class="line">    newNode-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == root) &#123;</span><br><span class="line">        root = newNode;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Tree *back = <span class="literal">NULL</span>, *current = root;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">NULL</span> != current) &#123;</span><br><span class="line">        back = current;</span><br><span class="line">        <span class="keyword">if</span> (current-&gt;data &gt; data) &#123;</span><br><span class="line">            current = current-&gt;left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            current = current-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == back) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (back-&gt;data &gt; data) &#123;</span><br><span class="line">        back-&gt;left = newNode;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        back-&gt;right = newNode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BinaryTree::PreOrder(Tree *p, <span class="built_in">string</span> name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; name &lt;&lt; <span class="string">": "</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    PreOrder(p-&gt;left, <span class="string">"left"</span>);</span><br><span class="line">    PreOrder(p-&gt;right, <span class="string">"right"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BinaryTree::InOrder(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    InOrder(p-&gt;left);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    InOrder(p-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> BinaryTree::PostOrder(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    PostOrder(p-&gt;left);</span><br><span class="line">    PostOrder(p-&gt;right);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> BinaryTree::GetCount(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> GetCount(p-&gt;left) + GetCount(p-&gt;right) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> BinaryTree::FindLeaf(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p-&gt;left &amp;&amp; <span class="literal">NULL</span> == p-&gt;right) &#123;</span><br><span class="line">        <span class="keyword">return</span> n+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    FindLeaf(p-&gt;left);</span><br><span class="line">    FindLeaf(p-&gt;right);</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> BinaryTree::FindNode(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != p-&gt;left &amp;&amp; <span class="literal">NULL</span> != p-&gt;right) &#123;</span><br><span class="line">        FindNode(p-&gt;left);</span><br><span class="line">        FindNode(p-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p-&gt;left &amp;&amp; <span class="literal">NULL</span> != p-&gt;right) &#123;</span><br><span class="line">        FindNode(p-&gt;right);</span><br><span class="line">        m ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != p-&gt;left &amp;&amp; <span class="literal">NULL</span> == p-&gt;right) &#123;</span><br><span class="line">        FindNode(p-&gt;left);</span><br><span class="line">        m ++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-平衡二叉树"><a href="#4-平衡二叉树" class="headerlink" title="4. 平衡二叉树"></a>4. 平衡二叉树</h1><ul><li>左右子树的高度相差不超过 1 的树为平衡二叉树</li><li>AVL树的查找、插入、删除操作在平均和最坏的情况下都是O（logn）</li><li>最小失衡子树<ul><li>在新插入的结点向上查找，以第一个平衡因子的<strong>绝对值</strong>超过 1 的结点为根的子树称为最小不平衡子树。也就是说，一棵失衡的树，是有可能有多棵子树同时失衡的。而这个时候，我们只要调整最小的不平衡子树，就能够将不平衡的树调整为平衡的树</li></ul></li><li>平衡二叉树的失衡调整主要是通过旋转最小失衡子树来实现的<ul><li>旋转的目的就是减少高度，通过降低整棵树的高度来平衡。哪边的树高，就把那边的树向上旋转</li><li>左旋<ul><li>节点的右孩子替代此节点位置</li><li>右孩子的左子树变为该节点的右子树</li><li>节点本身变为右孩子的左子树</li></ul></li><li>右旋<ul><li>节点的左孩子代表此节点</li><li>节点的左孩子的右子树变为节点的左子树</li><li>将此节点作为左孩子节点的右子树</li></ul></li></ul></li></ul><h2 id="4-1-插入操作"><a href="#4-1-插入操作" class="headerlink" title="4.1 插入操作"></a>4.1 插入操作</h2><ul><li>假设一颗 AVL 树的某个节点为 A，有四种操作会使 A 的左右子树高度差大于 1，从而破坏了原有 AVL 树的平衡性。平衡二叉树插入节点的情况分为以下四种<ul><li>在A的左子树根节点的左子树上插入节点而破坏平衡，需要右旋</li><li>在A的右子树根节点的右子树上插入节点而破坏平衡，需要左旋</li><li>在A的左子树根节点的右子树上插入节点而破坏平衡，需要先左旋后右旋</li><li>在A的右子树根节点的左子树上插入节点而破坏平衡，需要先右旋后左旋</li></ul></li></ul><h2 id="4-2-删除操作"><a href="#4-2-删除操作" class="headerlink" title="4.2 删除操作"></a>4.2 删除操作</h2><h2 id="4-3-代码实现"><a href="#4-3-代码实现" class="headerlink" title="4.3 代码实现"></a>4.3 代码实现</h2><ul><li>AVLTree.hpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  AVLTree.hpp</span></span><br><span class="line"><span class="comment">//  Tree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> AVLTree_hpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AVLTree_hpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> dataType;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AVLTree</span> &#123;</span></span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Tree</span> &#123;</span></span><br><span class="line">        dataType data;</span><br><span class="line">        Tree *left, *right;</span><br><span class="line">        Tree(dataType x) &#123;</span><br><span class="line">            data = x;</span><br><span class="line">            left = <span class="literal">NULL</span>;</span><br><span class="line">            right = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    AVLTree();</span><br><span class="line">    ~AVLTree();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Create</span><span class="params">(dataType data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> dataType data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(dataType data)</span></span>;</span><br><span class="line">    <span class="function">Tree* <span class="title">Search</span><span class="params">(dataType data)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PreOrder</span><span class="params">(Tree *p)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InOrder</span><span class="params">(Tree *p)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">PostOrder</span><span class="params">(Tree *p)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Height</span><span class="params">(Tree *p)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree * <span class="title">GetRoot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Tree *root;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">Insert</span><span class="params">(Tree* subRoot, dataType data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">NULL</span> == subRoot) &#123;</span><br><span class="line">            subRoot = <span class="keyword">new</span> Tree(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data &gt; subRoot-&gt;data) &#123;</span><br><span class="line">            subRoot-&gt;right = Insert(subRoot-&gt;right, data);</span><br><span class="line">            subRoot = Balance(subRoot);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data &lt; subRoot-&gt;data) &#123;</span><br><span class="line">            subRoot-&gt;left = Insert(subRoot-&gt;left, data);</span><br><span class="line">            subRoot = Balance(subRoot);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> subRoot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">TreeMax</span><span class="params">(Tree *p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!p) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (p-&gt;right) &#123;</span><br><span class="line">            p = p-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">TreeMin</span><span class="params">(Tree *p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!p) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (p-&gt;left) &#123;</span><br><span class="line">            p = p-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">BalanceFactor</span><span class="params">(Tree *p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Height(p-&gt;left) - Height(p-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree * <span class="title">Balance</span><span class="params">(Tree * subRoot)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> bf = BalanceFactor(subRoot);</span><br><span class="line">        <span class="keyword">if</span> (bf &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (BalanceFactor(subRoot-&gt;left) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                subRoot = LLRotation(subRoot);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                subRoot = LRRotation(subRoot);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bf &lt; <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (BalanceFactor(subRoot-&gt;right) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                subRoot = RLRotation(subRoot);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                subRoot = RRRotation(subRoot);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> subRoot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">LLRotation</span><span class="params">(Tree *subRoot)</span> </span>&#123;</span><br><span class="line">        Tree *p = subRoot-&gt;left;</span><br><span class="line">        subRoot-&gt;left = p-&gt;right;</span><br><span class="line">        p-&gt;right = subRoot;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">RRRotation</span><span class="params">(Tree *subRoot)</span> </span>&#123;</span><br><span class="line">        Tree *p = subRoot-&gt;right;</span><br><span class="line">        subRoot-&gt;right = p-&gt;left;</span><br><span class="line">        p-&gt;left = subRoot;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">RLRotation</span><span class="params">(Tree *subRoot)</span> </span>&#123;</span><br><span class="line">        subRoot-&gt;right = LLRotation(subRoot-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> RRRotation(subRoot);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">LRRotation</span><span class="params">(Tree *subRoot)</span> </span>&#123;</span><br><span class="line">        subRoot-&gt;left = RRRotation(subRoot-&gt;left);</span><br><span class="line">        <span class="keyword">return</span> LLRotation(subRoot);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Tree* <span class="title">Remove</span><span class="params">(Tree *subRoot, dataType data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!Search(data)) &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"不存在结点: "</span> &lt;&lt; data &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> subRoot;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Destroy</span><span class="params">(Tree *p)</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* AVLTree_hpp */</span></span></span><br></pre></td></tr></table></figure><ul><li>AVLTree.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  AVLTree.cpp</span></span><br><span class="line"><span class="comment">//  Tree</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"AVLTree.hpp"</span></span></span><br><span class="line"></span><br><span class="line">AVLTree::AVLTree() &#123;</span><br><span class="line">    root = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AVLTree::~AVLTree() &#123;</span><br><span class="line">    <span class="keyword">if</span> (root) &#123;</span><br><span class="line">        Destroy(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::Destroy(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (p) &#123;</span><br><span class="line">        Destroy(p-&gt;left);</span><br><span class="line">        Destroy(p-&gt;right);</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::Create(dataType data) &#123;</span><br><span class="line">    Insert(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::Insert(<span class="keyword">const</span> dataType data) &#123;</span><br><span class="line">    root = Insert(root, data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AVLTree::Tree* AVLTree::Search(dataType data) &#123;</span><br><span class="line">    Tree *p = root;</span><br><span class="line">    <span class="keyword">while</span> (p) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;data == data) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p-&gt;data &lt; data) &#123;</span><br><span class="line">            p = p-&gt;right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p = p-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::Remove(dataType data) &#123;</span><br><span class="line">    root = Remove(root, data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> AVLTree::Height(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i = Height(p-&gt;left);</span><br><span class="line">    <span class="keyword">int</span> j = Height(p-&gt;right);</span><br><span class="line">    <span class="keyword">return</span> i &gt; j ? i + <span class="number">1</span> : j + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::PreOrder(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != p) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        PreOrder(p-&gt;left);</span><br><span class="line">        PreOrder(p-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::InOrder(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != p) &#123;</span><br><span class="line">        InOrder(p-&gt;left);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        InOrder(p-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::PostOrder(Tree *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != p) &#123;</span><br><span class="line">        PostOrder(p-&gt;left);</span><br><span class="line">        PostOrder(p-&gt;right);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> AVLTree::Print() &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"先序遍历为: "</span>;</span><br><span class="line">    PreOrder(root);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"中序遍历为: "</span>;</span><br><span class="line">    InOrder(root);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"后序遍历为: "</span>;</span><br><span class="line">    PostOrder(root);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-面试题"><a href="#5-面试题" class="headerlink" title="5. 面试题"></a>5. 面试题</h1><h2 id="5-1-二叉树反转"><a href="#5-1-二叉树反转" class="headerlink" title="5.1 二叉树反转"></a>5.1 二叉树反转</h2><ul><li>递归算法<ul><li>交换根节点的左右子树</li><li>对左右子树分别执行递归反转</li></ul></li><li>非递归算法<ul><li>交换根节点的左右子节点</li><li>交换第二层每个节点的左右子节点</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">TreeNode* <span class="title">invertTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    TreeNode * ptmpNode = root-&gt;left;</span><br><span class="line">    root-&gt;left = invertTree(root-&gt;right);</span><br><span class="line">    root-&gt;right = invertTree(ptmpNode);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">TreeNode* <span class="title">invertTree2</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;TreeNode*&gt; tree_queue;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>)</span><br><span class="line">      <span class="keyword">return</span> root;</span><br><span class="line">    tree_queue.push(root);</span><br><span class="line">    <span class="keyword">while</span>(tree_queue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        TreeNode * pNode = tree_queue.front();</span><br><span class="line">        tree_queue.pop();</span><br><span class="line">        TreeNode * pLeft = pNode-&gt;left;</span><br><span class="line">        pNode-&gt;left = pNode-&gt;right;</span><br><span class="line">        pNode-&gt;right = pLeft;</span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;left)</span><br><span class="line">          tree_queue.push(pNode-&gt;left);</span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;right)</span><br><span class="line">          tree_queue.push(pNode-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-2-深度优先遍历"><a href="#5-2-深度优先遍历" class="headerlink" title="5.2 深度优先遍历"></a>5.2 深度优先遍历</h2><ul><li>从根节点出发，沿着左子树方向进行纵向遍历，直到找到叶子节点为止。然后回溯到前一个节点，进行右子树节点的遍历，直到遍历完所有可达节点为止</li><li>父节点入栈，父节点出栈，先右子节点入栈，后左子节点入栈。递归遍历全部节点即可</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">depthFirstSearch</span><span class="params">(Tree root)</span></span>&#123;</span><br><span class="line">    <span class="built_in">stack</span>&lt;Node *&gt; nodeStack;</span><br><span class="line">    nodeStack.push(root);</span><br><span class="line">    Node *node;</span><br><span class="line">    <span class="keyword">while</span>(!nodeStack.empty())&#123;</span><br><span class="line">    node = nodeStack.top();</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;node-&gt;data;</span><br><span class="line">        nodeStack.pop();</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;rchild)&#123;</span><br><span class="line">            nodeStack.push(node-&gt;rchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;lchild)&#123;</span><br><span class="line">            nodeStack.push(node-&gt;lchild);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-3-广度优先遍历"><a href="#5-3-广度优先遍历" class="headerlink" title="5.3 广度优先遍历"></a>5.3 广度优先遍历</h2><ul><li>从根节点出发，在横向遍历二叉树层段节点的基础上纵向遍历二叉树的层次</li><li>父节点入队，父节点出队列，先左子节点入队，后右子节点入队。递归遍历全部节点即可</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">breadthFirstSearch</span><span class="params">(Tree root)</span></span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;Node *&gt; nodeQueue;  <span class="comment">//使用C++的STL标准模板库</span></span><br><span class="line">    nodeQueue.push(root);</span><br><span class="line">    Node *node;</span><br><span class="line">    <span class="keyword">while</span>(!nodeQueue.empty())&#123;</span><br><span class="line">        node = nodeQueue.front();</span><br><span class="line">        nodeQueue.pop();</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;node-&gt;data;<span class="comment">//遍历根结点</span></span><br><span class="line">        <span class="keyword">if</span>(node-&gt;lchild)&#123;</span><br><span class="line">            nodeQueue.push(node-&gt;lchild);  <span class="comment">//先将左子树入队</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;rchild)&#123;</span><br><span class="line">            nodeQueue.push(node-&gt;rchild);  <span class="comment">//再将右子树入队</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（二）-四元数运动学</title>
      <link href="/2020/04/19/slam/vSLAMNet%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%9B%9B%E5%85%83%E6%95%B0%E8%BF%90%E5%8A%A8%E5%AD%A6/"/>
      <url>/2020/04/19/slam/vSLAMNet%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%9B%9B%E5%85%83%E6%95%B0%E8%BF%90%E5%8A%A8%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>本小节内容为以下文献的阅读记录<ul><li>Sola J. Quaternion kinematics for the error-state Kalman filter[J]. arXiv preprint arXiv:1711.02508, 2017.</li></ul></li></ul><h1 id="2-四元数基础"><a href="#2-四元数基础" class="headerlink" title="2. 四元数基础"></a>2. 四元数基础</h1><h2 id="2-1-定义"><a href="#2-1-定义" class="headerlink" title="2.1 定义"></a>2.1 定义</h2><ul><li>四元数的一般形式：$Q = a + bi + cj + dk \in H$, $i^2 = j^2 = l^2 = ijk = -1$, $ij = -ji = k$, $jk = -kj = i$, $ki = -ik = j$</li><li>其他表达方式：$Q = q_w + \bf{q}_v$, $\bf{q}_v = q_xi + q_yj + q_zk = (q_x, q_y, q_z)$，或$Q = <q_w, \bf{q}_v>$</q_w,></li></ul><h2 id="2-2-性质"><a href="#2-2-性质" class="headerlink" title="2.2 性质"></a>2.2 性质</h2><ul><li>和</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054151.png" alt="image-20200419134044382" style="zoom:50%;"></p><ul><li>乘积</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054158.png" alt="image-20200419134120525" style="zoom:50%;"><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054203.png" alt="image-20200419134133597" style="zoom:50%;"></p><ul><li>单位四元数</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054248.png" alt="image-20200419134242520" style="zoom:50%;"></p><ul><li>共轭四元数</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054337.png" alt="image-20200419134330247" style="zoom:50%;"></p><ul><li>范数</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054413.png" alt="image-20200419134407952" style="zoom:50%;"></p><ul><li>逆</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054439.png" alt="image-20200419134433339" style="zoom:50%;"></p><ul><li>Quaternion commutator</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-054553.png" alt="image-20200419134547222" style="zoom:50%;"></p><h1 id="3-旋转"><a href="#3-旋转" class="headerlink" title="3. 旋转"></a>3. 旋转</h1><h2 id="3-1-三维旋转方程"><a href="#3-1-三维旋转方程" class="headerlink" title="3.1 三维旋转方程"></a>3.1 三维旋转方程</h2><p>三维旋转方程的推导可结合如下图例：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-080927.png" alt="image-20200419155249168" style="zoom:50%;"></p><p>我们很容易得到如下等式：$\bf{x} = \bf{x_{||}} + \bf{x}_{\perp}$，$\bf{x}_{\parallel} = \bf{u}(||x||\cos\alpha) = \bf{uu^Tx}$, $\bf{x}_{\perp} = \bf{x - x}_{\parallel} = \bf{x - uu^Tx}$。</p><p>因此，$\bf{x}’_{\parallel} = \bf{x}_{\parallel}$.</p><p>另$\bf{e}_1 = \bf{x}_{\perp}$, $\bf{e}_2 = \bf{u \times x}_{\perp} = \bf{u \times x}$，</p><p>我们得到：$\bf{x}’_{\perp} = \bf{e}_1\cos\phi + \bf{e}_2\sin\phi = \bf{x}_{\perp}\cos\phi + (\bf{u \times x})\sin\phi$，</p><p>因此，我们得到如下旋转公式：</p><p>$\bf{x}’ = \bf{x}_{\parallel} + \bf{x}_{\perp}\cos\phi + (\bf{u \times x})\sin\phi$。</p><h2 id="3-2-旋转群"><a href="#3-2-旋转群" class="headerlink" title="3.2 旋转群"></a>3.2 旋转群</h2><p>$SO(3)$定义了旋转矩阵的集合，具体定义如下：</p><p>$SO(3): \{e: R^3\to R^3 /\forall \bf{v, w}\in R^3, ||r(\bf{v})|| = ||\bf{v}||, r(\bf{v}) \times r(\bf{w}) = r(\bf{v \times w})\}$。</p><p>一个很好地表达是使用四元数来表示，唯一的区别是四元数双覆盖旋转矩阵。</p><p>旋转矩阵和四元数的$SO(3)$如下表格所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-080922.png" alt="image-20200419160913652" style="zoom:50%;"></p><h2 id="3-3-旋转矩阵的指数映射"><a href="#3-3-旋转矩阵的指数映射" class="headerlink" title="3.3 旋转矩阵的指数映射"></a>3.3 旋转矩阵的指数映射</h2><p>指数映射和对数映射是分析三维空间旋转的强有力的工具。指数映射方便我们定义旋转的导数、扰动和速度。</p><p>由$R^TR = I$，可得，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-082043.png" alt="image-20200419161931634" style="zoom:50%;"></p><p>此处，可以看出$R^T\dot{R}$为斜对称矩阵。斜对称矩阵与向量之间的关系为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-082046.png" alt="image-20200419162036517" style="zoom:50%;"></p><p>因此，我们得到：$R^T\dot{R} = [w]_{\times}$，进一步地得到$\dot{R} = R[w]_{\times}$，即旋转矩阵的微分方程。</p><p>如果假设w是常向量，因此我们利用积分得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-082841.png" alt="image-20200419162314735" style="zoom:50%;"></p><p>另$\bf{v} \triangleq \bf{w}\Delta t$，得到</p><p>$R = e^{[\bf{v}]_{\times}}$。</p><p>上述公式即为指数映射，即：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-083522.png" alt="image-20200419162828130" style="zoom:50%;"></p><h2 id="3-4-旋转矩阵和旋转向量"><a href="#3-4-旋转矩阵和旋转向量" class="headerlink" title="3.4 旋转矩阵和旋转向量"></a>3.4 旋转矩阵和旋转向量</h2><p>旋转矩阵和旋转向量之间的关系可通过罗德里格斯公式进行转换。罗德里格斯公式本文将不再推导，感兴趣的同学可以参考诸多文献。</p><p>本文给出转换公式如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-083654.png" alt="image-20200419163513828" style="zoom:50%;"></p><p>其中，$R$为旋转矩阵，$\bf{v}$为旋转向量。</p><h2 id="3-5-旋转矩阵的对数映射"><a href="#3-5-旋转矩阵的对数映射" class="headerlink" title="3.5 旋转矩阵的对数映射"></a>3.5 旋转矩阵的对数映射</h2><p>对数映射是指数映射的逆，即：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-083652.png" alt="image-20200419163645313" style="zoom:50%;"></p><p>其中，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-083716.png" alt="image-20200419163710939" style="zoom:50%;"></p><h2 id="3-6-四元数的指数映射"><a href="#3-6-四元数的指数映射" class="headerlink" title="3.6 四元数的指数映射"></a>3.6 四元数的指数映射</h2><p>类似于旋转矩阵的求微分过程，我们对四元数进行同样的动作，得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-084453.png" alt="image-20200419164447939" style="zoom:50%;"></p><p>我们得到$q^*\otimes\dot{q}$是纯四元数。另$\Omega$为纯四元数，我们得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-084854.png" alt="image-20200419164848763" style="zoom:50%;"><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-084909.png" alt="image-20200419164903060" style="zoom:50%;"></p><p>假设$\Omega$为常向量，我们积分得到，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-085034.png" alt="image-20200419165017799" style="zoom:50%;"></p><p>另$\bf{V} = \Omega\Delta t$，我们得到四元数的指数映射为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-085123.png" alt="image-20200419165116045" style="zoom:50%;"></p><p>当我们引入角速度$w$时，由$w = 2\Omega$，可得：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-085255.png" alt="image-20200419165246976" style="zoom:50%;"></p><h2 id="3-7-四元数的对数映射"><a href="#3-7-四元数的对数映射" class="headerlink" title="3.7 四元数的对数映射"></a>3.7 四元数的对数映射</h2><p>对数映射是指数映射的逆，即：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-090712.png" alt="image-20200419170706731" style="zoom:50%;"></p><h1 id="4-扰动、微分和积分"><a href="#4-扰动、微分和积分" class="headerlink" title="4. 扰动、微分和积分"></a>4. 扰动、微分和积分</h1><h2 id="4-1-加和减操作"><a href="#4-1-加和减操作" class="headerlink" title="4.1 加和减操作"></a>4.1 加和减操作</h2><p>向量的加和减操作比较直观，但是作用在$SO(3)$上则不同。分别介绍如下。</p><ul><li>加<ul><li>产出$SO(3)$</li></ul></li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-092614.png" alt="image-20200419172607385" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-092633.png" alt="image-20200419172627770" style="zoom:50%;"></p><ul><li>减<ul><li>产出向量</li></ul></li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-092655.png" alt="image-20200419172650024" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-092709.png" alt="image-20200419172703895" style="zoom:50%;"></p><h2 id="4-2-微分定义"><a href="#4-2-微分定义" class="headerlink" title="4.2 微分定义"></a>4.2 微分定义</h2><ul><li>函数微分定义</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-093128.png" alt="image-20200419172915473" style="zoom:50%;"></p><p>欧拉积分得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-093130.png" alt="image-20200419172932923" style="zoom:50%;"></p><ul><li>$SO(3)$到$SO(3)$的微分定义</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-093133.png" alt="image-20200419173105364" style="zoom:50%;"></p><p>欧拉积分得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-093135.png" alt="image-20200419173121497" style="zoom:50%;"></p><ul><li>向量到$SO(3)$</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-094632.png" alt="image-20200419174621745" style="zoom:50%;"></p><p>欧拉积分：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-094707.png" alt="image-20200419174701013" style="zoom:50%;"></p><ul><li>$SO(3)$到向量空间</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-94738.png" alt="image-20200419174731717" style="zoom:50%;"></p><p>欧拉积分：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-094805.png" alt="image-20200419174800147" style="zoom:50%;"></p><h2 id="4-3-旋转的雅克比"><a href="#4-3-旋转的雅克比" class="headerlink" title="4.3 旋转的雅克比"></a>4.3 旋转的雅克比</h2><ul><li>向量的雅克比</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-095153.png" alt="image-20200419175147405" style="zoom:50%;"></p><ul><li>向量到四元数的雅克比</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-095349.png" alt="image-20200419175343630" style="zoom:50%;"></p><p>因此，我们得到$\bf{a}’$对w和$\bf{v}$的偏导为：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-095442.png" alt="image-20200419175436647" style="zoom:50%;"></p><p>因此，我们得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-095558.png" alt="image-20200419175552531" style="zoom:50%;"></p><h3 id="4-3-1-SO-3-的右雅克比"><a href="#4-3-1-SO-3-的右雅克比" class="headerlink" title="4.3.1 $SO(3)$的右雅克比"></a>4.3.1 $SO(3)$的右雅克比</h3><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-100352.png" alt="image-20200419180320929" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-100401.png" alt="image-20200419180355451" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-100421.png" alt="image-20200419180416092" style="zoom:50%;"></p><p>属性：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-100438.png" alt="image-20200419180433437" style="zoom:50%;"></p><h3 id="4-3-2-向量的雅克比"><a href="#4-3-2-向量的雅克比" class="headerlink" title="4.3.2 向量的雅克比"></a>4.3.2 向量的雅克比</h3><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-100602.png" alt="image-20200419180555715" style="zoom:50%;"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-04-19-100616.png" alt="image-20200419180611862" style="zoom:50%;"></p>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> SLAM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> SLAM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（六）-滤波算法-贝叶斯滤波</title>
      <link href="/2020/04/12/slam/vSLAMNet%EF%BC%88%E5%85%AD%EF%BC%89-%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95-%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%BB%A4%E6%B3%A2/"/>
      <url>/2020/04/12/slam/vSLAMNet%EF%BC%88%E5%85%AD%EF%BC%89-%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95-%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%BB%A4%E6%B3%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>贝叶斯滤波基于贝叶斯公式发展起来的</li></ul><h1 id="2-贝叶斯公式"><a href="#2-贝叶斯公式" class="headerlink" title="2. 贝叶斯公式"></a>2. 贝叶斯公式</h1><p>基于条件概率公式和全概率公式，我们可以导出贝叶斯公式：</p><p>$P(x, y) = P(x|y)p(y) = P(y|x)P(x)$, 得到，</p><p>$P(x|y) = \frac{P(y|x)P(x)}{P(y)}$,</p><p>其中，$P(y|x)$表示似然概率，或者causal knowledge；$P(x)$称为先验概率或者prior knowledge；$P(x|y)$称为后验概率，是基于观测对状态的诊断或推断。</p><p><strong>贝叶斯公式的本质就是利用causal knowledge和prior knowledge来进行状态推断或推理</strong>。</p><h1 id="3-滤波算法"><a href="#3-滤波算法" class="headerlink" title="3. 滤波算法"></a>3. 滤波算法</h1><p>假设有一个系统，它的状态方程和量测方程如下：</p><p>$x_k = f_k(x_{k-1}, v_{k-1})$和$y_k = h_k(x_k, n_k)$,</p><p>其中，x为系统状态，y为测量到的数据，f和h是状态转移函数和测量函数，v和n是过程噪声和测量噪声，噪声都是独立同分布的。</p><p>状态估计问题就是根据之前一系列的已有数据$y_{1:k}$递推的计算出当前状态$x_k$的可信度$p(x_k|y_{1:k})$，具体包括预测和更新两个过程</p><h1 id="3-1-预测"><a href="#3-1-预测" class="headerlink" title="3.1 预测"></a>3.1 预测</h1><ul><li>利用系统模型(状态方程)预测状态的先验概率密度，也就是通过已有的先验知识对未来的状态进行猜测，即$p(x_k|x_{k-1})$，它的概率分布形状和系统的过程噪声$v_{k-1}$形状一模一样。如果没有噪声，x(k)完全由x(k-1)计算得到，也就没由概率分布这个概念了，由于出现了噪声，所以x(k)不好确定，他的分布就如同$v_{k-1}$，实际上形状和噪声是一样的，只是进行了一些平移。理解了这一点，对粒子滤波程序中，状态x(k)的采样的计算很有帮助，要采样x(k)，直接采样一个过程噪声，再叠加上 f(x(k-1)) 这个常数就行了</li><li>由上一时刻的概率密度$p(x_{k-1}|y_{1:k-1})$得到$p(x_k|y_{1:k-1})$，含义是既然有了前面$1:k-1$时刻的测量数据，那就可以预测一下状态$x_k$出现的概率</li><li>计算推导如下</li></ul><p>$p(x_k|y_{1:k-1}) = \int p(x_k, x_{k-1}|y_{1:k-1})dx_{k-1}$</p><p>$= \int p(x_k|x_{k-1}, y_{1:k-1}p(x_{k-1}|y_{1:k-1}))dx_{k-1}$</p><p>$= \int p(x_k|x_{k-1})p(x+{k-1}|y_{1:k-1})dx_{k-1}$,</p><p>其中，等式的第一行到第二行纯粹是贝叶斯公式的应用，第二行得到第三行是由于一阶马尔科夫过程的假设，即状态$x_k$只由$x_{k-1}$决定。</p><h1 id="3-2-更新"><a href="#3-2-更新" class="headerlink" title="3.2 更新"></a>3.2 更新</h1><ul><li>利用最新的测量值对先验概率密度进行修正，得到后验概率密度，也就是对之前的猜测进行修正</li><li>由$p(x_k|y_{1:k-1})$得到后验概率$p(x_k|y_{1:k})$。这个后验概率才是真正有用的东西，上一步还只是预测，这里又多了k时刻的测量，对上面的预测再进行修正，就是滤波了。这里的后验概率也将是代入到下次的预测，形成递推</li></ul><p>$p(x_k|y_{1:k}) = \frac{p(y_k|x_k,y_{1:k-1})p(x_k|y_{1:k-1})}{p(y_k|y_{1:k-1})}$</p><p>$= \frac{p(y_k|x_k)p(x_k|y_{1:k-1})}{p(y_k|y_{1:k-1})}$，</p><p>其中归一化常数为$p(y_k|y_{1:k-1}) = \int p(y_k|x_k)p(x_k|y_{1:k-1})dx_k$。等式第一行到第二行是因为测量方程知道, y(k)只与x(k)有关。$p(y_k|x_k)$也称之为似然函数，由量测方程决定。也和上面的推理一样，$y_k = h(x_k) + n_k$，x(k)部分是常数，$p(y_k|x_k)$也是只和量测噪声n(k)的概率分布有关。</p><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ul><li><a href="https://www.cnblogs.com/ycwang16/p/5995702.html" target="_blank" rel="noopener">细说贝叶斯滤波：Bayes filters</a></li><li><a href="https://blog.csdn.net/heyijia0327/article/details/40899819" target="_blank" rel="noopener">Particle Filter Tutorial 粒子滤波：从推导到应用（一）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 滤波 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 滤波 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（四）-最优化-Levenberg-Marquardt算法</title>
      <link href="/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-Levenberg-Marquardt%E7%AE%97%E6%B3%95/"/>
      <url>/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-Levenberg-Marquardt%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>LM算法，全称为Levenberg-Marquard算法，它可用于解决非线性最小二乘问题，多用于曲线拟合等场合</li><li>主要思想<ul><li>LM算法属于一种“<a href="http://www.codelast.com/?p=7488" target="_blank" rel="noopener">信赖域法</a>”——所谓的信赖域法，此处稍微解释一下：在最优化算法中，都是要求一个函数的极小值，每一步迭代中，都要求目标函数值是下降的，而信赖域法，顾名思义，就是从初始点开始，先假设一个可以信赖的最大位移s，然后在以当前点为中心，以s为半径的区域内，通过寻找目标函数的一个近似函数（二次的）的最优点，来求解得到真正的位移。在得到了位移之后，再计算目标函数值，如果其使目标函数值的下降满足了一定条件，那么就说明这个位移是可靠的，则继续按此规则迭代计算下去；如果其不能使目标函数值的下降满足一定的条件，则应减小信赖域的范围，再重新求解。</li></ul></li></ul><h1 id="2-算法原理"><a href="#2-算法原理" class="headerlink" title="2. 算法原理"></a>2. 算法原理</h1><p>对于一个非线性最小二乘问题：</p><p>$x = \arg \min_x \frac{1}{2}||f(x)||^2$.</p><p>高斯牛顿的思想是把$f(x)$利用泰勒展开，取一阶线性项近似，即</p><p>$f(x + \Delta x) = f(x) + f’(x)\Delta x = f(x) + J(x)\Delta x$.</p><p>再将上述公式代入非线性最小二乘公式，得：</p><p>$\frac{1}{2}||f(x + \Delta x)||^2 = \frac{1}{2}[f(x)^Tf(x) + 2f(x)^TJ(x)\Delta x + \Delta x^TJ(x)^TJ(x)\Delta x]$.</p><p>阻尼法的的思想是再加入一个阻尼项$\frac{1}{2}\mu\Delta x^T\Delta x$，得到：</p><p>为了书写方便，将$\Delta x$记为h，</p><p>$h = \arg\min_hG(h) = \arg\min_h\frac{1}{2}f^Tf + h^TJ^Tf + \frac{1}{2}h^TJ^TJh + \frac{1}{2}\mu h^Th$.</p><p>对上式求偏导数，并令为0，得到：</p><p>$J^Tf + J^TJh + \mu h = 0$,</p><p>$(J^TJ + \mu I)h = -J^Tf$,</p><p>$(H + \mu I)h = -g$.</p><p>引入阻尼参数$\mu$由如下好处：</p><ul><li>对于$\mu &gt; 0$，$(H + \mu I)$正定，保证了h是梯度下降的方向</li><li>当$\mu$较大时，$h \approx -\frac{1}{\mu}g = -\frac{1}{\mu}F’(x)$，其实就是梯度、最速下降法，当离最终结果较远的时候，很好</li><li>当$\mu$较小时，方法接近与高斯牛顿，当离最终结果很近时，可以获得二次收敛速度，很好</li></ul><p>$\mu$的设定策略如下：</p><ul><li>初始时，取</li></ul><p>$A_0 = J(x_0)^TJ(x_0)$,</p><p>$\mu_0 = \tau \cdot\max{a_{ii}^0}$.</p><ul><li>迭代后，利用cost增益来确定</li></ul><p>$\mu = \frac{F(x) - f(x + h)}{L(0) - L(h)}$.</p><p>迭代终止条件：</p><ul><li>一阶导数为０：$F’(x) = g(x) = 0$，使用$||g(x)|| &lt; \epsilon$，其中$\epsilon$是设定的终止条件</li><li>x变化步距离足够小，$||h|| = ||x_{new} - x|| &lt; \epsilon(||x|| + \epsilon)$</li><li>超过最大迭代次数</li></ul><h1 id="3-例子"><a href="#3-例子" class="headerlink" title="3. 例子"></a>3. 例子</h1><p>求解非线性方程$y = e^{ax^2 + bx + c}$，给定n组观测数据$(x, y)$，求解系数$X = [a, b, c]^T$。</p><p>解：由题可得：</p><p>令$f(X) = y - e^{ax^2 + bx + c}$，N组数据可以组成一个大的非线性方程组，通过构建最小二乘问题来进行系数求解，即</p><p>$x = \arg\min_x \frac{1}{2}||f(X)||^2$.</p><p>要求解这个问题，根据推导部分可知，需要求解雅克比，</p><p>实现代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Dense&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Cholesky&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 计时类 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Runtimer</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        t_s_  = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        t_e_ = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">duration</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::duration&lt;<span class="keyword">double</span>&gt;&gt;(t_e_ - t_s_).count() * <span class="number">1000.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::chrono::steady_clock::time_point t_s_; <span class="comment">//start time ponit</span></span><br><span class="line">    <span class="built_in">std</span>::chrono::steady_clock::time_point t_e_; <span class="comment">//stop time point</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  优化方程 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LevenbergMarquardt</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    LevenbergMarquardt(<span class="keyword">double</span>* a, <span class="keyword">double</span>* b, <span class="keyword">double</span>* c):</span><br><span class="line">    a_(a), b_(b), c_(c)</span><br><span class="line">    &#123;</span><br><span class="line">        epsilon_1_ = <span class="number">1e-6</span>;</span><br><span class="line">        epsilon_2_ = <span class="number">1e-6</span>;</span><br><span class="line">        max_iter_ = <span class="number">50</span>;</span><br><span class="line">        is_out_ = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setParameters</span><span class="params">(<span class="keyword">double</span> epsilon_1, <span class="keyword">double</span> epsilon_2, <span class="keyword">int</span> max_iter, <span class="keyword">bool</span> is_out)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        epsilon_1_ = epsilon_1;</span><br><span class="line">        epsilon_2_ = epsilon_2;</span><br><span class="line">        max_iter_ = max_iter;</span><br><span class="line">        is_out_ = is_out;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addObservation</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span>&amp; x, <span class="keyword">const</span> <span class="keyword">double</span>&amp; y)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        obs_.push_back(Eigen::Vector2d(x, y));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calcJ_fx</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        J_ .resize(obs_.size(), <span class="number">3</span>);</span><br><span class="line">        fx_.resize(obs_.size(), <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; obs_.size(); i ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">const</span> Eigen::Vector2d&amp; ob = obs_.at(i);</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">double</span>&amp; x = ob(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">double</span>&amp; y = ob(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">double</span> j1 = -x*x*<span class="built_in">exp</span>(*a_ * x*x + *b_*x + *c_);</span><br><span class="line">            <span class="keyword">double</span> j2 = -x*<span class="built_in">exp</span>(*a_ * x*x + *b_*x + *c_);</span><br><span class="line">            <span class="keyword">double</span> j3 = -<span class="built_in">exp</span>(*a_ * x*x + *b_*x + *c_);</span><br><span class="line">            J_(i, <span class="number">0</span> ) = j1;</span><br><span class="line">            J_(i, <span class="number">1</span>) = j2;</span><br><span class="line">            J_(i, <span class="number">2</span>) = j3;</span><br><span class="line">            fx_(i, <span class="number">0</span>) = y - <span class="built_in">exp</span>( *a_ *x*x + *b_*x +*c_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calcH_g</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        H_ = J_.transpose() * J_;</span><br><span class="line">        g_ = -J_.transpose() * fx_;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">getCost</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Eigen::MatrixXd cost= fx_.transpose() * fx_;</span><br><span class="line">        <span class="keyword">return</span> cost(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">F</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b, <span class="keyword">double</span> c)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Eigen::MatrixXd fx;</span><br><span class="line">        fx.resize(obs_.size(), <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; obs_.size(); i ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">const</span> Eigen::Vector2d&amp; ob = obs_.at(i);</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">double</span>&amp; x = ob(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">double</span>&amp; y = ob(<span class="number">1</span>);</span><br><span class="line">            fx(i, <span class="number">0</span>) = y - <span class="built_in">exp</span>( a *x*x + b*x +c);</span><br><span class="line">        &#125;</span><br><span class="line">        Eigen::MatrixXd F = <span class="number">0.5</span> * fx.transpose() * fx;</span><br><span class="line">        <span class="keyword">return</span> F(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">L0_L</span><span class="params">( Eigen::Vector3d&amp; h)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">           Eigen::MatrixXd L = -h.transpose() * J_.transpose() * fx_ - <span class="number">0.5</span> * h.transpose() * J_.transpose() * J_ * h;</span><br><span class="line">           <span class="keyword">return</span> L(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">double</span> nu = <span class="number">2.0</span>;</span><br><span class="line">        calcJ_fx();</span><br><span class="line">        calcH_g();</span><br><span class="line">        <span class="keyword">bool</span> found = ( g_.lpNorm&lt;Eigen::Infinity&gt;() &lt; epsilon_1_ );</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; A;</span><br><span class="line">        A.push_back( H_(<span class="number">0</span>, <span class="number">0</span>) );</span><br><span class="line">        A.push_back( H_(<span class="number">1</span>, <span class="number">1</span>) );</span><br><span class="line">        A.push_back( H_(<span class="number">2</span>,<span class="number">2</span>) );</span><br><span class="line">        <span class="keyword">auto</span> max_p = <span class="built_in">std</span>::max_element(A.begin(), A.end());</span><br><span class="line">        <span class="keyword">double</span> mu = *max_p;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">double</span> sumt =<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( !found &amp;&amp; k &lt; max_iter_)</span><br><span class="line">        &#123;</span><br><span class="line">            Runtimer t;</span><br><span class="line">            t.start();</span><br><span class="line">            </span><br><span class="line">            k = k +<span class="number">1</span>;</span><br><span class="line">            Eigen::Matrix3d G = H_ + mu * Eigen::Matrix3d::Identity();</span><br><span class="line">            Eigen::Vector3d h = G.ldlt().solve(g_);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>( h.norm() &lt;= epsilon_2_ * ( <span class="built_in">sqrt</span>(*a_**a_ + *b_**b_ + *c_**c_ ) +epsilon_2_ ) )</span><br><span class="line">                found = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">double</span> na = *a_ + h(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">double</span> nb = *b_ + h(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">double</span> nc = *c_ + h(<span class="number">2</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">double</span> rho =( F(*a_, *b_, *c_) - F(na, nb, nc) )  / L0_L(h);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>( rho &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    *a_ = na;</span><br><span class="line">                    *b_ = nb;</span><br><span class="line">                    *c_ = nc;</span><br><span class="line">                    calcJ_fx();</span><br><span class="line">                    calcH_g();</span><br><span class="line">                                      </span><br><span class="line">                    found = ( g_.lpNorm&lt;Eigen::Infinity&gt;() &lt; epsilon_1_ );</span><br><span class="line">                    mu = mu * <span class="built_in">std</span>::max&lt;<span class="keyword">double</span>&gt;(<span class="number">0.33</span>, <span class="number">1</span> - <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="number">2</span>*rho <span class="number">-1</span>, <span class="number">3</span>));</span><br><span class="line">                    nu = <span class="number">2.0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    mu = mu * nu; </span><br><span class="line">                    nu = <span class="number">2</span>*nu;</span><br><span class="line">                &#125;<span class="comment">// if rho &gt; 0</span></span><br><span class="line">            &#125;<span class="comment">// if step is too small</span></span><br><span class="line">            </span><br><span class="line">            t.stop();</span><br><span class="line">            <span class="keyword">if</span>( is_out_ )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Iter: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">3</span>) &lt;&lt; k &lt;&lt; <span class="string">" Result: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>)  &lt;&lt; *a_ &lt;&lt; <span class="string">" "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>)  &lt;&lt; *b_ &lt;&lt; <span class="string">" "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>) &lt;&lt; *c_ &lt;&lt; </span><br><span class="line">                <span class="string">" step: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; h.norm() &lt;&lt; <span class="string">" cost: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>)  &lt;&lt; getCost() &lt;&lt; <span class="string">" time: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; t.duration()  &lt;&lt;</span><br><span class="line">                <span class="string">" total_time: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; (sumt += t.duration()) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            &#125;   </span><br><span class="line">        &#125; <span class="comment">// while</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>( found  == <span class="literal">true</span>)</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\nConverged\n\n"</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\nDiverged\n\n"</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="comment">//function </span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Eigen::MatrixXd fx_; </span><br><span class="line">    Eigen::MatrixXd J_; <span class="comment">// 雅克比矩阵</span></span><br><span class="line">    Eigen::Matrix3d H_; <span class="comment">// H矩阵</span></span><br><span class="line">    Eigen::Vector3d g_;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; Eigen::Vector2d&gt; obs_; <span class="comment">// 观测</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">/* 要求的三个参数 */</span></span><br><span class="line">   <span class="keyword">double</span>* a_, *b_, *c_;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* parameters */</span></span><br><span class="line">    <span class="keyword">double</span> epsilon_1_, epsilon_2_;</span><br><span class="line">    <span class="keyword">int</span> max_iter_;</span><br><span class="line">    <span class="keyword">bool</span> is_out_;</span><br><span class="line">&#125;;<span class="comment">//class LevenbergMarquardt</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> aa = <span class="number">0.1</span>, bb = <span class="number">0.5</span>, cc = <span class="number">2</span>; <span class="comment">// 实际方程的参数</span></span><br><span class="line">    <span class="keyword">double</span> a =<span class="number">0.0</span>, b=<span class="number">0.0</span>, c=<span class="number">0.0</span>; <span class="comment">// 初值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 构造问题 */</span></span><br><span class="line">    <span class="function">LevenbergMarquardt <span class="title">lm</span><span class="params">(&amp;a, &amp;b, &amp;c)</span></span>;</span><br><span class="line">    lm.setParameters(<span class="number">1e-10</span>, <span class="number">1e-10</span>, <span class="number">100</span>, <span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 制造数据 */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">size_t</span> N = <span class="number">100</span>; <span class="comment">//数据个数</span></span><br><span class="line">    cv::<span class="function">RNG <span class="title">rng</span><span class="params">(cv::getTickCount())</span></span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; N; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* 生产带有高斯噪声的数据　*/</span></span><br><span class="line">        <span class="keyword">double</span> x = rng.uniform(<span class="number">0.0</span>, <span class="number">1.0</span>) ;</span><br><span class="line">        <span class="keyword">double</span> y = <span class="built_in">exp</span>(aa*x*x + bb*x + cc) + rng.gaussian(<span class="number">0.05</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 添加到观测中　*/</span></span><br><span class="line">        lm.addObservation(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 用LM法求解 */</span></span><br><span class="line">    lm.solve();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（以上代码参考：<a href="https://zhuanlan.zhihu.com/p/42415718）" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/42415718）</a></p><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/42415718" target="_blank" rel="noopener">Levenberg-Marquardt 最小二乘优化</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 最优化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 最优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（四）-最优化-高斯牛顿法</title>
      <link href="/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E9%AB%98%E6%96%AF%E7%89%9B%E9%A1%BF%E6%B3%95/"/>
      <url>/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E9%AB%98%E6%96%AF%E7%89%9B%E9%A1%BF%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>高斯牛顿是基于牛顿法发展来的</li><li>回想牛顿法求解非线性优化问题需要求解海塞矩阵，有时该矩阵是很难求解的或者当维度较大时占用较大内存也会导致求解失败</li><li>高丝牛顿法舍弃了海塞矩阵的求解，采用如下公式代替</li></ul><p>$H_{jk} = 2\sum_{i=1}^m J_{ij}J_{ik}$.</p><h1 id="2-算法原理"><a href="#2-算法原理" class="headerlink" title="2. 算法原理"></a>2. 算法原理</h1><p>对于一个非线性最小二乘问题：</p><p>$x = \arg \min_x \frac{1}{2}||f(x)||^2$.</p><p>高斯牛顿的思想是把$f(x)$利用泰勒展开，取一阶线性项近似，即</p><p>$f(x + \Delta x) = f(x) + f’(x)\Delta x = f(x) + J(x)\Delta x$.</p><p>再将上述公式代入非线性最小二乘公式，得：</p><p>$\frac{1}{2}||f(x + \Delta x)||^2 = \frac{1}{2}[f(x)^Tf(x) + 2f(x)^TJ(x)\Delta x + \Delta x^TJ(x)^TJ(x)\Delta x]$.</p><p>上式对$\Delta x$求导，令导数为0，得：</p><p>$J(x)^TJ(x)\Delta x = -J(x)^Tf(x)$.</p><p>另$H = J^TJ$，$B = -J^Tf$，那么，得到：</p><p>$H\Delta x = B$.</p><p>通过求解上述公式即可解出增量$\Delta x$，要求H正定，但实际情况并不一定满足这个条件，因此可能发散，另外步长$\Delta x$可能太大，也会导致发散。</p><p>综上所述，高斯牛顿法的计算步骤如下：</p><ul><li>给定初值$x_0$</li><li>对于第k次迭代，计算雅克比矩阵J，矩阵H和矩阵B</li><li>求解增量$\Delta x$</li><li>如果$\Delta x$足够小，停止迭代；否则，更新$x_{k+1} = x_k + \Delta x$</li><li>如果迭代次数达到最大次数，也停止迭代</li></ul><h1 id="3-实例"><a href="#3-实例" class="headerlink" title="3. 实例"></a>3. 实例</h1><p>求解非线性方程$y = e^{ax^2 + bx + c}$，给定n组观测数据$(x, y)$，求解系数$X = [a, b, c]^T$。</p><p>解：由题可得：</p><p>令$f(X) = y - e^{ax^2 + bx + c}$，N组数据可以组成一个大的非线性方程组，通过构建最小二乘问题来进行系数求解，即</p><p>$x = \arg\min_x \frac{1}{2}||f(X)||^2$.</p><p>要求解这个问题，根据推导部分可知，需要求解雅克比，</p><p>实现代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Cholesky&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/QR&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/SVD&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 计时类 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Runtimer</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        t_s_  = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        t_e_ = <span class="built_in">std</span>::chrono::steady_clock::now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">duration</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::duration&lt;<span class="keyword">double</span>&gt;&gt;(t_e_ - t_s_).count() * <span class="number">1000.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::chrono::steady_clock::time_point t_s_; <span class="comment">//start time ponit</span></span><br><span class="line">    <span class="built_in">std</span>::chrono::steady_clock::time_point t_e_; <span class="comment">//stop time point</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  优化方程 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CostFunction</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        CostFunction(<span class="keyword">double</span>* a, <span class="keyword">double</span>* b, <span class="keyword">double</span>* c, <span class="keyword">int</span> max_iter, <span class="keyword">double</span> min_step, <span class="keyword">bool</span> is_out):</span><br><span class="line">        a_(a), b_(b), c_(c), max_iter_(max_iter), min_step_(min_step), is_out_(is_out)</span><br><span class="line">        &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">addObservation</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt; ob;</span><br><span class="line">            ob.push_back(x);</span><br><span class="line">            ob.push_back(y);</span><br><span class="line">            obs_.push_back(ob);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">calcJ_fx</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            J_ .resize(obs_.size(), <span class="number">3</span>);</span><br><span class="line">            fx_.resize(obs_.size(), <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; obs_.size(); i ++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;&amp; ob = obs_.at(i);</span><br><span class="line">                <span class="keyword">double</span>&amp; x = ob.at(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">double</span>&amp; y = ob.at(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">double</span> j1 = -x*x*<span class="built_in">exp</span>(*a_ * x*x + *b_*x + *c_);</span><br><span class="line">                <span class="keyword">double</span> j2 = -x*<span class="built_in">exp</span>(*a_ * x*x + *b_*x + *c_);</span><br><span class="line">                <span class="keyword">double</span> j3 = -<span class="built_in">exp</span>(*a_ * x*x + *b_*x + *c_);</span><br><span class="line">                J_(i, <span class="number">0</span> ) = j1;</span><br><span class="line">                J_(i, <span class="number">1</span>) = j2;</span><br><span class="line">                J_(i, <span class="number">2</span>) = j3;</span><br><span class="line">                fx_(i, <span class="number">0</span>) = y - <span class="built_in">exp</span>( *a_ *x*x + *b_*x +*c_);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="function"><span class="keyword">void</span> <span class="title">calcH_b</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            H_ = J_.transpose() * J_;</span><br><span class="line">            B_ = -J_.transpose() * fx_;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">calcDeltax</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            deltax_ = H_.ldlt().solve(B_); </span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="function"><span class="keyword">void</span> <span class="title">updateX</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            *a_ += deltax_(<span class="number">0</span>);</span><br><span class="line">            *b_ += deltax_(<span class="number">1</span>);</span><br><span class="line">            *c_ += deltax_(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">double</span> <span class="title">getCost</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Eigen::MatrixXd cost= fx_.transpose() * fx_;</span><br><span class="line">            <span class="keyword">return</span> cost(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">solveByGaussNewton</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">double</span> sumt =<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">bool</span> is_conv = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span>( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; max_iter_; i ++)</span><br><span class="line">            &#123;</span><br><span class="line">                Runtimer t;</span><br><span class="line">                t.start();</span><br><span class="line">                calcJ_fx();</span><br><span class="line">                calcH_b();</span><br><span class="line">                calcDeltax();</span><br><span class="line">                <span class="keyword">double</span> delta = deltax_.transpose() * deltax_;</span><br><span class="line">                t.stop();</span><br><span class="line">                <span class="keyword">if</span>( is_out_ )</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Iter: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">3</span>) &lt;&lt; i &lt;&lt; <span class="string">" Result: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>)  &lt;&lt; *a_ &lt;&lt; <span class="string">" "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>)  &lt;&lt; *b_ &lt;&lt; <span class="string">" "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">10</span>) &lt;&lt; *c_ &lt;&lt; </span><br><span class="line">                    <span class="string">" step: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; delta &lt;&lt; <span class="string">" cost: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>)  &lt;&lt; getCost() &lt;&lt; <span class="string">" time: "</span> &lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; t.duration()  &lt;&lt;</span><br><span class="line">                    <span class="string">" total_time: "</span>&lt;&lt; <span class="built_in">std</span>::left &lt;&lt;<span class="built_in">std</span>::setw(<span class="number">14</span>) &lt;&lt; (sumt += t.duration()) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>( delta &lt; min_step_)</span><br><span class="line">                &#123;</span><br><span class="line">                    is_conv = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                updateX();</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">           <span class="keyword">if</span>( is_conv  == <span class="literal">true</span>)</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\nConverged\n"</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"\nDiverged\n\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Eigen::MatrixXd fx_;</span><br><span class="line">        Eigen::MatrixXd J_; <span class="comment">// 雅克比矩阵</span></span><br><span class="line">        Eigen::Matrix3d H_; <span class="comment">// H矩阵</span></span><br><span class="line">        Eigen::Vector3d B_;</span><br><span class="line">        Eigen::Vector3d deltax_;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;  &gt; obs_; <span class="comment">// 观测</span></span><br><span class="line">        <span class="keyword">double</span>* a_, *b_, *c_;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> max_iter_;</span><br><span class="line">        <span class="keyword">double</span> min_step_;</span><br><span class="line">        <span class="keyword">bool</span> is_out_;</span><br><span class="line">&#125;;<span class="comment">//class CostFunction</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> aa = <span class="number">0.1</span>, bb = <span class="number">0.5</span>, cc = <span class="number">2</span>; <span class="comment">// 实际方程的参数</span></span><br><span class="line">    <span class="keyword">double</span> a =<span class="number">0.0</span>, b=<span class="number">0.0</span>, c=<span class="number">0.0</span>; <span class="comment">// 初值</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 构造问题 */</span></span><br><span class="line">    <span class="function">CostFunction <span class="title">cost_func</span><span class="params">(&amp;a, &amp;b, &amp;c, <span class="number">50</span>, <span class="number">1e-10</span>, <span class="literal">true</span>)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 制造数据 */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">size_t</span> N = <span class="number">100</span>; <span class="comment">//数据个数</span></span><br><span class="line">    cv::<span class="function">RNG <span class="title">rng</span><span class="params">(cv::getTickCount())</span></span>;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; N; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* 生产带有高斯噪声的数据　*/</span></span><br><span class="line">       <span class="keyword">double</span> x = rng.uniform(<span class="number">0.0</span>, <span class="number">1.0</span>) ;</span><br><span class="line">       <span class="keyword">double</span> y = <span class="built_in">exp</span>(aa*x*x + bb*x + cc) + rng.gaussian(<span class="number">0.05</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">/* 添加到观测中　*/</span></span><br><span class="line">       cost_func.addObservation(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 用高斯牛顿法求解 */</span></span><br><span class="line">    cost_func.solveByGaussNewton();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（以上代码参考：<a href="https://zhuanlan.zhihu.com/p/42383070）" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/42383070）</a></p><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/42383070" target="_blank" rel="noopener">Gauss-Newton非线性最小二乘算法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 最优化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 最优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（四）-最优化-牛顿法</title>
      <link href="/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E7%89%9B%E9%A1%BF%E6%B3%95/"/>
      <url>/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E7%89%9B%E9%A1%BF%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>是一种在实数域和复数域上近似求解方程的方法</li><li>方法使用函数<em>f</em> (<em>x</em>)的泰勒级数的前面几项来寻找方程<em>f</em> (<em>x</em>) = 0的根</li><li>最大的特点就在于它的收敛速度很快</li></ul><h1 id="2-算法原理"><a href="#2-算法原理" class="headerlink" title="2. 算法原理"></a>2. 算法原理</h1><p>将函数f(x)在$x_0$处应用泰勒展开得，$f(x) = f(x_0) + \frac{f’(x_0)}{1!}(x - x_0) + \frac{f’’(x_0)}{2!}(x-x_0)^2 + \cdots$，我们取前两项，$f(x) = f(x_0) + f’(x_0)(x-x_0)$。</p><p>对等式两边求导数得到，</p><p>$f’(x) = f’(x_0) + f’’(x_0)\Delta x$，</p><p>当f(x)取最小值时，$f’(x) = 0$，所以我们得到，</p><p>$0 = f’(x_0)+ f’’(x_0)\Delta x$，</p><p>$\Delta x = -\frac{f’(x_0)}{f’’(x_0)}$，</p><p>这样我们就得到了牛顿法的参数迭代更新公式如下，</p><p>$x_{n+1} = x_n- \frac{f’(x_n)}{f’’(x_n}$。</p><p>例子：</p><p>求解最优化问题，函数$\min_{x\in R^n}f(x)$，其中$x^*$为目标函数的极小值。</p><p>设f(x)具有二阶连续偏导数，若第k次的迭代值为$x^{(k)}$，则可将f(x)在$x^{(k)}$附近进行二阶泰勒展开，</p><p>$f(x) = f(x^{(k)}) + g_k^T(x-x^{(k)}) + \frac{1}{2}(x-x^{(k)})^TH(x^{(k)})(x-x^{(k)})$，</p><p>其中，$g_k = g(x^{(k)}) = \bigtriangledown f(x^{(k)})$是f(x)的梯度向量在点$x^{(k)}$，$H(x^{(k)})$是f(x)的海赛矩阵$H(x^{(k)}) = [\frac{\partial^2f}{\partial x_i\partial x_j}]_{nxn}$在点$x^{(k)}$的值。</p><p>函数f(x)有极值的必要条件是在极值点处一阶导数为0，即梯度向量为0。特别的当$H(x^{(k)})$是正定矩阵时，函数f(x)的极值为极小值。对上述泰勒公式再进行求导得到，</p><p>$\bigtriangledown f(x) = g_k + H_k(x - x^{(k)})$，</p><p>其中，$H_k = H(x^{(k)})$，那么，</p><p>$g_k + H_k(x^{(k+1)} - x^{(k)}) = 0$，</p><p>$x^{(k+1)} = x^{(k)} - H_k^{-1}g_k$。</p><p>令$H_kp_k = -g_k$，</p><p>那么得到迭代公式，</p><p>$x^{(k + 1)} = x^{(k)} + p_k$。<br>最终可在$\bigtriangledown f(x^*)= 0$处收敛。</p><p>算法伪代码：</p><p>输入: f(x)，梯度$g(x) = \bigtriangledown f(x)$，海赛矩阵H(x)，精度要求$\epsilon$</p><p>输出: f(x)的极小值点$x^*$</p><ol><li>取初始值$x^{(0)}$，置$k = 0$</li><li>计算$g_k = g(x^{(k)})$</li><li>若$||g_k|| \leq \epsilon$，停止得到近似解$x^* = x^{(k)}$</li><li>计算$H_k = H(x^{(k)})$，并求$p_k$，$H_kp_k = -g_k$</li><li>置$x^{(k+1)} = x^{(k)} + p_k$</li><li>置$k = k+1$，转2</li></ol><p>优缺点：</p><ul><li>二阶收敛，收敛速度快</li><li>牛顿法是一种迭代算法，每一步都需要求解目标函数的Hessian矩阵的逆矩阵，计算比较复杂</li></ul><h1 id="3-实例"><a href="#3-实例" class="headerlink" title="3. 实例"></a>3. 实例</h1><p>用牛顿法求解$f(x) = \frac{3}{2}x_1^2 - x_1*x_2 - 2x_1$的极小值。</p><p>解：由题可得，</p><p>梯度为$\nabla f(x) = (3x_1 - x_2 -2, x_2 - x_1)^T$，</p><p>$H(x) = \left[\begin{matrix} 3 &amp; -1 \\ -1 &amp; 1 \end{matrix}\right]$是正定矩阵。</p><p>取$x^{(0)} = (0, 0)^T$，则</p><p>$\nabla f(x^{(0)}) = (-2, 0)^T$，$H(x^{(0)}) = \left[\begin{matrix} 3 &amp; -1 \\ -1 &amp; 1 \end{matrix}\right]$，$H(x^{(0)})^{-1} = \left[\begin{matrix} \frac{1}{2} &amp; \frac{1}{2} \\ \frac{1}{2} &amp; \frac{3}{2} \end{matrix}\right]$。</p><p>$x^{(1)} = x^{(0)} - H(x^{(0)})^{-1} \nabla f(x^{0}) = (1, 1)^T$.</p><p>将$x^{(1)}$代入$\nabla f(x)$得$(0, 0)^T$，那么$x^{(1)} = (1, 1)^T$即为极小值点，那么极小值为$-1$。</p><h1 id="4-代码实现"><a href="#4-代码实现" class="headerlink" title="4. 代码实现"></a>4. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Newton法</span></span><br><span class="line"><span class="string">Rosenbrock函数</span></span><br><span class="line"><span class="string">函数 f(x)=100*(x(2)-x(1).^2).^2+(1-x(1)).^2</span></span><br><span class="line"><span class="string">梯度 g(x)=(-400*(x(2)-x(1)^2)*x(1)-2*(1-x(1)),200*(x(2)-x(1)^2))^(T)</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jacobian</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> np.array([<span class="number">-400</span>*x[<span class="number">0</span>]*(x[<span class="number">1</span>]-x[<span class="number">0</span>]**<span class="number">2</span>)<span class="number">-2</span>*(<span class="number">1</span>-x[<span class="number">0</span>]),<span class="number">200</span>*(x[<span class="number">1</span>]-x[<span class="number">0</span>]**<span class="number">2</span>)])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hessian</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> np.array([[<span class="number">-400</span>*(x[<span class="number">1</span>]<span class="number">-3</span>*x[<span class="number">0</span>]**<span class="number">2</span>)+<span class="number">2</span>,<span class="number">-400</span>*x[<span class="number">0</span>]],[<span class="number">-400</span>*x[<span class="number">0</span>],<span class="number">200</span>]])</span><br><span class="line"></span><br><span class="line">X1=np.arange(<span class="number">-1.5</span>,<span class="number">1.5</span>+<span class="number">0.05</span>,<span class="number">0.05</span>)</span><br><span class="line">X2=np.arange(<span class="number">-3.5</span>,<span class="number">2</span>+<span class="number">0.05</span>,<span class="number">0.05</span>)</span><br><span class="line">[x1,x2]=np.meshgrid(X1,X2)</span><br><span class="line">f=<span class="number">100</span>*(x2-x1**<span class="number">2</span>)**<span class="number">2</span>+(<span class="number">1</span>-x1)**<span class="number">2</span>; <span class="comment"># 给定的函数</span></span><br><span class="line">plt.contour(x1,x2,f,<span class="number">20</span>) <span class="comment"># 画出函数的20条轮廓线</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">newton</span><span class="params">(x0)</span>:</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">'初始点为:'</span>)</span><br><span class="line">    print(x0,<span class="string">'\n'</span>)</span><br><span class="line">    W=np.zeros((<span class="number">2</span>,<span class="number">10</span>**<span class="number">3</span>))</span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    imax = <span class="number">1000</span></span><br><span class="line">    W[:,<span class="number">0</span>] = x0 </span><br><span class="line">    x = x0</span><br><span class="line">    delta = <span class="number">1</span></span><br><span class="line">    alpha = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> i&lt;imax <span class="keyword">and</span> delta&gt;<span class="number">10</span>**(<span class="number">-5</span>):</span><br><span class="line">        p = -np.dot(np.linalg.inv(hessian(x)),jacobian(x))</span><br><span class="line">        x0 = x</span><br><span class="line">        x = x + alpha*p</span><br><span class="line">        W[:,i] = x</span><br><span class="line">        delta = sum((x-x0)**<span class="number">2</span>)</span><br><span class="line">        print(<span class="string">'第'</span>,i,<span class="string">'次迭代结果:'</span>)</span><br><span class="line">        print(x,<span class="string">'\n'</span>)</span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">    W=W[:,<span class="number">0</span>:i]  <span class="comment"># 记录迭代点</span></span><br><span class="line">    <span class="keyword">return</span> W</span><br><span class="line"></span><br><span class="line">x0 = np.array([<span class="number">-1.2</span>,<span class="number">1</span>])</span><br><span class="line">W=newton(x0)</span><br><span class="line"></span><br><span class="line">plt.plot(W[<span class="number">0</span>,:],W[<span class="number">1</span>,:],<span class="string">'g*'</span>,W[<span class="number">0</span>,:],W[<span class="number">1</span>,:]) <span class="comment"># 画出迭代点收敛的轨迹</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><p>-<a href="https://blog.csdn.net/piaoxuezhong/article/details/60135153" target="_blank" rel="noopener">梯度下降法，牛顿法，高斯-牛顿迭代法，附代码实现</a></p>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 最优化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 最优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（四）-最优化-最小二乘法</title>
      <link href="/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95/"/>
      <url>/2020/04/06/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>最小二乘法Least Square Method，是分类回归算法的基础</li><li>主要思想<ul><li>通过最小化误差的平方和寻找数据的最佳函数匹配</li><li>利用最小二乘法可以简便地求得未知的数据，并使得这些求得的数据与实际数据之间误差的平方和为最小</li></ul></li></ul><h1 id="2-最小二乘法原理"><a href="#2-最小二乘法原理" class="headerlink" title="2. 最小二乘法原理"></a>2. 最小二乘法原理</h1><p>假设我们现在有一系列数据点$(x_i, y_i), i = 1, 2, \dots, m$，那么，给定拟合函数$h(x)$，我们可以得到拟合出来的数据点。但是，给出的拟合函数与实际待求解的函数的拟合程度比较高呢？因此，提出残差来衡量，计算公式如下：</p><p>$r_i = h(x_i) - y_i$，</p><p>其中，$r_i$为第$i$个数据点的残差，$y_i$为第$i$个数据点的真值，$h(x_i)$就是第$i$个数据点由拟合函数计算得到的数值。</p><p>评估拟合程度的主要思想就是真值和拟合函数计算的数据距离越小越相似。相似性计算方法有如下几种：</p><ul><li>$\infty-$范数<ul><li>残差绝对值的最大值$\max_{1\leq i\leq m}|r_i|$，即所有数据点中残差距离的最大值</li></ul></li><li>$1-$范数<ul><li>绝对残差和$\sum_{i=1}^{m}|r_i|$，即所有数据点残差距离之和</li></ul></li><li>$2-$范数<ul><li>残差平方和$\sum_{i=1}^{m}r_i^2$</li></ul></li></ul><p>由于前两种评价方式不好计算微分，因此，较为广泛的采用二范数。</p><p>由此，我们可以写出<strong>最小二乘法的定义</strong>了：</p><ul><li><p>对于给定的数据$(x_i, y_i), i = 1, 2, \dots, m$，在取定的假设空间H中，求解$h(x)\in H$，使得残差$r_i = h(x_i) - y_i$的二范数最小，即</p><p>  $h(x)\ s.t.\ \min\sum_{i=1}^m(h(x_i) - y_i)^2$.</p></li></ul><p>从几何上讲，就是寻找与给定点$(x_i, y_i), i = 1, 2, \dots, m$距离平方和最小的曲线$y = h(x)$。$h(x)$称为拟合函数或者最小二乘解，求解拟合函数$h(x)$的方法称为曲线拟合的最小二乘法。</p><p>这里的$h(x)$一般情况下是一种多项式曲线，即$h(x, w) = w_0 + w_1x + \dots + w_nx^n$，其中$w$是参数。也就是说，最小二乘就是要找到一组$w$，使得$\sum_{i=1}^m(h(x_i) - y_i)^2$最小。</p><p><strong>如何求解得到$w$呢？</strong></p><p>下面以线性最小二乘举例，更高的非线性函数原理相同，即$h(x, w) = w_0 + w_1x$。优化目标为</p><p>$w = (w_0, w_1),\ s.t.\ \min\sum_{i=1}^m(w_0 + w_1x - y_i)^2$。</p><ul><li>代数解法</li></ul><p>令$Q(w) = \sum_{i=1}^m(w_0 + w_1x - y_i)^2$为样本的平方损失函数，这是一个典型的求解极值的问题，只需要分别对$w_0$和$w_1$求偏导数，令偏导数为0即可求出极值点，即</p><p>$\left\{\begin{array}{rc1} \frac{\partial Q}{\partial w_0} = 2\sum_{i=1}^m(w_0 + w_1x_i - y_i) = 0 \\ \frac{\partial Q}{\partial w_1} = 2\sum_{i=1}^m(w_0 + w_1x_i - y_i) = 0 \end{array}\right.$.</p><p>接下来只需要求解这个方程组。</p><ul><li>矩阵解法</li></ul><p>这里用多元线性回归例子来描。假设函数$h_{w}(x_1, x_2, \dots, x_n) = w_0 + w_1x_1 + \dots + w_nx_n$的矩阵表示为</p><p>$h_w(x) = Xw$，其中，$X$为$m\times n$为矩阵，即m个样本数和n个特征。</p><p>损失函数定义为：</p><p>$J(w) = \frac{1}{2}(Xw - Y)^T(Xw - Y)$，其中Y是样本的真实值。根据最小二乘法的原理，我们要对这个损失函数对w求导取0，即</p><p>$\frac{\partial J}{\partial w} = X^T(Xw - Y) = 0$，得$w = (X^TX)^{-1}X^TY$。</p><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  <span class="comment"># 引入numpy</span></span><br><span class="line"><span class="keyword">import</span> scipy <span class="keyword">as</span> sp</span><br><span class="line"><span class="keyword">import</span> pylab <span class="keyword">as</span> pl</span><br><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> leastsq  <span class="comment"># 引入最小二乘函数</span></span><br><span class="line"> </span><br><span class="line">n = <span class="number">9</span>  <span class="comment"># 多项式次数</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 目标函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">real_func</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> np.sin(<span class="number">2</span> * np.pi * x)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 多项式函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fit_func</span><span class="params">(p, x)</span>:</span></span><br><span class="line">    f = np.poly1d(p)</span><br><span class="line">    <span class="keyword">return</span> f(x)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 残差函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">residuals_func</span><span class="params">(p, y, x)</span>:</span></span><br><span class="line">    ret = fit_func(p, x) - y</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>)  <span class="comment"># 随机选择9个点作为x</span></span><br><span class="line">x_points = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1000</span>)  <span class="comment"># 画图时需要的连续点</span></span><br><span class="line"> </span><br><span class="line">y0 = real_func(x)  <span class="comment"># 目标函数</span></span><br><span class="line">y1 = [np.random.normal(<span class="number">0</span>, <span class="number">0.1</span>) + y <span class="keyword">for</span> y <span class="keyword">in</span> y0]  <span class="comment"># 添加正太分布噪声后的函数</span></span><br><span class="line"> </span><br><span class="line">p_init = np.random.randn(n)  <span class="comment"># 随机初始化多项式参数</span></span><br><span class="line"> </span><br><span class="line">plsq = leastsq(residuals_func, p_init, args=(y1, x))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> <span class="string">'Fitting Parameters: '</span>, plsq[<span class="number">0</span>]  <span class="comment"># 输出拟合参数</span></span><br><span class="line"> </span><br><span class="line">pl.plot(x_points, real_func(x_points), label=<span class="string">'real'</span>)</span><br><span class="line">pl.plot(x_points, fit_func(plsq[<span class="number">0</span>], x_points), label=<span class="string">'fitted curve'</span>)</span><br><span class="line">pl.plot(x, y1, <span class="string">'bo'</span>, label=<span class="string">'with noise'</span>)</span><br><span class="line">pl.legend()</span><br><span class="line">pl.show()</span><br></pre></td></tr></table></figure><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ul><li><a href="https://blog.csdn.net/yhao2014/article/details/51491413" target="_blank" rel="noopener">最小二乘法及其python实现</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 最优化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 最优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构（四）-串</title>
      <link href="/2020/03/29/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E5%9B%9B%EF%BC%89-%E4%B8%B2/"/>
      <url>/2020/03/29/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E5%9B%9B%EF%BC%89-%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>串是由零个或多个字符组成的有限序列，一般记为</li></ul><p>$s = ‘a_0a_1\cdots a_n’, n \geq 0$.</p><p>其中，s是串的名，用单引号括起来的是字符串序列串的值；$a_i$可以使数字、字母或其他字符。n称为串的长度，长度为零的串称为空串。</p><ul><li>串中任意个连续的字符组成的子序列称为该串的子串</li><li>包含子串的串称为主串</li><li>字符在序列中的序号为该字符串在串中的位置</li><li>子串在主串中的位置则以子串的第一个字符在主串中的位置来表示</li><li>称两个串是相等的，当且仅当这两个串的值相等</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构（三）-栈和队列</title>
      <link href="/2020/03/24/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%89%EF%BC%89-%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/"/>
      <url>/2020/03/24/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%89%EF%BC%89-%E6%A0%88%E5%92%8C%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="1-栈"><a href="#1-栈" class="headerlink" title="1. 栈"></a>1. 栈</h1><ul><li>栈是限定仅在表尾进行插入或删除的线性表</li><li>表尾称为栈顶，表头称为栈底</li><li>后进先出</li><li>栈既然是一种线性结构，就能够以数组或链表（单向链表、双向链表或循环链表）作为底层数据结构</li><li>操作<ul><li>压栈：栈的插入操作，叫做进栈，也称压栈、入栈，通常命名为push</li><li>弹栈：栈的删除操作，也叫做出栈，通常命名为pop</li><li>求栈的大小</li><li>判断栈是否为空</li><li>获取栈顶元素的值</li></ul></li></ul><h1 id="2-栈的数组实现"><a href="#2-栈的数组实现" class="headerlink" title="2. 栈的数组实现"></a>2. 栈的数组实现</h1><ul><li>以数组为底层数据结构时，通常以数组头为栈底，数组头到数组尾为栈顶的生长方向</li><li>代码<ul><li>Stack.h</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ArrayStack(<span class="keyword">int</span> s = <span class="number">10</span>);    <span class="comment">//默认的栈容量为10</span></span><br><span class="line">    ~ArrayStack();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">T <span class="title">top</span><span class="params">()</span></span>;            <span class="comment">//获取栈顶元素</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span></span>;        <span class="comment">//压栈操作</span></span><br><span class="line">    <span class="function">T <span class="title">pop</span><span class="params">()</span></span>;            <span class="comment">//弹栈操作</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;        <span class="comment">//判空操作</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;            <span class="comment">//求栈的大小</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> count;            <span class="comment">//栈的元素数量</span></span><br><span class="line">    <span class="keyword">int</span> capacity;        <span class="comment">//栈的容量</span></span><br><span class="line">    T * <span class="built_in">array</span>;            <span class="comment">//底层为数组</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>Stack.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*栈的判空操作*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> ArrayStack&lt;T&gt;::isEmpty()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">return</span> count == <span class="number">0</span>; <span class="comment">//栈元素为0时为栈空</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*返回栈的大小*/</span></span><br><span class="line"> <span class="keyword">template</span> &lt;<span class="keyword">typename</span>  T&gt;</span><br><span class="line"><span class="keyword">int</span> ArrayStack&lt;T&gt;::size()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">return</span> count;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*插入元素*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> ArrayStack&lt;T&gt;::push(T t)</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span> (count != capacity)    <span class="comment">//先判断是否栈满</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="built_in">array</span>[count++] = t;   </span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*弹栈*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T ArrayStack&lt;T&gt;::pop()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span> (count != <span class="number">0</span>)    <span class="comment">//先判断是否是空栈</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">array</span>[--count];</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*获取栈顶元素*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T ArrayStack&lt;T&gt;::top()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span> (count != <span class="number">0</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="built_in">array</span>[count - <span class="number">1</span>];</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="3-栈的单链表实现"><a href="#3-栈的单链表实现" class="headerlink" title="3. 栈的单链表实现"></a>3. 栈的单链表实现</h1><ul><li>以链表为底层的数据结构时，以链表头为作为栈顶较为合适，这样方便节点的插入与删除</li><li>压栈产生的新节点将一直出现在链表的头部</li><li>代码实现<ul><li>Stack.h</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*链表节点结构*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Node(T t) :value(t), next(<span class="literal">nullptr</span>)&#123;&#125;;</span><br><span class="line">    Node() :next(<span class="literal">nullptr</span>)&#123;&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    T value;</span><br><span class="line">    Node&lt;T&gt;* next;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*栈的抽象数据结构*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkStack</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">     LinkStack();</span><br><span class="line">     ~LinkStack();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span></span>;</span><br><span class="line">     <span class="function">T <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line">     <span class="function">T <span class="title">top</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"> </span><br><span class="line">     Node&lt;T&gt;* phead;</span><br><span class="line">     <span class="keyword">int</span> count;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>Stack.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*返回栈的大小*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">int</span> LinkStack&lt;T&gt;::size()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">return</span> count;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*栈的判空操作*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> LinkStack&lt;T&gt;::isEmpty()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">return</span> count == <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*插入元素*/</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> LinkStack&lt;T&gt;::push(T t)</span><br><span class="line">&#123;</span><br><span class="line">     Node &lt;T&gt; *pnode = <span class="keyword">new</span>  Node&lt;T&gt;(t);</span><br><span class="line">     pnode-&gt;next = phead-&gt;next;</span><br><span class="line">     phead-&gt;next = pnode;</span><br><span class="line">     count++;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*弹栈*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T LinkStack&lt;T&gt;::pop()</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span> (phead-&gt;next != <span class="literal">nullptr</span>) <span class="comment">//栈空判断</span></span><br><span class="line">     &#123;</span><br><span class="line">         Node&lt;T&gt;* pdel = phead-&gt;next;</span><br><span class="line">         phead-&gt;next = phead-&gt;next-&gt;next;</span><br><span class="line">         T value = pdel-&gt;value;</span><br><span class="line">         <span class="keyword">delete</span> pdel;</span><br><span class="line">         count--;</span><br><span class="line">         <span class="keyword">return</span> value;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*获取栈顶元素*/</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T LinkStack&lt;T&gt;::top()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (phead-&gt;next!=<span class="literal">nullptr</span>)</span><br><span class="line">        <span class="keyword">return</span> phead-&gt;next-&gt;value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="4-栈的代码题"><a href="#4-栈的代码题" class="headerlink" title="4. 栈的代码题"></a>4. 栈的代码题</h1><h2 id="4-1-数制转换"><a href="#4-1-数制转换" class="headerlink" title="4.1 数制转换"></a>4.1 数制转换</h2><ul><li>10进制转换为其他进制的数采用取余法，即每次将整数部分除以8，余数为该位权上的数，而商继续除以8，余数又为上一个位权上的数，这个步骤一直持续下去，直到商为0为止，最后读数时候，从最后一个余数起，一直到最前面的一个余数</li><li>代码</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Conversion</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">stack</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        <span class="built_in">stack</span>.push(n % <span class="number">8</span>);</span><br><span class="line">        n = n / <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">stack</span>.empty()) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">stack</span>.top() &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        <span class="built_in">stack</span>.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-括号匹配的检验"><a href="#4-2-括号匹配的检验" class="headerlink" title="4.2 括号匹配的检验"></a>4.2 括号匹配的检验</h2><ul><li>代码</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetCharacter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> a[<span class="number">1024</span>];</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">char</span>&gt; character;</span><br><span class="line">    <span class="keyword">char</span> *s = a;</span><br><span class="line">    character.empty();</span><br><span class="line">    <span class="keyword">while</span> (*s != <span class="string">'\0'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*s == <span class="string">'['</span> || *s == <span class="string">'('</span>) &#123;</span><br><span class="line">            character.push(*s);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (*s == <span class="string">']'</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (character.top() == <span class="string">'['</span>) &#123;</span><br><span class="line">                    character.pop();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    character.push(*s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (*s == <span class="string">')'</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (character.top() == <span class="string">'('</span>) &#123;</span><br><span class="line">                    character.pop();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    character.push(*s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (character.empty()) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Character is valid\n"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Character is invalid\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-汉诺塔问题"><a href="#4-3-汉诺塔问题" class="headerlink" title="4.3 汉诺塔问题"></a>4.3 汉诺塔问题</h2><ul><li>非递归算法<ul><li>根据圆盘的数量确定柱子的排放顺序：<ul><li>若n为偶数，按顺时针方向依次摆放 A B C</li><li>若n为奇数，按顺时针方向依次摆放 A C B</li></ul></li><li>然后进行如下操作<ul><li>按顺时针方向把圆盘1从现在的柱子移动到下一根柱子，即当n为偶数时，若圆盘1在柱子A，则把它移动到B；若圆盘1在柱子B，则把它移动到C；若圆盘1在柱子C，则把它移动到A</li><li>接着，把另外两根柱子上可以移动的圆盘移动到新的柱子上。即把非空柱子上的圆盘移动到空柱子上，当两根柱子都非空时，移动较小的圆盘</li><li>反复进行（1）（2）操作，最后就能按规定完成汉诺塔的移动。</li></ul></li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hanoi</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Tower</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="keyword">char</span> Name;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; Disks;</span><br><span class="line">    &#125;Tow[<span class="number">3</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        n=num;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Tow[i].Name=<span class="string">'A'</span>+i;</span><br><span class="line">            <span class="keyword">while</span>(!Tow[i].Disks.empty()) Tow[i].Disks.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=n;i&gt;=<span class="number">1</span>;i--) Tow[<span class="number">0</span>].Disks.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        LL cnt=<span class="number">0</span>,cnt_max=(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(cnt&lt;cnt_max)</span><br><span class="line">        &#123;</span><br><span class="line">            cnt++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> flag1,flag2;</span><br><span class="line">            <span class="keyword">if</span>(cnt%<span class="number">2</span>)<span class="comment">//第奇数次的移动</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++) <span class="keyword">if</span>(!Tow[i].Disks.empty() &amp;&amp; Tow[i].Disks.top()==<span class="number">1</span>) flag1=i;</span><br><span class="line">                <span class="keyword">if</span>(n%<span class="number">2</span>)<span class="comment">//n为奇数</span></span><br><span class="line">                    flag2=((flag1<span class="number">-1</span>)+<span class="number">3</span>)%<span class="number">3</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    flag2=(flag1+<span class="number">1</span>)%<span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//第偶数次的移动</span></span><br><span class="line">            &#123;</span><br><span class="line">                flag1=flag2=<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!Tow[i].Disks.empty() &amp;&amp; Tow[i].Disks.top()==<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(flag1==<span class="number">-1</span>) flag1=i;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(flag2==<span class="number">-1</span>) flag2=i;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(!Tow[flag1].Disks.empty() &amp;&amp; !Tow[flag2].Disks.empty())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(Tow[flag1].Disks.top()&gt;Tow[flag2].Disks.top()) swap(flag1,flag2);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(Tow[flag1].Disks.empty()) swap(flag1,flag2);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;cnt&lt;&lt;<span class="string">": "</span>&lt;&lt;<span class="string">"Move disk "</span>&lt;&lt;Tow[flag1].Disks.top()&lt;&lt;<span class="string">" from "</span>&lt;&lt;Tow[flag1].Name&lt;&lt;<span class="string">" to "</span>&lt;&lt;Tow[flag2].Name&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            Tow[flag2].Disks.push(Tow[flag1].Disks.top());</span><br><span class="line">            Tow[flag1].Disks.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;hanoi;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入圆盘个数:"</span>; <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    hanoi.init(n);</span><br><span class="line">    hanoi.solve();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>递归算法<ul><li>设Hanoi(n,a,c,b)表示n个圆盘在a柱上，通过服从汉诺塔规则的若干步骤移动，在b柱的辅助下，全部按原顺序移动到了c柱上</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line">LL cnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Hanoi</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">char</span> a,<span class="keyword">char</span> c,<span class="keyword">char</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;++cnt&lt;&lt;<span class="string">": "</span>&lt;&lt;<span class="string">"Move disk "</span>&lt;&lt;n&lt;&lt;<span class="string">" from "</span>&lt;&lt;a&lt;&lt;<span class="string">" to "</span>&lt;&lt;c&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Hanoi(n<span class="number">-1</span>,a,b,c);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;++cnt&lt;&lt;<span class="string">": "</span>&lt;&lt;<span class="string">"Move disk "</span>&lt;&lt;n&lt;&lt;<span class="string">" from "</span>&lt;&lt;a&lt;&lt;<span class="string">" to "</span>&lt;&lt;c&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    Hanoi(n<span class="number">-1</span>,b,c,a);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入圆盘个数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    cnt=<span class="number">0</span>;</span><br><span class="line">    Hanoi(n,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'B'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-队列"><a href="#5-队列" class="headerlink" title="5. 队列"></a>5. 队列</h1><ul><li>先进先出</li><li>允许插入的一端叫队尾，允许删除的一端叫队头</li></ul><h1 id="6-队列题"><a href="#6-队列题" class="headerlink" title="6. 队列题"></a>6. 队列题</h1><h2 id="6-1-用两个栈实现队列"><a href="#6-1-用两个栈实现队列" class="headerlink" title="6.1 用两个栈实现队列"></a>6.1 用两个栈实现队列</h2><ul><li>用两个栈来实现一个队列，完成队列的 Push 和 Pop 操作</li><li><p>in 栈用来处理入栈（push）操作，out 栈用来处理出栈（pop）操作。一个元素进入 in 栈之后，出栈的顺序被反转。当元素要出栈时，需要先进入 out 栈，此时元素出栈顺序再一次被反转，因此出栈顺序就和最开始入栈顺序是相同的，先进入的元素先退出，这就是队列的顺序</p><ul><li>push 元素时，始终是进入栈，pop 和 peek 元素时始终是走出栈</li><li>pop 和 peek 操作，如果出栈为空，则需要从入栈将所有元素移到出栈，也就是调换顺序，比如开始push的顺序是 3-2-1，1 是最先进入的元素，则到出栈的顺序是 1-2-3，那 pop 操作拿到的就是 1，满足了先进先出的特点</li><li>pop 和 peek 操作，如果出栈不为空，则不需要从入栈中移到数据到出栈</li></ul></li><li><p>代码</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">StackAsQueue</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (data.size() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; inStack;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; outStack;</span><br><span class="line">    inStack.empty();</span><br><span class="line">    outStack.empty();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator iter = data.begin(); iter != data.end(); iter ++) &#123;</span><br><span class="line">        inStack.push((*iter));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (!inStack.empty()) &#123;</span><br><span class="line">        outStack.push(inStack.top());</span><br><span class="line">        inStack.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2020/03/12/computer_vision/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%EF%BC%88%E4%B8%89%EF%BC%89-%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
      <url>/2020/03/12/computer_vision/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%EF%BC%88%E4%B8%89%EF%BC%89-%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>title: 计算机视觉（三）-图像处理<br>date: 2020-03-12 22:34:33<br>categories:</p><ul><li>理论</li><li>计算机视觉<br>tags:</li><li>理论</li><li>计算机视觉<br>mathjax: true<br>copyright:</li></ul><h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>本系列主要记录入门计算机视觉领域的基础知识</li></ul><h1 id="2-点算子"><a href="#2-点算子" class="headerlink" title="2. 点算子"></a>2. 点算子</h1><ul><li>亮度、对比度的校正，彩色的校正和变换</li></ul><h2 id="2-1-像素变换"><a href="#2-1-像素变换" class="headerlink" title="2.1 像素变换"></a>2.1 像素变换</h2><ul><li>一个或多个输入图像到一个输出图像的函数，在连续域中将其表示为</li></ul><p>$g(x) = h(f(x))$或者$g(x) = h(f_0(x), \dots, f_n(x))$</p><ul><li>常用的两个点算子是乘以和加上一个常数</li></ul><p>$g(x) = af(x) + b$.</p><ul><li>线性混合算子<ul><li>可以使两幅图像或者视频间的时间上的淡入和淡出</li></ul></li></ul><p>$g(x) = (1 - \alpha)f_0(x) + \alpha f_1(x)$.</p><ul><li>伽马校正算子</li></ul><p>$g(x) = [f(x)]^{\frac{1}{\gamma}}$.</p><h2 id="2-1-直方图均衡化"><a href="#2-1-直方图均衡化" class="headerlink" title="2.1 直方图均衡化"></a>2.1 直方图均衡化</h2><ul><li>当图像直方图完全均匀分布的时候，此时图像的熵是最大的（随机变量每个值的概率都相同时，概率最大），图像对比度是最大的。所以，理想情况下，图像经过变换函数f(x)f(x)f(x)变换后，直方图能够均匀分布，此时对比度是最大的</li><li>提高图像对比度的变换函数f(x)f(x)f(x)需要满足以下条件<ul><li>f(x)在0 &lt;= x &lt;= L−1上单调递增(不要求严格单调递增),其中L表示灰度级（L=256）</li><li>f(x)的范围是[0,L−1]</li></ul></li><li>在图像处理中，有一个函数，能够满足上面的条件</li></ul><p>$y = f(x) = (L-1)\int_p^x p_x(t)dt$,</p><p>其中p(x)表示概率密度函数，在离散的图像中，表示直方图的每个灰度级的概率。f(x)其实就是连续型随机变量x的分布函数，表示的是函数下方的面积。</p><p>接下来证明经过该函数变换能够实现直方图均匀化。</p><p>由概率论知识，变换后的概率密度为</p><p>$p_y(y) = p_x(x)|(f^{-1}(y))’|$.</p><p>由变上限函数求导法则可知：</p><p>$f(x)’ = (L-1)p_x(x)$.</p><p>反函数的导数等于原函数导数的倒数：</p><p>$(f^{-1}(y))’ = \frac{1}{(L-1)p_x(x)}$.</p><p>所以，</p><p>$p_y(y) = \frac{1}{L-1}$.</p><p>变换后的概率密度函数是一个均匀分布，对于图像来说，就是每个灰度级概率都是相等的，达到了我们的目的。将这个变换函数转换为图像中的表达，图像中，我们可以知道，可以使用求和代替积分，差分代替微分，所以上述的变换函数为：</p><p>$y = f(x) = (L-1)\sum_{0}^{x_i}\frac{h(x_i)}{w\times h}$.</p><p>其中，$h(x_i)$表示直方图中每个灰度级像素的个数，$w$和$h$分别表示图像的宽和高。</p><ul><li><p>本质</p><ul><li>扩展了像素的动态范围</li></ul></li><li><p>算法</p><ul><li><p>输入：图像</p></li><li><p>输出：均衡化后图像</p></li><li><p>算法过程</p><ul><li><p>求出图像的恢复直方图，h（一个256维的向量）</p></li><li><p>求出图像的总体像素个数机器所占百分比</p><p>  $N_f = m\times n$,</p><p>  $hs(i) = h(i) / N_f, i = 0, 1, \dots, 255$.</p></li><li><p>计算图像各灰度级的累计分布hp</p><p>  $hp(i) = \sum_{k=0}^{i}h(k), i = 1, 2, \dots, 255$.</p></li><li><p>计算新图像的灰度值</p><p>  $g = 255 * hp(i), i = 1, 2, \dots, 255$.</p><p>  $g = 0, i = 0$.</p></li></ul></li></ul></li><li><p>代码实现</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">img = cv.imread(<span class="string">'source.jpg'</span>)</span><br><span class="line">im_gray = cv.cvtColor(img,cv.COLOR_RGB2GRAY)</span><br><span class="line">cv.imshow(<span class="string">'im_gray'</span>,im_gray)</span><br><span class="line"></span><br><span class="line">w, h = im_gray.shape[<span class="number">0</span>], im_gray.shape[<span class="number">1</span>] </span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line">p1 = plt.hist(im_gray.reshape(im_gray.size,<span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#创建直方图</span></span><br><span class="line">n = np.zeros((<span class="number">256</span>),dtype = np.float)</span><br><span class="line">p = np.zeros((<span class="number">256</span>),dtype = np.float)</span><br><span class="line">c = np.zeros((<span class="number">256</span>),dtype = np.float)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#遍历图像的每个像素,得到统计分布直方图</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>,im_gray.shape[<span class="number">0</span>]):</span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">0</span>,im_gray.shape[<span class="number">1</span>]):</span><br><span class="line">n[im_gray[x][y]] += <span class="number">1</span></span><br><span class="line">print(n)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#归一化</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line"> p[i] = n[i] / float(im_gray.size)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#计算累积直方图</span></span><br><span class="line">c[<span class="number">0</span>] = p[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">c[i] = c[i<span class="number">-1</span>] + p[i]</span><br><span class="line">print(c)</span><br><span class="line"> </span><br><span class="line">des = np.zeros((w, h), dtype=np.uint8)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, w):</span><br><span class="line"><span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">0</span>, h):</span><br><span class="line">des[x][y] = <span class="number">255</span> * c[im_gray[x][y]]</span><br><span class="line">print(des)</span><br><span class="line"></span><br><span class="line">cv.imshow(<span class="string">'des'</span>,des)</span><br><span class="line">plt.figure()</span><br><span class="line">p2 = plt.hist(des.reshape(des.size, <span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="2-2-连通量"><a href="#2-2-连通量" class="headerlink" title="2.2 连通量"></a>2.2 连通量</h2><ul><li>在图像中，最小的单位是像素，每个像素周围有8个邻接像素，常见的邻接关系有2种：4邻接与8邻接。4邻接一共4个点，即上下左右；8邻接的点一共有8个，包括了对角线位置的点</li><li>如果像素点A与B邻接，我们称A与B连通</li><li>如果A与B连通，B与C连通，则A与C连通</li><li>在视觉上看来，彼此连通的点形成了一个区域，而不连通的点形成了不同的区域。这样的一个所有的点彼此连通点构成的集合，我们称为一个连通区域</li><li>常见算法<ul><li>第一种算法是现在matlab中连通区域标记函数bwlabel中使的算法，它一次遍历图像，并记下每一行（或列）中连续的团（run）和标记的等价对，然后通过等价对对原来的图像进行重新标记，这个算法是目前我尝试的几个中效率最高的一个，但是算法里用到了稀疏矩阵与Dulmage-Mendelsohn分解算法用来消除等价对，这部分原理比较麻烦</li><li>第二种算法是现在开源库cvBlob中使用的标记算法，它通过定位连通区域的内外轮廓来标记整个图像，这个算法的核心是轮廓的搜索算法，这个我们将在文章中详细介绍。这个算法相比与第一种方法效率上要低一些，但是在连通区域个数在100以内时，两者几乎无差别，当连通区域个数到了103103数量级时，上面的算法会比该算法快10倍以上</li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/fffupeng/article/details/73463749" target="_blank" rel="noopener">直方图均衡化python代码实现</a></li><li><a href="https://blog.csdn.net/superjunenaruto/article/details/52431941" target="_blank" rel="noopener">直方图均衡化的数学原理</a></li><li><a href="https://blog.csdn.net/qianqing13579/article/details/52422364" target="_blank" rel="noopener">直方图均衡化算法原理与实现</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>数据结构（二）-线性表</title>
      <link href="/2020/03/06/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%BA%BF%E6%80%A7%E8%A1%A8/"/>
      <url>/2020/03/06/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%BA%BF%E6%80%A7%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>线性结构的特点<ul><li>存在惟一的一个被称作“第一个”的数据元素</li><li>存在惟一的一个被称作“最后一个”的数据元素</li><li>除第一个之外，集合中每个数据元素均只有一个前驱</li><li>除最后一个之外，集合中每个数据元素均只有一个后继</li></ul></li></ul><h1 id="2-线性表的类型定义"><a href="#2-线性表的类型定义" class="headerlink" title="2. 线性表的类型定义"></a>2. 线性表的类型定义</h1><ul><li>线性表<ul><li>是$n$个数据元素的有限序列</li></ul></li><li>复杂的线性表<ul><li>一个元素可以由若干个数据项(item)组成，数据元素称为记录(record)，含有大量记录的线性表又称文件(file)</li><li>同一线性表中的元素必定具有相同属性，即属同一数据对象</li></ul></li><li>数组<ul><li>线性表的顺序存储结构，即一段连续的内存空间存储的数据元素</li></ul></li><li>线性链表<ul><li>用一组任意的存储单元存储线性表的数据元素，由结点构成</li><li>一个结点不仅存储数据元素，也需要存储后继结点指针</li><li>只包含一个指针域的线性链表称为单链表</li><li>包含前后指针域的线性链表称为双向线性链表</li></ul></li><li>循环链表<ul><li>表中最后一个结点的指针域指向头结点，整个链表形成一个环</li></ul></li></ul><h1 id="3-单向链表实现"><a href="#3-单向链表实现" class="headerlink" title="3. 单向链表实现"></a>3. 单向链表实现</h1><ul><li>创建链表</li><li>插入数据</li><li>在指定数据点后插入数据</li><li>更新指定数据点的数据</li><li>删除指定数据的结点</li><li>链表反转</li><li>打印</li><li>清空链表</li></ul><p>代码：</p><ul><li>List.h</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATA_STRUCTURE_LIST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATA_STRUCTURE_LIST_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    List();</span><br><span class="line">    ~List();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">InsertPos</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> data, <span class="keyword">const</span> <span class="keyword">int</span> dataInsert)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> data, <span class="keyword">const</span> <span class="keyword">int</span> dataUpdate)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Erase</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Reverse</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Clear</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> data;</span><br><span class="line">        Node * next;</span><br><span class="line">        Node(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d):data(d),next(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Node *head;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node* <span class="title">Find</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> data)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//DATA_STRUCTURE_LIST_H</span></span></span><br></pre></td></tr></table></figure><ul><li>List.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"List.h"</span></span></span><br><span class="line"></span><br><span class="line">List::List() &#123;</span><br><span class="line">    head = <span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List::~List() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != head) &#123;</span><br><span class="line">        head = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> List::Insert(<span class="keyword">const</span> <span class="keyword">int</span> data) &#123;</span><br><span class="line">    Node * p = <span class="keyword">new</span> Node(data);</span><br><span class="line">    p-&gt;next = head-&gt;next;</span><br><span class="line">    head-&gt;next = p;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> List::InsertPos(<span class="keyword">const</span> <span class="keyword">int</span> data, <span class="keyword">const</span> <span class="keyword">int</span> dataInsert) &#123;</span><br><span class="line">    Node* p = Find(data);</span><br><span class="line">    Node* q = <span class="keyword">new</span> Node(dataInsert);</span><br><span class="line">    q-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = q;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Update(<span class="keyword">const</span> <span class="keyword">int</span> data, <span class="keyword">const</span> <span class="keyword">int</span> dataUpdate) &#123;</span><br><span class="line">    Node* p = Find(data);</span><br><span class="line">    p-&gt;next-&gt;data = dataUpdate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Erase(<span class="keyword">const</span> <span class="keyword">int</span> data) &#123;</span><br><span class="line">    Node *p = Find(data);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == p-&gt;next-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Node* q = p-&gt;next;</span><br><span class="line">        p-&gt;next = p-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">delete</span> q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Reverse() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node* p = head-&gt;next;</span><br><span class="line">    Node* q = head-&gt;next-&gt;next;</span><br><span class="line">    Node* m = head-&gt;next-&gt;next-&gt;next;</span><br><span class="line">    p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (m) &#123;</span><br><span class="line">        q-&gt;next = p;</span><br><span class="line">        p = q;</span><br><span class="line">        q = m;</span><br><span class="line">        m = m-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;next = p;</span><br><span class="line">    head-&gt;next = q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Clear() &#123;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    <span class="keyword">while</span> (p) &#123;</span><br><span class="line">        Node *q = p-&gt;next;</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">        p = q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Print() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"List is clear\n"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p = head-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (p) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p-&gt;data);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List::Node* List::Find(<span class="keyword">const</span> <span class="keyword">int</span> data) &#123;</span><br><span class="line">    <span class="keyword">for</span> (Node *p = head; p; p = p-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;next-&gt;data == data) &#123;</span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4-双向链表实现"><a href="#4-双向链表实现" class="headerlink" title="4. 双向链表实现"></a>4. 双向链表实现</h1><ul><li>创建链表</li><li>插入数据</li><li>在指定数据点后插入数据</li><li>更新指定数据点的数据</li><li>删除指定数据的结点</li><li>打印</li><li>清空链表</li></ul><p>代码：</p><ul><li>DoubleLinkedList.hpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DoubleLinkedList_hpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DoubleLinkedList_hpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoubleLinkedList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    DoubleLinkedList();</span><br><span class="line">    ~DoubleLinkedList();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateLinedList</span><span class="params">(<span class="keyword">int</span> n)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> data)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetLength</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> data;</span><br><span class="line">        Node *pNext, *pPre;</span><br><span class="line">        Node(<span class="keyword">const</span> <span class="keyword">int</span>&amp; data):data(data), pNext(<span class="literal">NULL</span>), pPre(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    Node* head;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* DoubleLinkedList_hpp */</span></span></span><br></pre></td></tr></table></figure><ul><li>DoubleLinkedList.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"DoubleLinkedList.hpp"</span></span></span><br><span class="line"></span><br><span class="line">DoubleLinkedList::DoubleLinkedList() &#123;</span><br><span class="line">    head = <span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DoubleLinkedList::~DoubleLinkedList() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != head) &#123;</span><br><span class="line">        <span class="keyword">delete</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> DoubleLinkedList::CreateLinedList(<span class="keyword">int</span> n) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p, *q;</span><br><span class="line">    p = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i ++) &#123;</span><br><span class="line">        q = <span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">        q-&gt;pPre = p;</span><br><span class="line">        p-&gt;pNext = q;</span><br><span class="line">        p = q;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> DoubleLinkedList::Insert(<span class="keyword">int</span> position, <span class="keyword">int</span> data) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &lt; <span class="number">0</span> || position &gt; GetLength() - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p, *q;</span><br><span class="line">    q = <span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">    q-&gt;data = data;</span><br><span class="line">    p = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (position -- &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        p = p-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != p-&gt;pNext) &#123;</span><br><span class="line">        p-&gt;pNext-&gt;pPre = q;</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;pNext = p-&gt;pNext;</span><br><span class="line">    q-&gt;pPre = p;</span><br><span class="line">    p-&gt;pNext = q;</span><br><span class="line">    p = q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> DoubleLinkedList::Remove(<span class="keyword">int</span> position) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &lt; <span class="number">0</span> || position &gt; GetLength() - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    Node *q;</span><br><span class="line">    <span class="keyword">while</span> (position -- &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        p = p-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    q = p-&gt;pNext;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> != q-&gt;pNext) &#123;</span><br><span class="line">        q-&gt;pNext-&gt;pPre = p;</span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;pNext = q-&gt;pNext;</span><br><span class="line">    <span class="keyword">delete</span> q;</span><br><span class="line">    q = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> DoubleLinkedList::GetLength() &#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    Node *p = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (p) &#123;</span><br><span class="line">        n ++;</span><br><span class="line">        p = p-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> DoubleLinkedList::Print() &#123;</span><br><span class="line">    Node *p = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (p) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, p-&gt;data);</span><br><span class="line">        p = p-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5-循环链表实现"><a href="#5-循环链表实现" class="headerlink" title="5. 循环链表实现"></a>5. 循环链表实现</h1><ul><li>创建链表</li><li>插入数据</li><li>在指定数据点后插入数据</li><li>更新指定数据点的数据</li><li>删除指定数据的结点</li><li>打印</li><li>清空链表</li></ul><p>代码：</p><ul><li>CircularList.h</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATA_STRUCTURE_CIRCULARLIST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATA_STRUCTURE_CIRCULARLIST_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    Node *pNext;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircularList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    CircularList();</span><br><span class="line">    ~CircularList();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateList</span><span class="params">(<span class="keyword">int</span> n)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">TraverseLinkList</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetLength</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InsertNode</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> d)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteNode</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteLinkList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Node *head;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//DATA_STRUCTURE_CIRCULARLIST_H</span></span></span><br></pre></td></tr></table></figure><ul><li>CircularList.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CircularList.h"</span></span></span><br><span class="line"></span><br><span class="line">CircularList::CircularList() &#123;</span><br><span class="line">    head = <span class="keyword">new</span> Node;</span><br><span class="line">    head-&gt;data = <span class="number">0</span>;</span><br><span class="line">    head-&gt;pNext = head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CircularList::~CircularList() &#123;</span><br><span class="line">    <span class="keyword">delete</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::CreateList(<span class="keyword">int</span> n) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *pnew, *ptemp = head;</span><br><span class="line">    <span class="keyword">int</span> i = n;</span><br><span class="line">    <span class="keyword">while</span> (n-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        pnew = <span class="keyword">new</span> Node;</span><br><span class="line">        pnew-&gt;data = n;</span><br><span class="line">        pnew-&gt;pNext = head;</span><br><span class="line">        ptemp-&gt;pNext = pnew;</span><br><span class="line">        ptemp = pnew;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::TraverseLinkList() &#123;</span><br><span class="line">    Node *ptemp = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (ptemp != head) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ptemp-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> CircularList::IsEmpty() &#123;</span><br><span class="line">    <span class="keyword">if</span> (head-&gt;pNext == head) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> CircularList::GetLength() &#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    Node *ptemp = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (ptemp != head) &#123;</span><br><span class="line">        n ++;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::InsertNode(<span class="keyword">int</span> position, <span class="keyword">int</span> d) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &lt; <span class="number">0</span> || position &gt; GetLength() + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *pnew, *ptemp = head;</span><br><span class="line">    pnew = <span class="keyword">new</span> Node;</span><br><span class="line">    pnew-&gt;data = d;</span><br><span class="line">    <span class="keyword">while</span> (position-- &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    pnew-&gt;pNext = ptemp-&gt;pNext;</span><br><span class="line">    ptemp-&gt;pNext = pnew;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::DeleteNode(<span class="keyword">int</span> position) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &lt; <span class="number">0</span> || position &gt; GetLength()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *ptemp = head, *pdelete;</span><br><span class="line">    <span class="keyword">while</span> (position-- &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    pdelete = ptemp-&gt;pNext;</span><br><span class="line">    ptemp-&gt;pNext = pdelete-&gt;pNext;</span><br><span class="line">    <span class="keyword">delete</span> pdelete;</span><br><span class="line">    pdelete = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::DeleteLinkList() &#123;</span><br><span class="line">    Node *pdelete = head-&gt;pNext, *ptemp;</span><br><span class="line">    <span class="keyword">while</span> (pdelete != head) &#123;</span><br><span class="line">        ptemp = pdelete-&gt;pNext;</span><br><span class="line">        head-&gt;pNext = ptemp;</span><br><span class="line">        <span class="keyword">delete</span> pdelete;</span><br><span class="line">        pdelete = ptemp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="6-编程题"><a href="#6-编程题" class="headerlink" title="6. 编程题"></a>6. 编程题</h1><h2 id="6-1-查找单链表中的倒数第k个结点"><a href="#6-1-查找单链表中的倒数第k个结点" class="headerlink" title="6.1 查找单链表中的倒数第k个结点"></a>6.1 查找单链表中的倒数第k个结点</h2><ul><li>这里需要声明两个指针：即两个结点型的变量first和second，首先让first和second都指向第一个结点，然后让second结点前移k-1个位置，此时first和second就间隔了k-1个位置，然后整体向前移动这两个节点，直到second节点走到最后一个结点的时候，此时first节点所指向的位置就是倒数第k个节点的位置</li><li>时间复杂度为O（n）</li></ul><p>代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">FindNode</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt; <span class="number">0</span> || k &gt; GetLength()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *q = head;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k - <span class="number">1</span>; i ++) &#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        q = q-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-2-查找单链表中的中间结点"><a href="#6-2-查找单链表中的中间结点" class="headerlink" title="6.2 查找单链表中的中间结点"></a>6.2 查找单链表中的中间结点</h2><ul><li>不允许你算出链表的长度</li><li>设置两个指针first和second，只不过这里是，两个指针同时向前走，second指针每次走两步，first指针每次走一步，直到second指针走到最后一个结点时，此时first指针所指的结点就是中间结点</li></ul><p>代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">FindNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head || <span class="literal">NULL</span> == head-&gt;next || <span class="literal">NULL</span> == head-&gt;next-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    Node *q = head;</span><br><span class="line">    <span class="keyword">while</span> (p-&gt;next != <span class="literal">NULL</span> &amp;&amp; p-&gt;next-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        p = p-&gt;next-&gt;next;</span><br><span class="line">        q = q-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-3-合并两个有序单向链表"><a href="#6-3-合并两个有序单向链表" class="headerlink" title="6.3 合并两个有序单向链表"></a>6.3 合并两个有序单向链表</h2><ul><li>已知两个链表 head1 和 head2 各自有序，请把它们合并成一个链表依然有序。结果链表要包含 head1 和head2 的所有节点，即使节点值相同</li><li><p>不能开辟新空间来存储合并后的链表。如果第一次做该题，很容易会想到使用新链表来存储合并后的有序链表。虽然可以如此实现，但是不符合常规解法和面试官的要求</p></li><li><p>非递归实现</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">MergeList</span><span class="params">(Node *head_1, Node *head_2)</span> </span>&#123;</span><br><span class="line">    Node *p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head_1) &#123;</span><br><span class="line">        <span class="keyword">return</span> head_2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head_2) &#123;</span><br><span class="line">        <span class="keyword">return</span> head_1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head_1-&gt;data &lt; head_2-&gt;data) &#123;</span><br><span class="line">        p = head_1;</span><br><span class="line">        head_1 = head_1-&gt;next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        p = head_2;</span><br><span class="line">        head_2 = head_2-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (head_1 &amp;&amp; head_2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (head_1-&gt;data &lt; head_2-&gt;data) &#123;</span><br><span class="line">            p-&gt;next = head_1;</span><br><span class="line">            head_1 = head_1-&gt;next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            p-&gt;next = head_2;</span><br><span class="line">            head_2 = head_2-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head_1) &#123;</span><br><span class="line">        p-&gt;next = head_1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head_2) &#123;</span><br><span class="line">        p-&gt;next = head_2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>递归实现</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">MergeList</span><span class="params">(Node *head_1, Node *head_2)</span> </span>&#123;</span><br><span class="line">    Node *p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head_1) &#123;</span><br><span class="line">        <span class="keyword">return</span> head_2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head_2) &#123;</span><br><span class="line">        <span class="keyword">return</span> head_1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head_1-&gt;data &lt; head_2-&gt;data) &#123;</span><br><span class="line">        p = head_1;</span><br><span class="line">        p-&gt;next = MergeList(head_1-&gt;next, head_2);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        p = head_2;</span><br><span class="line">        p-&gt;next = MergeList(head_1, head_2-&gt;next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-4-单链表的反转"><a href="#6-4-单链表的反转" class="headerlink" title="6.4 单链表的反转"></a>6.4 单链表的反转</h2><ul><li>不使用额外的空间</li><li>思路：从头到尾遍历原链表，每遍历一个结点，将其摘下放在新链表的最前端。<br>  注意链表为空和只有一个结点的情况。时间复杂度为O（n）</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">ReverseList</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head || <span class="literal">NULL</span> == head-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p = <span class="literal">NULL</span>;</span><br><span class="line">    Node *q = head;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">NULL</span> != q) &#123;</span><br><span class="line">        Node *m = q-&gt;next;</span><br><span class="line">        q-&gt;next = p;</span><br><span class="line">        p = q;</span><br><span class="line">        q = m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-5-从尾到头打印单链表"><a href="#6-5-从尾到头打印单链表" class="headerlink" title="6.5 从尾到头打印单链表"></a>6.5 从尾到头打印单链表</h2><ul><li>递归实现：用递归实现，但有个问题：当链表很长的时候，就会导致方法调用的层级很深，有可能造成栈溢出。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">ReversePrint</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ReversePrint(head-&gt;next);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, head-&gt;data);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-6-判断单链表是否有环"><a href="#6-6-判断单链表是否有环" class="headerlink" title="6.6 判断单链表是否有环"></a>6.6 判断单链表是否有环</h2><ul><li>这里也是用到两个指针，如果一个链表有环，那么用一个指针去遍历，是永远走不到头的。因此，我们用两个指针去遍历：first指针每次走一步，second指针每次走两步，如果first指针和second指针相遇，说明有环。<br>  时间复杂度为O (n)</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsCycle</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    Node *q = head;</span><br><span class="line">    <span class="keyword">while</span> (q != <span class="literal">NULL</span> &amp;&amp; q-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        q = q-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">if</span> (p == q) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-7-取出有环链表中环的长度"><a href="#6-7-取出有环链表中环的长度" class="headerlink" title="6.7 取出有环链表中环的长度"></a>6.7 取出有环链表中环的长度</h2><ul><li>思路：环的长度即为从开始到相遇处first走的步数</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetCycleLength</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head || <span class="literal">NULL</span> == head-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    Node *q = head;</span><br><span class="line">    <span class="keyword">while</span> (q != <span class="literal">NULL</span> &amp;&amp; q-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        q = q-&gt;next-&gt;next;</span><br><span class="line">        length ++;</span><br><span class="line">        <span class="keyword">if</span> (p == q) &#123;</span><br><span class="line">            <span class="keyword">return</span> length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-8-有环单链表中，取出环的起始点"><a href="#6-8-有环单链表中，取出环的起始点" class="headerlink" title="6.8 有环单链表中，取出环的起始点"></a>6.8 有环单链表中，取出环的起始点</h2><ul><li>思路：从相遇点开始，设置一个节点从头开始，然后最终相遇的节点就是环的起始点。由a=c可知。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">GetCycleLength</span><span class="params">(Node *head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == head || <span class="literal">NULL</span> == head-&gt;next) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *p = head;</span><br><span class="line">    Node *q = head;</span><br><span class="line">    <span class="keyword">while</span> (q != <span class="literal">NULL</span> &amp;&amp; q-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        q = q-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">if</span> (p == q) &#123;</span><br><span class="line">            Node* m = head;</span><br><span class="line">            <span class="keyword">while</span> (m != q) &#123;</span><br><span class="line">                m = m-&gt;next;</span><br><span class="line">                q = q-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> q;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（七）-微分方程</title>
      <link href="/2020/01/25/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%B8%83%EF%BC%89-%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/"/>
      <url>/2020/01/25/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%B8%83%EF%BC%89-%E5%BE%AE%E5%88%86%E6%96%B9%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="1-微分方程的基本概念"><a href="#1-微分方程的基本概念" class="headerlink" title="1. 微分方程的基本概念"></a>1. 微分方程的基本概念</h1><ul><li>凡表示未知函数、未知函数的导数与自变量之间的关系的方程，叫做微分方程</li><li>一般的，n阶微分方程的形式是$F(x, y, y’, \cdots, y^{(n)}) = 0$</li><li>找出这样的函数，把这函数代入微分方程能使该方程称为恒等式，这个函数叫做该微分方程的解</li><li>如果微分方程的解中含有任意常数，且任意常数的个数与微分方程的阶数相同，这样的解叫做微分方程的通解</li><li>设微分方程中的未知函数为$y = \phi(x)$，如果微分方程是一阶的，通常用来确定任意常数的条件是$x = x_0$时，$y = y_0$，或写成$y|_{x = x_0} = y_0$，其中$x_0$，$y_0$都是给定的值，上述这种条件叫做初始条件</li><li>确定了通解中的任意常数以后，就得到微分方程的特解</li><li>求微分方程$y’ = f(x, y )$满足初值条件$y|_{x = x_0} = y_0$的特解这样一个问题，叫做一阶微分方程的初值问题，记作$y’ = f(x, y)$，$y|_{x = x_0} = y_0$</li><li>微分方程的解的图形是一条曲线，叫做微分方程的积分曲线</li></ul><h1 id="2-可分离变量的微分方程"><a href="#2-可分离变量的微分方程" class="headerlink" title="2. 可分离变量的微分方程"></a>2. 可分离变量的微分方程</h1><ul><li>如果一个一阶微分方程能写成$g(y)dy = f(x)dx$的形式，就是说，能把微分方程写成一端只含y的函数和dy，另一端只含x的函数和dx，那么原方程就称为可分离变量的微分方程</li></ul><h1 id="3-齐次方程"><a href="#3-齐次方程" class="headerlink" title="3. 齐次方程"></a>3. 齐次方程</h1><ul><li>如果一阶微分方程可化成$\frac{dy}{dx} = \psi(\frac{y}{x})$的形式，那么就称这方程为齐次方程</li><li>方程$\frac{dy}{dx} + P(x) = Q(x)$叫做一阶线性微分方程，如果$Q(x) = 0$，那么方程称为齐次的；如果$Q(x) \neq 0$，那么方程称为非齐次的</li><li>为了求出非齐次线性方程的解，我们先把$Q(x)$换成零而写出方程$\frac{dy}{dx} + P(x)y = 0$，叫做对应于非齐次线性方程的齐次线性方程；分离变量后得$\frac{dy}{y} = -P(x)dx$，两端积分得$\ln|y| = -\int P(x)dx + C_1$或$y = Ce^{-\int P(x)dx}$（$C = \pm e^{C_1}$），这是对应的齐次线性方程的通解</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（六）-定积分的应用</title>
      <link href="/2020/01/25/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E5%85%AD%EF%BC%89-%E5%AE%9A%E7%A7%AF%E5%88%86%E7%9A%84%E5%BA%94%E7%94%A8/"/>
      <url>/2020/01/25/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E5%85%AD%EF%BC%89-%E5%AE%9A%E7%A7%AF%E5%88%86%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1-定积分的元素法"><a href="#1-定积分的元素法" class="headerlink" title="1. 定积分的元素法"></a>1. 定积分的元素法</h1><ul><li>旋转体就是由一个平面图形绕这平面内一条直线旋转一周而成的立体。这直线叫做旋转轴</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（五）-定积分</title>
      <link href="/2020/01/24/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%BA%94%EF%BC%89-%E5%AE%9A%E7%A7%AF%E5%88%86/"/>
      <url>/2020/01/24/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%BA%94%EF%BC%89-%E5%AE%9A%E7%A7%AF%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1-定积分的概念与性质"><a href="#1-定积分的概念与性质" class="headerlink" title="1. 定积分的概念与性质"></a>1. 定积分的概念与性质</h1><ul><li>设函数$f(x)$在$[a, b]$上有界，在$[a, b]$中任意插入若干个分点$a = x_0 &lt; x_1 &lt; \cdots &lt; x_n = b$，把区间$[a, b]$分成n个小区间$[x_0, x_1], [x_1, x_2], \cdots, [x_{n-1}, x_n]$，各个小区间的长度依次为$\Delta x_1 = x_1 - x_0, \cdots, \Delta x_n = x_n - x_{n-1}$，在每个小区间$[x_{i - 1}, x_i]$上任取一点$\psi_i$（$x_{i - 1} \leq \psi_i \leq x_i$），作函数值$f(\psi_i)$与小区间长度$\Delta x_i$的面积$f(\psi_i)\Delta x_i (i = 1, 2, \cdots, n)$，并作出和$S = \sum_{i = 1}^{n}f(\psi_i)\Delta x_i$。记$\lambda = \max\{\Delta x_1, \cdots, \Delta x_n\}$，如果当$\lambda\to 0$时，这和的极限总存在，且与闭区间$[a, b]$的分法及点$\psi_i$的取法无关，那么称这个极限I为函数$f(x)$在区间$[a, b]$上的定积分（简称积分），记作$\int_a^b f(x)dx$，即$\int_a^b f(x)dx = I = \lim_{\lambda\to 0}\sum_{i = 1}^n f(\psi_i)\Delta x_i$，其中$f(x)$叫做被积函数，$f(x)dx$叫做被积表达式，x叫做积分变量，a叫做积分下限，b叫做积分上限，$[a, b]$叫做积分区间</li><li>设$f(x)$在区间$[a, b]$上连续，则$f(x)$在$[a, b]$上可积</li><li>设$f(x)$在区间$[a, b]$上有界，且只有有限个间断点，则$f(x)$在$[a, b]$上可积</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（四）-不定积分</title>
      <link href="/2020/01/23/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E5%9B%9B%EF%BC%89-%E4%B8%8D%E5%AE%9A%E7%A7%AF%E5%88%86/"/>
      <url>/2020/01/23/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E5%9B%9B%EF%BC%89-%E4%B8%8D%E5%AE%9A%E7%A7%AF%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1-不定积分的概念与性质"><a href="#1-不定积分的概念与性质" class="headerlink" title="1. 不定积分的概念与性质"></a>1. 不定积分的概念与性质</h1><ul><li>在区间I上，函数$f(x)$的带有任意常数项的原函数称为$f(x)$（或$f(x)dx$）在区间I上的不定积分，记作$\int f(x)dx$，其中记号$\int$称为积分号，$f(x)$称为被积函数，$f(x)dx$称为被积表达式，x称为积分变量</li><li>基本积分表<ul><li>$\int kdx = kx + C$</li><li>$\int x^{\mu}dx = \frac{x^{\mu + 1}}{\mu + 1} + C$</li><li>$\int\frac{dx}{x} = \ln|x| + C$</li><li>$\int\frac{dx}{1 + x^2} = \arctan x + C$</li><li>$\int\frac{dx}{\sqrt{1 - x^2}} = \arcsin x + C$</li><li>$\int \cos x dx = \sin x + C$</li><li>$\int \sin x dx = -\cos x + C$</li><li>$\int\frac{dx}{\cos^2 x} = \int \sec^2 x dx = \tan x + C$</li><li>$\int \frac{dx}{\sin^2 x} = \int\csc^2 x dx = -\cot x + C$</li><li>$\int \sec x\tan x dx = \sec x + C$</li><li>$\int \csc x \cot x dx = -\csc x + C$</li><li>$\int e^x dx = e^x + C$</li><li>$\int a^x dx = \frac{a^x}{\ln a} + C$</li><li>$\int sh xdx = ch x + C$</li><li>$\int ch x dx = sh x + C$</li><li>$\int \tan x dx = -\ln|\cos x| + C$</li><li>$\int \cot x dx = \ln|\sin x| + C$</li><li>$\int \sec x dx = \ln|\sec x + \tan x| + C$</li><li>$\int \csc x dx = \ln|\csc x - \cot x| + C$</li><li>$\int \frac{dx}{a^2 + x^2} = \frac{1}{a}\arctan\frac{x}{a} + C$</li><li>$\int \frac{dx}{x^2 - a^2} = \frac{1}{2a}\ln|\frac{x - a}{x + a}| + C$</li><li>$\int \frac{dx}{\sqrt{a^2 - x^2}} = \arcsin\frac{x}{a} + C$</li><li>$\int \frac{dx}{x^2 + a^2} = \ln(x + \sqrt{x^2 + a^2}) + C$</li><li>$\int \frac{dx}{\sqrt{x^2 - a^2}} = \ln|x + \sqrt{x^2 - a^2}| + C$</li></ul></li><li>第一类换元法<ul><li>设$f(u)$具有原函数，$u = \phi(x)$可导，则有换元公式$\int f[\phi(x)]\phi’(x)dx = [\int f(u)du_{u = \phi(x)}]$</li></ul></li><li>第二类换元法<ul><li>设$x = \psi(t)$是单调的可导函数，并且$\psi’(t) \neq 0$，又设$f[\psi(t)]\psi’(t)$具有原函数，则有换元公式$\int f(x)dx = [\int f[\psi(t)]\psi’(t)dt]_{t = \psi^{-1}(x)}$，其中$\psi^{-1}(x)$是$x = \psi(t)$的反函数</li></ul></li><li>分部积分法<ul><li>设函数$u = u(x)$及$v = v(x)$具有连续导数，则两个函数乘积的导数公式为$(uv)’ = u’v + uv’$，移项，得$uv’ = (uv)’ - u’v$。对这个等式两边求不定积分，得，$\int uv’dx = uv - \int u’v dx$</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（三）-微分中值定理与导数的应用</title>
      <link href="/2020/01/23/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%B8%89%EF%BC%89-%E5%BE%AE%E5%88%86%E4%B8%AD%E5%80%BC%E5%AE%9A%E7%90%86%E4%B8%8E%E5%AF%BC%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8/"/>
      <url>/2020/01/23/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%B8%89%EF%BC%89-%E5%BE%AE%E5%88%86%E4%B8%AD%E5%80%BC%E5%AE%9A%E7%90%86%E4%B8%8E%E5%AF%BC%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1-微分中值定理"><a href="#1-微分中值定理" class="headerlink" title="1. 微分中值定理"></a>1. 微分中值定理</h1><ul><li>费马引理<ul><li>设函数$f(x)$在点$x_0$的某邻域$U(x_0)$内有定义，并且在$x_0$处可导，如果对任意的$x\in U(x_0)$，有$f(x) \leq f(x_0)$（或$f(x)\geq f(x_0)$），那么$f’(x_0) = 0$</li></ul></li><li><p>罗尔定理</p><ul><li>如果函数$f(x)$满足<ul><li>在闭区间$[a, b]$上连续</li><li>在开区间$(a, b)$内可导</li><li>在区间端点处的函数值相等，即$f(a) = f(b)$</li><li>那么在$(a, b)$内至少有一点$\psi$（$a &lt; \psi &lt; b$），使得$f’(\psi) = 0$</li></ul></li></ul></li><li><p>拉格朗日中值定理</p><ul><li>如果函数$f(x)$满足<ul><li>在闭区间$[a, b]$上连续</li><li>在开区间$(a, b)$内可导</li><li>那么在$(a, b)$内至少有一点$\psi$（$a &lt; \psi &lt; b$），使等式$f(b) - f(a) = f’(\psi)(b - a)$成立</li></ul></li></ul></li><li>如果函数$f(x)$在区间I上连续，I内可导且导数恒为零，那么$f(x)$在区间I上是一个常数</li><li>如果当$x\to a$（或$x \to \infty$）时，两个函数$f(x)$与$F(x)$都趋于零或都趋于无穷大，那么极限$\lim_{x\to a或x\to \infty}\frac{f(x)}{F(x)}$可能存在、也可能不存在，通常把这种极限叫做未定式</li><li>洛必达法则<ul><li>设当$x\to a$时，函数$f(x)$及$F(x)$都趋于零</li><li>在点a的某去心领域内，$f’(x)$及$F’(x)$都存在且$F’(x) \neq 0$</li><li>$\lim_{x\to a}\frac{f’(x)}{F’(x)}$存在（或为无穷大）</li><li>则$\lim_{x\to a}\frac{f(x)}{F(x)} = \lim_{x\to a}\frac{f’(x)}{F’(x)}$</li></ul></li></ul><h1 id="2-泰勒公式"><a href="#2-泰勒公式" class="headerlink" title="2. 泰勒公式"></a>2. 泰勒公式</h1><ul><li>泰勒中值定理<ul><li>如果函数$f(x)$在$x_0$处具有n阶导数，那么存在$x_0$的一个邻域，对于该邻域内的任一x，有$f(x) = f(x_0) + f’(x_0)(x - x_0) + \frac{f^n(x_0)}{2!}(x - x_0)^2 + \cdots + \frac{f^{(n)}(x_0)}{n!}(x - x_0)^n + R_n(x)$，其中，$R_n(x) = o((x - x_0)^n)$</li></ul></li><li>设函数$y = f(x)$在$[a, b]$上连续，在$(a, b)$内可导<ul><li>如果在$(a, b)$内$f’(x) \geq 0$，且等号仅在有限多个点处成立，那么函数$y = f(x)$在$[a, b]$上单调增加</li><li>如果在$(a, b)$内$f’(x) \leq 0$，且等号仅在有限多个点处成立，那么函数$y = f(x)$在$[a, b]$上单调减少</li></ul></li><li>设$f(x)$在区间I上连续，如果对I上任意两点$x_1$，$x_2$恒有$f(\frac{x_1 + x_2}{2}) &lt; \frac{f(x_1) + f(x_2)}{2}$，那么称$f(x)$在I上的图形是（向上）凹的（或凹弧）；如果恒有$f(\frac{x_1 + x_2}{2}) &gt; \frac{f(x_1) + f(x_2)}{2}$，那么称$f(x)$在I上的图形是（向上）凸的（或凸弧）</li><li>设$f(x)$在$[a, b]$上连续，在$(a, b)$内具有一阶和二阶导数，那么<ul><li>若在$(a, b)$内$f^n(x) &gt; 0$，则$f(x)$在$[a, b]$上的图形是凹的</li><li>若在$(a, b)$内$f^n(x) &lt; 0$，则$f(x)$在$[a, b]$上的图形是凸的</li></ul></li></ul><h1 id="3-函数的极值与最大值最小值"><a href="#3-函数的极值与最大值最小值" class="headerlink" title="3. 函数的极值与最大值最小值"></a>3. 函数的极值与最大值最小值</h1><ul><li>设函数$f(x)$在点$x_0$的某邻域$U(x_0)$内有定义，如果对于去心邻域$\circ{U}(x_0)$内的任一x，有$f(x) &lt; f(x_0)$（或$f(x) &gt; f(x_0)$），那么就称$f(x_0)$是函数$f(x)$的一个极大值（或极小值）</li><li>设函数$f(x)$在$x_0$处可导，且在$x_0$处取得极值，则$f’(x_0) = 0$</li><li>设函数$f(x)$在$x_0$处连续，且在$x_0$的某去心邻域$\circ{U}(x_0, \delta)$内可导<ul><li>若$x \in (x_0 - \delta, x_0)$时，$f’(x) &gt; 0$，而$x \in (x_0, x_0 + \delta)$时，$f’(x) &lt; 0$，则$f(x)$在$x_0$处取得极大值</li><li>若$x \in (x_0 - \delta, x_0)$时，$f’(x) &lt; 0$，而$x \in (x_0, x_0 + \delta)$时，$f’(x) &gt; 0$，则$f(x)$在$x_0$处取得极小值</li><li>若$x \in \circ{U}(x_0, \delta)$时，$f’(x)$的符号保持不变，则$f(x)$在$x_0$处没有极值</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（二）-导数与微分</title>
      <link href="/2020/01/22/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%AF%BC%E6%95%B0%E4%B8%8E%E5%BE%AE%E5%88%86/"/>
      <url>/2020/01/22/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%AF%BC%E6%95%B0%E4%B8%8E%E5%BE%AE%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1-导数概念"><a href="#1-导数概念" class="headerlink" title="1. 导数概念"></a>1. 导数概念</h1><ul><li>设函数$y = f(x)$在点$x_0$的某个邻域内有定义，当自变量x在$x_0$处取得增量$\Delta x$（点$x + \Delta x$仍在该邻域内）时，相应地，因变量取得增量$\Delta y = f(x_0 + \Delta x) - f(x_0)$；如果$\Delta y$与$\Delta x$之比当$\Delta x \to 0$时的极限存在，那么称函数$y = f(x)$在点$x_0$处可导，并称这个极限为函数$y = f(x)$在点$x_0$处的导数，记为$f’(x_0)$，即$f’(x_0) = \lim_{\Delta x\to 0}\frac{\Delta y}{\Delta x} = \lim_{\Delta x \to 0}\frac{f(x_0 + \Delta x) - f(x_0)}{\Delta x}$，也可记作$y’|_{x=x_0}$，$\frac{dy}{dx}|_{x = x_0}$或$\frac{df(x)}{dx}|_{x = x_0}$</li><li>如果函数$f(x)$在开区间I内的每点处都可导，那么就称函数$f(x)$在开区间I内可导。这时，对于任一$x\in I$，都对应着$f(x)$的一个确定的导数值，这样就构成了一个新函数，这个函数叫做原来函数$y = f(x)$的导函数，记作$y’$，$f’(x)$，$\frac{dy}{dx}$或$\frac{df(x)}{dx}$</li><li>函数的和、差、积、商的求导法则<ul><li>如果函数$u = u(x)$及$v = v(x)$都在点x具有导数，那么它们的和、差、积、商（除分母为零的点外）都在点x具有导数，且<ul><li>$[u(x) \pm v(x)]’ = u’(x) \pm v’(x)$</li><li>$[u(x)v(x)]’ = u’(x)v(x) + u(x)v’(x)$</li><li>$[\frac{u(x)}{v(x)}]’ = \frac{u’(x)v(x) - u(x)v’(x)}{v^2(x)}$（$v(x) \neq 0$）</li></ul></li></ul></li><li>反函数的求导法则<ul><li>如果函数$x = f(x)$在区间$I_y$内单调、可导且$f’(x)\neq 0$，那么它的反函数$y = f^{-1}(x)$在区间$I_x = \{x|x = f(x), y\in I_y\}$内也可导，且$[f^{-1}(x)]’ = \frac{1}{f’(x)}$或$\frac{dy}{dx} = \frac{1}{\frac{dx}{dy}}$</li></ul></li><li>复合函数的求导法则<ul><li>如果$u = g(x)$在点x可导，而$y = f(u)$在点$u = g(x)$可导，那么复合函数$y = f[g(x)]$在点x可导，且其导数为$\frac{dy}{dx} = f’(u)\cdot g’(x)$或$\frac{dy}{dx} = \frac{dy}{du}\cdot\frac{du}{dx}$</li></ul></li><li>基本求导法则和导数公式<ul><li>$(C)’ = 0$</li><li>$(\sin x)’ = \cos x$</li><li>$(x^\mu)’ = \mu x^{\mu - 1}$</li><li>$(\cos x)’ = -\sin x$</li><li>$(\tan x)’ = \sec^2 x$</li><li>$(\cot x)’ = -\csc^2 x$</li><li>$(\sec x)’ = \sec x\tan x$</li><li>$(csc x)’ = -\csc x \cot x$</li><li>$(a^x)’ = a^x\ln a (a &gt; 0, a\neq 1)$</li><li>$(e^x)’ = e^x$</li><li>$(\log_a x)’ = \frac{1}{x\ln a} (a &gt; 0, a \neq 1)$</li><li>$(\ln x)’ = \frac{1}{x}$</li><li>$(\arcsin x)’ = \frac{1}{\sqrt{1 - x^2}}$</li><li>$(\arccos x)’ = -\frac{1}{\sqrt{1 - x^2}}$</li><li>$(\arctan x)’ = \frac{1}{1 + x^2}$</li><li>$(\arccot x)’ = -\frac{1}{1 + x^2}$</li></ul></li></ul><h1 id="2-函数的微分"><a href="#2-函数的微分" class="headerlink" title="2. 函数的微分"></a>2. 函数的微分</h1><ul><li>设函数$y = f(x)$在某区间内有定义，$x_0$及$x_0 + \Delta x$在这区间内，如果函数的增量$\Delta y = f(x_0 + \Delta x) - f(x_0)$，可表示为$\Delta y = A\Delta x + o(\Delta x)$，其中A是不依赖于$\Delta x$的常数，那么称函数$y = f(x)$在点$x_0$是可微的，而$A\Delta x$叫做函数$y = f(x)$在点$x_0$相应于自变量增量$\Delta x$的微分，记作$dy$，即$dy = A\Delta x$</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>高等数学（一）-函数与极限</title>
      <link href="/2020/01/18/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%B8%80%EF%BC%89-%E5%87%BD%E6%95%B0%E4%B8%8E%E6%9E%81%E9%99%90/"/>
      <url>/2020/01/18/math/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%88%E4%B8%80%EF%BC%89-%E5%87%BD%E6%95%B0%E4%B8%8E%E6%9E%81%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h1 id="1-映射与函数"><a href="#1-映射与函数" class="headerlink" title="1. 映射与函数"></a>1. 映射与函数</h1><ul><li>函数的几种特性<ul><li>函数的有界性</li><li>函数的单调性</li><li>函数的奇偶性</li><li>函数的周期性</li></ul></li><li>初等函数<ul><li>幂函数</li><li>指数函数</li><li>对数函数</li><li>三角函数</li><li>反三角函数</li><li>由常数和 基本初等函数经过有限次的四则运算和有限次的函数复合步骤所构成并用一个式子表示的函数，称为初等函数，如$y = \sqrt{1 - x^2}$</li><li>双曲正弦$sh x = \frac{e^x - e^{-x}}{2}$</li><li>双曲余弦$ch x = \frac{e^x + e^{-x}}{2}$</li><li>双曲正切$th x = \frac{sh x}{ch x} = \frac{e^x - e^{-x}}{e^x + e^{-x}}$</li></ul></li></ul><h1 id="2-数列的极限"><a href="#2-数列的极限" class="headerlink" title="2. 数列的极限"></a>2. 数列的极限</h1><ul><li>对于定义的记忆，只需要记住公式$|x_n - a| &lt; \epsilon$即可，那么根据公式即可整理出定义</li><li>极限的唯一性<ul><li>如果数列$\{x_n\}$收敛，那么它的极限唯一</li></ul></li><li>对于数列$\{x_n\}$，如果存在正整数M，使得对于一切$x_n$都满足不等式$|x_n| \leq M$，那么称数列$\{x_n\}$是有界的；如果这样的正数M不存在，就说数列$\{x_n\}$是无界的</li><li>收敛数列的有界性<ul><li>如果数列$\{x_n\}$收敛，那么数列$\{x_n\}$一定有界</li><li>但是，有界不一定收敛，例如$1, -1, 1, \dots, (-1)^{n+1}, \dots$</li></ul></li><li>收敛数列的保号性<ul><li>如果$\lim_{n\rightarrow \infty} x_n = a$，且$a &gt; 0$（或$a &lt; 0$），那么存在正整数N，当$n &gt; N$时，都有$x_n &gt; 0$（或$x_n &lt; 0$）</li><li>如果数列$\{x_n\}$从某项起有$x_n \geq 0$（或$x_n \leq 0$），且$\lim_{n\to \infty} x_n = a$，那么$a \geq 0$（或$a\leq 0$）</li></ul></li></ul><h1 id="3-无穷小与无穷大"><a href="#3-无穷小与无穷大" class="headerlink" title="3. 无穷小与无穷大"></a>3. 无穷小与无穷大</h1><ul><li>无穷小<ul><li>如果函数$f(x)$当$x\to x_0$（或$x\to \infty$）时的极限为零，那么称函数$f(x)$为当$x\to x_0$（或$x\to \infty$）时的无穷小</li></ul></li><li>无穷大<ul><li>设函数$f(x)$在$x_0$的某一去心邻域内有定义（或$|x|$大于某一正数时有定义）。如果对于任意给定的正数M（不论它多么大），总存在正数$\delta$（或正数X），只要x适合不等式$0 &lt; |x - x_0| &lt; \delta$（或$|x| &gt; X$），对应的函数值$f(x)$总满足不等式$|f(x)| &gt; M$，那么称函数$f(x)$是当$x\to x_0$（或$x\to \infty$）时的无穷大</li></ul></li><li>极限运算法则<ul><li>两个无穷小的和是无穷小；有限个无穷小的和也是无穷小</li><li>有界函数与无穷小的乘积是无穷小<ul><li>常数与无穷小的乘积是无穷小</li><li>有限个无穷小的乘积是无穷小</li></ul></li><li>如果$\lim f(x) = A$，$\lim g(x) + B$，那么<ul><li>$\lim[f(x)\pm g(x)] = A\pm B$</li><li>$\lim [f(x)\cdot g(x)] = A\cdot B$</li><li>若又有$B\neq 0$，则<ul><li>$\lim \frac{f(x)}{g(x)} = \frac{\lim f(x)}{\lim g(x)} = \frac{A}{B}$</li></ul></li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（七）-对称矩阵和二次型</title>
      <link href="/2020/01/18/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%83%EF%BC%89-%E5%AF%B9%E7%A7%B0%E7%9F%A9%E9%98%B5%E5%92%8C%E4%BA%8C%E6%AC%A1%E5%9E%8B/"/>
      <url>/2020/01/18/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%83%EF%BC%89-%E5%AF%B9%E7%A7%B0%E7%9F%A9%E9%98%B5%E5%92%8C%E4%BA%8C%E6%AC%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="1-对称矩阵的对角化"><a href="#1-对称矩阵的对角化" class="headerlink" title="1. 对称矩阵的对角化"></a>1. 对称矩阵的对角化</h1><ul><li>一个对角矩阵是一个满足$A^T = A$的矩阵A，这种矩阵当然是方阵，它的主对角元素是任意的，但其他元素在主对角线的两边成对出现</li><li>一个nxn矩阵A可正交对角化的充分必要条件是A是对称矩阵</li><li>$R^n$上的一个二次型是一个定义在$R^n$上的函数，它在向量x处的值可由表达式$Q(x) = x^TAx$计算，此处A是一个nxn对称矩阵，且矩阵A称为关于二次型的矩阵</li><li>主轴定理<ul><li>设A是一个nxn对称矩阵，那么存在一个正交变量变换$x = Py$，它将二次型$x^TAx$变换为不含交叉项的二次型$y^TDy$</li></ul></li><li>一个二次型Q是<ul><li>正定的，如果对于所有$x\neq 0$，有$Q(x) &gt; 0$</li><li>负定的，如果对所有$x\neq 0$，有$Q(x) &lt; 0$</li><li>不定的，如果$Q(x)$既有正值又有负值</li><li>半正定的，如果对所有x，有$Q(x) \geq 0$</li><li>半负定的，如果对于所有x，有$Q(x) \leq 0$</li></ul></li><li>二次型与特征值<ul><li>设A是nxn对称矩阵，那么一个二次型是<ul><li>正定的，当且仅当A的所有特征值是正数</li><li>负定的，当且仅当A的所有特征值是负数</li><li>不定的，当且仅当A既有正特征值，又有负特征值</li></ul></li></ul></li></ul><h1 id="2-奇异值分解"><a href="#2-奇异值分解" class="headerlink" title="2. 奇异值分解"></a>2. 奇异值分解</h1><ul><li>详见：<a href="https://vslam.net/2019/10/17/线性代数及其应用（二）-矩阵代数/" target="_blank" rel="noopener">线性代数及其应用（二）-矩阵代数</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（六）-正交性和最小二乘法</title>
      <link href="/2020/01/01/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E5%85%AD%EF%BC%89-%E6%AD%A3%E4%BA%A4%E6%80%A7%E5%92%8C%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95/"/>
      <url>/2020/01/01/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E5%85%AD%EF%BC%89-%E6%AD%A3%E4%BA%A4%E6%80%A7%E5%92%8C%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-內积、长度和正交性"><a href="#1-內积、长度和正交性" class="headerlink" title="1. 內积、长度和正交性"></a>1. 內积、长度和正交性</h1><ul><li>如果$\vec{u}$和$\vec{v}$是$R^n$空间中的向量，可以将$\vec{u}$和$\vec{v}$作为$n\times 1$矩阵。向量矩阵$\vec{u}^T$是1xn矩阵且矩阵成绩$\vec{u}^T\vec{v}$是一个1x1矩阵，我们将其记为一个不加括号的实数。如$\vec{u}^T\vec{v}$称为$\vec{u}$和$\vec{v}$的內积，并记做$\vec{u}\cdot\vec{v}$。</li><li>如果$\vec{u} = \left[<br>   \begin{matrix}<pre><code> u_0 \\ u_1 \\\cdots \\ u_n \end{matrix}\right]$和$\vec{v} = \left[</code></pre>   \begin{matrix}<pre><code> v_0 \\ v_1 \\\cdots \\ v_n \end{matrix}\right]$，那么$\vec{u}$和$\vec{v}$的內积定义为$\left[</code></pre>   \begin{matrix}<pre><code> u_0 &amp; u_1 &amp; \cdots &amp; u_n \end{matrix}\right]\left[</code></pre>   \begin{matrix}<pre><code> v_0 \\ v_1 \\\cdots \\ v_n \end{matrix}\right] = u_0v_0 + u_1v_1 + \cdots + u_nv_n$</code></pre></li><li>向量$\vec{v}$的长度（范数）是非负数$||\vec{v}||$定义为$||\vec{v}|| = \sqrt{\vec{v}\cdot \vec{v}} = \sqrt{v_1^2 + \cdots + v_n^2}$且$||\vec{v}||^2 = \vec{v}\cdot \vec{v}$</li><li>$R^n$中向量$\vec{u}$和$\vec{v}$的距离，记作$dist(\vec{u}, \vec{v})$，表示向量$\vec{u} - \vec{v}$的长度，即$dist(\vec{u}, \vec{v}) = ||\vec{u} - \vec{v}||$</li><li>如果$\vec{u}\cdot\vec{v} = 0$，则两个向量$\vec{u}$和$\vec{v}$称为（相互）正交的</li><li>毕达哥拉斯（勾股）定理<ul><li>两个向量$\vec{u}$和$\vec{v}$正交的充分必要条件是$||\vec{u} + \vec{v}||^2 = ||\vec{u}||^2 + ||\vec{v}||^2$</li></ul></li><li>如果向量$\vec{z}$与$R^n$的子空间W中的任意向量都正交，则称$\vec{z}$正交于W，与子空间W正交的向量$\vec{z}$的全体组成的集合称为W的正交补，并记作$W^\perp$（读作W正交补）</li></ul><h1 id="2-正交集"><a href="#2-正交集" class="headerlink" title="2. 正交集"></a>2. 正交集</h1><ul><li><p>$R^n$中的向量集合$\{\bf{u}_1, \cdots, \bf{u}_p\}$称为正交向量集，如果集合中的任意两个不同向量都正交，即当$i\neq j$时，$\bf{u}_i\cdot \bf{u}_j = 0$</p></li><li><p>如果$S = \{\bf{u}_1, \cdots, \bf{u}_p\}$是由$R^n$空间中非零向量构成的正交集，那么S是线性无关集，因此构成所生成的子空间S的一组基</p></li><li><p>假设$\{\bf{u}_1, \cdots, \bf{u}_p\}$是$R^n$中子空间W的正交基，对W中的每个向量$\bf{y}$，线性组合$\bf{y} = c_1\bf{u}_1 +\cdots + c_p\bf{u}_p$中的权值可以由$c_j = \frac{\bf{y}\cdot \bf{u}_j}{\bf{u}_j\cdot\bf{u}_j} (j = 1, \dots, p)$计算</p></li><li><p>正交分解定理</p><ul><li>若W是$R^n$的一个子空间，那么$R^n$中每一个向量$\bf{y}$可以惟一表示，$\bf{y} = \hat{\bf{y}} + \bf{z}$，此处$\hat{\bf{y}}$属于W且$\bf{z}$属于$W^{\perp}$，实际上，如果$\{\bf{u}_1, \cdots, \bf{u}_p\}$是W的任意正交基，那么$\hat{\bf{y}} = \frac{\bf{y}\cdot\bf{u}_1}{\bf{u}_1\cdot\bf{u}_1}\bf{u}_1 + \cdots + \frac{\bf{y}\cdot\bf{u}_p}{\bf{u}_p\cdot\bf{u}_p}\bf{u}_p$且$\bf{z} = \bf{y} - \hat{\bf{y}}$，其中$\hat{\bf{y}}$称为$\bf{y}$在W上的正交投影，常记作$proj_W\bf{y}$</li></ul></li><li><p>最佳逼近定理</p><ul><li>假设W是$R^n$空间中的一个子空间，$\bf{y}$是$R^n$中的任意向量，$\hat{\bf{y}}$是$\bf{y}$在W上的正交投影，那么$\hat{\bf{y}}$是W中最接近$\bf{y}$的点，也就是指$||\bf{y} - \hat{\bf{y}}|| &lt; ||\bf{y} - \bf{v}||$，对所有属于W又异于$\hat{\bf{y}}$的$\bf{v}$成立</li></ul></li><li><p>格拉姆-施密特方法</p><ul><li><p>对$R^n$中子空间的一个基$\{\bf{x}_1, \dots, \bf{x}_p\}$，定义</p><p>  $\bf{v}_1 = \bf{x}_1$,</p><p>  $\bf{x}_2 = \bf{x}_2 - \frac{\bf{x}_2\cdot\bf{v}_1}{\bf{v}_1\cdot\bf{v}_1}\bf{v}_1$,</p><p>  $\cdots$,</p><p>  $\bf{v}_p = \bf{x}_p - \frac{\bf{x}_p\cdot\bf{v}_1}{\bf{v}_1\cdot\bf{v}_1}\bf{v}_1 - \frac{\bf{x}_p\cdot\bf{v}_2}{\bf{v}_2\cdot\bf{v}_2}\bf{v}_2 - \cdots - \frac{\bf{x}_p\cdot\bf{v}_{p-1}}{\bf{v}_{p-1}\cdot\bf{v}_{p-1}}\bf{v}_{p-1}$.</p><p>  那么$\{\bf{v}_1, \dots, \bf{v}_p\}$是W的一个正交基，此外，</p><p>  $Span\{\bf{v}_1, \dots, \bf{v}_p\} = Span\{\bf{x}_1, \dots, \bf{x}_k\}$，其中$1 \leq k \leq p$.</p></li></ul></li></ul><h1 id="3-最小二乘问题"><a href="#3-最小二乘问题" class="headerlink" title="3. 最小二乘问题"></a>3. 最小二乘问题</h1><ul><li>问题背景<ul><li>巨型方程组$Ax = b$，在实际工作中往往很难直接求解，最好的方法是寻找x，使得Ax尽可能的接近于b</li></ul></li><li>考虑Ax作为b的一个近似，从b到Ax的距离最小，$||\bf{b} - A\bf{x}||$近似程度越好。一般的最小二乘问题就是找出使$||\bf{b} - A\bf{x}||$尽量小的$\bf{x}$</li><li>如果mxn矩阵A和向量$\bf{b}$属于$R^n$，$A\bf{x} = \bf{b}$的最小二乘解是$R^n$中的$\hat{\bf{x}}$，使得$||\bf{b} - A\hat{\bf{x}}|| \leq ||\bf{b} - A\bf{x}||$对所有$\bf{x} \in R$成立</li><li>方程$A\bf{x} = \bf{b}$的最小二乘解集和法方程$A^TA\bf{x} = A^T\bf{b}$的非空解集一致</li><li>矩阵$A^TA$是可逆的充分必要条件是：A的列是线性无关的。在这种情形下，方程$A\bf{x} = \bf{b}$有惟一最小二乘解$\hat{\bf{x}}$且它有下面的表示$\hat{\bf{x}} = (A^TA)^{-1}A^T\bf{b}$</li><li>给定一个mxn矩阵A，且具有线性无关的列，取A = QR是A的QR分解，那么对每一个属于$R^m$的$\bf{b}$，矩阵$A\bf{x} = \bf{b}$有惟一的最小二乘解，其解为$\hat{\bf{x}} = R^{-1}Q^T\bf{b}$</li></ul><h1 id="4-內积空间"><a href="#4-內积空间" class="headerlink" title="4. 內积空间"></a>4. 內积空间</h1><ul><li><p>向量空间V上的內积是一个函数，对每一对属于V的向量$\bf{u}$和$\bf{v}$，存在一个实数$&lt;\bf{u}, \bf{v}&gt;$满足下面公理。对任意属于V的$\bf{u}$，$\bf{v}$，$\bf{w}$和所有数c,</p><p>  $&lt;\bf{u}, \bf{v}&gt; = &lt;\bf{v}, \bf{u}&gt;$,</p><p>  $&lt;\bf{u} + \bf{v}, \bf{w}&gt; = &lt;\bf{u}, \bf{w}&gt; + &lt;\bf{v}, \bf{w}&gt;$,</p><p>  $<c\bf{u}, \bf{v}> = c&lt;\bf{u}, \bf{v}&gt;$,</c\bf{u},></p><p>  $&lt;\bf{u}, \bf{v}&gt; \geq 0$，且$&lt;\bf{u}, \bf{v}&gt; = 0的充分必要条件是$$\bf{u} = 0$,</p><p>  一个赋予上面內积的向量空间称为內积空间</p></li><li><p>柯西-施瓦茨不等式</p><ul><li>对空间V中任意向量$\bf{u}$和$\bf{v}$，有$|&lt;\bf{u}, \bf{v}&gt;| \leq ||\bf{u}||||\bf{v}||$</li></ul></li><li><p>三角不等式</p><ul><li>对属于V的所有向量$\bf{u}$，$\bf{v}$，有$||\bf{u} + \bf{v}|| \leq ||\bf{u}|| + ||\bf{v}||$</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（六）-滤波算法-卡尔曼滤波基础</title>
      <link href="/2019/12/22/slam/vSLAMNet%EF%BC%88%E5%85%AD%EF%BC%89-%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95-%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%9F%BA%E7%A1%80/"/>
      <url>/2019/12/22/slam/vSLAMNet%EF%BC%88%E5%85%AD%EF%BC%89-%E6%BB%A4%E6%B3%A2%E7%AE%97%E6%B3%95-%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>Welch G, Bishop G. An introduction to the Kalman filter[J]. 1995.</li><li><a href="http://www.cs.unc.edu/~welch/kalman/" target="_blank" rel="noopener">http://www.cs.unc.edu/~welch/kalman/</a></li></ul><h1 id="2-基础知识"><a href="#2-基础知识" class="headerlink" title="2. 基础知识"></a>2. 基础知识</h1><ul><li>概率<ul><li>概率的本质是用数值表示某件事情发生的可能性</li></ul></li></ul><h1 id="3-卡尔曼滤波"><a href="#3-卡尔曼滤波" class="headerlink" title="3. 卡尔曼滤波"></a>3. 卡尔曼滤波</h1><h2 id="3-1-运动方程"><a href="#3-1-运动方程" class="headerlink" title="3.1 运动方程"></a>3.1 运动方程</h2><p>给定一个线性系统的状态差分方程：</p><p>$x_k = Ax_{k-1} + Bu_{k-1} + w_{k-1}$,</p><p>其中，$x$是系统的状态向量，大小为$n<em>1$；$A$为状态转移矩阵，大小为$n</em>n$；$u$为系统输入，即控制量，大小为$k<em>1$；$B$是将输入控制量转换为状态量的矩阵，大小为$n</em>k$；$w$为系统噪声，随机变量。</p><p>运动方程举例：</p><p>一个匀加速运动的小车，受到合理为$f_t$，那么，由$t-1$到$t$时刻的位移和速度计算公式为：</p><p>$x_t = x_{t-1} + (\dot{x}_{t-1}*\Delta t) + \frac{f_t(\Delta t)^2}{2m}$,</p><p>$\dot{x}_t = \dot{x}_{t-1} + \frac{f_t\Delta t}{m}$.</p><p>我们得到：</p><p>$x_t = \left[\begin{matrix} x_t \\ \dot{x}_t \end{matrix}\right]$, $u_t = \frac{f_t}{m}$.</p><p>$\left[\begin{matrix} x_t \\ \dot{x}_t \end{matrix}\right] = \left[\begin{matrix} 1 &amp; \Delta t \\ 0 &amp; 1 \end{matrix}\right]\left[\begin{matrix} x_{t-1} \\ \dot{x}_{t-1} \end{matrix}\right] + \left[\begin{matrix} \frac{(\Delta t)^2}{2} \\ \Delta t \end{matrix}\right]\frac{f_t}{m}$.</p><p>那么，有了该运动方程我们就可以地推得到系统的每一个时刻的状态了。那卡尔曼滤波的作用是什么呢？该运动方程的问题在于在实际中，由于系统的复杂程度，很难建立精确地运动方程。此外，由于运动方程是包含噪声的，即随着时间的推移，状态量的误差会逐步累积，直至误差达到不可用的地步。因此，卡尔曼滤波就发挥作用了。既然，一致利用运动方程地推会产生累计误差，那如果中间有观测数据来校准，就能够减少状态量的误差了。此外，由于观测也不是十分精确的，也会带来噪声，那么如果利用运动方程和观测量来计算系统的精确地状态量，就是卡尔曼滤波发挥作用的地方。</p><p>这个观测，或者说是反馈，从概率论贝叶斯模型的观点来看前面预测的结果就是先验，测量出的结果就是后验。</p><h2 id="3-2-运动方程的状态量分析"><a href="#3-2-运动方程的状态量分析" class="headerlink" title="3.2 运动方程的状态量分析"></a>3.2 运动方程的状态量分析</h2><p>下面先来分析一下状态量及其方差。</p><p>目标的状态定义为</p><p>$\vec{x} = \left[<br> \begin{matrix}<br>   p \\<br>   v<br>  \end{matrix}<br>  \right]$，其中$v$表示目标的运动速度，$p$表示目标的当前位置。</p><p>卡尔曼滤波假设两个变量（即位置和速度）是<strong>随机的</strong>，而且符合<strong>高斯分布</strong>。每个变量都有一个均值$\mu$，它是随机分布的中心；有一个方差$\sigma$，它衡量组合的不确定性。</p><p>由于基于旧位置估计新位置，我们会产生这两个结论：如果速度很快，机器人可能移动得更远，所以得到的位置会更远；如果速度很慢，机器人就走不了那么远。这种关系对目标跟踪来说非常重要，因为它提供了更多信息：一个可以衡量可能性的标准。这就是卡尔曼滤波的目标：从不确定信息中挤出尽可能多的信息。为了捕获这种相关性，我们用的是协方差矩阵。简而言之，矩阵的每个值是第i个变量和第j个变量之间的相关程度（由于矩阵是对称的，$i$和$j$的位置可以随便交换）。我们用$\Sigma$表示协方差矩阵，在这个例子中，就是$\Sigma_{ij}$。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-090518.png" alt="image-20191228170503855" style="zoom:67%;"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><p>为了把以上关于状态的信息建模为高斯分布（图中色块），我们还需要$k$时的两个信息：最佳估计$\hat{x}$（均值，也就是$\mu$，协方差矩阵$P_k$。（虽然还是用了位置和速度两个变量，但只要和问题相关，卡尔曼滤波可以包含任意数量的变量）。</p><p>$\hat{x} = \left[<br> \begin{matrix}<br>   p \\<br>   v<br>  \end{matrix}<br>  \right]$, $P_{k} = \left[<br> \begin{matrix}<br>   \Sigma_{pp} &amp; \Sigma_{pv} \\<br>   \Sigma_{vp} &amp; \Sigma_{vv}<br>  \end{matrix}<br>  \right]$.</p><p>接下来，我们利用$k-1$时刻的状态来预测$k$时刻的状态。从$k-1$时刻到$k$时刻，状态变换矩阵定义为$F_k$，如下图所示。它从原始预测中取每一点，并将其移动到新的预测位置。如果原始预测是正确的，系统就会移动到新位置。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-090800.png" alt="image-20191228170749372" style="zoom:67%;"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><p>假设目标的运动方程为</p><p>$p_k = p_{k-1}+ \Delta tv_{k-1}$,</p><p>$v_k = v_{k-1}$,</p><p>那么，由$\hat{x}_k = \left[<br> \begin{matrix}<br>   1 &amp; \Delta t \\<br>   0 &amp; 1<br>  \end{matrix}<br>  \right]\hat{x}_{k-1} = F_k\hat{x}_{k-1}$得，$F_k = \left[<br> \begin{matrix}<br>   1 &amp; \Delta t \\<br>   0 &amp; 1<br>  \end{matrix}<br>  \right]$。</p><p>这是一个预测矩阵，它能给出机器人的下一个状态，但目前我们还不知道协方差矩阵的更新方法。这也是我们要引出下面这个等式的原因：如果我们将分布中的每个点乘以矩阵A，那么它的协方差矩阵为</p><p>$Cov(x) = \Sigma$,</p><p>$Cov(Ax) = A\Sigma A^T$.</p><p>因此，我们得到</p><p>$\hat{x}_k = F_k\hat{x}_{k-1}$,</p><p>$P_k = F_kP_{k-1}F_k^T$.</p><p>其中，$P_k$表示的就是预测值和真实值之间的误差协方差。</p><p><strong>接下来，我们推导误差写方程是如何从k-1时刻通过预测方程传递到k时刻的。</strong></p><p>假设$\vec{x}_k$为t时刻下状态向量的真值，我们得到，</p><p>$\vec{x}_k - \hat{\vec{x}}_{k|k-1} = F(\vec{x}_{k-1} - \hat{\vec{x}}_{k|k-1}) + w_k$,</p><p>而$P_{k|k-1} = E[(\vec{x}_k - \hat{\vec{x}}_{k|k-1})(\vec{x}_k - \hat{\vec{x}}_{k|k-1})^T] = E[(F(\vec{x}_k - \hat{\vec{x}}_{k|k-1}) + w_k)(F(\vec{x}_k - \hat{\vec{x}}_{k|k-1}) + w_k))^T]$</p><p>$= F(E[(\vec{x}_k - \hat{\vec{x}}_{k|k-1})(\vec{x}_k - \hat{\vec{x}}_{k|k-1})^T])F^T + FE[(\vec{x}_k - \hat{\vec{x}}_{k|k-1})w_k^T]F^T$</p><p>$+ FE[(w_k\vec{x}_k - \hat{\vec{x}}_{k|k-1})^T]F^T + E[w_kw_k^T]$.</p><p>考虑到状态向量和噪声是<strong>不相关</strong>的，则$E[(w_t\vec{x}_k - \hat{\vec{x}}_{k|k-1})^T] = 0$，上式可以简化为</p><p>$P_{k|k-1} = FE[(\vec{x}_{k-1} - \hat{\vec{x}}_{k|k-1})(\vec{x}_{k-1} - \hat{\vec{x}}_{k|k-1})^T]F^T + E[w_kw_k^T]$</p><p>$= F_kP_{k-1}F_k^T + Q_k$</p><p>现在，我们考虑加速度计输入，定义为$\vec{u}_k$。那么，运动方程进一步写成</p><p>$p_k = p_{k-1} + \Delta t v_{k-1} + \frac{1}{2}a\Delta t$,</p><p>$v_k = v_{k-1} + a\Delta t$.</p><p>由于预测也是有误差的，否则我们就直接使用预测结果来作为目标的下一步状态。因此，我们需要一个不确定性来衡量预测可能带来的误差。如下图所示，加上预测不确定性后，$\hat{x}_{k-1}$的每个预测状态都可能会移动到另一点，也就是蓝色的高斯分布会移动到紫色高斯分布的位置，并且具有协方差$Q_k$，换句话说，我们把这些不确定影响视为协方差$Q_k$的噪声。这个紫色的高斯分布拥有和原分布相同的均值，但协方差不同。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-091413.png" alt="image-20191228171402000" style="zoom:67%;"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><p><img src="/Users/xiaoqiangteng/Library/Application Support/typora-user-images/image-20191228171439482.png" alt="image-20191228171439482"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><p>此处，我们得到的预测方程和协方差方程为</p><p>$\hat{x}_k = F_k\hat{x}_{k-1} + B_k\vec{u}_k$,</p><p>$P_k = F_kP_{k-1}F_{k}^{T}+Q_k$.</p><p>这两个公式主要思想如下：</p><ul><li>新的估计结果是基于原估计结果和已知外部输入校正后得到的预测结果</li><li>新的不确定性是基于原不确定性和外部输入的不确定性得到的预测不确定性</li></ul><h2 id="3-3-观测方程"><a href="#3-3-观测方程" class="headerlink" title="3.3 观测方程"></a>3.3 观测方程</h2><p>基于运动预测方程，当有额外传感器输入观测数据时，我们可利用该观测数据来融合预测数据，易获取目标更加准确地状态。观测是一系列读数，其与状态之间存在一定变换关系，定义为H矩阵。在刚刚的一维情况的小例子中，我们其实做了一个隐式的<strong>假设</strong>，即有预测更新得到的位置的概率分布和测距仪所得的测量值具有相同的单位 (unit)，如米 (m)。但实际情况往往不是这样的，比如，测距仪给出的可能不是距离，而是信号的飞行时间（由仪器至小车的光的传播时间），单位为秒 (s)。这样的话，我们就无法直接如上面一般直接将两个高斯分布相乘了。如下图所示，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-130904.png" alt="image-20191228210904176" style="zoom:67%;"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><p>我们得到如下等式，</p><p>$\vec{\mu} = H_k\hat{x}_k$,</p><p>$\Sigma = H_kP_kH_k^T$.</p><p>由于种种因素，传感器记录的信息其实是不准的，一个状态事实上可以产生多种读数。我们将这种不确定性（即传感器噪声）的协方差设为$R_k$，读数的分布均值为$z_k$，如下图所示，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-131227.png" alt="image-20191228211227194" style="zoom:67%;"></p><p>此时，得到了两块高斯分布，一块围绕预测的均值，另一块围绕传感器读数。如下图所示，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-131348.png" alt="image-20191228211347844" style="zoom:67%;"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><h2 id="3-4-基于高斯分布的预测和观测融合"><a href="#3-4-基于高斯分布的预测和观测融合" class="headerlink" title="3.4 基于高斯分布的预测和观测融合"></a>3.4 基于高斯分布的预测和观测融合</h2><p>如果要生成靠谱预测，模型必须调和这两个信息。也就是说，对于任何可能的读数$z_1, z_2$，这两种方法预测的状态都有可能是准的，也都有可能是不准的。重点是我们怎么找到这两个准确率。最简单的方法是两者相乘，可以得到它们的重叠部分，这也是会出现最佳估计的区域。换个角度看，它看起来也符合高斯分布。当你把两个高斯分布和它们各自的均值和协方差矩阵相乘时，你会得到一个拥有独立均值和协方差矩阵的新高斯分布。最后剩下的问题就不难解决了：我们必须有一个公式来从旧的参数中获取这些新参数！</p><p>下面将要讨论两个一维高斯分布得到更加准确地高斯分布。</p><p>设方差为$\sigma^2$，均值为$\mu$，高斯分布一般形式为$N(x, \mu, \sigma) = \frac{1}{\sigma\sqrt{2\pi}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}$，那么两条高斯曲线相乘后的曲线大约如下图所示，</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-28-131924.png" alt="image-20191228211923880" style="zoom:67%;"></p><p>（图片来源：<a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）" target="_blank" rel="noopener">http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/）</a></p><p>把这个式子按照一维方程进行扩展，可得：</p><p>$\mu’ = \mu_0 + \frac{\sigma_0^2(\mu_1 - \mu_0)}{\sigma_0^2 + \sigma_1^2}$,</p><p>$\sigma’^2 = \sigma_0^2 - \frac{\sigma_0^4}{\sigma_0^2 + \sigma_1^2}$.</p><p>如果有些太复杂，我们用k简化一下，</p><p>$k = \frac{\sigma_0^2}{\sigma_0^2 + \sigma_1^2}$,</p><p>$\mu’ = \mu_0 + k(\mu_1 - \mu_0)$,</p><p>$\sigma’^2 = \sigma_0^2 - k\sigma_0^2$.</p><p>以上是一维的内容，如果是多维空间，把这个式子转成矩阵格式：</p><p>$K = \Sigma_0(\Sigma_0 + \Sigma_1)^{-1}$,</p><p>$\vec{\mu}’ = \vec{\mu}_0 + K(\vec{\mu}_1 - \vec{\mu}_0)$,</p><p>$\Sigma’ = \Sigma_0 - K\Sigma_0$.</p><p>这个矩阵K就是卡尔曼增益。</p><p>基于以上基础，我们开始推导卡尔曼滤波的更新过程。</p><p>截至目前，我们有用矩阵$(\mu_0, \Sigma_0) = (H_k\hat{x}_k, H_kP_kH_k^T)$预测的分布，有用传感器读数$(\mu_1, \Sigma_1) = (\vec{z}_k, R_k)$预测的分布。把它们代入上节的矩阵等式中：</p><p>$H_k\hat{x}_k’ = H_k\hat{x}_k + K(\vec{z}_k - H_k\hat{x}_k)$,</p><p>$H_kP_k’H_k^T = H_kP_kH_k^T - KH_kP_kH_k^T$.</p><p>卡尔曼增益就是：</p><p>$K = H_kP_kH_k^T(H_kP_kH_k^T + R_k)^{-1}$.</p><p>考虑到$K$里还包含着一个$H_k$，再精简一下上式：</p><p>$\hat{x}_k’ = \hat{x}_k + K’(\vec{z}_k - H_k\hat{x}_k)$,</p><p>$P_k’ = P_k - K’H_kP_k$,</p><p>$K’ = P_kH_k^T(H_kP_kH_k^T + R_k)^{-1}$.</p><p>$\hat{x}_k’$是最佳估计值，我们可以把它继续放进去做另一轮预测。</p><h2 id="3-5-总结"><a href="#3-5-总结" class="headerlink" title="3.5 总结"></a>3.5 总结</h2><p>卡尔曼滤波的流程可总结为下图：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2020-05-17-095735.png" alt="image-20200517175726271" style="zoom:50%;"></p><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/39912633" target="_blank" rel="noopener">图说卡尔曼滤波，一份通俗易懂的教程</a></li><li><a href="http://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/" target="_blank" rel="noopener">How a Kalman filter works, in pictures</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 滤波 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 滤波 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（五）-特征值与特征向量</title>
      <link href="/2019/12/22/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%94%EF%BC%89-%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E7%89%B9%E5%BE%81%E5%90%91%E9%87%8F/"/>
      <url>/2019/12/22/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%94%EF%BC%89-%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E7%89%B9%E5%BE%81%E5%90%91%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="1-特征向量与特征值"><a href="#1-特征向量与特征值" class="headerlink" title="1. 特征向量与特征值"></a>1. 特征向量与特征值</h1><ul><li>A为nxn矩阵，$\bf{x}$为非零向量，若存在数$\lambda$使$A\bf{x} = \lambda \bf{x}$成立，则称$\lambda$为A的特征值，$\bf{x}$称为对应于$\lambda$的特征向量</li><li>三角矩阵的主对角线的元素是其特征值</li><li>$\lambda_1, \cdots, \lambda_r$是nxn矩阵A相异的特征值，$\bf{v}_1, \cdots, \bf{v}_r$是与$\lambda_1, \cdots, \lambda_r$对应的特征向量，那么向量集合$\{\bf{v}_1. \cdots, \bf{v}_r\}$线性无关</li></ul><h1 id="2-特征方程"><a href="#2-特征方程" class="headerlink" title="2. 特征方程"></a>2. 特征方程</h1><ul><li>通过行列式来判断矩阵$A - \lambda I$是否可逆，数值方程$det(A - \lambda I) = 0$称为A的特征方程</li><li>数$\lambda$是nxn矩阵A的特征值的充要条件是$\lambda$是特征方程$det(A - \lambda I) = 0$的根</li><li>相似性<ul><li>假如矩阵A和B是nxn举着，如果存在可逆矩阵P，使得$P^{-1}AP = B$，或等价地$A = PBP^{-1}$，则称A相似于B，记$Q = P^{-1}$，则有$A^{-1}BQ = A$</li><li>若nxn矩阵A和B是相似的，那么它们有相同的特征多项式，从而有相同的特征值（和相同的重数）</li></ul></li></ul><h1 id="3-对角化"><a href="#3-对角化" class="headerlink" title="3. 对角化"></a>3. 对角化</h1><ul><li>如果方阵A相似于对角矩阵，即存在可逆矩阵P和对角矩阵D，有$A = PDP^{-1}$，则称A可对角化</li><li>nxn矩阵可对角化的充分必要条件是A有n个线性无关的特征向量</li><li>有n个相异特征值的nxn矩阵可对角化</li></ul><h1 id="4-特征向量与线性变换"><a href="#4-特征向量与线性变换" class="headerlink" title="4. 特征向量与线性变换"></a>4. 特征向量与线性变换</h1><ul><li>设V是n维向量空间，W是m维向量空间，T是V到W的线性变换；为了把T与矩阵相联系，指定B和C分别是V和W的基</li><li>V到V的线性变换<ul><li>当W=V，C=B时，M称为T相对于B的矩阵，或简称为T的B-矩阵，记为$[T]_B$</li><li>$V\rightarrow V$的线性变换T的B-矩阵对所有V中的$\bf{x}$，有$[T(\bf{x})]_B = [T]_B[\bf{x}]_B$</li></ul></li><li>对角矩阵表示<ul><li>设$A = PDP^{-1}$，其中D为nxn对角矩阵，若$R^n$的基B由P的列向量组成，那么D是变换$\bf{x}\mapsto A\bf{x}$的B-矩阵</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（四）-向量空间</title>
      <link href="/2019/12/19/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89-%E5%90%91%E9%87%8F%E7%A9%BA%E9%97%B4/"/>
      <url>/2019/12/19/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89-%E5%90%91%E9%87%8F%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="1-向量空间与子空间"><a href="#1-向量空间与子空间" class="headerlink" title="1. 向量空间与子空间"></a>1. 向量空间与子空间</h1><ul><li><p>定义</p><ul><li>一个向量空间是由一些被称为向量的对象构成的非空集合V，在这个集合上定义两个运算，称为加法和标量乘法，服从以下定理，这些定理必须对V中所有向量u, v, w及所有标量c和d均成立<ul><li>$\vec{u}$和$\vec{v}$之和表示为$\vec{u} + \vec{v}$，仍在V中</li><li>$\vec{u} + \vec{v} = \vec{v} + \vec{u}$</li><li>$(\vec{u} + \vec{v}) + \vec{w} = \vec{u} + (\vec{v} + \vec{w})$</li><li>V中存在一个零向量$\vec{0}$，使得$\vec{u} + \vec{0} = \vec{u}$</li><li>对V中的每个向量$\vec{u}$，存在V中向量$-\vec{u}$，使得$\vec{u} + (-\vec{u}) = \vec{0}$</li><li>$\vec{u}$与标量c的标量乘法记为$c\vec{u}$，仍在V中</li><li>$c(\vec{u} + \vec{v}) = c\vec{u} + c\vec{v}$</li><li>$(c + d)\vec{u} = c\vec{u} + d\vec{u}$</li><li>$c(d\vec{u}) = (cd)\vec{u}$</li><li>$l\vec{u} = \vec{u}$</li></ul></li></ul></li><li><p>子空间</p><ul><li>向量空间V的一个子空间是V的一个满足以下三个性质的子集H<ul><li>V中的零向量在H中</li><li>H对向量加法封闭，即对H中任意向量$\vec{u}$和$\vec{v}$，和$\vec{u} + \vec{v}$仍在H中</li><li>H对标量乘法封闭，即对H中任意向量$\vec{u}$和任意标量c，向量$c\vec{u}$仍在H中</li></ul></li></ul></li></ul><h1 id="2-零空间、列空间和线性变换"><a href="#2-零空间、列空间和线性变换" class="headerlink" title="2. 零空间、列空间和线性变换"></a>2. 零空间、列空间和线性变换</h1><ul><li>零空间<ul><li>满足$A\bf{x} = \bf{0}$的所有x的集合为矩阵A的零空间</li><li>mxn矩阵A的零空间写成Nul A，是齐次方程$A\bf{x} = \bf{0}$的全体解的集合，用集合符号表示，即$Nul A = \{\bf{x}: \bf{x}\in R^n, A\bf{x} = \bf{0}\}$</li></ul></li><li>矩阵的列空间<ul><li>mxn矩阵的列空间（记为Col A）是由A的列的所有线性组合组成的集合，若$A = [a_1, \cdots, a_n]$，则$Col A = Span\{a_1, \cdots, a_n\}$</li><li>mxn矩阵A的列空间是$R^m$的一个子空间</li></ul></li><li>线性变换的核与值域<ul><li>由向量空间V映射到向量空间W内的线性变换T是一个规则，它将V中每个向量x映射成W中惟一向量T(x)，且满足<ul><li>$T(\bf{u} + \bf{v}) = T(\bf{u}) + T(\bf{v})$，对V中所有$\bf{u}$，$\bf{v}$均成立</li><li>$T(c\bf{u}) = cT(\bf{u})$，对V中所有$\bf{u}$及所有数c均成立</li></ul></li><li>线性变换T的核（或零空间）是V中所有满足$T(\bf{u}) = \bf{0}$的向量$\bf{u}$的集合（$\bf{0}$为W中的零向量）。T的值域是W中所有具有刑事$T(\bf{x})$（任意$\bf{x}\in V$）的向量的集合。如果T是由一个矩阵变换得到的，比如对某矩阵A，$T(\bf{x}) = A\bf{x}$，则T的核与值域恰好是前面定义的A的零空间和列空间</li></ul></li></ul><h1 id="3-线性无关集合基"><a href="#3-线性无关集合基" class="headerlink" title="3. 线性无关集合基"></a>3. 线性无关集合基</h1><ul><li>另H是向量空间V的一个子空间，V中向量的指标集$B = \{b_1, \cdots, b_p\}$称为H的一个基，如果<ul><li>B是一线性无关集</li><li>由B生成的子空间与H相同，即$H = Span\{b_1, \cdots, b_p\}$</li></ul></li><li>生成集<ul><li>另$S = \{\bf{v}_1, \cdots, \bf{v}_p\}$是V中的向量集，$H = Span\{\bf{v}_1, \cdots, \bf{v}_p\}$<ul><li>若S中某一个向量，比如说$\bf{v}_k$，是S中其余向量的线性组合，则S中去掉$\bf{v}_k$后形成的集合仍然可以生成H</li><li>若$H \neq \{\bf{0}\}$，则S的某一子集是H的一个基</li></ul></li></ul></li><li>矩阵A的主元列构成Col A的一个基</li></ul><h1 id="4-坐标系"><a href="#4-坐标系" class="headerlink" title="4. 坐标系"></a>4. 坐标系</h1><ul><li>对一个向量空间V，明确指定一个基B的一个重要原因是在V上强加一个“坐标系”</li><li>惟一表示定理<ul><li>另$B = \{\bf{b}_1, \cdots, \bf{b}_n\}$是向量空间V的一个基，则对V中每个向量$\bf{x}$，存在惟一的一组数$c_1, cdots, c_n$使得$\bf{x} = c_1\bf{b}_1 + \cdots + c_n\bf{b}_n$</li></ul></li><li>假设集合$B = \{\bf{b}_1, \cdots, \bf{b}_n\}$是V的一个基，$\bf{x}$在V中，$\bf{x}$相对于基B的坐标（或$\bf{x}$的B-坐标）是使得$\bf{x} = c_1\bf{b}_1 + \cdots + c_n\bf{b}_n$的权$c_1, \cdots, c_n$</li></ul><h1 id="5-向量空间的维数"><a href="#5-向量空间的维数" class="headerlink" title="5. 向量空间的维数"></a>5. 向量空间的维数</h1><ul><li>若V由一个有限集生成，则V称为有限维的，V的维数写成dimV，是V的基中含有向量的个数，零向量空间${\bf{0}}$的维数定义为零。如果V不是由一有限集生成，则V称为无穷维的</li><li>有限维空间的子空间<ul><li>另H是有限维向量空间V的子空间，若有需要的话，H中任一个线性无关集均可以扩充为H的一个基，H也是有限维的并且$dim H \leq dim V$</li></ul></li></ul><h1 id="6-秩"><a href="#6-秩" class="headerlink" title="6. 秩"></a>6. 秩</h1><ul><li>行空间<ul><li>若A是一个mxn矩阵，A的每一行具有n个数字，即可以视为$R^n$中一个向量。其行向量的所有线性组合的集合称为A的行空间，记为Row A。由于每一行具有n个数，所以Row A是$R^n$的一个子空间。因为A的行与$A^T$的列相同，也可用$Col A^T$代替Row A</li></ul></li><li>A的秩即A的列空间的维数</li><li>mxn矩阵A的列空间和行空间的维数相等，这个公共的维数（即A的秩）还等于A的主元位置的个数且满足方程$rank A + dim Nul A = n$</li><li>秩和可逆矩阵定理<ul><li>令A是一个nxn矩阵，则下列的命题中的每个均等价于A是可逆矩阵<ul><li>A的列构成$R^n$的一个基</li><li>$Col A = R^n$</li><li>$dim Col A = n$</li><li>$rank A = n$</li><li>$Nul A = \{0\}$</li></ul></li></ul></li></ul><h1 id="7-基的变换"><a href="#7-基的变换" class="headerlink" title="7. 基的变换"></a>7. 基的变换</h1><ul><li>设$B = \{\bf{b}_1, \cdots, \bf{b}_n\}$和$C = \{\bf{c}_1, \cdots, 、bf{c}_n\}$是向量空间V的基，则存在一个nxn矩阵$P_{C\leftarrow B}$使得$[\bf{x}]_C = P_{C\leftarrow B}[\bf{x}]_B$</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（三）-行列式</title>
      <link href="/2019/12/14/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%89%EF%BC%89-%E8%A1%8C%E5%88%97%E5%BC%8F/"/>
      <url>/2019/12/14/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%89%EF%BC%89-%E8%A1%8C%E5%88%97%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="1-行列式的介绍"><a href="#1-行列式的介绍" class="headerlink" title="1. 行列式的介绍"></a>1. 行列式的介绍</h1><ul><li>当$n \geq 2$，nxn矩阵$A = [a_{ij}]$的行列式是形如$\pm a_{ij}detA_{ij}$的n个项的和，其中加号和减号交替出现，这里元素$a_{11}, a_{12}, \cdots, a_{1n}$来自A的第一行，即$detA = a_{11}detA_{11} - a_{12}detA_{12} + \cdots + (-1)^{1+n}a_{1n}detA_{1n} = \sum_{j=1}^{n}(-1)^{1+j}a_{1j}detA_{1j}$.</li><li>给定$A = [a_{ij}]$，A的(i, j)余因子$C_{ij}$由下式给出$C_{ij} = (-1)^{i+j}detA_{ij}$，则$detA = a_{11}C_{11} + a_{12}C_{12} + \cdots + a_{1n}C_{1n}$.</li><li>nxn矩阵A的行列式可按任意行或列的余因子展开式来计算。按第i行展开为$detA = a_{i1}C_{i1} + a_{i2}C_{i2} + \cdots + a_{in}C_{in}$；按第j列的余因子展开式为$detA = a_{1j}C_{1j} + a_{2j}C_{2j} + \cdots + a_{nj}C_{nj}$.</li></ul><h1 id="2-行列式的性质"><a href="#2-行列式的性质" class="headerlink" title="2 行列式的性质"></a>2 行列式的性质</h1><ul><li>令A是一个方阵<ul><li>若A的某一行的倍数加到另一行得到矩阵B，则$det B = det A$</li><li>若A的两行互换得到矩阵B，则$det B = det A$</li><li>若A的某行乘以k倍得到矩阵B，则$det B = kdet A$</li></ul></li><li>方阵A可逆当且仅当$det A \neq 0$</li><li>若A为一个nxn矩阵，则$det A^T = det A$</li><li>若A和B均为nxn矩阵，则$det AB = (det A)(det B)$</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">det</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(A) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> A[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">    value = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(A)):</span><br><span class="line">        n = [[row[a] <span class="keyword">for</span> a <span class="keyword">in</span> range(len(A)) <span class="keyword">if</span> a != i] <span class="keyword">for</span> row <span class="keyword">in</span> A[<span class="number">1</span>:]]</span><br><span class="line">        value += A[<span class="number">0</span>][i] * det(n) * (<span class="number">-1</span>) ** (i % <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure><h1 id="3-克拉默法则、体积和线性变换"><a href="#3-克拉默法则、体积和线性变换" class="headerlink" title="3. 克拉默法则、体积和线性变换"></a>3. 克拉默法则、体积和线性变换</h1><ul><li>克拉默法则<ul><li>设A是一个可逆的nxn矩阵，对$R^n$中任意向量b，方程$Ax = b$的唯一解可由下式给出$x_i = \frac{det A_{i}(b)}{det A}$，其中，$i = 1, 2, \dots, n$.</li></ul></li><li>一个求$A^{-1}$的公式<ul><li>$A^{-1}$的第j列是一个向量x，满足$Ax = e_j$，其中$e_j$是单位矩阵的第j列，x的第i个数值是$A^{-1}$中(i, j)位置的数值，由克拉默法则$\{A^{-1}中(i, j)元素\} = x_i = \frac{det A_i(e_j)}{det A}$</li><li>那么，$A^{-1} = \frac{1}{det A}adj A$</li></ul></li><li>用行列式表示面积或体积<ul><li>若A是一个2x2矩阵，则由A的列确定的平行四边形的面积为$|det A|$，若A是一个3x3矩阵，则由A的列确定的平行六面体的体积为$|det A|$</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（五）-姿态估计-Madgwick算法</title>
      <link href="/2019/12/07/slam/vSLAMNet%EF%BC%88%E4%BA%94%EF%BC%89-%E5%A7%BF%E6%80%81%E4%BC%B0%E8%AE%A1-Madgwick%E7%AE%97%E6%B3%95/"/>
      <url>/2019/12/07/slam/vSLAMNet%EF%BC%88%E4%BA%94%EF%BC%89-%E5%A7%BF%E6%80%81%E4%BC%B0%E8%AE%A1-Madgwick%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>Madgwick S. An efficient orientation filter for inertial and inertial/magnetic sensor arrays[J]. Report x-io and University of Bristol (UK), 2010, 25: 113-118.</li><li>Madgwick S O H, Harrison A J L, Vaidyanathan R. Estimation of IMU and MARG orientation using a gradient descent algorithm[C]//2011 IEEE international conference on rehabilitation robotics. IEEE, 2011: 1-7.</li><li>位姿估计</li><li>传感器<ul><li>陀螺仪 + 加速度计</li><li>陀螺仪 + 加速度计 + 磁力计</li></ul></li><li>优点<ul><li>计算量低，适用于轻量级设备</li><li>适用于低采样频率</li><li>仅有2个需要调的参数</li></ul></li><li>核心思想<ul><li>首先，通过陀螺仪的角速度初步计算传感器方向偏移$^{E}_{S}q_{w,t}$；然后，通过对重力加速度和地磁这两个恒定量在传感器坐标系下的投影计算传感器方向偏移$^{E}_{S}q_{\nabla,t}$；最后通过互补滤波器融合$^{E}_{S}q_{w,t}$和$^{E}_{S}q_{\nabla,t}$来得到一个更加可信的结果。除此之外还需要校正地磁计数据畸变和陀螺仪零点漂移。</li></ul></li></ul><h1 id="2-算法详解"><a href="#2-算法详解" class="headerlink" title="2. 算法详解"></a>2. 算法详解</h1><h2 id="2-1-陀螺仪姿态解算"><a href="#2-1-陀螺仪姿态解算" class="headerlink" title="2.1 陀螺仪姿态解算"></a>2.1 陀螺仪姿态解算</h2><ul><li><p>主要思想</p><ul><li>建立四元数和陀螺仪读数之间的微分方程</li><li>欧拉中值积分</li></ul></li><li><p>坐标系定义</p><ul><li>世界坐标系E</li><li>传感器坐标系S</li><li>$^{S}_{E}q$表示坐标系E相对于坐标系S的单位旋转四元数</li></ul></li><li>陀螺仪数据输出<ul><li>$^{S}w = [0 w_x w_y w_z]$</li></ul></li><li>地面参考系（Earth）相对于传感器参考系（Sensor）的旋转可以由其四元数的导数对时间的积分获得，$^{S}_{E}q_{w,t} = ^{S}_{E}\hat{q}_{est.t-1} + ^{S}_{E}q_{w,t}\Delta t$，其中$^{S}_{E}\dot{q} = \frac{1}{2}^{S}_{E}\hat{q} \otimes ^{S}w$，$^{S}_{E}\dot{q}$表示姿态四元数变化的速度。该公式中的角速度可以直接从传感器读出，上一时刻的位姿也是已知，时间间隔也可以从传感器芯片中的获得。可以轻松的计算出结果，下面推导下该公式</li></ul><p>已知t时刻的四元数$^{S}_{E}q_{t-1}$和角速度$^{S}w_{t-1}$、t时刻的加速度$^{S}w_t$，系统采样间隔为$\Delta t$，求t时刻的四元数$^{S}_{E}q_{t}$。</p><p>基于常微分方程，套用中值积分公式，得到$^{S}_{E}q_t = ^{S}_{E}q_{t-1} + \frac{\Delta t}{2}(K_1 + K_2)$，其中，$K_1 = \frac{1}{2}^{S}_{E}q_{t-1}\otimes ^{S}w_{t-1}$和$K_2 = \frac{1}{2}(^{S}_{E}q_{t-1} + \Delta tK_1)\otimes^{S}w_t$。</p><p>此处，近似估计物体四元数在t-1到t时刻之间的平均变化速度$^{S}_{E}\dot{q}_{w,t-1,t}$。在实际过程中，往往并不能得到t-1时刻的准确的四元数，二是一个最优的估计值$^{S}_{E}\hat{q}_{est,t-1}$。</p><p>我们得到$^{S}_{E}\dot{q}_{w,t-1,t} = \frac{1}{2}(K_1 + K_2) = \frac{1}{2}(\frac{1}{2}^{S}_{E}\hat{q}_{est,t-1}\otimes ^{S}w_{t-1} + \frac{1}{2}(^{S}_{E}\hat{q}_{est,t-1} + \Delta t(\frac{1}{2}^{S}_{E}\hat{q}_{est,t-1}\otimes ^{S}w_{t-1})) \otimes ^{S}w_{t})$</p><p>$^{S}_{E}q_{w,t} = ^{S}_{E}\hat{q}_{est,t-1} + ^{S}_{E}\dot{q}_{w,t-1,t}\Delta t$</p><p>从而得到，</p><p>$^{S}_{E}q_{w,t} = ^{S}_{E}\hat{q}_{est,t-1} + \frac{\Delta}{2}(\frac{1}{2}^{S}_{E}\hat{q}_{est,t-1}\otimes ^{S}w_{t-1} + \frac{1}{2}(^{S}_{E}\hat{q}_{est,t-1} + \Delta t(\frac{1}{2}^{S}_{E}\hat{q}_{est,t-1}\otimes ^{S}w_{t-1})) \otimes ^{S}w_{t})$</p><p>以上迭代公式是计算精度要求较高时采用的。而在实际工程中，不要求如此的高精度而追求计算速度时，可采用以下的近似迭代公式。亦是参考<a href="https://www.cnblogs.com/ilekoaiq/p/8849217.html" target="_blank" rel="noopener">Madgwick算法详细解读</a>。</p><p>在t-1时刻到t时刻之间的变化速度$^S_E\dot{q}_{w,t-1,t}$可近似为，</p><p>$^S_E\dot{q}_{w,t-1,t} = \frac{1}{2}^S_E\hat{q}_{est,t-1}\otimes ^Sw_t$,</p><p>所以，$^S_Eq_{w,t} = ^S_E\hat{q}_{est,t-1} + ^S_E\dot{q}_{w,t-1,t}\Delta t = ^S_E\hat{q}_{est,t-1} + (\frac{1}{2}^S_E\hat{q}_{est,t-1}\otimes ^Sw_t)\Delta t$.</p><h2 id="2-2-加速度计和磁力计姿态解算"><a href="#2-2-加速度计和磁力计姿态解算" class="headerlink" title="2.2 加速度计和磁力计姿态解算"></a>2.2 加速度计和磁力计姿态解算</h2><ul><li>传感器介绍<ul><li>加速度计<ul><li>测量重力和外界施加给物体的力产生的加速度的和</li></ul></li><li>磁力计<ul><li>测量地球磁场和外界地磁干扰在传感器坐标系下的磁通量</li></ul></li></ul></li><li>假设<ul><li>该算法假设加速度计和磁力计分别仅仅观测重力和地球磁场</li></ul></li><li>目标<ul><li>利用加速度计和磁力计求解姿态$^{S}_{E}q_{\bigtriangledown, t}$</li></ul></li></ul><p>以上的推导参考<a href="https://www.cnblogs.com/ilekoaiq/p/8849217.html" target="_blank" rel="noopener">Madgwick算法详细解读</a>，推导思路同论文一致，只是有些符号定义不同。此外，论文中首先分别对加速度计读数和磁力计读数进行推导，然后组合在一起。以下的推导直接将加速度计读数和磁力计读数组合在一起。</p><p>当物体静止朝北时，加速度计理论输出为$^{E}\hat{g} = [0\ 0\ 0\ 1]$，磁力计理论输出为$^E\hat{b} = [0\ b_x\ 0\ b_z]$，表示为实部为0的四元数。进一步地，我们得到向量$^E\hat{y} = [0\ 0\ 1\ b_x\ 0\ b_z]$。</p><p>当物体运动后，在t时刻，我们得到新的加速度计和磁力计的向量分别为$^S\hat{a}_t = [0\ a_x\ a_y\ a_z]$和$^S\hat{m}_t = [0\ m_x\ m_y\ m_z]$。进一步地，我们得到新的向量$^S\hat{y}_t = [a_x\ a_y\ a_z\ m_x\ m_y\ m_z]$。</p><p>设t时刻物体的姿态为$^{S}_{E}q_t$，那么根据四元数旋转可得到，</p><p>$^S\hat{a}_t = ^{S}_{E}q_t \otimes ^E\hat{g} \otimes ^{S}_{E}q_t^*$,</p><p>$^S\hat{m}_t = ^{S}_{E}q_t \otimes ^E\hat{b} \otimes ^{S}_{E}q_t^*$。</p><p>利用旋转矩阵表示为，</p><p>$^S\hat{a}_t^T = R_t ^E\hat{g}^T$，</p><p>$^S\hat{m}_t^T = R_t ^E\hat{b}^T$,</p><p>将$R_t$组合为新的矩阵$M_t$，</p><p>$M_t = \left[<br> \begin{matrix}<br>   R_t &amp; 0 \\<br>   0 &amp; R_t<br>  \end{matrix}<br>  \right]$,</p><p>那么，我们得到，</p><p>$^S\hat{y}_t^T = M_t^E\hat{y}^T$.</p><p>上式中，$^S\hat{y}_t$和$^E\hat{y}$是已知的，可以求出$^{S}_{E}q_t$，即估计值$^{S}_{E}\hat{q}_t = [q_0\ q_1\ q_2\ q_3]^T$，由此转换成$\hat{M}_t$，使得误差平方和$F(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)$最小，得到如下优化方程，</p><p>$\min_{^{S}_{E}\hat{q}_t\in R^4}F(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)$,</p><p>其中，$F(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t) = ||f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)||^2 = (\hat{M}_t\ ^E\hat{y}^T - ^S\hat{y}_t^T)^T(\hat{M}_t\ ^E\hat{y}^T - ^S\hat{y}_t^T)$。</p><p>函数$f(\cdot)$回一个多元向量函数，采用数值解法，例如梯度下降法、牛顿法等。论文中采用梯度下降法。</p><p>设$^{S}_{E}\hat{q}_t$的初值为$^{S}_{E}\hat{q}_{t,k}$，为4行1列矩阵，那么误差平方和为$F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t$。假设初值四元数需要修正的量为$\bigtriangledown f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)$，那么修正后的误差平方和为$F(^{S}_{E}\hat{q}_{t,k} + \bigtriangledown f, ^E\hat{y}, ^S\hat{y}_t)$。</p><p>由泰勒公式展开得到，</p><p>$F(^{S}_{E}\hat{q}_{t,k} + \bigtriangledown f, ^E\hat{y}, ^S\hat{y}_t) = F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t) + \frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}\bigtriangledown f + O(||\bigtriangledown f||^2) \approx F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t) + \frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}\bigtriangledown f$,</p><p>其中，$\bigtriangledown f$为4行1列矩阵，$\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}$为1行4列矩阵，得到，</p><p>$\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q} = [\frac{\partial F}{\partial q_0}\ \frac{\partial F}{\partial q_1}\ \frac{\partial F}{\partial q_2}\ \frac{\partial F}{\partial q_3}]$，</p><p>那么，梯度为，</p><p>$\lim_{\bigtriangledown f\rightarrow 0}\frac{F(^{S}_{E}\hat{q}_{t,k} + \bigtriangledown f, ^E\hat{y}, ^S\hat{y}_t) - F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f||} = \frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}\frac{\bigtriangledown f}{||\bigtriangledown f||} = ||\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}||\cos \theta$,</p><p>其中，$\theta$为向量$(\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q})^T$与单位向量$\frac{\bigtriangledown f}{||\bigtriangledown f||}$的夹角。当$\theta = \pi$时，误差平方和下降最快。因此，我们得到，</p><p>$\bigtriangledown f = -\rho (\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q})^T$,</p><p>其中，$\rho$为一个大于0的比例系数。上式中的$F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)$关于四元数q的偏导计算为，</p><p>$\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q} = \frac{\partial (f^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t))}{\partial q}$</p><p>$= [\frac{\partial (f_{11}^2 + f_{21}^2 + \cdots + f_{61}^2)}{\partial q_0}\ \frac{\partial (f_{11}^2 + f_{21}^2 + \cdots + f_{61}^2)}{\partial q_1}\ \frac{\partial (f_{11}^2 + f_{21}^2 + \cdots + f_{61}^2)}{\partial q_2}\ \frac{\partial (f_{11}^2 + f_{21}^2 + \cdots + f_{61}^2)}{\partial q_3}]$</p><p>$= [2f_{11}\frac{\partial f_{11}}{\partial q_0} + \cdots + 2f_{61}\frac{\partial f_{61}}{\partial q_0}\ 2f_{11}\frac{\partial f_{11}}{\partial q_1} + \cdots + 2f_{61}\frac{\partial f_{61}}{\partial q_1}\ 2f_{11}\frac{\partial f_{11}}{\partial q_2} + \cdots + 2f_{61}\frac{\partial f_{61}}{\partial q_2}\ 2f_{11}\frac{\partial f_{11}}{\partial q_3} + \cdots + 2f_{61}\frac{\partial f_{61}}{\partial q_3}]$</p><p>$= 2f^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)\frac{\partial f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}$,</p><p>其中，$f_{ij}$表示$f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)$中第i行第j列元素。$f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)$的表达式为，</p><p>$f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t) = \hat{M}_t\ ^E\hat{y}^T - ^S\hat{y}_t^T$</p><p>$= \left[<br>\begin{matrix}<br>    2(q_1q_3 - q_0q_2) - a_x \\<br>    2(q_0q_1 + q_2q_3) - a_y \\<br>    2(\frac{1}{2} - q_1^2 - q_2^2) \\<br>    2b_x(\frac{1}{2} - q_2^2 - q_3^2) + 2b_z(q_1q_3 - q_0q_2) - m_x \\<br>    2b_x(q_1q_2 - q_0q_3) + 2b_z(q_0q_1 + q_1q_3) - m_y \\<br>    2b_x(q_0q_2 + q_1q_3) + 2b_z(\frac{1}{2} - q_1^2 - q_2^2) - m_z<br>\end{matrix}<br>\right]$.</p><p>而$\frac{\partial f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q}$是$f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)$关于四元数的偏导，其雅可比矩阵为，</p><p>$\frac{\partial F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q} = J(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t))$</p><p>$ = [\frac{\partial f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q_0}\ \frac{\partial f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q_1}\ \frac{\partial f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q_2}\ \frac{\partial f(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)}{\partial q_3}]$</p><p>$= \left[<br>\begin{matrix}<br>    -2q_2 &amp; 2q_3 &amp; -2q_0 &amp; 2q_1 \\<br>    2q_1 &amp; 2q_0 &amp; 2q_3 &amp; 2q_2 \\<br>    0 &amp; -4q_1 &amp; -4q_2 &amp; 0 \\<br>    -2b_zq_2 &amp; 2b_zq_3 &amp; -4b_xq_2 - 2b_zq_0 &amp; -4b_xq_3 + 2b_zq_1 \\<br>    -2b_xq_3 + 2b_zq_1 &amp; 2b_xq_2 + 2b_zq_0 &amp; 2b_xq_1 + 2b_zq_3 &amp; -2b_xq_0 + 2b_zq_2 \\<br>    2b_xq_2 &amp; 2b_xq_3 - 4b_zq_1 &amp; 2b_xq_0 - 4b_zq_2 &amp; 2b_xq_1<br>\end{matrix}<br>\right]$,</p><p>因此，$\bigtriangledown f$的计算为，</p><p>$\bigtriangledown f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t) = -rho(2f^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)J(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t))^T$</p><p>$= -2\rho J^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)$.</p><p>进行归一化，除以其范数，得到梯度方向为，</p><p>$\frac{\bigtriangledown f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)||} = \frac{-2\rho J^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)}{||-2\rho J^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)||}$</p><p>$= \frac{-J^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)}{||-J^T(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)||}$,</p><p>然后再乘以步长$\mu_t$就得到各个变量要改变的值。因此，各个自变量现有的值加上要修正的量，得到新的$^S_E\hat{q}_t$的估计为，</p><p>$^S_E\hat{q}_{t,k} = ^S_E\hat{q}_{t,k-1} + \frac{\bigtriangledown f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_t, ^E\hat{y}, ^S\hat{y}_t)||}\mu_t$,</p><p>其中，$k = 1, 2, \cdots, n$.</p><p>如此迭代下去，用上一时刻的姿态$^S_E\hat{q}_{est,t-1}$作为初值$^S_E\hat{q}_{t,0}$，即已知上一次的估计$^S_E\hat{q}_{t,k}$，代入上述公式中，进行多次迭代，直到$F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t)$小于某一阈值，或者经过多次迭代，直到满足$F(^{S}_{E}\hat{q}_{t,k}, ^E\hat{y}, ^S\hat{y}_t) - F(^{S}_{E}\hat{q}_{t,k-1}, ^E\hat{y}, ^S\hat{y}_t) \geq 0$，此时，$^S_E\hat{q}_{t,k}$为$^S_E\hat{q}_{t}$的最佳估计值。</p><p>以上迭代公式是计算精度要求较高时采用的。而在实际工程中，不要求如此的高精度而追求计算速度时，可采用以下的近似迭代公式。亦是参考<a href="https://www.cnblogs.com/ilekoaiq/p/8849217.html" target="_blank" rel="noopener">Madgwick算法详细解读</a>。</p><p>梯度下降法的迭代过程，也可以只用一步来简化，即认为一步就可以近似达到最佳估计值。那就是要设置步长$\mu_t$，使得迭代一次就能够接近最佳估计值，</p><p>$\mu_t = \eta||^S_E\dot{q}_{w,t-1,t}||\Delta t$，其中，$\eta \geq 1$，是一个根据实际情况调节的量，用来弥补加速度计和磁力计的测量误差。</p><p>因此，简化后的$^S_Eq_{\bigtriangledown, t}$为，</p><p>$^S_Eq_{\bigtriangledown, t} = ^S_E\hat{q}_{est,t-1} - \mu_t\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||}$</p><p>$= ^S_E\hat{q}_{est,t-1} - (\eta||^S_E\dot{q}_{w,t-1,t}||\Delta t)\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||}$</p><p>$^S_E\hat{q}_{est,t-1} - (\eta||\frac{1}{2}^S_E\hat{q}_{est,t-1}\otimes ^Sw_t||\Delta t)\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||}$</p><h2 id="2-3-加权融合"><a href="#2-3-加权融合" class="headerlink" title="2.3 加权融合"></a>2.3 加权融合</h2><p>互补滤波的方法将两个部分的加权平均，</p><p>$^S_Eq_{est,t} = \alpha_1\ ^S_Eq_{w,t} + \alpha_2\ ^S_Eq_{\bigtriangledown,t}$,</p><p>其中，$\alpha_1 + \alpha_2 = 1$，$0 \leq \alpha_1 \leq 1$，$0 \leq \alpha_2 \leq 1$。$\alpha_1$和$\alpha_2$是加权系数，它们是由各自的误差占总体误差的比重所决定的，误差所占的比重越小则加权系数越大。</p><p>设采样间隔为$\Delta t$，陀螺仪的单位误差$\beta$可以通过查手册得到，那么陀螺仪的误差为$\beta \Delta t$。而加速度计磁场计共同算出的姿态的误差是由计算方法决定的，计算方法如梯度下降法、高斯牛顿迭代法、牛顿法、共轭梯度法等，由于采用的方法是梯度下降法，所以其误差为梯度下降法中所选取的步长$\mu_t$，步长越长则其计算结果的误差越大。所以，总体误差为$\beta \Delta t + \mu_t$。</p><p>$\alpha_1$是陀螺仪的姿态加权系数，$\alpha_1 = 1 - \frac{\beta \Delta t}{\beta \Delta t + \mu_t}$。</p><p>$\alpha_2$是加速度计和磁力计的姿态加权系数，$\alpha_2 = \alpha_1 = 1 - \frac{\mu_t}{\beta \Delta t + \mu_t}$。</p><p>所以，</p><p>$^S_Eq_{est,t} = \alpha_1\ ^S_Eq_{w,t} + \alpha_2\ ^S_Eq_{\bigtriangledown,t}$</p><p>$= (1-\frac{\beta\Delta t}{\beta\Delta t + \mu_t})(^S_E\hat{q}_{est,t-1} + ^S_E\dot{q}_{w,t-1,t}\Delta t) + (1-\frac{\mu_t}{\beta\Delta t + \mu_t})(^S_E\hat{q}_{est,t-1} - \mu_t\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||})$</p><p>$= ^S_E\hat{q}_{est,t-1} + \frac{\mu_t}{\beta\Delta t + \mu_t}^S_E\dot{q}_{w,t-1,t}\Delta t - \frac{\beta\Delta t}{\beta\Delta t + \mu_t}\mu_t\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||}$</p><p>$= ^S_E\hat{q}_{est,t-1} + \frac{\eta||^S_E\dot{q}_{w,t-1,t}||\Delta t}{\beta\Delta t + \eta||^S_E\dot{q}_{w,t-1,t}||\Delta t}^S_E\dot{q}_{w,t-1,t}\Delta t - \frac{\beta\Delta t}{\beta\Delta t + \eta||^S_E\dot{q}_{w,t-1,t}||}\eta||^S_E\dot{q}_{w,t-1,t}||\Delta t\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||}$</p><p>$= ^S_E\hat{q}_{est,t-1}+ \frac{\eta||^S_E\hat{q}_{est,t-1}||}{\beta + \eta||^S_E\hat{q}_{est,t-1}||}(\frac{1}{2}^S_E\hat{q}_{est,t-1}\otimes ^Sw_t)\Delta t - \frac{\beta}{\beta + \eta||^S_E\hat{q}_{est,t-1}||}\eta||\frac{1}{2}^S_E\hat{q}_{est,t-1}\otimes ^Sw_t||\Delta t\frac{\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)}{||\bigtriangledown f(^{S}_{E}\hat{q}_{est,t-1}, ^E\hat{y}, ^S\hat{y}_t)||}$.</p><h2 id="2-4-系统流程图"><a href="#2-4-系统流程图" class="headerlink" title="2.4 系统流程图"></a>2.4 系统流程图</h2><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-08-081943.png" alt="image-20191208161930373" style="zoom:50%;"></p><h2 id="2-5-磁力计校准"><a href="#2-5-磁力计校准" class="headerlink" title="2.5 磁力计校准"></a>2.5 磁力计校准</h2><ul><li>磁力计易受外界地磁干扰，导致地磁测量数据误差较大</li><li>磁力计本身也具有误差，例如漂移、制造误差等</li><li><p>如果使用磁力计估计姿态，为了获取精确地姿态，需要对磁力计进行校准</p></li><li><p>主要思想</p><ul><li>利用加速度计来校准磁力计</li><li>因为加速度计不收外界干扰，仅有其自身传感器相关误差</li><li>采用最优化算法来估计最优姿态，继而校准磁力计</li></ul></li></ul><p>根据论文和参考<a href="https://www.cnblogs.com/ilekoaiq/p/8849217.html" target="_blank" rel="noopener">Madgwick算法详细解读</a>，磁力计校准过程描述如下。</p><p>在传感器刚开始运行的时候，即第一帧的时候，传感器可能处于任意一种姿态，几乎不会是水平静止朝北的，所以磁场计的输出$^S\hat{m}_0$几乎不会是$^E\hat{b}_0$。所以，$^E\hat{b}_0$是未知的。此时，可利用加速度计来估计姿态，</p><p>$^S\hat{a}_0 = ^S_Eq_0 \otimes ^E\hat{g} \otimes ^S_Eq^*_0$,</p><p>用旋转矩阵R表示为，</p><p>$^S\hat{a}_0^T = R ^E\hat{g}$.</p><p>在上式中，$^S\hat{a}_0$和$^E\hat{g}$是已知的，所以可以由上式再反过来去求出第一帧的姿态$^S_Eq_0$，转换成R，使得f最小，</p><p>$\epsilon = R\ ^E\hat{g}^T - ^S\hat{a}^T_0$,</p><p>$f = \epsilon^T\epsilon = (R\ ^E\hat{g}^T - ^S\hat{a}_0^T)^T(R\ ^E\hat{g}^T - ^S\hat{a}_0^T)$.</p><p>用高斯牛顿迭代法来寻找这个最佳的四元数，其雅克比矩阵为，</p><p>$J = [\frac{\partial \epsilon}{\partial q_0}\ \frac{\partial \epsilon}{\partial q_1}\ \frac{\partial \epsilon}{\partial q_2}\ \frac{\partial \epsilon}{\partial q_3}]$.</p><p>假设当前四元数各个元素的误差为4行1列的矩阵x，那么$Jx = \epsilon$。采用最小二乘法计算x，</p><p>$x = (J^TJ)^{-1}\epsilon$.</p><p>所以，现有的四元数的值减去误差，得到新的四元数，</p><p>$,^S_E\hat{q}_{0,k+1} = ^S_E\hat{q}_{0,k} - x = ^S_E\hat{q}_{0,k+1} - (J^TJ)^{-1}J^T\epsilon$</p><p>其中，$^S_E\hat{q}_{0}$的初始值可以设为$[1\ 0\ 0\ 0]$。</p><p>重复上述公式，迭代多次，直到f达到最小值。</p><p>于是就得到加速度计估计出的第一帧的姿态$^S_E\hat{q}_{0}$。</p><p>根据四元数的坐标系旋转性质，可以把坐标系转到水平的位置上，但并不能保证朝北。对于向量来讲，坐标系逆着四元数转回去，就相当于是向量顺着四元数继续转，得到在这个水平坐标系中的磁场的向量$^E\hat{h}_0$。</p><p>其中，$h_x$和$h_y$是$b_x$在这个坐标系中的x轴和y轴上的分量，得到$^E\hat{b}_0 = [0\ \sqrt{h_x^2 + h_y^2}\ 0\ h_z]$.</p><p>以上是第一帧的时候得到$^E\hat{b}_0$的方法。</p><p>再将加速度计估计出来的姿态$^S_E\hat{q}_{0}$作为初值，将$^E\hat{g}$、$^S\hat{a}_0$、$^E\hat{b}_0$、$^S\hat{m}_0$代入之前公式中，用梯度下降法迭代，得到高精度的第一帧的姿态$^S_E\hat{q}_{0}$。</p><p>当物体发生运动之后，由于周围环境的影响，每一帧都要对$^E\hat{b}_t$进行修正，假设上一针的最佳的姿态估计为$^S_R\hat{q}_{est,t-1}$，那么这一帧的$^E\hat{b}_t$为</p><p>$^E\hat{h}_t = [0\ h_x\ h_y\ h_z] = ^S_R\hat{q}_{est,t-1} \otimes ^S\hat{m}_t \otimes ^S_R\hat{q}_{est,t-1}^*$,</p><p>$^E\hat{b}_t  = [0\ \sqrt{h_x^2 + h_y^2}\ 0\ h_z]$.</p><p>这样的校准计算可以将外界的电磁干扰影响约束在对传感器指向的方向估计中。而且不需要预先给定地磁方向。</p><h2 id="2-6-陀螺仪零点漂移校准"><a href="#2-6-陀螺仪零点漂移校准" class="headerlink" title="2.6 陀螺仪零点漂移校准"></a>2.6 陀螺仪零点漂移校准</h2><ul><li>陀螺仪的零飘受温度和运动等因素的影响</li><li>本文提出陀螺仪的零飘可通过姿态变化率来进行弥补</li></ul><p>修正方法如下：</p><p>$^S_E\dot{\hat{q}}_{\epsilon}$代表了陀螺仪在各个轴的角误差，使用前文提到的$^S_E\dot{q}_{w,t} = \frac{1}{2}^S_E\hat{q}_{est,t-1}\otimes ^Sw_t$公式的逆运算可以得出陀螺仪当前度数的可能偏差为$^Sw_{\epsilon, t} = 2^S_E\hat{q}^*_{est,t-1}\otimes ^S_E\dot{\hat{q}}_{\epsilon,t}$。</p><p>那么，陀螺仪随着时间的漂移量为$^Sw_{b,t} = \zeta\sum\ ^Sw_{\epsilon,t}\Delta t$。</p><p>最后，得到校正后的陀螺仪读数为$^Sw_{\epsilon,t} = ^Sw_{t} - ^Sw_{b,t}$。</p><h2 id="2-7-算法的整体流程"><a href="#2-7-算法的整体流程" class="headerlink" title="2.7 算法的整体流程"></a>2.7 算法的整体流程</h2><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-08-125136.png" alt="image-20191208205128064"></p><h1 id="3-实验评测"><a href="#3-实验评测" class="headerlink" title="3. 实验评测"></a>3. 实验评测</h1><h2 id="3-1-实验设置"><a href="#3-1-实验设置" class="headerlink" title="3.1 实验设置"></a>3.1 实验设置</h2><ul><li>传感器<ul><li>xsens MTx orientation sensor</li><li>tri-axis gyroscopes, accelerometers and magnetometers</li><li>512 Hz</li></ul></li><li>对比算法<ul><li>Kalman-based orientation filter</li></ul></li><li>真值<ul><li>A Vicon system</li></ul></li></ul><h2 id="3-2-实验结果"><a href="#3-2-实验结果" class="headerlink" title="3.2 实验结果"></a>3.2 实验结果</h2><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-08-125811.png" alt="image-20191208205742715"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-08-125832.png" alt="image-20191208205816720"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-08-130056.png" alt="image-20191208205959230"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-08-130351.png" alt="image-20191208210044291"></p><h1 id="5-代码实现"><a href="#5-代码实现" class="headerlink" title="5. 代码实现"></a>5. 代码实现</h1><h2 id="5-1-论文源码"><a href="#5-1-论文源码" class="headerlink" title="5.1 论文源码"></a>5.1 论文源码</h2><ul><li>加速度计和陀螺仪</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// System constants</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> deltat 0.001f <span class="comment">// sampling period in seconds (shown as 1 ms)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> gyroMeasError 3.14159265358979f * (5.0f / 180.0f) <span class="comment">// gyroscope measurement error in rad/s (shown as 5 deg/s)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> beta sqrt(3.0f / 4.0f) * gyroMeasError <span class="comment">// compute beta</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Global system variables</span></span><br><span class="line"><span class="keyword">float</span> a_x, a_y, a_z; <span class="comment">// accelerometer measurements</span></span><br><span class="line"><span class="keyword">float</span> w_x, w_y, w_z; <span class="comment">// gyroscope measurements in rad/s</span></span><br><span class="line"><span class="keyword">float</span> SEq_1 = <span class="number">1.0f</span>, SEq_2 = <span class="number">0.0f</span>, SEq_3 = <span class="number">0.0f</span>, SEq_4 = <span class="number">0.0f</span>; <span class="comment">// estimated orientation quaternion elements with initial conditions</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">filterUpdate</span><span class="params">(<span class="keyword">float</span> w_x, <span class="keyword">float</span> w_y, <span class="keyword">float</span> w_z, <span class="keyword">float</span> a_x, <span class="keyword">float</span> a_y, <span class="keyword">float</span> a_z)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Local system variables</span></span><br><span class="line">  <span class="keyword">float</span> norm; <span class="comment">// vector norm</span></span><br><span class="line">  <span class="keyword">float</span> SEqDot_omega_1, SEqDot_omega_2, SEqDot_omega_3, SEqDot_omega_4; <span class="comment">// quaternion derrivative from gyroscopes elements</span></span><br><span class="line">  <span class="keyword">float</span> f_1, f_2, f_3; <span class="comment">// objective function elements</span></span><br><span class="line">  <span class="keyword">float</span> J_11or24, J_12or23, J_13or22, J_14or21, J_32, J_33; <span class="comment">// objective function Jacobian elements</span></span><br><span class="line">  <span class="keyword">float</span> SEqHatDot_1, SEqHatDot_2, SEqHatDot_3, SEqHatDot_4; <span class="comment">// estimated direction of the gyroscope error</span></span><br><span class="line">  <span class="comment">// Axulirary variables to avoid reapeated calcualtions</span></span><br><span class="line">  <span class="keyword">float</span> halfSEq_1 = <span class="number">0.5f</span> * SEq_1;</span><br><span class="line">  <span class="keyword">float</span> halfSEq_2 = <span class="number">0.5f</span> * SEq_2;</span><br><span class="line">  <span class="keyword">float</span> halfSEq_3 = <span class="number">0.5f</span> * SEq_3;</span><br><span class="line">  <span class="keyword">float</span> halfSEq_4 = <span class="number">0.5f</span> * SEq_4;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_1 = <span class="number">2.0f</span> * SEq_1;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_2 = <span class="number">2.0f</span> * SEq_2;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_3 = <span class="number">2.0f</span> * SEq_3;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Normalise the accelerometer measurement</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(a_x * a_x + a_y * a_y + a_z * a_z);</span><br><span class="line">  a_x /= norm;</span><br><span class="line">  a_y /= norm;</span><br><span class="line">  a_z /= norm;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Compute the objective function and Jacobian</span></span><br><span class="line">  f_1 = twoSEq_2 * SEq_4 - twoSEq_1 * SEq_3 - a_x;</span><br><span class="line">  f_2 = twoSEq_1 * SEq_2 + twoSEq_3 * SEq_4 - a_y;</span><br><span class="line">  f_3 = <span class="number">1.0f</span> - twoSEq_2 * SEq_2 - twoSEq_3 * SEq_3 - a_z;</span><br><span class="line">  J_11or24 = twoSEq_3; <span class="comment">// J_11 negated in matrix multiplication</span></span><br><span class="line">  J_12or23 = <span class="number">2.0f</span> * SEq_4;</span><br><span class="line">  J_13or22 = twoSEq_1; <span class="comment">// J_12 negated in matrix multiplication</span></span><br><span class="line">  J_14or21 = twoSEq_2;</span><br><span class="line">  J_32 = <span class="number">2.0f</span> * J_14or21; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_33 = <span class="number">2.0f</span> * J_11or24; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Compute the gradient (matrix multiplication)</span></span><br><span class="line">  SEqHatDot_1 = J_14or21 * f_2 - J_11or24 * f_1;</span><br><span class="line">  SEqHatDot_2 = J_12or23 * f_1 + J_13or22 * f_2 - J_32 * f_3;</span><br><span class="line">  SEqHatDot_3 = J_12or23 * f_2 - J_33 * f_3 - J_13or22 * f_1;</span><br><span class="line">  SEqHatDot_4 = J_14or21 * f_1 + J_11or24 * f_2;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Normalise the gradient</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(SEqHatDot_1 * SEqHatDot_1 + SEqHatDot_2 * SEqHatDot_2 + SEqHatDot_3 * SEqHatDot_3 + SEqHatDot_4 * SEqHatDot_4);</span><br><span class="line">  SEqHatDot_1 /= norm;</span><br><span class="line">  SEqHatDot_2 /= norm;</span><br><span class="line">  SEqHatDot_3 /= norm;</span><br><span class="line">  SEqHatDot_4 /= norm;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Compute the quaternion derrivative measured by gyroscopes</span></span><br><span class="line">  SEqDot_omega_1 = -halfSEq_2 * w_x - halfSEq_3 * w_y - halfSEq_4 * w_z;</span><br><span class="line">  SEqDot_omega_2 = halfSEq_1 * w_x + halfSEq_3 * w_z - halfSEq_4 * w_y;</span><br><span class="line">  SEqDot_omega_3 = halfSEq_1 * w_y - halfSEq_2 * w_z + halfSEq_4 * w_x;</span><br><span class="line">  SEqDot_omega_4 = halfSEq_1 * w_z + halfSEq_2 * w_y - halfSEq_3 * w_x;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Compute then integrate the estimated quaternion derrivative</span></span><br><span class="line">  SEq_1 += (SEqDot_omega_1 - (beta * SEqHatDot_1)) * deltat;</span><br><span class="line">  SEq_2 += (SEqDot_omega_2 - (beta * SEqHatDot_2)) * deltat;</span><br><span class="line">  SEq_3 += (SEqDot_omega_3 - (beta * SEqHatDot_3)) * deltat;</span><br><span class="line">  SEq_4 += (SEqDot_omega_4 - (beta * SEqHatDot_4)) * deltat;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Normalise quaternion</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(SEq_1 * SEq_1 + SEq_2 * SEq_2 + SEq_3 * SEq_3 + SEq_4 * SEq_4);</span><br><span class="line">  SEq_1 /= norm;</span><br><span class="line">  SEq_2 /= norm;</span><br><span class="line">  SEq_3 /= norm;</span><br><span class="line">  SEq_4 /= norm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>加速度计、陀螺仪和磁力计</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Math library required for `sqrt'</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// System constants</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> deltat 0.001f <span class="comment">// sampling period in seconds (shown as 1 ms)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> gyroMeasError 3.14159265358979 * (5.0f / 180.0f) <span class="comment">// gyroscope measurement error in rad/s (shown as 5 deg/s)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> gyroMeasDrift 3.14159265358979 * (0.2f / 180.0f) <span class="comment">// gyroscope measurement error in rad/s/s (shown as 0.2f deg/s/s)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> beta sqrt(3.0f / 4.0f) * gyroMeasError <span class="comment">// compute beta</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> zeta sqrt(3.0f / 4.0f) * gyroMeasDrift <span class="comment">// compute zeta</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Global system variables</span></span><br><span class="line"><span class="keyword">float</span> a_x, a_y, a_z; <span class="comment">// accelerometer measurements</span></span><br><span class="line"><span class="keyword">float</span> w_x, w_y, w_z; <span class="comment">// gyroscope measurements in rad/s</span></span><br><span class="line"><span class="keyword">float</span> m_x, m_y, m_z; <span class="comment">// magnetometer measurements</span></span><br><span class="line"><span class="keyword">float</span> SEq_1 = <span class="number">1</span>, SEq_2 = <span class="number">0</span>, SEq_3 = <span class="number">0</span>, SEq_4 = <span class="number">0</span>; <span class="comment">// estimated orientation quaternion elements with initial conditions</span></span><br><span class="line"><span class="keyword">float</span> b_x = <span class="number">1</span>, b_z = <span class="number">0</span>; <span class="comment">// reference direction of flux in earth frame</span></span><br><span class="line"><span class="keyword">float</span> w_bx = <span class="number">0</span>, w_by = <span class="number">0</span>, w_bz = <span class="number">0</span>; <span class="comment">// estimate gyroscope biases error</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">filterUpdate</span><span class="params">(<span class="keyword">float</span> w_x, <span class="keyword">float</span> w_y, <span class="keyword">float</span> w_z, <span class="keyword">float</span> a_x, <span class="keyword">float</span> a_y, <span class="keyword">float</span> a_z, <span class="keyword">float</span> m_x, <span class="keyword">float</span> m_y, <span class="keyword">float</span> m_z)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// local system variables</span></span><br><span class="line">  <span class="keyword">float</span> norm; <span class="comment">// vector norm</span></span><br><span class="line">  <span class="keyword">float</span> SEqDot_omega_1, SEqDot_omega_2, SEqDot_omega_3, SEqDot_omega_4; <span class="comment">// quaternion rate from gyroscopes elements</span></span><br><span class="line">  <span class="keyword">float</span> f_1, f_2, f_3, f_4, f_5, f_6; <span class="comment">// objective function elements</span></span><br><span class="line">  <span class="keyword">float</span> J_11or24, J_12or23, J_13or22, J_14or21, J_32, J_33, <span class="comment">// objective function Jacobian elements</span></span><br><span class="line">  J_41, J_42, J_43, J_44, J_51, J_52, J_53, J_54, J_61, J_62, J_63, J_64; <span class="comment">//</span></span><br><span class="line">  <span class="keyword">float</span> SEqHatDot_1, SEqHatDot_2, SEqHatDot_3, SEqHatDot_4; <span class="comment">// estimated direction of the gyroscope error</span></span><br><span class="line">  <span class="keyword">float</span> w_err_x, w_err_y, w_err_z; <span class="comment">// estimated direction of the gyroscope error (angular)</span></span><br><span class="line">  <span class="keyword">float</span> h_x, h_y, h_z; <span class="comment">// computed flux in the earth frame</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// axulirary variables to avoid reapeated calcualtions</span></span><br><span class="line">  <span class="keyword">float</span> halfSEq_1 = <span class="number">0.5f</span> * SEq_1;</span><br><span class="line">  <span class="keyword">float</span> halfSEq_2 = <span class="number">0.5f</span> * SEq_2;</span><br><span class="line">  <span class="keyword">float</span> halfSEq_3 = <span class="number">0.5f</span> * SEq_3;</span><br><span class="line">  <span class="keyword">float</span> halfSEq_4 = <span class="number">0.5f</span> * SEq_4;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_1 = <span class="number">2.0f</span> * SEq_1;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_2 = <span class="number">2.0f</span> * SEq_2;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_3 = <span class="number">2.0f</span> * SEq_3;</span><br><span class="line">  <span class="keyword">float</span> twoSEq_4 = <span class="number">2.0f</span> * SEq_4;</span><br><span class="line">  <span class="keyword">float</span> twob_x = <span class="number">2.0f</span> * b_x;</span><br><span class="line">  <span class="keyword">float</span> twob_z = <span class="number">2.0f</span> * b_z;</span><br><span class="line">  <span class="keyword">float</span> twob_xSEq_1 = <span class="number">2.0f</span> * b_x * SEq_1;</span><br><span class="line">  <span class="keyword">float</span> twob_xSEq_2 = <span class="number">2.0f</span> * b_x * SEq_2;</span><br><span class="line">  <span class="keyword">float</span> twob_xSEq_3 = <span class="number">2.0f</span> * b_x * SEq_3;</span><br><span class="line">  <span class="keyword">float</span> twob_xSEq_4 = <span class="number">2.0f</span> * b_x * SEq_4;</span><br><span class="line">  <span class="keyword">float</span> twob_zSEq_1 = <span class="number">2.0f</span> * b_z * SEq_1;</span><br><span class="line">  <span class="keyword">float</span> twob_zSEq_2 = <span class="number">2.0f</span> * b_z * SEq_2;</span><br><span class="line">  <span class="keyword">float</span> twob_zSEq_3 = <span class="number">2.0f</span> * b_z * SEq_3;</span><br><span class="line">  <span class="keyword">float</span> twob_zSEq_4 = <span class="number">2.0f</span> * b_z * SEq_4;</span><br><span class="line">  <span class="keyword">float</span> SEq_1SEq_2;</span><br><span class="line">  <span class="keyword">float</span> SEq_1SEq_3 = SEq_1 * SEq_3;</span><br><span class="line">  <span class="keyword">float</span> SEq_1SEq_4;</span><br><span class="line">  <span class="keyword">float</span> SEq_2SEq_3;</span><br><span class="line">  <span class="keyword">float</span> SEq_2SEq_4 = SEq_2 * SEq_4;</span><br><span class="line">  <span class="keyword">float</span> SEq_3SEq_4;</span><br><span class="line">  <span class="keyword">float</span> twom_x = <span class="number">2.0f</span> * m_x;</span><br><span class="line">  <span class="keyword">float</span> twom_y = <span class="number">2.0f</span> * m_y;</span><br><span class="line">  <span class="keyword">float</span> twom_z = <span class="number">2.0f</span> * m_z;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// normalise the accelerometer measurement</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(a_x * a_x + a_y * a_y + a_z * a_z);</span><br><span class="line">  a_x /= norm;</span><br><span class="line">  a_y /= norm;</span><br><span class="line">  a_z /= norm;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// normalise the magnetometer measurement</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(m_x * m_x + m_y * m_y + m_z * m_z);</span><br><span class="line">  m_x /= norm;</span><br><span class="line">  m_y /= norm;</span><br><span class="line">  m_z /= norm;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute the objective function and Jacobian</span></span><br><span class="line">  f_1 = twoSEq_2 * SEq_4 - twoSEq_1 * SEq_3 - a_x;</span><br><span class="line">  f_2 = twoSEq_1 * SEq_2 + twoSEq_3 * SEq_4 - a_y;</span><br><span class="line">  f_3 = <span class="number">1.0f</span> - twoSEq_2 * SEq_2 - twoSEq_3 * SEq_3 - a_z;</span><br><span class="line">  f_4 = twob_x * (<span class="number">0.5f</span> - SEq_3 * SEq_3 - SEq_4 * SEq_4) + twob_z * (SEq_2SEq_4 - SEq_1SEq_3) - m_x;</span><br><span class="line">  f_5 = twob_x * (SEq_2 * SEq_3 - SEq_1 * SEq_4) + twob_z * (SEq_1 * SEq_2 + SEq_3 * SEq_4) - m_y;</span><br><span class="line">  f_6 = twob_x * (SEq_1SEq_3 + SEq_2SEq_4) + twob_z * (<span class="number">0.5f</span> - SEq_2 * SEq_2 - SEq_3 * SEq_3) - m_z;</span><br><span class="line">  J_11or24 = twoSEq_3; <span class="comment">// J_11 negated in matrix multiplication</span></span><br><span class="line">  J_12or23 = <span class="number">2.0f</span> * SEq_4;</span><br><span class="line">  J_13or22 = twoSEq_1; <span class="comment">// J_12 negated in matrix multiplication</span></span><br><span class="line">  J_14or21 = twoSEq_2;</span><br><span class="line">  J_32 = <span class="number">2.0f</span> * J_14or21; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_33 = <span class="number">2.0f</span> * J_11or24; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_41 = twob_zSEq_3; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_42 = twob_zSEq_4;</span><br><span class="line">  J_43 = <span class="number">2.0f</span> * twob_xSEq_3 + twob_zSEq_1; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_44 = <span class="number">2.0f</span> * twob_xSEq_4 - twob_zSEq_2; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_51 = twob_xSEq_4 - twob_zSEq_2; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_52 = twob_xSEq_3 + twob_zSEq_1;</span><br><span class="line">  J_53 = twob_xSEq_2 + twob_zSEq_4;</span><br><span class="line">  J_54 = twob_xSEq_1 - twob_zSEq_3; <span class="comment">// negated in matrix multiplication</span></span><br><span class="line">  J_61 = twob_xSEq_3;</span><br><span class="line">  J_62 = twob_xSEq_4 - <span class="number">2.0f</span> * twob_zSEq_2;</span><br><span class="line">  J_63 = twob_xSEq_1 - <span class="number">2.0f</span> * twob_zSEq_3;</span><br><span class="line">  J_64 = twob_xSEq_2;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute the gradient (matrix multiplication)</span></span><br><span class="line">  SEqHatDot_1 = J_14or21 * f_2 - J_11or24 * f_1 - J_41 * f_4 - J_51 * f_5 + J_61 * f_6;</span><br><span class="line">  SEqHatDot_2 = J_12or23 * f_1 + J_13or22 * f_2 - J_32 * f_3 + J_42 * f_4 + J_52 * f_5 + J_62 * f_6;</span><br><span class="line">  SEqHatDot_3 = J_12or23 * f_2 - J_33 * f_3 - J_13or22 * f_1 - J_43 * f_4 + J_53 * f_5 + J_63 * f_6;</span><br><span class="line">  SEqHatDot_4 = J_14or21 * f_1 + J_11or24 * f_2 - J_44 * f_4 - J_54 * f_5 + J_64 * f_6;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// normalise the gradient to estimate direction of the gyroscope error</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(SEqHatDot_1 * SEqHatDot_1 + SEqHatDot_2 * SEqHatDot_2 + SEqHatDot_3 * SEqHatDot_3 + SEqHatDot_4 * SEqHatDot_4);</span><br><span class="line">  SEqHatDot_1 = SEqHatDot_1 / norm;</span><br><span class="line">  SEqHatDot_2 = SEqHatDot_2 / norm;</span><br><span class="line">    SEqHatDot_3 = SEqHatDot_3 / norm;</span><br><span class="line">  SEqHatDot_4 = SEqHatDot_4 / norm;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute angular estimated direction of the gyroscope error</span></span><br><span class="line">  w_err_x = twoSEq_1 * SEqHatDot_2 - twoSEq_2 * SEqHatDot_1 - twoSEq_3 * SEqHatDot_4 + twoSEq_4 * SEqHatDot_3;</span><br><span class="line">  w_err_y = twoSEq_1 * SEqHatDot_3 + twoSEq_2 * SEqHatDot_4 - twoSEq_3 * SEqHatDot_1 - twoSEq_4 * SEqHatDot_2;</span><br><span class="line">  w_err_z = twoSEq_1 * SEqHatDot_4 - twoSEq_2 * SEqHatDot_3 + twoSEq_3 * SEqHatDot_2 - twoSEq_4 * SEqHatDot_1;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute and remove the gyroscope baises</span></span><br><span class="line">  w_bx += w_err_x * deltat * zeta;</span><br><span class="line">  w_by += w_err_y * deltat * zeta;</span><br><span class="line">  w_bz += w_err_z * deltat * zeta;</span><br><span class="line">  w_x -= w_bx;</span><br><span class="line">  w_y -= w_by;</span><br><span class="line">  w_z -= w_bz;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute the quaternion rate measured by gyroscopes</span></span><br><span class="line">  SEqDot_omega_1 = -halfSEq_2 * w_x - halfSEq_3 * w_y - halfSEq_4 * w_z;</span><br><span class="line">  SEqDot_omega_2 = halfSEq_1 * w_x + halfSEq_3 * w_z - halfSEq_4 * w_y;</span><br><span class="line">  SEqDot_omega_3 = halfSEq_1 * w_y - halfSEq_2 * w_z + halfSEq_4 * w_x;</span><br><span class="line">  SEqDot_omega_4 = halfSEq_1 * w_z + halfSEq_2 * w_y - halfSEq_3 * w_x;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute then integrate the estimated quaternion rate</span></span><br><span class="line">  SEq_1 += (SEqDot_omega_1 - (beta * SEqHatDot_1)) * deltat;</span><br><span class="line">  SEq_2 += (SEqDot_omega_2 - (beta * SEqHatDot_2)) * deltat;</span><br><span class="line">  SEq_3 += (SEqDot_omega_3 - (beta * SEqHatDot_3)) * deltat;</span><br><span class="line">  SEq_4 += (SEqDot_omega_4 - (beta * SEqHatDot_4)) * deltat;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// normalise quaternion</span></span><br><span class="line">  norm = <span class="built_in">sqrt</span>(SEq_1 * SEq_1 + SEq_2 * SEq_2 + SEq_3 * SEq_3 + SEq_4 * SEq_4);</span><br><span class="line">  SEq_1 /= norm;</span><br><span class="line">  SEq_2 /= norm;</span><br><span class="line">  SEq_3 /= norm;</span><br><span class="line">  SEq_4 /= norm;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// compute flux in the earth frame</span></span><br><span class="line">  SEq_1SEq_2 = SEq_1 * SEq_2; <span class="comment">// recompute axulirary variables</span></span><br><span class="line">  SEq_1SEq_3 = SEq_1 * SEq_3;</span><br><span class="line">  SEq_1SEq_4 = SEq_1 * SEq_4;</span><br><span class="line">  SEq_3SEq_4 = SEq_3 * SEq_4;</span><br><span class="line">  SEq_2SEq_3 = SEq_2 * SEq_3;</span><br><span class="line">  SEq_2SEq_4 = SEq_2 * SEq_4;</span><br><span class="line">  h_x = twom_x * (<span class="number">0.5f</span> - SEq_3 * SEq_3 - SEq_4 * SEq_4) + twom_y * (SEq_2SEq_3 - SEq_1SEq_4) + twom_z * (SEq_2SEq_4 + SEq_1SEq_3);</span><br><span class="line">  h_y = twom_x * (SEq_2SEq_3 + SEq_1SEq_4) + twom_y * (<span class="number">0.5f</span> - SEq_2 * SEq_2 - SEq_4 * SEq_4) + twom_z * (SEq_3SEq_4 - SEq_1SEq_2);</span><br><span class="line">  h_z = twom_x * (SEq_2SEq_4 - SEq_1SEq_3) + twom_y * (SEq_3SEq_4 + SEq_1SEq_2) + twom_z * (<span class="number">0.5f</span> - SEq_2 * SEq_2 - SEq_3 * SEq_3);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// normalise the flux vector to have only components in the x and z</span></span><br><span class="line">  b_x = <span class="built_in">sqrt</span>((h_x * h_x) + (h_y * h_y));</span><br><span class="line">  b_z = h_z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-2-x-io源码"><a href="#5-2-x-io源码" class="headerlink" title="5.2 x-io源码"></a>5.2 x-io源码</h2><ul><li><a href="https://x-io.co.uk/open-source-imu-and-ahrs-algorithms/" target="_blank" rel="noopener">https://x-io.co.uk/open-source-imu-and-ahrs-algorithms/</a></li><li>MadgwickAHRS.h</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">// MadgwickAHRS.h</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Implementation of Madgwick's IMU and AHRS algorithms.</span></span><br><span class="line"><span class="comment">// See: http://www.x-io.co.uk/node/8#open_source_ahrs_and_imu_algorithms</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// DateAuthor          Notes</span></span><br><span class="line"><span class="comment">// 29/09/2011SOH Madgwick    Initial release</span></span><br><span class="line"><span class="comment">// 02/10/2011SOH MadgwickOptimised for reduced CPU load</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MadgwickAHRS_h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MadgwickAHRS_h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Variable declaration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">float</span> beta;<span class="comment">// algorithm gain</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">float</span> q0, q1, q2, q3;<span class="comment">// quaternion of sensor frame relative to auxiliary frame</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Function declarations</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MadgwickAHRSupdate</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az, <span class="keyword">float</span> mx, <span class="keyword">float</span> my, <span class="keyword">float</span> mz)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MadgwickAHRSupdateIMU</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">// End of file</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br></pre></td></tr></table></figure><ul><li>MadgwickAHRS.c</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">// MadgwickAHRS.c</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Implementation of Madgwick's IMU and AHRS algorithms.</span></span><br><span class="line"><span class="comment">// See: http://www.x-io.co.uk/node/8#open_source_ahrs_and_imu_algorithms</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// DateAuthor          Notes</span></span><br><span class="line"><span class="comment">// 29/09/2011SOH Madgwick    Initial release</span></span><br><span class="line"><span class="comment">// 02/10/2011SOH MadgwickOptimised for reduced CPU load</span></span><br><span class="line"><span class="comment">// 19/02/2012SOH MadgwickMagnetometer measurement is normalised</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Header files</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MadgwickAHRS.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Definitions</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sampleFreq512.0f<span class="comment">// sample frequency in Hz</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> betaDef0.1f<span class="comment">// 2 * proportional gain</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Variable definitions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">float</span> beta = betaDef;<span class="comment">// 2 * proportional gain (Kp)</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">float</span> q0 = <span class="number">1.0f</span>, q1 = <span class="number">0.0f</span>, q2 = <span class="number">0.0f</span>, q3 = <span class="number">0.0f</span>;<span class="comment">// quaternion of sensor frame relative to auxiliary frame</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Function declarations</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">invSqrt</span><span class="params">(<span class="keyword">float</span> x)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//====================================================================================================</span></span><br><span class="line"><span class="comment">// Functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// AHRS algorithm update</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MadgwickAHRSupdate</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az, <span class="keyword">float</span> mx, <span class="keyword">float</span> my, <span class="keyword">float</span> mz)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> recipNorm;</span><br><span class="line"><span class="keyword">float</span> s0, s1, s2, s3;</span><br><span class="line"><span class="keyword">float</span> qDot1, qDot2, qDot3, qDot4;</span><br><span class="line"><span class="keyword">float</span> hx, hy;</span><br><span class="line"><span class="keyword">float</span> _2q0mx, _2q0my, _2q0mz, _2q1mx, _2bx, _2bz, _4bx, _4bz, _2q0, _2q1, _2q2, _2q3, _2q0q2, _2q2q3, q0q0, q0q1, q0q2, q0q3, q1q1, q1q2, q1q3, q2q2, q2q3, q3q3;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use IMU algorithm if magnetometer measurement invalid (avoids NaN in magnetometer normalisation)</span></span><br><span class="line"><span class="keyword">if</span>((mx == <span class="number">0.0f</span>) &amp;&amp; (my == <span class="number">0.0f</span>) &amp;&amp; (mz == <span class="number">0.0f</span>)) &#123;</span><br><span class="line">MadgwickAHRSupdateIMU(gx, gy, gz, ax, ay, az);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rate of change of quaternion from gyroscope</span></span><br><span class="line">qDot1 = <span class="number">0.5f</span> * (-q1 * gx - q2 * gy - q3 * gz);</span><br><span class="line">qDot2 = <span class="number">0.5f</span> * (q0 * gx + q2 * gz - q3 * gy);</span><br><span class="line">qDot3 = <span class="number">0.5f</span> * (q0 * gy - q1 * gz + q3 * gx);</span><br><span class="line">qDot4 = <span class="number">0.5f</span> * (q0 * gz + q1 * gy - q2 * gx);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compute feedback only if accelerometer measurement valid (avoids NaN in accelerometer normalisation)</span></span><br><span class="line"><span class="keyword">if</span>(!((ax == <span class="number">0.0f</span>) &amp;&amp; (ay == <span class="number">0.0f</span>) &amp;&amp; (az == <span class="number">0.0f</span>))) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise accelerometer measurement</span></span><br><span class="line">recipNorm = invSqrt(ax * ax + ay * ay + az * az);</span><br><span class="line">ax *= recipNorm;</span><br><span class="line">ay *= recipNorm;</span><br><span class="line">az *= recipNorm;   </span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise magnetometer measurement</span></span><br><span class="line">recipNorm = invSqrt(mx * mx + my * my + mz * mz);</span><br><span class="line">mx *= recipNorm;</span><br><span class="line">my *= recipNorm;</span><br><span class="line">mz *= recipNorm;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Auxiliary variables to avoid repeated arithmetic</span></span><br><span class="line">_2q0mx = <span class="number">2.0f</span> * q0 * mx;</span><br><span class="line">_2q0my = <span class="number">2.0f</span> * q0 * my;</span><br><span class="line">_2q0mz = <span class="number">2.0f</span> * q0 * mz;</span><br><span class="line">_2q1mx = <span class="number">2.0f</span> * q1 * mx;</span><br><span class="line">_2q0 = <span class="number">2.0f</span> * q0;</span><br><span class="line">_2q1 = <span class="number">2.0f</span> * q1;</span><br><span class="line">_2q2 = <span class="number">2.0f</span> * q2;</span><br><span class="line">_2q3 = <span class="number">2.0f</span> * q3;</span><br><span class="line">_2q0q2 = <span class="number">2.0f</span> * q0 * q2;</span><br><span class="line">_2q2q3 = <span class="number">2.0f</span> * q2 * q3;</span><br><span class="line">q0q0 = q0 * q0;</span><br><span class="line">q0q1 = q0 * q1;</span><br><span class="line">q0q2 = q0 * q2;</span><br><span class="line">q0q3 = q0 * q3;</span><br><span class="line">q1q1 = q1 * q1;</span><br><span class="line">q1q2 = q1 * q2;</span><br><span class="line">q1q3 = q1 * q3;</span><br><span class="line">q2q2 = q2 * q2;</span><br><span class="line">q2q3 = q2 * q3;</span><br><span class="line">q3q3 = q3 * q3;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reference direction of Earth's magnetic field</span></span><br><span class="line">hx = mx * q0q0 - _2q0my * q3 + _2q0mz * q2 + mx * q1q1 + _2q1 * my * q2 + _2q1 * mz * q3 - mx * q2q2 - mx * q3q3;</span><br><span class="line">hy = _2q0mx * q3 + my * q0q0 - _2q0mz * q1 + _2q1mx * q2 - my * q1q1 + my * q2q2 + _2q2 * mz * q3 - my * q3q3;</span><br><span class="line">_2bx = <span class="built_in">sqrt</span>(hx * hx + hy * hy);</span><br><span class="line">_2bz = -_2q0mx * q2 + _2q0my * q1 + mz * q0q0 + _2q1mx * q3 - mz * q1q1 + _2q2 * my * q3 - mz * q2q2 + mz * q3q3;</span><br><span class="line">_4bx = <span class="number">2.0f</span> * _2bx;</span><br><span class="line">_4bz = <span class="number">2.0f</span> * _2bz;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gradient decent algorithm corrective step</span></span><br><span class="line">s0 = -_2q2 * (<span class="number">2.0f</span> * q1q3 - _2q0q2 - ax) + _2q1 * (<span class="number">2.0f</span> * q0q1 + _2q2q3 - ay) - _2bz * q2 * (_2bx * (<span class="number">0.5f</span> - q2q2 - q3q3) + _2bz * (q1q3 - q0q2) - mx) + (-_2bx * q3 + _2bz * q1) * (_2bx * (q1q2 - q0q3) + _2bz * (q0q1 + q2q3) - my) + _2bx * q2 * (_2bx * (q0q2 + q1q3) + _2bz * (<span class="number">0.5f</span> - q1q1 - q2q2) - mz);</span><br><span class="line">s1 = _2q3 * (<span class="number">2.0f</span> * q1q3 - _2q0q2 - ax) + _2q0 * (<span class="number">2.0f</span> * q0q1 + _2q2q3 - ay) - <span class="number">4.0f</span> * q1 * (<span class="number">1</span> - <span class="number">2.0f</span> * q1q1 - <span class="number">2.0f</span> * q2q2 - az) + _2bz * q3 * (_2bx * (<span class="number">0.5f</span> - q2q2 - q3q3) + _2bz * (q1q3 - q0q2) - mx) + (_2bx * q2 + _2bz * q0) * (_2bx * (q1q2 - q0q3) + _2bz * (q0q1 + q2q3) - my) + (_2bx * q3 - _4bz * q1) * (_2bx * (q0q2 + q1q3) + _2bz * (<span class="number">0.5f</span> - q1q1 - q2q2) - mz);</span><br><span class="line">s2 = -_2q0 * (<span class="number">2.0f</span> * q1q3 - _2q0q2 - ax) + _2q3 * (<span class="number">2.0f</span> * q0q1 + _2q2q3 - ay) - <span class="number">4.0f</span> * q2 * (<span class="number">1</span> - <span class="number">2.0f</span> * q1q1 - <span class="number">2.0f</span> * q2q2 - az) + (-_4bx * q2 - _2bz * q0) * (_2bx * (<span class="number">0.5f</span> - q2q2 - q3q3) + _2bz * (q1q3 - q0q2) - mx) + (_2bx * q1 + _2bz * q3) * (_2bx * (q1q2 - q0q3) + _2bz * (q0q1 + q2q3) - my) + (_2bx * q0 - _4bz * q2) * (_2bx * (q0q2 + q1q3) + _2bz * (<span class="number">0.5f</span> - q1q1 - q2q2) - mz);</span><br><span class="line">s3 = _2q1 * (<span class="number">2.0f</span> * q1q3 - _2q0q2 - ax) + _2q2 * (<span class="number">2.0f</span> * q0q1 + _2q2q3 - ay) + (-_4bx * q3 + _2bz * q1) * (_2bx * (<span class="number">0.5f</span> - q2q2 - q3q3) + _2bz * (q1q3 - q0q2) - mx) + (-_2bx * q0 + _2bz * q2) * (_2bx * (q1q2 - q0q3) + _2bz * (q0q1 + q2q3) - my) + _2bx * q1 * (_2bx * (q0q2 + q1q3) + _2bz * (<span class="number">0.5f</span> - q1q1 - q2q2) - mz);</span><br><span class="line">recipNorm = invSqrt(s0 * s0 + s1 * s1 + s2 * s2 + s3 * s3); <span class="comment">// normalise step magnitude</span></span><br><span class="line">s0 *= recipNorm;</span><br><span class="line">s1 *= recipNorm;</span><br><span class="line">s2 *= recipNorm;</span><br><span class="line">s3 *= recipNorm;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Apply feedback step</span></span><br><span class="line">qDot1 -= beta * s0;</span><br><span class="line">qDot2 -= beta * s1;</span><br><span class="line">qDot3 -= beta * s2;</span><br><span class="line">qDot4 -= beta * s3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integrate rate of change of quaternion to yield quaternion</span></span><br><span class="line">q0 += qDot1 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">q1 += qDot2 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">q2 += qDot3 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">q3 += qDot4 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise quaternion</span></span><br><span class="line">recipNorm = invSqrt(q0 * q0 + q1 * q1 + q2 * q2 + q3 * q3);</span><br><span class="line">q0 *= recipNorm;</span><br><span class="line">q1 *= recipNorm;</span><br><span class="line">q2 *= recipNorm;</span><br><span class="line">q3 *= recipNorm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// IMU algorithm update</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MadgwickAHRSupdateIMU</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> recipNorm;</span><br><span class="line"><span class="keyword">float</span> s0, s1, s2, s3;</span><br><span class="line"><span class="keyword">float</span> qDot1, qDot2, qDot3, qDot4;</span><br><span class="line"><span class="keyword">float</span> _2q0, _2q1, _2q2, _2q3, _4q0, _4q1, _4q2 ,_8q1, _8q2, q0q0, q1q1, q2q2, q3q3;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rate of change of quaternion from gyroscope</span></span><br><span class="line">qDot1 = <span class="number">0.5f</span> * (-q1 * gx - q2 * gy - q3 * gz);</span><br><span class="line">qDot2 = <span class="number">0.5f</span> * (q0 * gx + q2 * gz - q3 * gy);</span><br><span class="line">qDot3 = <span class="number">0.5f</span> * (q0 * gy - q1 * gz + q3 * gx);</span><br><span class="line">qDot4 = <span class="number">0.5f</span> * (q0 * gz + q1 * gy - q2 * gx);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compute feedback only if accelerometer measurement valid (avoids NaN in accelerometer normalisation)</span></span><br><span class="line"><span class="keyword">if</span>(!((ax == <span class="number">0.0f</span>) &amp;&amp; (ay == <span class="number">0.0f</span>) &amp;&amp; (az == <span class="number">0.0f</span>))) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise accelerometer measurement</span></span><br><span class="line">recipNorm = invSqrt(ax * ax + ay * ay + az * az);</span><br><span class="line">ax *= recipNorm;</span><br><span class="line">ay *= recipNorm;</span><br><span class="line">az *= recipNorm;   </span><br><span class="line"></span><br><span class="line"><span class="comment">// Auxiliary variables to avoid repeated arithmetic</span></span><br><span class="line">_2q0 = <span class="number">2.0f</span> * q0;</span><br><span class="line">_2q1 = <span class="number">2.0f</span> * q1;</span><br><span class="line">_2q2 = <span class="number">2.0f</span> * q2;</span><br><span class="line">_2q3 = <span class="number">2.0f</span> * q3;</span><br><span class="line">_4q0 = <span class="number">4.0f</span> * q0;</span><br><span class="line">_4q1 = <span class="number">4.0f</span> * q1;</span><br><span class="line">_4q2 = <span class="number">4.0f</span> * q2;</span><br><span class="line">_8q1 = <span class="number">8.0f</span> * q1;</span><br><span class="line">_8q2 = <span class="number">8.0f</span> * q2;</span><br><span class="line">q0q0 = q0 * q0;</span><br><span class="line">q1q1 = q1 * q1;</span><br><span class="line">q2q2 = q2 * q2;</span><br><span class="line">q3q3 = q3 * q3;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gradient decent algorithm corrective step</span></span><br><span class="line">s0 = _4q0 * q2q2 + _2q2 * ax + _4q0 * q1q1 - _2q1 * ay;</span><br><span class="line">s1 = _4q1 * q3q3 - _2q3 * ax + <span class="number">4.0f</span> * q0q0 * q1 - _2q0 * ay - _4q1 + _8q1 * q1q1 + _8q1 * q2q2 + _4q1 * az;</span><br><span class="line">s2 = <span class="number">4.0f</span> * q0q0 * q2 + _2q0 * ax + _4q2 * q3q3 - _2q3 * ay - _4q2 + _8q2 * q1q1 + _8q2 * q2q2 + _4q2 * az;</span><br><span class="line">s3 = <span class="number">4.0f</span> * q1q1 * q3 - _2q1 * ax + <span class="number">4.0f</span> * q2q2 * q3 - _2q2 * ay;</span><br><span class="line">recipNorm = invSqrt(s0 * s0 + s1 * s1 + s2 * s2 + s3 * s3); <span class="comment">// normalise step magnitude</span></span><br><span class="line">s0 *= recipNorm;</span><br><span class="line">s1 *= recipNorm;</span><br><span class="line">s2 *= recipNorm;</span><br><span class="line">s3 *= recipNorm;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Apply feedback step</span></span><br><span class="line">qDot1 -= beta * s0;</span><br><span class="line">qDot2 -= beta * s1;</span><br><span class="line">qDot3 -= beta * s2;</span><br><span class="line">qDot4 -= beta * s3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integrate rate of change of quaternion to yield quaternion</span></span><br><span class="line">q0 += qDot1 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">q1 += qDot2 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">q2 += qDot3 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">q3 += qDot4 * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise quaternion</span></span><br><span class="line">recipNorm = invSqrt(q0 * q0 + q1 * q1 + q2 * q2 + q3 * q3);</span><br><span class="line">q0 *= recipNorm;</span><br><span class="line">q1 *= recipNorm;</span><br><span class="line">q2 *= recipNorm;</span><br><span class="line">q3 *= recipNorm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Fast inverse square-root</span></span><br><span class="line"><span class="comment">// See: http://en.wikipedia.org/wiki/Fast_inverse_square_root</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">invSqrt</span><span class="params">(<span class="keyword">float</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> halfx = <span class="number">0.5f</span> * x;</span><br><span class="line"><span class="keyword">float</span> y = x;</span><br><span class="line"><span class="keyword">long</span> i = *(<span class="keyword">long</span>*)&amp;y;</span><br><span class="line">i = <span class="number">0x5f3759df</span> - (i&gt;&gt;<span class="number">1</span>);</span><br><span class="line">y = *(<span class="keyword">float</span>*)&amp;i;</span><br><span class="line">y = y * (<span class="number">1.5f</span> - (halfx * y * y));</span><br><span class="line"><span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//====================================================================================================</span></span><br><span class="line"><span class="comment">// END OF CODE</span></span><br><span class="line"><span class="comment">//====================================================================================================</span></span><br></pre></td></tr></table></figure><ul><li>MahonyAHRS.h</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">// MahonyAHRS.h</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Madgwick's implementation of Mayhony's AHRS algorithm.</span></span><br><span class="line"><span class="comment">// See: http://www.x-io.co.uk/node/8#open_source_ahrs_and_imu_algorithms</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// DateAuthorNotes</span></span><br><span class="line"><span class="comment">// 29/09/2011SOH Madgwick    Initial release</span></span><br><span class="line"><span class="comment">// 02/10/2011SOH MadgwickOptimised for reduced CPU load</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MahonyAHRS_h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MahonyAHRS_h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//----------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Variable declaration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">float</span> twoKp;<span class="comment">// 2 * proportional gain (Kp)</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">float</span> twoKi;<span class="comment">// 2 * integral gain (Ki)</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keyword">float</span> q0, q1, q2, q3;<span class="comment">// quaternion of sensor frame relative to auxiliary frame</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Function declarations</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MahonyAHRSupdate</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az, <span class="keyword">float</span> mx, <span class="keyword">float</span> my, <span class="keyword">float</span> mz)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MahonyAHRSupdateIMU</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">// End of file</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br></pre></td></tr></table></figure><ul><li>MahonyAHRS.c</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">// MahonyAHRS.c</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Madgwick's implementation of Mayhony's AHRS algorithm.</span></span><br><span class="line"><span class="comment">// See: http://www.x-io.co.uk/node/8#open_source_ahrs_and_imu_algorithms</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// DateAuthorNotes</span></span><br><span class="line"><span class="comment">// 29/09/2011SOH Madgwick    Initial release</span></span><br><span class="line"><span class="comment">// 02/10/2011SOH MadgwickOptimised for reduced CPU load</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//=====================================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Header files</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MahonyAHRS.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Definitions</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sampleFreq512.0f<span class="comment">// sample frequency in Hz</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> twoKpDef(2.0f * 0.5f)<span class="comment">// 2 * proportional gain</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> twoKiDef(2.0f * 0.0f)<span class="comment">// 2 * integral gain</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Variable definitions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">float</span> twoKp = twoKpDef;<span class="comment">// 2 * proportional gain (Kp)</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">float</span> twoKi = twoKiDef;<span class="comment">// 2 * integral gain (Ki)</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">float</span> q0 = <span class="number">1.0f</span>, q1 = <span class="number">0.0f</span>, q2 = <span class="number">0.0f</span>, q3 = <span class="number">0.0f</span>;<span class="comment">// quaternion of sensor frame relative to auxiliary frame</span></span><br><span class="line"><span class="keyword">volatile</span> <span class="keyword">float</span> integralFBx = <span class="number">0.0f</span>,  integralFBy = <span class="number">0.0f</span>, integralFBz = <span class="number">0.0f</span>;<span class="comment">// integral error terms scaled by Ki</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Function declarations</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">invSqrt</span><span class="params">(<span class="keyword">float</span> x)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//====================================================================================================</span></span><br><span class="line"><span class="comment">// Functions</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// AHRS algorithm update</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MahonyAHRSupdate</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az, <span class="keyword">float</span> mx, <span class="keyword">float</span> my, <span class="keyword">float</span> mz)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> recipNorm;</span><br><span class="line">    <span class="keyword">float</span> q0q0, q0q1, q0q2, q0q3, q1q1, q1q2, q1q3, q2q2, q2q3, q3q3;  </span><br><span class="line"><span class="keyword">float</span> hx, hy, bx, bz;</span><br><span class="line"><span class="keyword">float</span> halfvx, halfvy, halfvz, halfwx, halfwy, halfwz;</span><br><span class="line"><span class="keyword">float</span> halfex, halfey, halfez;</span><br><span class="line"><span class="keyword">float</span> qa, qb, qc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use IMU algorithm if magnetometer measurement invalid (avoids NaN in magnetometer normalisation)</span></span><br><span class="line"><span class="keyword">if</span>((mx == <span class="number">0.0f</span>) &amp;&amp; (my == <span class="number">0.0f</span>) &amp;&amp; (mz == <span class="number">0.0f</span>)) &#123;</span><br><span class="line">MahonyAHRSupdateIMU(gx, gy, gz, ax, ay, az);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compute feedback only if accelerometer measurement valid (avoids NaN in accelerometer normalisation)</span></span><br><span class="line"><span class="keyword">if</span>(!((ax == <span class="number">0.0f</span>) &amp;&amp; (ay == <span class="number">0.0f</span>) &amp;&amp; (az == <span class="number">0.0f</span>))) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise accelerometer measurement</span></span><br><span class="line">recipNorm = invSqrt(ax * ax + ay * ay + az * az);</span><br><span class="line">ax *= recipNorm;</span><br><span class="line">ay *= recipNorm;</span><br><span class="line">az *= recipNorm;     </span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise magnetometer measurement</span></span><br><span class="line">recipNorm = invSqrt(mx * mx + my * my + mz * mz);</span><br><span class="line">mx *= recipNorm;</span><br><span class="line">my *= recipNorm;</span><br><span class="line">mz *= recipNorm;   </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Auxiliary variables to avoid repeated arithmetic</span></span><br><span class="line">        q0q0 = q0 * q0;</span><br><span class="line">        q0q1 = q0 * q1;</span><br><span class="line">        q0q2 = q0 * q2;</span><br><span class="line">        q0q3 = q0 * q3;</span><br><span class="line">        q1q1 = q1 * q1;</span><br><span class="line">        q1q2 = q1 * q2;</span><br><span class="line">        q1q3 = q1 * q3;</span><br><span class="line">        q2q2 = q2 * q2;</span><br><span class="line">        q2q3 = q2 * q3;</span><br><span class="line">        q3q3 = q3 * q3;   </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Reference direction of Earth's magnetic field</span></span><br><span class="line">        hx = <span class="number">2.0f</span> * (mx * (<span class="number">0.5f</span> - q2q2 - q3q3) + my * (q1q2 - q0q3) + mz * (q1q3 + q0q2));</span><br><span class="line">        hy = <span class="number">2.0f</span> * (mx * (q1q2 + q0q3) + my * (<span class="number">0.5f</span> - q1q1 - q3q3) + mz * (q2q3 - q0q1));</span><br><span class="line">        bx = <span class="built_in">sqrt</span>(hx * hx + hy * hy);</span><br><span class="line">        bz = <span class="number">2.0f</span> * (mx * (q1q3 - q0q2) + my * (q2q3 + q0q1) + mz * (<span class="number">0.5f</span> - q1q1 - q2q2));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Estimated direction of gravity and magnetic field</span></span><br><span class="line">halfvx = q1q3 - q0q2;</span><br><span class="line">halfvy = q0q1 + q2q3;</span><br><span class="line">halfvz = q0q0 - <span class="number">0.5f</span> + q3q3;</span><br><span class="line">        halfwx = bx * (<span class="number">0.5f</span> - q2q2 - q3q3) + bz * (q1q3 - q0q2);</span><br><span class="line">        halfwy = bx * (q1q2 - q0q3) + bz * (q0q1 + q2q3);</span><br><span class="line">        halfwz = bx * (q0q2 + q1q3) + bz * (<span class="number">0.5f</span> - q1q1 - q2q2);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// Error is sum of cross product between estimated direction and measured direction of field vectors</span></span><br><span class="line">halfex = (ay * halfvz - az * halfvy) + (my * halfwz - mz * halfwy);</span><br><span class="line">halfey = (az * halfvx - ax * halfvz) + (mz * halfwx - mx * halfwz);</span><br><span class="line">halfez = (ax * halfvy - ay * halfvx) + (mx * halfwy - my * halfwx);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compute and apply integral feedback if enabled</span></span><br><span class="line"><span class="keyword">if</span>(twoKi &gt; <span class="number">0.0f</span>) &#123;</span><br><span class="line">integralFBx += twoKi * halfex * (<span class="number">1.0f</span> / sampleFreq);<span class="comment">// integral error scaled by Ki</span></span><br><span class="line">integralFBy += twoKi * halfey * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">integralFBz += twoKi * halfez * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">gx += integralFBx;<span class="comment">// apply integral feedback</span></span><br><span class="line">gy += integralFBy;</span><br><span class="line">gz += integralFBz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">integralFBx = <span class="number">0.0f</span>;<span class="comment">// prevent integral windup</span></span><br><span class="line">integralFBy = <span class="number">0.0f</span>;</span><br><span class="line">integralFBz = <span class="number">0.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Apply proportional feedback</span></span><br><span class="line">gx += twoKp * halfex;</span><br><span class="line">gy += twoKp * halfey;</span><br><span class="line">gz += twoKp * halfez;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integrate rate of change of quaternion</span></span><br><span class="line">gx *= (<span class="number">0.5f</span> * (<span class="number">1.0f</span> / sampleFreq));<span class="comment">// pre-multiply common factors</span></span><br><span class="line">gy *= (<span class="number">0.5f</span> * (<span class="number">1.0f</span> / sampleFreq));</span><br><span class="line">gz *= (<span class="number">0.5f</span> * (<span class="number">1.0f</span> / sampleFreq));</span><br><span class="line">qa = q0;</span><br><span class="line">qb = q1;</span><br><span class="line">qc = q2;</span><br><span class="line">q0 += (-qb * gx - qc * gy - q3 * gz);</span><br><span class="line">q1 += (qa * gx + qc * gz - q3 * gy);</span><br><span class="line">q2 += (qa * gy - qb * gz + q3 * gx);</span><br><span class="line">q3 += (qa * gz + qb * gy - qc * gx); </span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise quaternion</span></span><br><span class="line">recipNorm = invSqrt(q0 * q0 + q1 * q1 + q2 * q2 + q3 * q3);</span><br><span class="line">q0 *= recipNorm;</span><br><span class="line">q1 *= recipNorm;</span><br><span class="line">q2 *= recipNorm;</span><br><span class="line">q3 *= recipNorm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// IMU algorithm update</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MahonyAHRSupdateIMU</span><span class="params">(<span class="keyword">float</span> gx, <span class="keyword">float</span> gy, <span class="keyword">float</span> gz, <span class="keyword">float</span> ax, <span class="keyword">float</span> ay, <span class="keyword">float</span> az)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> recipNorm;</span><br><span class="line"><span class="keyword">float</span> halfvx, halfvy, halfvz;</span><br><span class="line"><span class="keyword">float</span> halfex, halfey, halfez;</span><br><span class="line"><span class="keyword">float</span> qa, qb, qc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compute feedback only if accelerometer measurement valid (avoids NaN in accelerometer normalisation)</span></span><br><span class="line"><span class="keyword">if</span>(!((ax == <span class="number">0.0f</span>) &amp;&amp; (ay == <span class="number">0.0f</span>) &amp;&amp; (az == <span class="number">0.0f</span>))) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise accelerometer measurement</span></span><br><span class="line">recipNorm = invSqrt(ax * ax + ay * ay + az * az);</span><br><span class="line">ax *= recipNorm;</span><br><span class="line">ay *= recipNorm;</span><br><span class="line">az *= recipNorm;        </span><br><span class="line"></span><br><span class="line"><span class="comment">// Estimated direction of gravity and vector perpendicular to magnetic flux</span></span><br><span class="line">halfvx = q1 * q3 - q0 * q2;</span><br><span class="line">halfvy = q0 * q1 + q2 * q3;</span><br><span class="line">halfvz = q0 * q0 - <span class="number">0.5f</span> + q3 * q3;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Error is sum of cross product between estimated and measured direction of gravity</span></span><br><span class="line">halfex = (ay * halfvz - az * halfvy);</span><br><span class="line">halfey = (az * halfvx - ax * halfvz);</span><br><span class="line">halfez = (ax * halfvy - ay * halfvx);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compute and apply integral feedback if enabled</span></span><br><span class="line"><span class="keyword">if</span>(twoKi &gt; <span class="number">0.0f</span>) &#123;</span><br><span class="line">integralFBx += twoKi * halfex * (<span class="number">1.0f</span> / sampleFreq);<span class="comment">// integral error scaled by Ki</span></span><br><span class="line">integralFBy += twoKi * halfey * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">integralFBz += twoKi * halfez * (<span class="number">1.0f</span> / sampleFreq);</span><br><span class="line">gx += integralFBx;<span class="comment">// apply integral feedback</span></span><br><span class="line">gy += integralFBy;</span><br><span class="line">gz += integralFBz;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">integralFBx = <span class="number">0.0f</span>;<span class="comment">// prevent integral windup</span></span><br><span class="line">integralFBy = <span class="number">0.0f</span>;</span><br><span class="line">integralFBz = <span class="number">0.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Apply proportional feedback</span></span><br><span class="line">gx += twoKp * halfex;</span><br><span class="line">gy += twoKp * halfey;</span><br><span class="line">gz += twoKp * halfez;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integrate rate of change of quaternion</span></span><br><span class="line">gx *= (<span class="number">0.5f</span> * (<span class="number">1.0f</span> / sampleFreq));<span class="comment">// pre-multiply common factors</span></span><br><span class="line">gy *= (<span class="number">0.5f</span> * (<span class="number">1.0f</span> / sampleFreq));</span><br><span class="line">gz *= (<span class="number">0.5f</span> * (<span class="number">1.0f</span> / sampleFreq));</span><br><span class="line">qa = q0;</span><br><span class="line">qb = q1;</span><br><span class="line">qc = q2;</span><br><span class="line">q0 += (-qb * gx - qc * gy - q3 * gz);</span><br><span class="line">q1 += (qa * gx + qc * gz - q3 * gy);</span><br><span class="line">q2 += (qa * gy - qb * gz + q3 * gx);</span><br><span class="line">q3 += (qa * gz + qb * gy - qc * gx); </span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalise quaternion</span></span><br><span class="line">recipNorm = invSqrt(q0 * q0 + q1 * q1 + q2 * q2 + q3 * q3);</span><br><span class="line">q0 *= recipNorm;</span><br><span class="line">q1 *= recipNorm;</span><br><span class="line">q2 *= recipNorm;</span><br><span class="line">q3 *= recipNorm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// Fast inverse square-root</span></span><br><span class="line"><span class="comment">// See: http://en.wikipedia.org/wiki/Fast_inverse_square_root</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">invSqrt</span><span class="params">(<span class="keyword">float</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">float</span> halfx = <span class="number">0.5f</span> * x;</span><br><span class="line"><span class="keyword">float</span> y = x;</span><br><span class="line"><span class="keyword">long</span> i = *(<span class="keyword">long</span>*)&amp;y;</span><br><span class="line">i = <span class="number">0x5f3759df</span> - (i&gt;&gt;<span class="number">1</span>);</span><br><span class="line">y = *(<span class="keyword">float</span>*)&amp;i;</span><br><span class="line">y = y * (<span class="number">1.5f</span> - (halfx * y * y));</span><br><span class="line"><span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//====================================================================================================</span></span><br><span class="line"><span class="comment">// END OF CODE</span></span><br><span class="line"><span class="comment">//====================================================================================================</span></span><br></pre></td></tr></table></figure><h1 id="6-参考："><a href="#6-参考：" class="headerlink" title="6. 参考："></a>6. 参考：</h1><ul><li><p><a href="https://www.samba.org/tridge/UAV/madgwick_internal_report.pdf" target="_blank" rel="noopener">An efficient orientation filter for inertial and inertial/magnetic sensor arrays</a></p></li><li><p><a href="https://blog.csdn.net/Gregory24/article/details/90646084" target="_blank" rel="noopener">Madgwick算法的数学推演：基于惯性导航元件的位姿估计</a></p></li><li><a href="https://www.cnblogs.com/ilekoaiq/p/8849217.html" target="_blank" rel="noopener">Madgwick算法详细解读</a></li><li>[<a href="https://x-io.co.uk/open-source-imu-and-ahrs-algorithms/" target="_blank" rel="noopener">Open source IMU and AHRS algorithms</a>]</li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 姿态估计 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 姿态估计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（四）-最优化-梯度下降法</title>
      <link href="/2019/12/07/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E6%B3%95/"/>
      <url>/2019/12/07/slam/vSLAMNet%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%9C%80%E4%BC%98%E5%8C%96-%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>梯度下降法</li><li>高斯牛顿迭代法</li><li>牛顿法</li><li>共轭梯度法</li></ul><h1 id="2-基础知识"><a href="#2-基础知识" class="headerlink" title="2. 基础知识"></a>2. 基础知识</h1><h2 id="2-1-微分"><a href="#2-1-微分" class="headerlink" title="2.1 微分"></a>2.1 微分</h2><ul><li>函数图像中，某点的切线的斜率</li><li>函数的变化率</li></ul><p>例子：</p><p>$\frac{d(x^2)}{dx} = 2x$，为单变量微分。</p><p>$\frac{\partial}{\partial x}(x^2y^2) = 2xy^2$，为多变量微分</p><h2 id="2-2-梯度"><a href="#2-2-梯度" class="headerlink" title="2.2 梯度"></a>2.2 梯度</h2><ul><li>梯度实际上就是多变量微分的一般化</li><li>在单变量的函数中，梯度其实就是函数的微分，代表着函数在某个给定点的切线的斜率</li><li>在多变量函数中，梯度是一个向量，向量有方向，梯度的方向就指出了函数在给定点的上升最快的方向<ul><li>分别对每个变量进行微分，然后用逗号分割开，梯度是用&lt;&gt;包括起来，说明梯度其实一个向量</li></ul></li><li>梯度的方向是函数在给定点上升最快的方向，那么梯度的反方向就是函数在给定点下降最快的方向</li><li>只要沿着梯度的方向一直走，就能走到局部的最低点</li></ul><p>例子：</p><p>$J(\Theta) = 0.55 - (5\theta_1 + 2\theta_2 - 12\theta_3)$,</p><p>$\bigtriangledown J(\Theta) = &lt;\frac{\partial J}{\partial \theta_1}, \frac{\partial J}{\partial \theta_2}, \frac{\partial J}{\partial \theta_3}&gt; = &lt;-5, -2, 12&gt;$.</p><h2 id="2-3-泰勒公式"><a href="#2-3-泰勒公式" class="headerlink" title="2.3 泰勒公式"></a>2.3 泰勒公式</h2><ul><li>用多项式函数去逼近光滑函数</li></ul><p>$f(x) = \sum_{i=0}^{n}\frac{f^{(i)}(x_0)}{i!}(x - x_0)^{i}$.</p><h1 id="3-梯度下降法"><a href="#3-梯度下降法" class="headerlink" title="3. 梯度下降法"></a>3. 梯度下降法</h1><h2 id="3-1-原理分析"><a href="#3-1-原理分析" class="headerlink" title="3.1 原理分析"></a>3.1 原理分析</h2><ul><li><p>目标</p><ul><li>有一个可微分的函数，找到这个函数的最小值，就是找到给定点的梯度，然后朝着梯度相反的方向，就能让函数值下降的最快</li></ul></li><li><p>核心公式</p><p>  $\theta_1 = \theta_0 - \alpha \bigtriangledown J(\theta)$.</p></li><li><p>该公式的主要含义如下</p><ul><li>J是$\theta$的函数</li><li>当前处在$\theta_0$点，目标是要从这个点走到J的最小值点</li><li>先确定前进的方向，也就是梯度的反向，然后走一段距离的步长$\alpha$，此时到了$\theta_1$</li><li>如果$\theta_1$就是使得函数局部最小值的点，那么迭代结束</li><li>如果$\theta_1$不是使得函数取得局部最小值的点，那么继续迭代下去</li><li>公式中负号的含义是朝着梯度相反的方向前进；因为梯度的方向实际就是函数在此点上升最快的方向，我们需要朝着下降最快的方向走，自然就是负的梯度的方向，所以此处需要加上负号</li></ul></li></ul><p>例子1：</p><p>假设单变量函数为$J(\theta) = \theta^2$，其微分为$J’(\theta) = 2\theta$，假设起点为$\theta_0 = 1$，步长为$\alpha = 0.4$，那么梯度下降法的迭代过程如下：</p><p>$\theta_0 = 1$,</p><p>$\theta_1 = \theta_0 - \alpha <em> J’(\theta_0) = 1 - 0.4 </em> 2 = 0.2$,</p><p>$\theta_2 = \theta_1 - \alpha <em> J’(\theta_1) = 0.2 - 0.4 </em> 2 * 0.2 = 0.04$,</p><p>$\theta_3 = 0.008$,</p><p>$\theta_4 = 0.0016$.</p><p>如果我们要求的精度为1e2或者迭代次数最大4次，那么，此时我们的算法已收敛。</p><p>例子2：</p><p>假设目标函数为$J(\Theta) = \theta_1^2 + \theta_2^2$，初始值为(1, 3)，步长为0.1，函数的梯度为$\bigtriangledown J(\Theta) = <2\theta_1, 2\theta_2>$，迭代过程如下：</2\theta_1,></p><p>$\Theta_0 = (1, 3)$,</p><p>$\Theta_1 = \Theta_0 - \alpha <em> \bigtriangledown J(\Theta) = (1, 3) - 0.1 </em> (2, 6) = (0.8, 2.4)$,</p><p>$\Theta_2 = \Theta_1 - \alpha <em> \bigtriangledown J(\Theta) = (0.8, 2.4) - 0.1 </em> (1.6, 4.8) = (0.64, 1.92)$,</p><p>$\Theta_3 = (0.512, 1.536)$,</p><p>$\dots$,</p><p>$\Theta_{10} = (0.1073, 0.3221)$,</p><p>$\dots$,</p><p>$\Theta_{100} = (1.629e^{-10}, 4.8888e^{-10})$.</p><h2 id="3-2-算法实现"><a href="#3-2-算法实现" class="headerlink" title="3.2 算法实现"></a>3.2 算法实现</h2><ul><li>线性回归</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Size of the points dataset.</span></span><br><span class="line">m = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Points x-coordinate and dummy value (x0, x1).</span></span><br><span class="line">X0 = np.ones((m, <span class="number">1</span>))</span><br><span class="line">X1 = np.arange(<span class="number">1</span>, m+<span class="number">1</span>).reshape(m, <span class="number">1</span>)</span><br><span class="line">X = np.hstack((X0, X1))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Points y-coordinate</span></span><br><span class="line">y = np.array([</span><br><span class="line">    <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>,</span><br><span class="line">    <span class="number">11</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span></span><br><span class="line">]).reshape(m, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The Learning Rate alpha.</span></span><br><span class="line">alpha = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">error_function</span><span class="params">(theta, X, y)</span>:</span></span><br><span class="line">    <span class="string">'''Error function J definition.'''</span></span><br><span class="line">    diff = np.dot(X, theta) - y</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1.</span>/<span class="number">2</span>*m) * np.dot(np.transpose(diff), diff)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradient_function</span><span class="params">(theta, X, y)</span>:</span></span><br><span class="line">    <span class="string">'''Gradient of the function J definition.'''</span></span><br><span class="line">    diff = np.dot(X, theta) - y</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1.</span>/m) * np.dot(np.transpose(X), diff)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradient_descent</span><span class="params">(X, y, alpha)</span>:</span></span><br><span class="line">    <span class="string">'''Perform gradient descent.'''</span></span><br><span class="line">    theta = np.array([<span class="number">1</span>, <span class="number">1</span>]).reshape(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">    gradient = gradient_function(theta, X, y)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> np.all(np.absolute(gradient) &lt;= <span class="number">1e-5</span>):</span><br><span class="line">        theta = theta - alpha * gradient</span><br><span class="line">        gradient = gradient_function(theta, X, y)</span><br><span class="line">    <span class="keyword">return</span> theta</span><br><span class="line"></span><br><span class="line">optimal = gradient_descent(X, y, alpha)</span><br><span class="line">print(<span class="string">'optimal:'</span>, optimal)</span><br><span class="line">print(<span class="string">'error function:'</span>, error_function(optimal, X, y)[<span class="number">0</span>,<span class="number">0</span>])</span><br></pre></td></tr></table></figure><h2 id="3-3-梯度下降法大家族（BGD，SGD，MBGD）"><a href="#3-3-梯度下降法大家族（BGD，SGD，MBGD）" class="headerlink" title="3.3 梯度下降法大家族（BGD，SGD，MBGD）"></a>3.3 梯度下降法大家族（BGD，SGD，MBGD）</h2><ul><li>批量梯度下降法（Batch Gradient Descent）<ul><li>批量梯度下降法，是梯度下降法最常用的形式，具体做法也就是在更新参数时使用所有的样本来进行更新</li></ul></li><li>随机梯度下降法（Stochastic Gradient Descent）<ul><li>随机梯度下降法，其实和批量梯度下降法原理类似，区别在与求梯度时没有用所有的样本的数据，而是仅仅选取一个样本来求梯度</li></ul></li><li><p>小批量梯度下降法（Mini-batch Gradient Descent）</p><ul><li>小批量梯度下降法是批量梯度下降法和随机梯度下降法的折衷，也就是对于m个样本，我们采用x个样子来迭代</li></ul></li><li><p>批量梯度下降法python实现</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(X, y, W, B, alpha, max_iters)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    使用了所有的样本进行梯度下降</span></span><br><span class="line"><span class="string">    X: 训练集,</span></span><br><span class="line"><span class="string">    y: 标签,</span></span><br><span class="line"><span class="string">    W: 权重向量,</span></span><br><span class="line"><span class="string">    B: bias,</span></span><br><span class="line"><span class="string">    alpha: 学习率,</span></span><br><span class="line"><span class="string">    max_iters: 最大迭代次数.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    dW = <span class="number">0</span> <span class="comment"># 权重梯度收集器</span></span><br><span class="line">    dB = <span class="number">0</span> <span class="comment"># Bias梯度的收集器</span></span><br><span class="line">    m = X.shape[<span class="number">0</span>] <span class="comment"># 样本数</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(max_iters):</span><br><span class="line">        dW = <span class="number">0</span> <span class="comment"># 每次迭代重置</span></span><br><span class="line">        dB = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(m):</span><br><span class="line">            <span class="comment"># 1. 迭代所有的样本</span></span><br><span class="line">            <span class="comment"># 2. 计算权重和bias的梯度保存在w_grad和b_grad,</span></span><br><span class="line">            <span class="comment"># 3. 通过增加w_grad和b_grad来更新dW和dB</span></span><br><span class="line">            W = W - alpha * (dW / m) <span class="comment"># 更新权重</span></span><br><span class="line">            B = B - alpha * (dB / m) <span class="comment"># 更新bias</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> W, B</span><br></pre></td></tr></table></figure><h2 id="3-4-梯度下降法和最小二乘法"><a href="#3-4-梯度下降法和最小二乘法" class="headerlink" title="3.4 梯度下降法和最小二乘法"></a>3.4 梯度下降法和最小二乘法</h2><ul><li>梯度下降法和最小二乘法相比，梯度下降法需要选择步长，而最小二乘法不需要</li><li>梯度下降法是迭代求解，最小二乘法是计算解析解</li><li>如果样本量不算很大，且存在解析解，最小二乘法比起梯度下降法要有优势，计算速度很快</li><li>如果样本量很大，用最小二乘法由于需要求一个超级大的逆矩阵，这时就很难或者很慢才能求解解析解了，使用迭代的梯度下降法比较有优势</li></ul><h2 id="3-5-优缺点"><a href="#3-5-优缺点" class="headerlink" title="3.5 优缺点"></a>3.5 优缺点</h2><ul><li>靠近极小值时收敛速度减慢</li><li>直线搜索时可能会产生一些问题</li><li>可能会“之字形”地下降</li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.jianshu.com/p/c7e642877b0e" target="_blank" rel="noopener">深入浅出—梯度下降法及其实现</a></li><li><a href="https://zhuanlan.zhihu.com/p/37524275" target="_blank" rel="noopener">梯度下降法、牛顿法和拟牛顿法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 最优化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 最优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（三）-数字图像处理-高斯滤波</title>
      <link href="/2019/12/07/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86-%E9%AB%98%E6%96%AF%E6%BB%A4%E6%B3%A2/"/>
      <url>/2019/12/07/slam/vSLAMNet%EF%BC%88%E4%B8%89%EF%BC%89-%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86-%E9%AB%98%E6%96%AF%E6%BB%A4%E6%B3%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-高斯模糊概述"><a href="#1-高斯模糊概述" class="headerlink" title="1. 高斯模糊概述"></a>1. 高斯模糊概述</h1><p>高斯模糊(英语: Gaussian Blur), 也叫高斯平滑, 是在 Adobe Photoshop, GIMP 以及 Paint.NET 等图像处理软件中广泛使用的处理效果, 通常用它来减少图像噪声以及降低细节层次.</p><ul><li>从数学的角度来看, 图像的高斯模糊过程就是图像与正态分布做卷积. 由于正态分布又叫作高斯分布, 所以这项技术就叫作高斯模糊. </li><li>由于高斯函数的傅立叶变换是另外一个高斯函数, 所以高斯模糊对于图像来说就是一个低通滤波器.</li></ul><h1 id="2-原理"><a href="#2-原理" class="headerlink" title="2. 原理"></a>2. 原理</h1><p>所谓”模糊”，可以理解成每一个像素都取周边像素的平均值，如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-142820.png" alt="image-20191012093017995" style="zoom:70%;"></p><p>“中间点”取”周围点”的平均值，就是1。在数值上，这是一种”平滑化”。</p><ul><li>在图形上，就相当于产生”模糊”效果，”中间点”失去细节。显然，计算平均值时，取值范围越大，”模糊效果”越强烈。</li><li>从数值角度看，就是数值越平滑。</li></ul><p>接下来的问题就是，既然每个点都要取周边像素的平均值，那么应该如何分配权重呢？如果使用简单平均，显然不是很合理，因为图像都是连续的，越靠近的点关系越密切，越远离的点关系越疏远。因此，加权平均更合理，距离越近的点权重越大，距离越远的点权重越小。</p><h2 id="2-1-正态分布的权重"><a href="#2-1-正态分布的权重" class="headerlink" title="2.1 正态分布的权重"></a>2.1 正态分布的权重</h2><p>正态分布显然是一种可取的权重分配模式。在图形上，正态分布是一种钟形曲线，越接近中心，取值越大，越远离中心，取值越小。计算平均值的时候，我们只需要将”中心点”作为原点，其他点按照其在正态曲线上的位置，分配权重，就可以得到一个加权平均值。</p><p>一维高斯函数如下公式所述：</p><p><script type="math/tex">G(x) = \frac{1}{2\pi \sigma^{2}}e^{-\frac{x^2}{2\sigma^2}}</script>，</p><p>其中， 由于对于中心点而言，$\mu = 0$。</p><p>图像是二维的，因此，图像对应的高斯函数如下公式所述：</p><p><script type="math/tex">G(x, y, \sigma) = \frac{1}{2\pi \sigma^{2}}e^{-\frac{x^2 + y^2}{2\sigma^2}}</script>.</p><p>有了这个函数 ，就可以计算每个点的权重了。</p><h2 id="2-2-sigma-值介绍"><a href="#2-2-sigma-值介绍" class="headerlink" title="2.2 $\sigma$值介绍"></a>2.2 $\sigma$值介绍</h2><p>尺度参数$\sigma$决定了分布幅度，在高斯模糊处理中，$\sigma$常取 1.5。</p><h2 id="2-3-权重矩阵计算"><a href="#2-3-权重矩阵计算" class="headerlink" title="2.3 权重矩阵计算"></a>2.3 权重矩阵计算</h2><p>假定中心点的坐标是（0,0），那么距离它最近的8个点的坐标如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-142917.png" alt="image-20191012094212344" style="zoom:70%;"></p><p>为了计算权重矩阵，需要设定$\sigma$的值。假定$\sigma = 1.5$，则模糊半径为1的权重矩阵如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-142955.png" alt="image-20191012094249560" style="zoom:70%;"></p><p>这9个点的权重总和等于0.4787147，如果只计算这9个点的加权平均，还必须让它们的权重之和等于1，因此上面9个值还要分别除以0.4787147，得到最终的权重矩阵。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-143027.png" alt="image-20191012094534679" style="zoom:70%;"></p><h2 id="2-4-计算高斯模糊"><a href="#2-4-计算高斯模糊" class="headerlink" title="2.4 计算高斯模糊"></a>2.4 计算高斯模糊</h2><p>假设现有9个像素点，灰度值（0-255）如下：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-143058.png" alt="image-20191012094613535" style="zoom:70%;"></p><p>每个点乘以自己的权重值：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-143232.png" alt="image-20191012094635553" style="zoom:70%;"></p><p>得到：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-07-143314.png" alt="image-20191012094708241" style="zoom:70%;"></p><p>将这9个值加起来，就是中心点的高斯模糊的值。</p><p>对所有点重复这个过程，就得到了高斯模糊后的图像。如果原图是彩色图片，可以对RGB三个通道分别做高斯模糊。</p><h1 id="2-5-边界点的处理"><a href="#2-5-边界点的处理" class="headerlink" title="2.5 边界点的处理"></a>2.5 边界点的处理</h1><ul><li>一个变通方法，就是把已有的点拷贝到另一面的对应位置，模拟出完整的矩阵。</li><li>填充0。</li></ul><h1 id="3-代码实现"><a href="#3-代码实现" class="headerlink" title="3. 代码实现"></a>3. 代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> PIL.Image</span><br><span class="line"><span class="keyword">import</span> PIL.ImageFilter</span><br><span class="line"><span class="keyword">import</span> scipy.misc</span><br><span class="line"><span class="keyword">import</span> scipy.signal</span><br><span class="line"></span><br><span class="line"><span class="comment"># 概率密度函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cv</span><span class="params">(r, sigma)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">2</span> * math.pi * sigma ** <span class="number">2</span>) * math.exp((-r**<span class="number">2</span>) / (<span class="number">2</span> * sigma ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 高斯滤波掩模</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_window</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 模糊半径为 2, sigma 为 1.5</span></span><br><span class="line">    radius, sigma = <span class="number">2</span>, <span class="number">1.5</span></span><br><span class="line">    window = np.zeros((radius * <span class="number">2</span> + <span class="number">1</span>, radius * <span class="number">2</span> + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(-radius, radius + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(-radius, radius + <span class="number">1</span>):</span><br><span class="line">            r = (i ** <span class="number">2</span> + j ** <span class="number">2</span>) ** <span class="number">0.5</span></span><br><span class="line">            window[i + radius][j + radius] = get_cv(r, sigma)</span><br><span class="line">    <span class="keyword">return</span> window / np.sum(window)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_2d</span><span class="params">(r)</span>:</span></span><br><span class="line">    window = get_window()</span><br><span class="line">    s = scipy.signal.convolve2d(r, window, mode=<span class="string">'same'</span>, boundary=<span class="string">'symm'</span>)</span><br><span class="line">    <span class="keyword">return</span> s.astype(np.uint8)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_3d</span><span class="params">(r)</span>:</span></span><br><span class="line">    s_dsplit = []</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> range(r.shape[<span class="number">2</span>]):</span><br><span class="line">        rr = r[:, :, d]</span><br><span class="line">        ss = convert_2d(rr)</span><br><span class="line">        s_dsplit.append(ss)</span><br><span class="line">    s = np.dstack(s_dsplit)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">im = PIL.Image.open(<span class="string">'/img/jp.jpg'</span>)</span><br><span class="line">im_mat = scipy.misc.fromimage(im)</span><br><span class="line">im_converted_mat = convert_3d(im_mat)</span><br><span class="line">im_converted = PIL.Image.fromarray(im_converted_mat)</span><br><span class="line">im_converted.show()</span><br></pre></td></tr></table></figure><h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ul><li><a href="http://accu.cc/content/pil/spatial_filter_gaussian_blur/" target="_blank" rel="noopener">数字图像处理 » 数字图像处理-空间滤波-高斯滤波</a></li><li><a href="https://blog.csdn.net/farmwang/article/details/74452750" target="_blank" rel="noopener">高斯模糊的算法（高斯卷积 高斯核）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 计算机视觉 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 计算机视觉 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vSLAMNet（二）-三维旋转变换</title>
      <link href="/2019/12/07/slam/vSLAMNet%EF%BC%88%E4%BA%8C%EF%BC%89-%E4%B8%89%E7%BB%B4%E6%97%8B%E8%BD%AC%E5%8F%98%E6%8D%A2/"/>
      <url>/2019/12/07/slam/vSLAMNet%EF%BC%88%E4%BA%8C%EF%BC%89-%E4%B8%89%E7%BB%B4%E6%97%8B%E8%BD%AC%E5%8F%98%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>欧拉角</li><li>旋转矩阵</li><li>四元数</li></ul><h1 id="2-欧拉角与旋转矩阵相互转换"><a href="#2-欧拉角与旋转矩阵相互转换" class="headerlink" title="2. 欧拉角与旋转矩阵相互转换"></a>2. 欧拉角与旋转矩阵相互转换</h1><h2 id="2-1-旋转矩阵转欧拉角"><a href="#2-1-旋转矩阵转欧拉角" class="headerlink" title="2.1 旋转矩阵转欧拉角"></a>2.1 旋转矩阵转欧拉角</h2><ul><li>C++</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotationMatrixToEuler</span><span class="params">(Eigen::Matrix3d rotation, Eigen::Vector3d&amp; euler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">float</span> sy = <span class="keyword">static_cast</span>&lt;<span class="keyword">float</span>&gt;(<span class="built_in">sqrt</span>(rotation(<span class="number">0</span>, <span class="number">0</span>) * rotation(<span class="number">0</span>, <span class="number">0</span>) + rotation(<span class="number">1</span>, <span class="number">0</span>) * rotation(<span class="number">1</span>, <span class="number">0</span>)));</span><br><span class="line">    <span class="keyword">bool</span> singular = sy &lt; <span class="number">1e-6</span>;</span><br><span class="line">    <span class="keyword">if</span> (!singular) &#123;</span><br><span class="line">        euler[<span class="number">0</span>] = <span class="built_in">atan2</span>(rotation(<span class="number">2</span>, <span class="number">1</span>) , rotation(<span class="number">2</span>, <span class="number">2</span>));</span><br><span class="line">        euler[<span class="number">1</span>] = <span class="built_in">atan2</span>(-rotation(<span class="number">2</span>, <span class="number">0</span>), sy);</span><br><span class="line">        euler[<span class="number">2</span>] = <span class="built_in">atan2</span>(rotation(<span class="number">1</span>, <span class="number">0</span>), rotation(<span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        euler[<span class="number">0</span>] = <span class="built_in">atan2</span>(-rotation(<span class="number">1</span>, <span class="number">2</span>), rotation(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        euler[<span class="number">1</span>] = <span class="built_in">atan2</span>(-rotation(<span class="number">2</span>, <span class="number">0</span>), sy);</span><br><span class="line">        euler[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetEulerAngles</span><span class="params">(<span class="keyword">const</span> ARFrame* frame, Eigen::Vector3d&amp; euler)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//first we get the quaternion from m00...m22</span></span><br><span class="line">    <span class="comment">//see http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.html</span></span><br><span class="line">    <span class="keyword">float</span> qw = <span class="built_in">sqrt</span>(<span class="number">1</span> + frame.camera.transform.columns[<span class="number">0</span>][<span class="number">0</span>] + frame.camera.transform.columns[<span class="number">1</span>][<span class="number">1</span>] + frame.camera.transform.columns[<span class="number">2</span>][<span class="number">2</span>]) / <span class="number">2.0</span>;</span><br><span class="line">    <span class="keyword">float</span> qx = (frame.camera.transform.columns[<span class="number">2</span>][<span class="number">1</span>] - frame.camera.transform.columns[<span class="number">1</span>][<span class="number">2</span>]) / (qw * <span class="number">4.0</span>);</span><br><span class="line">    <span class="keyword">float</span> qy = (frame.camera.transform.columns[<span class="number">0</span>][<span class="number">2</span>] - frame.camera.transform.columns[<span class="number">2</span>][<span class="number">0</span>]) / (qw * <span class="number">4.0</span>);</span><br><span class="line">    <span class="keyword">float</span> qz = (frame.camera.transform.columns[<span class="number">1</span>][<span class="number">0</span>] - frame.camera.transform.columns[<span class="number">0</span>][<span class="number">1</span>]) / (qw * <span class="number">4.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//then we deduce euler angles with some cosines</span></span><br><span class="line">    <span class="comment">//see https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles</span></span><br><span class="line">    <span class="comment">// roll (x-axis rotation)</span></span><br><span class="line">    <span class="keyword">float</span> sinr = +<span class="number">2.0</span> * (qw * qx + qy * qz);</span><br><span class="line">    <span class="keyword">float</span> cosr = +<span class="number">1.0</span> - <span class="number">2.0</span> * (qx * qx + qy * qy);</span><br><span class="line">    <span class="keyword">float</span> roll = <span class="built_in">atan2</span>(sinr, cosr);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// pitch (y-axis rotation)</span></span><br><span class="line">    <span class="keyword">float</span> sinp = +<span class="number">2.0</span> * (qw * qy - qz * qx);</span><br><span class="line">    <span class="keyword">float</span> pitch;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(sinp) &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        pitch = copysign(M_PI/<span class="number">2</span>, sinp);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pitch = <span class="built_in">asin</span>(sinp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// yaw (z-axis rotation)</span></span><br><span class="line">    <span class="keyword">float</span> siny = +<span class="number">2.0</span> * (qw * qz + qx * qy);</span><br><span class="line">    <span class="keyword">float</span> cosy = +<span class="number">1.0</span> - <span class="number">2.0</span> * (qy * qy + qz * qz);</span><br><span class="line">    <span class="keyword">float</span> yaw = <span class="built_in">atan2</span>(siny, cosy);</span><br><span class="line">    euler[<span class="number">0</span>] = roll;</span><br><span class="line">    euler[<span class="number">1</span>] = pitch;</span><br><span class="line">    euler[<span class="number">2</span>] = yaw;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotationToEuler</span><span class="params">(rotation)</span>:</span></span><br><span class="line">    euler = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(rotation)):</span><br><span class="line">        sy = math.sqrt(rotation[i][<span class="number">0</span>]*rotation[i][<span class="number">0</span>] + rotation[i][<span class="number">3</span>]*rotation[i][<span class="number">3</span>])</span><br><span class="line">        singular = sy &lt; <span class="number">1e-6</span></span><br><span class="line">        eulers = []</span><br><span class="line">        <span class="keyword">if</span> ~singular:</span><br><span class="line">            eulers.append(-math.atan2(rotation[i][<span class="number">7</span>], rotation[i][<span class="number">8</span>]))</span><br><span class="line">            eulers.append(-math.atan2(-rotation[i][<span class="number">6</span>], sy))</span><br><span class="line">            eulers.append(-math.atan2(rotation[i][<span class="number">3</span>], rotation[i][<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            eulers.append(-math.atan2(-rotation[i][<span class="number">5</span>], rotation[i][<span class="number">4</span>]))</span><br><span class="line">            eulers.append(-math.atan2(-rotation[i][<span class="number">6</span>], sy))</span><br><span class="line">            eulers.append(<span class="number">0</span>)</span><br><span class="line">        eulers = np.array(eulers)</span><br><span class="line">        euler.append(eulers)</span><br><span class="line">    euler = np.array(euler)</span><br><span class="line">    <span class="keyword">return</span> euler</span><br></pre></td></tr></table></figure><h2 id="2-2-欧拉角转旋转矩阵"><a href="#2-2-欧拉角转旋转矩阵" class="headerlink" title="2.2 欧拉角转旋转矩阵"></a>2.2 欧拉角转旋转矩阵</h2><ul><li>Python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yaw pitch roll</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">EularToRotationMatrix</span><span class="params">(angle)</span>:</span></span><br><span class="line">    y = angle[<span class="number">0</span>]</span><br><span class="line">    p = angle[<span class="number">1</span>]</span><br><span class="line">    r = angle[<span class="number">2</span>]</span><br><span class="line">    Rx = random.rand(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    Ry = random.rand(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    Rz = random.rand(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    Rz[<span class="number">0</span>, <span class="number">0</span>] = math.cos(y)</span><br><span class="line">    Rz[<span class="number">0</span>, <span class="number">1</span>] = -math.sin(y)</span><br><span class="line">    Rz[<span class="number">0</span>, <span class="number">2</span>] = <span class="number">0.0</span></span><br><span class="line">    Rz[<span class="number">1</span>, <span class="number">0</span>] = math.sin(y)</span><br><span class="line">    Rz[<span class="number">1</span>, <span class="number">1</span>] = math.cos(y)</span><br><span class="line">    Rz[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">0.0</span></span><br><span class="line">    Rz[<span class="number">2</span>, <span class="number">0</span>] = <span class="number">0.0</span></span><br><span class="line">    Rz[<span class="number">2</span>, <span class="number">1</span>] = <span class="number">0.0</span></span><br><span class="line">    Rz[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1.0</span></span><br><span class="line">    Ry[<span class="number">0</span>, <span class="number">0</span>] = math.cos(p)</span><br><span class="line">    Ry[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">0.0</span></span><br><span class="line">    Ry[<span class="number">0</span>, <span class="number">2</span>] = math.sin(p)</span><br><span class="line">    Ry[<span class="number">1</span>, <span class="number">0</span>] = <span class="number">0.0</span></span><br><span class="line">    Ry[<span class="number">1</span>, <span class="number">1</span>] = <span class="number">1.0</span></span><br><span class="line">    Ry[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">0.0</span></span><br><span class="line">    Ry[<span class="number">2</span>, <span class="number">0</span>] = -math.sin(p)</span><br><span class="line">    Ry[<span class="number">2</span>, <span class="number">1</span>] = <span class="number">0.0</span></span><br><span class="line">    Ry[<span class="number">2</span>, <span class="number">2</span>] = math.cos(p)</span><br><span class="line">    Rx[<span class="number">0</span>, <span class="number">0</span>] = <span class="number">1.0</span></span><br><span class="line">    Rx[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">0.0</span></span><br><span class="line">    Rx[<span class="number">0</span>, <span class="number">2</span>] = <span class="number">0.0</span></span><br><span class="line">    Rx[<span class="number">1</span>, <span class="number">0</span>] = <span class="number">0.0</span></span><br><span class="line">    Rx[<span class="number">1</span>, <span class="number">1</span>] = math.cos(r)</span><br><span class="line">    Rx[<span class="number">1</span>, <span class="number">2</span>] = -math.sin(r)</span><br><span class="line">    Rx[<span class="number">2</span>, <span class="number">0</span>] = <span class="number">0.0</span></span><br><span class="line">    Rx[<span class="number">2</span>, <span class="number">1</span>] = math.sin(r)</span><br><span class="line">    Rx[<span class="number">2</span>, <span class="number">2</span>] = math.cos(r)</span><br><span class="line">    <span class="keyword">return</span> np.dot(np.dot(Rz, Ry), Rx)</span><br></pre></td></tr></table></figure><h1 id="3-欧拉角与四元数相互转换"><a href="#3-欧拉角与四元数相互转换" class="headerlink" title="3. 欧拉角与四元数相互转换"></a>3. 欧拉角与四元数相互转换</h1><h2 id="3-1-欧拉角转四元数"><a href="#3-1-欧拉角转四元数" class="headerlink" title="3.1 欧拉角转四元数"></a>3.1 欧拉角转四元数</h2><ul><li>C++</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// euler angles: roll pitch yaw</span></span><br><span class="line"><span class="keyword">void</span> Utility::EulerAngleToQuat(<span class="keyword">const</span> Eigen::Vector3d euler, Eigen::Quaterniond&amp; quat)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> fCosHRoll = <span class="built_in">cos</span>(euler[<span class="number">0</span>] * <span class="number">.5</span>f);</span><br><span class="line">    <span class="keyword">float</span> fSinHRoll = <span class="built_in">sin</span>(euler[<span class="number">0</span>] * <span class="number">.5</span>f);</span><br><span class="line">    <span class="keyword">float</span> fCosHPitch = <span class="built_in">cos</span>(euler[<span class="number">1</span>] * <span class="number">.5</span>f);</span><br><span class="line">    <span class="keyword">float</span> fSinHPitch = <span class="built_in">sin</span>(euler[<span class="number">1</span>] * <span class="number">.5</span>f);</span><br><span class="line">    <span class="keyword">float</span> fCosHYaw = <span class="built_in">cos</span>(euler[<span class="number">2</span>] * <span class="number">.5</span>f);</span><br><span class="line">    <span class="keyword">float</span> fSinHYaw = <span class="built_in">sin</span>(euler[<span class="number">2</span>] * <span class="number">.5</span>f);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// Cartesian coordinate System</span></span><br><span class="line">    <span class="keyword">float</span> w = fCosHRoll * fCosHPitch * fCosHYaw + fSinHRoll * fSinHPitch * fSinHYaw;</span><br><span class="line">    <span class="keyword">float</span> x = fSinHRoll * fCosHPitch * fCosHYaw - fCosHRoll * fSinHPitch * fSinHYaw;</span><br><span class="line">    <span class="keyword">float</span> y = fCosHRoll * fSinHPitch * fCosHYaw + fSinHRoll * fCosHPitch * fSinHYaw;</span><br><span class="line">    <span class="keyword">float</span> z = fCosHRoll * fCosHPitch * fSinHYaw - fSinHRoll * fSinHPitch * fCosHYaw;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    float w = fCosHRoll * fCosHPitch * fCosHYaw + fSinHRoll * fSinHPitch * fSinHYaw;</span></span><br><span class="line"><span class="comment">//    float x = fCosHRoll * fSinHPitch * fCosHYaw + fSinHRoll * fCosHPitch * fSinHYaw;</span></span><br><span class="line"><span class="comment">//    float y = fCosHRoll * fCosHPitch * fSinHYaw - fSinHRoll * fSinHPitch * fCosHYaw;</span></span><br><span class="line"><span class="comment">//    float z = fSinHRoll * fCosHPitch * fCosHYaw - fCosHRoll * fSinHPitch * fSinHYaw;</span></span><br><span class="line">    </span><br><span class="line">    quat.coeffs().w() = w;</span><br><span class="line">    quat.coeffs().x() = x;</span><br><span class="line">    quat.coeffs().y() = y;</span><br><span class="line">    quat.coeffs().z() = z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">EulerAngle Quaternion::GetEulerAngle() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">EulerAngle ea;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Cartesian coordinate System </span></span><br><span class="line"><span class="comment">//ea.m_fRoll  = atan2(2 * (w * x + y * z) , 1 - 2 * (x * x + y * y));</span></span><br><span class="line"><span class="comment">//ea.m_fPitch = asin(2 * (w * y - z * x));</span></span><br><span class="line"><span class="comment">//ea.m_fYaw   = atan2(2 * (w * z + x * y) , 1 - 2 * (y * y + z * z));</span></span><br><span class="line"></span><br><span class="line">ea.m_fRoll  = <span class="built_in">atan2</span>(<span class="number">2</span> * (w * z + x * y) , <span class="number">1</span> - <span class="number">2</span> * (z * z + x * x));</span><br><span class="line">ea.m_fPitch = <span class="built_in">asin</span>(CLAMP(<span class="number">2</span> * (w * x - y * z) , <span class="number">-1.0f</span> , <span class="number">1.0f</span>));</span><br><span class="line">ea.m_fYaw   = <span class="built_in">atan2</span>(<span class="number">2</span> * (w * y + z * x) , <span class="number">1</span> - <span class="number">2</span> * (x * x + y * y));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ea;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> Quaternion <span class="title">eulerAngleToQuaternion</span><span class="params">(Vector3f euler, Quaternion quat)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">float</span> fCosHRoll = (<span class="keyword">float</span>) Math.cos(euler.getX() * .<span class="number">5f</span>);</span><br><span class="line">        <span class="keyword">float</span> fSinHRoll = (<span class="keyword">float</span>) Math.sin(euler.getX() * .<span class="number">5f</span>);</span><br><span class="line">        <span class="keyword">float</span> fCosHPitch = (<span class="keyword">float</span>) Math.cos(euler.getY() * .<span class="number">5f</span>);</span><br><span class="line">        <span class="keyword">float</span> fSinHPitch = (<span class="keyword">float</span>) Math.sin(euler.getY() * .<span class="number">5f</span>);</span><br><span class="line">        <span class="keyword">float</span> fCosHYaw = (<span class="keyword">float</span>) Math.cos(euler.getZ() * .<span class="number">5f</span>);</span><br><span class="line">        <span class="keyword">float</span> fSinHYaw = (<span class="keyword">float</span>) Math.sin(euler.getZ() * .<span class="number">5f</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Cartesian coordinate System</span></span><br><span class="line">        <span class="keyword">float</span> w = fCosHRoll * fCosHPitch * fCosHYaw + fSinHRoll * fSinHPitch * fSinHYaw;</span><br><span class="line">        <span class="keyword">float</span> x = fSinHRoll * fCosHPitch * fCosHYaw - fCosHRoll * fSinHPitch * fSinHYaw;</span><br><span class="line">        <span class="keyword">float</span> y = fCosHRoll * fSinHPitch * fCosHYaw + fSinHRoll * fCosHPitch * fSinHYaw;</span><br><span class="line">        <span class="keyword">float</span> z = fCosHRoll * fCosHPitch * fSinHYaw - fSinHRoll * fSinHPitch * fCosHYaw;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    float w = fCosHRoll * fCosHPitch * fCosHYaw + fSinHRoll * fSinHPitch * fSinHYaw;</span></span><br><span class="line"><span class="comment">//    float x = fCosHRoll * fSinHPitch * fCosHYaw + fSinHRoll * fCosHPitch * fSinHYaw;</span></span><br><span class="line"><span class="comment">//    float y = fCosHRoll * fCosHPitch * fSinHYaw - fSinHRoll * fSinHPitch * fCosHYaw;</span></span><br><span class="line"><span class="comment">//    float z = fSinHRoll * fCosHPitch * fCosHYaw - fCosHRoll * fSinHPitch * fSinHYaw;</span></span><br><span class="line"></span><br><span class="line">        quat.setW(w);</span><br><span class="line">        quat.setX(x);</span><br><span class="line">        quat.setY(y);</span><br><span class="line">        quat.setZ(z);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> quat;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>Eigen</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3d euler;</span><br><span class="line">euler[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">euler[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">euler[<span class="number">2</span>] = M_PI/<span class="number">4.0f</span>;</span><br><span class="line"></span><br><span class="line">Eigen::<span class="function">AngleAxisd <span class="title">rollAngle</span><span class="params">(euler[<span class="number">0</span>], Eigen::Vector3d::UnitX())</span></span>;</span><br><span class="line">Eigen::<span class="function">AngleAxisd <span class="title">pitchAngle</span><span class="params">(euler[<span class="number">1</span>], Eigen::Vector3d::UnitY())</span></span>;</span><br><span class="line">Eigen::<span class="function">AngleAxisd <span class="title">yawAngle</span><span class="params">(euler[<span class="number">2</span>], Eigen::Vector3d::UnitZ())</span></span>;</span><br><span class="line">Eigen::Quaterniond q = yawAngle * pitchAngle * rollAngle;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"q = "</span> &lt;&lt; q.coeffs().w() &lt;&lt; <span class="string">" "</span> &lt;&lt; q.coeffs().x() &lt;&lt; <span class="string">" "</span> &lt;&lt; q.coeffs().y() &lt;&lt; <span class="string">" "</span> &lt;&lt; q.coeffs().z() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br></pre></td></tr></table></figure><h3 id><a href="#" class="headerlink" title=" "></a> </h3><h1 id="4-四元数与旋转矩阵相互转换"><a href="#4-四元数与旋转矩阵相互转换" class="headerlink" title="4. 四元数与旋转矩阵相互转换"></a>4. 四元数与旋转矩阵相互转换</h1><h2 id="4-1-旋转矩阵转四元数"><a href="#4-1-旋转矩阵转四元数" class="headerlink" title="4.1 旋转矩阵转四元数"></a>4.1 旋转矩阵转四元数</h2><ul><li>python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotation_matrix_to_quaternion</span><span class="params">(rotation)</span>:</span></span><br><span class="line">    quat = quaternion.quaternion(<span class="number">1</span>, *[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">    trace = rotation[<span class="number">0</span>, <span class="number">0</span>] + rotation[<span class="number">1</span>, <span class="number">1</span>] + rotation[<span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> trace &gt; <span class="number">0</span>:</span><br><span class="line">        s = <span class="number">0.5</span> / math.sqrt(trace + <span class="number">1.0</span>)</span><br><span class="line">        quat.w = <span class="number">0.25</span> / s</span><br><span class="line">        quat.x = (rotation[<span class="number">2</span>, <span class="number">1</span>] - rotation[<span class="number">1</span>, <span class="number">2</span>]) * s</span><br><span class="line">        quat.y = (rotation[<span class="number">0</span>, <span class="number">2</span>] - rotation[<span class="number">2</span>, <span class="number">0</span>]) * s</span><br><span class="line">        quat.z = (rotation[<span class="number">1</span>, <span class="number">0</span>] - rotation[<span class="number">0</span>, <span class="number">1</span>]) * s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> rotation[<span class="number">0</span>, <span class="number">0</span>] &gt; rotation[<span class="number">1</span>, <span class="number">1</span>] <span class="keyword">and</span> rotation[<span class="number">0</span>, <span class="number">0</span>] &gt; rotation[<span class="number">2</span>, <span class="number">2</span>]:</span><br><span class="line">            s = <span class="number">2.0</span> * math.sqrt(<span class="number">1.0</span> + rotation[<span class="number">0</span>, <span class="number">0</span>] - rotation[<span class="number">1</span>, <span class="number">1</span>] - rotation[<span class="number">2</span>, <span class="number">2</span>])</span><br><span class="line">            quat.w = (rotation[<span class="number">2</span>, <span class="number">1</span>] - rotation[<span class="number">1</span>, <span class="number">2</span>]) / s</span><br><span class="line">            quat.x = <span class="number">0.25</span> * s</span><br><span class="line">            quat.y = (rotation[<span class="number">0</span>, <span class="number">1</span>] + rotation[<span class="number">1</span>, <span class="number">0</span>]) / s</span><br><span class="line">            quat.z = (rotation[<span class="number">0</span>, <span class="number">2</span>] + rotation[<span class="number">2</span>, <span class="number">0</span>]) / s</span><br><span class="line">        <span class="keyword">elif</span> rotation[<span class="number">1</span>, <span class="number">1</span>] &gt; rotation[<span class="number">2</span>, <span class="number">2</span>]:</span><br><span class="line">            s = <span class="number">2.0</span> * math.sqrt(<span class="number">1.0</span> + rotation[<span class="number">1</span>, <span class="number">1</span>] - rotation[<span class="number">0</span>, <span class="number">0</span>] - rotation[<span class="number">2</span>, <span class="number">2</span>])</span><br><span class="line">            quat.w = (rotation[<span class="number">0</span>, <span class="number">2</span>] - rotation[<span class="number">2</span>, <span class="number">0</span>]) / s</span><br><span class="line">            quat.x = (rotation[<span class="number">0</span>, <span class="number">1</span>] + rotation[<span class="number">1</span>, <span class="number">0</span>]) / s</span><br><span class="line">            quat.y = <span class="number">0.25</span> * s</span><br><span class="line">            quat.z = (rotation[<span class="number">1</span>, <span class="number">2</span>] + rotation[<span class="number">2</span>, <span class="number">1</span>]) / s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = <span class="number">2.0</span> * math.sqrt(<span class="number">1.0</span> + rotation[<span class="number">2</span>, <span class="number">2</span>] - rotation[<span class="number">0</span>, <span class="number">0</span>] - rotation[<span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line">            quat.w = (rotation[<span class="number">1</span>, <span class="number">0</span>] - rotation[<span class="number">0</span>, <span class="number">1</span>]) / s</span><br><span class="line">            quat.x = (rotation[<span class="number">0</span>, <span class="number">2</span>] + rotation[<span class="number">2</span>, <span class="number">0</span>]) / s</span><br><span class="line">            quat.y = (rotation[<span class="number">1</span>, <span class="number">2</span>] + rotation[<span class="number">2</span>, <span class="number">1</span>]) / s</span><br><span class="line">            quat.z = <span class="number">0.25</span> * s</span><br><span class="line">    quat_array = [quat.w, quat.x, quat.y, quat.z]</span><br><span class="line">    <span class="keyword">return</span> np.array(quat_array)</span><br></pre></td></tr></table></figure><h2 id="4-2-四元数转旋转矩阵"><a href="#4-2-四元数转旋转矩阵" class="headerlink" title="4.2 四元数转旋转矩阵"></a>4.2 四元数转旋转矩阵</h2><ul><li>python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># qw, qx, qy, qz</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">QuatToRotationMatrix</span><span class="params">(q)</span>:</span></span><br><span class="line">    R = np.eye(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    w = q[<span class="number">0</span>]</span><br><span class="line">    x = q[<span class="number">1</span>]</span><br><span class="line">    y = q[<span class="number">2</span>]</span><br><span class="line">    z = q[<span class="number">3</span>]</span><br><span class="line">    x2 = x * x</span><br><span class="line">    y2 = y * y</span><br><span class="line">    z2 = z * z</span><br><span class="line">    xy = x * y</span><br><span class="line">    xz = x * z</span><br><span class="line">    yz = y * z</span><br><span class="line">    wx = w * x</span><br><span class="line">    wy = w * y</span><br><span class="line">    wz = w * z</span><br><span class="line">    R[<span class="number">0</span>, <span class="number">0</span>] = <span class="number">1.0</span> - <span class="number">2.0</span> * (y2 + z2)</span><br><span class="line">    R[<span class="number">0</span>, <span class="number">1</span>] = <span class="number">2.0</span> * (xy - wz)</span><br><span class="line">    R[<span class="number">0</span>, <span class="number">2</span>] = <span class="number">2.0</span> * (xz + wy)</span><br><span class="line">    R[<span class="number">1</span>, <span class="number">0</span>] = <span class="number">2.0</span> * (xy + wz)</span><br><span class="line">    R[<span class="number">1</span>, <span class="number">1</span>] = <span class="number">1.0</span> - <span class="number">2.0</span> * (x2 + z2)</span><br><span class="line">    R[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">2.0</span> * (yz - wx)</span><br><span class="line">    R[<span class="number">2</span>, <span class="number">0</span>] = <span class="number">2.0</span> * (xz - wy)</span><br><span class="line">    R[<span class="number">2</span>, <span class="number">1</span>] = <span class="number">2.0</span> * (yz + wx)</span><br><span class="line">    R[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1.0</span> - <span class="number">2.0</span> * (x2 + y2)</span><br><span class="line">    <span class="keyword">return</span> R</span><br></pre></td></tr></table></figure><h1 id="5-其他变换"><a href="#5-其他变换" class="headerlink" title="5. 其他变换"></a>5. 其他变换</h1><h2 id="5-1-静止检测"><a href="#5-1-静止检测" class="headerlink" title="5.1 静止检测"></a>5.1 静止检测</h2><ul><li>Python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetMotionState</span><span class="params">(values)</span>:</span></span><br><span class="line">    state = []</span><br><span class="line">    isMoving = false</span><br><span class="line">    moveBeg = false</span><br><span class="line">    xPositive = false</span><br><span class="line">    xNegative = false</span><br><span class="line">    yPositive = false</span><br><span class="line">    yNegative = false</span><br><span class="line">    zPositive = false</span><br><span class="line">    zNegative = false</span><br><span class="line">    userAccel = max(max(abs(values[<span class="number">0</span>]), abs(values[<span class="number">1</span>])), abs(values[<span class="number">2</span>]))</span><br><span class="line">    <span class="keyword">if</span> userAccel &gt; <span class="number">0.07</span>:</span><br><span class="line">        isMoving = <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">if</span> isMoving :</span><br><span class="line">        moveBeg = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">if</span> userAccel == fabs(values[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">if</span> values[<span class="number">0</span>] &gt; <span class="number">0</span>:</span><br><span class="line">                xPositive = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                xNegative = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">elif</span> userAccel == fabs(values[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> values[<span class="number">1</span>] &gt; <span class="number">0</span>:</span><br><span class="line">                yPositive = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                yNegative = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">elif</span> userAccel == fabs(values[<span class="number">2</span>]):</span><br><span class="line">            <span class="keyword">if</span> values[<span class="number">2</span>] &gt; <span class="number">0</span>:</span><br><span class="line">                zPositive = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                zNegative = <span class="keyword">True</span></span><br><span class="line">        state = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> moveBeg:</span><br><span class="line">            changeSymbol = false</span><br><span class="line">            <span class="keyword">if</span> xPositive <span class="keyword">or</span> xNegative:</span><br><span class="line">                <span class="keyword">if</span> xPositive <span class="keyword">and</span> xNegative:</span><br><span class="line">                    changeSymbol = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">elif</span> yPositive <span class="keyword">or</span> yNegative:</span><br><span class="line">                <span class="keyword">if</span> yPositive <span class="keyword">and</span> yNegative:</span><br><span class="line">                    changeSymbol = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">elif</span> zPositive <span class="keyword">or</span> zNegative:</span><br><span class="line">                <span class="keyword">if</span> zPositive <span class="keyword">and</span> zNegative:</span><br><span class="line">                    changeSymbol = <span class="keyword">True</span></span><br><span class="line">            xPositive = false</span><br><span class="line">            xNegative = false</span><br><span class="line">            yPositive = false</span><br><span class="line">            yNegative = false</span><br><span class="line">            zPositive = false</span><br><span class="line">            zNegative = false</span><br><span class="line">            <span class="keyword">if</span> ~changeSymbol:</span><br><span class="line">                state = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                state = <span class="number">0</span></span><br><span class="line">            moveBeg = false</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            state = <span class="number">0</span></span><br><span class="line">    moveBeg = false</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetMotionStateVar</span><span class="params">(values)</span>:</span></span><br><span class="line">    state = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">global</span> values_buf</span><br><span class="line">    value = sqrt(pow(values[<span class="number">0</span>], <span class="number">2</span>) + pow(values[<span class="number">1</span>], <span class="number">2</span>) + pow(values[<span class="number">2</span>], <span class="number">2</span>))</span><br><span class="line">    values_buf.append(value)</span><br><span class="line">    <span class="keyword">print</span> len(values_buf)</span><br><span class="line">    <span class="keyword">if</span> len(values_buf) &gt;= <span class="number">120</span>*<span class="number">0.3</span> <span class="keyword">and</span> len(values_buf) &lt;= <span class="number">120</span>*<span class="number">2</span>:</span><br><span class="line">        var = VarCalculation(values_buf)</span><br><span class="line">        <span class="keyword">print</span> var</span><br><span class="line">        <span class="keyword">if</span> var &gt;= <span class="number">0.0003</span>:</span><br><span class="line">            state = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            state = <span class="number">0</span></span><br><span class="line">        <span class="keyword">del</span>(values_buf[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">elif</span> len(values_buf) &lt; <span class="number">120</span>*<span class="number">0.3</span>:</span><br><span class="line">        state = <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">del</span>(values_buf[<span class="number">0</span>])</span><br><span class="line">        state = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">VarCalculation</span><span class="params">(values_buf)</span>:</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    m = len(values_buf)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        sum += values_buf[i]</span><br><span class="line">    dAve = sum/m;</span><br><span class="line">    dVar = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):</span><br><span class="line">        dVar += (values_buf[i]-dAve)*(values_buf[i]-dAve);</span><br><span class="line">    <span class="keyword">return</span> dVar/m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LowPassFilter</span><span class="params">(values, time)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> values</span><br><span class="line">    <span class="keyword">global</span> output</span><br><span class="line">    <span class="keyword">global</span> startTime</span><br><span class="line">    <span class="keyword">global</span> timestamp</span><br><span class="line">    <span class="keyword">global</span> dt</span><br><span class="line">    <span class="keyword">global</span> alpha</span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line">    <span class="keyword">if</span> startTime == <span class="number">0</span>:</span><br><span class="line">        startTime = time*<span class="number">1000</span></span><br><span class="line">    timestamp = time*<span class="number">1000</span>+<span class="number">0.0000001</span></span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    dt = <span class="number">1.0</span> / (count/(float((timestamp-startTime))/<span class="number">1000.0</span>))</span><br><span class="line">    alpha = <span class="number">0.05</span> / (<span class="number">0.05</span> + dt)</span><br><span class="line"><span class="comment">#     print(startTime, timestamp, count, dt, alpha)</span></span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">5</span>:</span><br><span class="line">        output[<span class="number">0</span>] = alpha * output[<span class="number">0</span>] + (<span class="number">1</span>-alpha)*values[<span class="number">0</span>]</span><br><span class="line">        output[<span class="number">1</span>] = alpha * output[<span class="number">1</span>] + (<span class="number">1</span>-alpha)*values[<span class="number">1</span>]</span><br><span class="line">        output[<span class="number">2</span>] = alpha * output[<span class="number">2</span>] + (<span class="number">1</span>-alpha)*values[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        output[<span class="number">0</span>] = values[<span class="number">0</span>]</span><br><span class="line">        output[<span class="number">1</span>] = values[<span class="number">1</span>]</span><br><span class="line">        output[<span class="number">2</span>] = values[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">print</span> output</span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure><h2 id="5-2-数据点对齐"><a href="#5-2-数据点对齐" class="headerlink" title="5.2 数据点对齐"></a>5.2 数据点对齐</h2><ul><li>Python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">searchInsert</span><span class="params">(nums, target)</span>:</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    end = len(nums) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> start &lt;= end:</span><br><span class="line">        mid = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> nums[mid] == target:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> nums[mid] &lt; target:</span><br><span class="line">            start = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = mid - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> end + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给定一个元素，在制定list中查找最相邻的元素</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rIndex</span><span class="params">(nums, target)</span>:</span></span><br><span class="line">    n = len(nums)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>: <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    mid = searchInsert(nums, target)</span><br><span class="line">    rlist = []  <span class="comment"># 保持索引</span></span><br><span class="line">    i, j = <span class="number">-1</span>, n</span><br><span class="line">    left, rigth = <span class="number">0</span>, <span class="number">0</span>  <span class="comment"># 左右扩展的标志</span></span><br><span class="line">    mxg = float(<span class="string">'-inf'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; mid &lt; n:  <span class="comment"># 如果找到了</span></span><br><span class="line">        i, j = mid<span class="number">-1</span>, mid</span><br><span class="line">        mxg = min(abs(nums[i] - target), abs(nums[j] - target))</span><br><span class="line">        left, rigth = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> mid == <span class="number">0</span>:  <span class="comment"># 小于最左边的数字</span></span><br><span class="line">        j = mid</span><br><span class="line">        mxg = abs(nums[j] - target)</span><br><span class="line">        left, rigth = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> mid == n:  <span class="comment"># 大于最右边的数字</span></span><br><span class="line">        i = mid<span class="number">-1</span></span><br><span class="line">        mxg = abs(nums[i] - target)</span><br><span class="line">        left, rigth = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> left == <span class="number">1</span> <span class="keyword">or</span> rigth == <span class="number">1</span>:  <span class="comment"># 两边查找</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">-1</span>: left = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> j == n: rigth = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> left == <span class="number">1</span> <span class="keyword">and</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">            le = abs(nums[i] - target)</span><br><span class="line">            <span class="keyword">if</span> le == mxg:</span><br><span class="line">                rlist = [i] + rlist</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> rigth == <span class="number">1</span> <span class="keyword">and</span> j &lt; len(nums):</span><br><span class="line">            ri = abs(nums[j] - target)</span><br><span class="line">            <span class="keyword">if</span> mxg == ri:</span><br><span class="line">                rlist = rlist + [j]</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rigth = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> rlist</span><br></pre></td></tr></table></figure><h2 id="5-3-向量转四元数"><a href="#5-3-向量转四元数" class="headerlink" title="5.3 向量转四元数"></a>5.3 向量转四元数</h2><ul><li>Python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quaternion_from_two_vectors</span><span class="params">(v1, v2)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Compute quaternion from two vectors. v1 and v2 need not be normalized.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param v1: starting vector</span></span><br><span class="line"><span class="string">    :param v2: ending vector</span></span><br><span class="line"><span class="string">    :return Quaternion representation of rotation that rotate v1 to v2.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    v1n = v1 / np.linalg.norm(v1)</span><br><span class="line">    <span class="comment">#     print(v1n)</span></span><br><span class="line">    v2n = v2 / np.linalg.norm(v2)</span><br><span class="line">    <span class="comment">#     print(v2n)</span></span><br><span class="line">    w = np.cross(v1n, v2n)</span><br><span class="line">    <span class="comment">#     print("w = &#123;&#125;".format(w))</span></span><br><span class="line">    q = np.array([<span class="number">1.0</span> + np.dot(v1n, v2n), *w])</span><br><span class="line">    <span class="comment">#     print("q = &#123;&#125;".format(q))</span></span><br><span class="line">    q /= np.linalg.norm(q)</span><br><span class="line">    <span class="comment">#     print("q_normlizaed = &#123;&#125;".format(q))</span></span><br><span class="line">    <span class="keyword">return</span> quaternion.quaternion(*q)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> SLAM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> SLAM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux实战技能（三）-系统管理</title>
      <link href="/2019/12/06/programmings/linux/Linux%E5%AE%9E%E6%88%98%E6%8A%80%E8%83%BD%EF%BC%88%E4%B8%89%EF%BC%89-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
      <url>/2019/12/06/programmings/linux/Linux%E5%AE%9E%E6%88%98%E6%8A%80%E8%83%BD%EF%BC%88%E4%B8%89%EF%BC%89-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="1-网络管理"><a href="#1-网络管理" class="headerlink" title="1. 网络管理"></a>1. 网络管理</h1><h2 id="1-1-⽹络状态查看"><a href="#1-1-⽹络状态查看" class="headerlink" title="1.1 ⽹络状态查看"></a>1.1 ⽹络状态查看</h2><ul><li>net-tools<ul><li>ifconfig<ul><li>eth0 第⼀块⽹卡（⽹络接口）</li><li>查看⽹卡物理连接情况<ul><li>mii-tool eth0</li></ul></li></ul></li><li>route<ul><li>查看⽹网关<ul><li>route -n</li><li>使⽤ -n 参数不解析主机名</li></ul></li><li>添加⽹关<ul><li>route add default gw &lt;⽹网关ip&gt;</li><li>route add -host &lt;指定ip&gt; gw &lt;⽹网关ip&gt;</li><li>route add -net &lt;指定⽹网段&gt; netmask &lt;⼦子⽹网掩码&gt; gw &lt;⽹网关ip&gt;</li></ul></li></ul></li><li>netstat</li></ul></li><li>Iproute<ul><li>ip<ul><li>ip addr ls<ul><li>ifconfig</li></ul></li><li>ip link set dev eth0 up<ul><li>ifup eth0</li></ul></li><li>ip addr add 10.0.0.1/24 dev eth1<ul><li>ifconfig eth1 10.0.0.1 netmask 255.255.255.0</li></ul></li><li>ip route add 10.0.0/24 via 192.168.0.1<ul><li>route add -net 10.0.0.0 netmask 255.255.255.0 gw 192.168.0.1</li></ul></li></ul></li><li>Ss</li></ul></li></ul><h2 id="1-2-⽹络故障排除命令"><a href="#1-2-⽹络故障排除命令" class="headerlink" title="1.2 ⽹络故障排除命令"></a>1.2 ⽹络故障排除命令</h2><ul><li>ping<ul><li>网络通不通</li></ul></li><li>traceroute<ul><li>路由</li></ul></li><li>mtr<ul><li>丢包</li></ul></li><li>nslookup<ul><li>域名访问</li></ul></li><li>telnet<ul><li>端口问题</li></ul></li><li>tcpdump</li><li>netstat</li><li>ss</li></ul><h2 id="1-3-网络服务管理"><a href="#1-3-网络服务管理" class="headerlink" title="1.3 网络服务管理"></a>1.3 网络服务管理</h2><ul><li>⽹络服务管理程序分为两种，分别为SysV和systemd<ul><li>service network start|stop|restart</li><li>chkconfig -list network</li><li>systemctl list-unit-files NetworkManager.service</li><li>systemctl start|stop|restart NetworkManger</li><li>systemctl enable|disable NetworkManger</li></ul></li><li>主机名<ul><li>hostname</li><li>hostname c7.test11</li><li>hostname set-hostname c7.test11</li></ul></li></ul><h1 id="2-软件安装"><a href="#2-软件安装" class="headerlink" title="2. 软件安装"></a>2. 软件安装</h1><ul><li>rpm 包和 rpm 命令</li><li>yum 仓库</li><li>源代码编译安装</li><li>内核升级</li><li>grub 配置⽂文件</li></ul><h2 id="2-1-软件包管理器"><a href="#2-1-软件包管理器" class="headerlink" title="2.1 软件包管理器"></a>2.1 软件包管理器</h2><ul><li>包管理器是⽅便软件安装、卸载，解决软件依赖关系的重要工具</li><li>CentOS、RedHat 使⽤ yum 包管理器，软件安装包格式为 rpm</li><li>Debian、Ubuntu 使⽤ apt 包管理器，软件安装包格式为 deb</li><li>rpm 包<ul><li>vim-common-7.4.10-5.el7.x86_64.rpm</li><li>软件名称 软件版本 系统版本 平台</li></ul></li><li>rpm 命令常⽤参数<ul><li>-q 查询软件包</li><li>-i 安装软件包</li><li>-e 卸载软件包</li></ul></li><li>rpm 包的问题<ul><li>需要⾃己解决依赖关系</li><li>软件包来源不不可靠</li></ul></li></ul><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示已经安装的rpm软件包</span></span><br><span class="line">$ rpm -qa</span><br><span class="line"><span class="comment"># 分屏显示</span></span><br><span class="line">$ rpm -qa | more</span><br><span class="line"><span class="comment"># 查询安装的vim软件包</span></span><br><span class="line">$ rpm -q vim*</span><br><span class="line"><span class="comment"># 卸载软件包</span></span><br><span class="line">$ rpm -e vim*</span><br><span class="line"><span class="comment"># 卸载多个软件包</span></span><br><span class="line">$ rpm -e vim* tmux*</span><br></pre></td></tr></table></figure><h2 id="2-2-yum管理软件包"><a href="#2-2-yum管理软件包" class="headerlink" title="2.2 yum管理软件包"></a>2.2 yum管理软件包</h2><ul><li>yum 配置⽂件<ul><li>/etc/yum.repos.d/CentOS-Base.repo</li></ul></li><li>常⽤选项<ul><li>install 安装软件包</li><li>remove 卸载软件包</li><li>list| grouplist 查看软件包</li><li>update 升级软件包</li></ul></li><li>更改yum仓库镜像<ul><li>备份<ul><li>mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</li></ul></li><li>wget -O /etc/yum.repos.d/CentOS-Base.repo <a href="http://mirrors.aliyun.com/repo/Centos-7.repo" target="_blank" rel="noopener">http://mirrors.aliyun.com/repo/Centos-7.repo</a></li><li>yum makecache</li></ul></li><li>yum install vim</li><li>yum remove vim</li><li>yum update</li></ul><h2 id="2-3-其他安装方式"><a href="#2-3-其他安装方式" class="headerlink" title="2.3 其他安装方式"></a>2.3 其他安装方式</h2><ul><li>⼆进制安装</li><li>源代码编译安装<ul><li>wget <a href="https://openresty.org/download/openresty-1.15.8.1.tar.gz" target="_blank" rel="noopener">https://openresty.org/download/openresty-1.15.8.1.tar.gz</a></li><li>tar -zxf openresty-VERSION.tar.gz</li><li>cd openresty-VERSION/</li><li>./configure —prefix=/usr/local/openresty</li><li>make -j2</li><li>make install</li></ul></li></ul><h2 id="2-4-升级内核"><a href="#2-4-升级内核" class="headerlink" title="2.4 升级内核"></a>2.4 升级内核</h2><ul><li><p>rpm 格式内核</p><ul><li>查看内核版本<ul><li>uname –r</li></ul></li></ul></li><li><p>yum安装</p><ul><li>升级内核版本<ul><li>yum install kernel-3.10.0</li></ul></li><li>升级已安装的其他软件包和补丁<ul><li>yum update</li></ul></li></ul></li><li><p>源代码编译安装内核</p><ul><li><p>安装依赖包</p><ul><li>yum install gcc gcc-c++ make ncurses-devel openssl-devel elfutils-libelf-devel</li></ul></li><li><p>下载并解压缩内核</p><ul><li><a href="https://www.kernel.org" target="_blank" rel="noopener">https://www.kernel.org</a></li><li>tar xvf linux-5.1.10.tar.xz -C /usr/src/kernels</li></ul></li><li><p>配置内核编译参数</p><ul><li>cd /usr/src/kernels/linux-5.1.10/</li><li>make menuconfig | allyesconfig | allnoconfig</li></ul></li><li><p>使⽤当前系统内核配置</p><ul><li><p>cp /boot/config-kernelversion.platform /usr/src/kernels/</p><p>  linux-5.1.10/.config</p></li></ul></li><li><p>编译</p><ul><li>make -j2 all</li><li>其中CPU数目可通过命令lscpu查询</li></ul></li><li><p>安装内核</p><ul><li>安装内核支持的组件<ul><li>make modules_install</li></ul></li><li>安装内核<ul><li>make install</li></ul></li></ul></li></ul></li></ul><h2 id="2-5-grub-配置⽂件"><a href="#2-5-grub-配置⽂件" class="headerlink" title="2.5 grub 配置⽂件"></a>2.5 grub 配置⽂件</h2><ul><li>grub 配置⽂件<ul><li>基本grub配置<ul><li>/etc/default/grub</li></ul></li><li>新的grub配置文件<ul><li>/etc/grub.d/</li><li>/boot/grub2/grub.cfg</li><li>grub2-mkconfig -o /boot/grub2/grub.cfg</li></ul></li></ul></li></ul><h1 id="3-进程管理"><a href="#3-进程管理" class="headerlink" title="3. 进程管理"></a>3. 进程管理</h1><ul><li>进程—运⾏中的程序，从程序开始运⾏到终⽌的整个⽣生命周期是可管理的</li><li>进程也是树形结构</li><li>进程和权限有着密不可分的关系</li><li>查看命令<ul><li>ps</li><li>pstree</li><li>top</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看进行信息，包括UID、PID、PPID、C、STIME、TTY、TIME、CMD</span></span><br><span class="line">$ ps -eLf | more</span><br><span class="line"></span><br><span class="line"><span class="comment"># MacOS信息</span></span><br><span class="line">$ top</span><br><span class="line">Processes: 405 total, 5 running, 400 sleeping, 1826 threads                                                              22:02:45</span><br><span class="line">Load Avg: 3.54, 4.17, 4.47  CPU usage: 15.43% user, 19.71% sys, 64.84% idle  SharedLibs: 138M resident, 42M data, 24M linkedit.</span><br><span class="line">MemRegions: 98102 total, 2019M resident, 101M private, 1087M shared. PhysMem: 7732M used (2199M wired), 459M unused.</span><br><span class="line">VM: 1969G vsize, 1372M framework vsize, 118892587(0) swapins, 120274963(0) swapouts.</span><br><span class="line">Networks: packets: 111277167/150G <span class="keyword">in</span>, 85519715/43G out. Disks: 21984786/773G <span class="built_in">read</span>, 16581121/641G written.</span><br><span class="line">- Load Avg为平均负载，用来衡量系统的繁忙程度，包括1min, 5min, 15min</span><br><span class="line">- CPU usage为CPU利用率</span><br><span class="line">- Processes处理的任务</span><br></pre></td></tr></table></figure><ul><li>进程的优先级调整<ul><li>nice 范围从-20 到 19 ，值越⼩小优先级越⾼高，抢占资源就越多</li><li>renice 重新设置优先级</li><li>进程的作业控制<ul><li>jobs</li><li>&amp; 符号</li></ul></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> $$</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">:</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ ./XXX.sh</span><br><span class="line">18746</span><br><span class="line"></span><br><span class="line">$ top -p 18746</span><br><span class="line">$ nice -n 10 ./XXX.sh</span><br><span class="line">$ renice -n 15 18764</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序运行在后台</span></span><br><span class="line">$ ./XXX.sh &amp;</span><br><span class="line"><span class="comment"># 程序运行在前台</span></span><br><span class="line">$ <span class="built_in">jobs</span></span><br><span class="line">$ <span class="built_in">fg</span> 1</span><br></pre></td></tr></table></figure><ul><li>进程通信信号<ul><li>Ctrl + C终止进程</li><li>kill -9 id终止id进程</li></ul></li><li>守护进程<ul><li>使⽤nohup 与 &amp; 符号配合运⾏⼀个命令<ul><li>运行的该命令将不会因为终端等关闭而终止</li></ul></li><li>screen 命令<ul><li>进入screen，命令为screen</li><li>退出，ctrl+a d</li><li>screen -ls 查看 screen 的会话</li><li>screen -r sessionid 恢复会话</li></ul></li></ul></li><li>查看系统日志<ul><li>路径为/var/log/</li><li>messages，操作日志</li><li>dmesg，内核相关日志信息</li><li>secure，安全日志</li><li>cron，计划任务日志</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行程序</span></span><br><span class="line">$ nohup sh XXX.sh &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入screen环境</span></span><br><span class="line">$ screen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复程序</span></span><br><span class="line">$ screen -r sessionid</span><br></pre></td></tr></table></figure><h1 id="4-服务管理工具"><a href="#4-服务管理工具" class="headerlink" title="4. 服务管理工具"></a>4. 服务管理工具</h1><ul><li>服务（提供常⻅功能的守护进程）集中管理工具<ul><li>service<ul><li>/etc/init.d/</li></ul></li><li>systemctl<ul><li>/usr/lib/systemd/system/</li><li>systemctl start | stop | restart | reload | enable | disable 服务名称</li></ul></li></ul></li></ul><h1 id="5-内存和磁盘管理"><a href="#5-内存和磁盘管理" class="headerlink" title="5. 内存和磁盘管理"></a>5. 内存和磁盘管理</h1><ul><li>内存使用率查看<ul><li>free<ul><li>free -m</li><li>free -g</li></ul></li><li>top</li><li>du<ul><li>du -h</li></ul></li><li>fdisk<ul><li>fdisk -l</li></ul></li><li>df<ul><li>df -h</li></ul></li></ul></li><li>文件系统<ul><li>ext4<ul><li>超级块、超级块副本</li><li>i 节点(inode)<ul><li>ls -i</li><li>记录每一个文件相关属性</li></ul></li><li>数据块(datablock)<ul><li>记录数据</li></ul></li></ul></li><li>cp更改了文件i节点和复制了数据block</li><li>mv没有改变i节点和数据block，只更改了文件名</li><li>硬链接ln，不改变文件的i节点</li><li>软连接ln -s，更改了文件i节点</li></ul></li><li>磁盘分区和挂载<ul><li>fdisk /dev/sdc</li><li>parted</li></ul></li><li>逻辑卷管理<ul><li>pvcreate /dev/sdb1</li><li>pvs，显示所有物理卷</li></ul></li></ul><h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h1><ul><li><a href="geekbang.org">Linux实战技能100讲</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构与算法（三）-链表</title>
      <link href="/2019/11/30/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%89%EF%BC%89-%E9%93%BE%E8%A1%A8/"/>
      <url>/2019/11/30/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%89%EF%BC%89-%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>数组需要一块连续的内存空间来存储，对内存的要求比较高，而链表恰恰相反，它并不需要一块连续的内存空间，它通过“指针”将一组零散的内存块串联起来使用</li><li>内存块称为链表的“结点”</li><li>为了将所有的结点串起来，每个链表的结点除了存储数据之外，还需要记录链上的下一个结点的地址，把这个记录下个结点地址的指针叫作后继指针 next</li><li>第一个结点叫作头结点，用来记录链表的基地址，基于头结点，可以遍历得到整条链表</li><li>最后一个结点叫作尾结点，指向一个空地址 NULL</li><li>优点<ul><li>快速插入和删除，时间复杂度为O(1)</li></ul></li><li>缺点<ul><li>无法快速的随机访问第 k 个元素，需要根据指针一个结点一个结点地依次遍历，直到找到相应的结点，时间复杂度为O(n)</li></ul></li></ul><h1 id="2-单链表"><a href="#2-单链表" class="headerlink" title="2. 单链表"></a>2. 单链表</h1><ul><li>结点定义<ul><li>结点由存放数据元素的数据域存放后继结点地址的指针域组成</li><li>假设p是指向线性表第i个元素的指针，则该结点ai的数据域我们可以用p-&gt;data来表示，p-&gt;data的值是一个数据元素，结点ai的指针域可以用 p-&gt;next来表示，p-&gt;next的值是一个指针。p-&gt;next指向第i+1个元素，即指向ai+1的指针</li><li>关于结构体”struct Node *next;”，next是指向下一个Node，所以其类型必须是Node，但是 Node 是结构体，所以前面还得加上个 struct</li><li>“Node(const int&amp; d): data(d), next(NULL) {}”是结构体的构造函数，d=T()来指定默认值，用构造函数来初始化成员变量data和指针，所有数据类型，默认初始化都为0，这里data默认初始化为0</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">ElemType data;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">  Node(<span class="keyword">const</span> ElemType&amp; d = ElemType()): data(d), next(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">&#125; Node;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">LinkList</span>;</span></span><br></pre></td></tr></table></figure><p>如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-11-30-133845.png" alt="image-20191130213822896" style="zoom:50%;"></p><p>（图片来源：<a href="https://blog.csdn.net/sinat_20265495/article/details/52716710）" target="_blank" rel="noopener">https://blog.csdn.net/sinat_20265495/article/details/52716710）</a></p><ul><li>创建头结点<ul><li>新建节点Node，将Node的next置为NULL</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head = <span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">head-&gt;next = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure><ul><li>从头插入一个新的节点<ul><li>新建新节点p，p的next的指向head-&gt;next所指向的地址</li><li>head-&gt;next指向p</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Node * p = <span class="keyword">new</span> Node(<span class="keyword">int</span>);</span><br><span class="line">p-&gt;next = data-&gt;next;</span><br><span class="line">head-&gt;next = p;</span><br></pre></td></tr></table></figure><ul><li>删除指定节点<ul><li>先遍历到指定节点的前一个节点</li><li>将前一个节点的next指针指向指定节点的下一个节点，达到悬空指定节点的效果</li><li>删除指定节点</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Node * p = find(d);</span><br><span class="line">Node *q = p-&gt;next;</span><br><span class="line">p-&gt;next = p-&gt;next-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> q;</span><br></pre></td></tr></table></figure><ul><li>修改指定节点<ul><li>遍历到指定节点的位置</li><li>将其data修改为要修改的值</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Node *p = find(d);</span><br><span class="line">p-&gt;next-&gt;data = d_new;</span><br></pre></td></tr></table></figure><ul><li>链表反转<ul><li>定义三个临时节点指向头结点之后的第1个节点p，第2个节点q和第3个节点m</li><li>将p-&gt;next置为空</li><li>将q-&gt;next = p</li><li>将p向后移动一个节点，即p = q</li><li>将q向后移动一个节点，即q = m</li><li>把m向后移动一个节点，即m = m-&gt;next;</li><li>依此类推直到m等于NULL</li><li>将q-&gt;next = p</li><li>将head-&gt;next指向q（即目前第一个节点，也就是原本最后的一个节点）</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Node *p = head-&gt;next;</span><br><span class="line">Node *q = head-&gt;next-&gt;next;</span><br><span class="line">Node *m = head-&gt;next-&gt;next-&gt;next;</span><br><span class="line">p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">while</span>(m) &#123;</span><br><span class="line">    q-&gt;next = p;</span><br><span class="line">    p = q;</span><br><span class="line">    q = m;</span><br><span class="line">    m = m-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line">q-&gt;next = p;</span><br><span class="line">head-&gt;next = q;</span><br></pre></td></tr></table></figure><p>代码如下:</p><ul><li>List.hpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Xiaoqiang Teng on 2019/11/30.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATA_STRUCTURE_LIST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATA_STRUCTURE_LIST_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    List();</span><br><span class="line">    ~List();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateList</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InsertPos</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d_new)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Erase</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Updata</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d_new)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Reverse</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> data;</span><br><span class="line">        Node * next;</span><br><span class="line">        Node(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d):data(d),next(<span class="literal">NULL</span>)&#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Node *head;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node * p = head;</span><br><span class="line">        <span class="keyword">while</span>(p) &#123;</span><br><span class="line">            Node * q = p-&gt;next;</span><br><span class="line">            <span class="keyword">delete</span> p;</span><br><span class="line">            p = q;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node* <span class="title">find</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d)</span> </span>&#123;</span><br><span class="line">        Node * p = head;</span><br><span class="line">        <span class="keyword">for</span>(; p; p = p-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">if</span>(p-&gt;next-&gt;data == d)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//DATA_STRUCTURE_LIST_H</span></span></span><br></pre></td></tr></table></figure><ul><li>List.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Xiaoqiang Teng on 2019/11/30.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"List.h"</span></span></span><br><span class="line"></span><br><span class="line">List::List() &#123;</span><br><span class="line">    CreateList();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List::~List() &#123;</span><br><span class="line">    Clear();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::CreateList() &#123;</span><br><span class="line">    head = <span class="keyword">new</span> Node(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Insert(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d) &#123;</span><br><span class="line">    Node *p = <span class="keyword">new</span> Node(d);</span><br><span class="line">    p-&gt;next = head-&gt;next;</span><br><span class="line">    head-&gt;next = p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::InsertPos(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d_new) &#123;</span><br><span class="line">    Node *p = find(d);</span><br><span class="line">    Node *q = <span class="keyword">new</span> Node(d_new);</span><br><span class="line">    q-&gt;next = p-&gt;next;</span><br><span class="line">    p-&gt;next = q;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Erase(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d) &#123;</span><br><span class="line">    Node *p = find(d);</span><br><span class="line">    Node *q = p-&gt;next;</span><br><span class="line">    p-&gt;next = p-&gt;next-&gt;next;</span><br><span class="line">    <span class="keyword">delete</span> q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Updata(<span class="keyword">const</span> <span class="keyword">int</span>&amp; d, <span class="keyword">const</span> <span class="keyword">int</span>&amp; d_new) &#123;</span><br><span class="line">    Node *p = find(d);</span><br><span class="line">    p-&gt;next-&gt;data = d_new;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Reverse() &#123;</span><br><span class="line">    Node *p = head-&gt;next;</span><br><span class="line">    Node *q = head-&gt;next-&gt;next;</span><br><span class="line">    Node *m = head-&gt;next-&gt;next-&gt;next;</span><br><span class="line">    p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(m) &#123;</span><br><span class="line">        q-&gt;next = p;</span><br><span class="line">        p = q;</span><br><span class="line">        q = m;</span><br><span class="line">        m = m-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;next = p;</span><br><span class="line">    head-&gt;next = q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> List::Print() &#123;</span><br><span class="line">    <span class="keyword">for</span> (Node * p = head-&gt;next; p; p = p-&gt;next) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; p-&gt;data &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码参考：<a href="https://www.cnblogs.com/scandy-yuan/archive/2013/01/06/2847801.html" target="_blank" rel="noopener">https://www.cnblogs.com/scandy-yuan/archive/2013/01/06/2847801.html</a></p><h1 id="3-单向循环链表"><a href="#3-单向循环链表" class="headerlink" title="3. 单向循环链表"></a>3. 单向循环链表</h1><ul><li>单向循环链表和单向链表差不多，只不过是最后的尾节点指向的不是空，而是指向头节点</li><li>优点是从链尾到链头比较方便。当要处理的数据具有环型结构特点时，就特别适合采用循环链表</li></ul><p>代码如下：</p><ul><li>CircularList.hpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Xiaoqiang Teng on 2019/11/30.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATA_STRUCTURE_CIRCULARLIST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATA_STRUCTURE_CIRCULARLIST_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    Node *pNext;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircularList</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    CircularList();</span><br><span class="line">    ~CircularList();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CreateList</span><span class="params">(<span class="keyword">int</span> n)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">TraverseLinkList</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">GetLength</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">InsertNode</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">int</span> d)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteNode</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DeleteLinkList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Node *head;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//DATA_STRUCTURE_CIRCULARLIST_H</span></span></span><br></pre></td></tr></table></figure><ul><li>CircularList.cpp</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Xiaoqiang Teng on 2019/11/30.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CircularList.h"</span></span></span><br><span class="line"></span><br><span class="line">CircularList::CircularList() &#123;</span><br><span class="line">    head = <span class="keyword">new</span> Node;</span><br><span class="line">    head-&gt;data = <span class="number">0</span>;</span><br><span class="line">    head-&gt;pNext = head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CircularList::~CircularList() &#123;</span><br><span class="line">    <span class="keyword">delete</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::CreateList(<span class="keyword">int</span> n) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *pnew, *ptemp = head;</span><br><span class="line">    <span class="keyword">int</span> i = n;</span><br><span class="line">    <span class="keyword">while</span> (n-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        pnew = <span class="keyword">new</span> Node;</span><br><span class="line">        pnew-&gt;data = n;</span><br><span class="line">        pnew-&gt;pNext = head;</span><br><span class="line">        ptemp-&gt;pNext = pnew;</span><br><span class="line">        ptemp = pnew;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::TraverseLinkList() &#123;</span><br><span class="line">    Node *ptemp = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (ptemp != head) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ptemp-&gt;data &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> CircularList::IsEmpty() &#123;</span><br><span class="line">    <span class="keyword">if</span> (head-&gt;pNext == head) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> CircularList::GetLength() &#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">    Node *ptemp = head-&gt;pNext;</span><br><span class="line">    <span class="keyword">while</span> (ptemp != head) &#123;</span><br><span class="line">        n ++;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::InsertNode(<span class="keyword">int</span> position, <span class="keyword">int</span> d) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &lt; <span class="number">0</span> || position &gt; GetLength() + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *pnew, *ptemp = head;</span><br><span class="line">    pnew = <span class="keyword">new</span> Node;</span><br><span class="line">    pnew-&gt;data = d;</span><br><span class="line">    <span class="keyword">while</span> (position-- &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    pnew-&gt;pNext = ptemp-&gt;pNext;</span><br><span class="line">    ptemp-&gt;pNext = pnew;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::DeleteNode(<span class="keyword">int</span> position) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position &lt; <span class="number">0</span> || position &gt; GetLength()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node *ptemp = head, *pdelete;</span><br><span class="line">    <span class="keyword">while</span> (position-- &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        ptemp = ptemp-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">    pdelete = ptemp-&gt;pNext;</span><br><span class="line">    ptemp-&gt;pNext = pdelete-&gt;pNext;</span><br><span class="line">    <span class="keyword">delete</span> pdelete;</span><br><span class="line">    pdelete = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CircularList::DeleteLinkList() &#123;</span><br><span class="line">    Node *pdelete = head-&gt;pNext, *ptemp;</span><br><span class="line">    <span class="keyword">while</span> (pdelete != head) &#123;</span><br><span class="line">        ptemp = pdelete-&gt;pNext;</span><br><span class="line">        head-&gt;pNext = ptemp;</span><br><span class="line">        <span class="keyword">delete</span> pdelete;</span><br><span class="line">        pdelete = ptemp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码参考：<a href="https://blog.csdn.net/fisherwan/article/details/25561857" target="_blank" rel="noopener">https://blog.csdn.net/fisherwan/article/details/25561857</a></p><h1 id="4-双向链表"><a href="#4-双向链表" class="headerlink" title="4. 双向链表"></a>4. 双向链表</h1><ul><li>双向链表支持两个方向，每个结点不止有一个后继指针 next 指向后面的结点，还有一个前驱指针 prev 指向前面的结点</li><li>双向链表需要额外的两个空间来存储后继结点和前驱结点的地址。所以，如果存储同样多的数据，双向链表要比单链表占用更多的内存空间。虽然两个指针比较浪费存储空间，但可以支持双向遍历，这样也带来了双向链表操作的灵活性</li><li>用空间换时间</li><li>从结构上来看，双向链表可以支持 O(1) 时间复杂度的情况下找到前驱结点，使双向链表在某些情况下的插入、删除等操作都要比单链表简单、高效</li><li>优点<ul><li>插入效率高，双向链表中的结点已经保存了前驱结点的指针，不需要像单链表那样遍历</li><li>查找效率高，可以记录上次查找的位置 p，每次查询时，根据要查找的值与 p 的大小关系，决定是往前还是往后查找，所以平均只需要查找一半的数据</li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.cnblogs.com/scandy-yuan/archive/2013/01/06/2847801.html" target="_blank" rel="noopener">C++ 单链表基本操作分析与实现</a></li><li><a href="https://blog.csdn.net/fisherwan/article/details/25561857" target="_blank" rel="noopener">C++版）链表（二）——实现单项循环链表创建、插入、删除等操作</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构和算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构和算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux实战技能（二）-常用命令</title>
      <link href="/2019/11/27/programmings/linux/Linux%E5%AE%9E%E6%88%98%E6%8A%80%E8%83%BD%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/2019/11/27/programmings/linux/Linux%E5%AE%9E%E6%88%98%E6%8A%80%E8%83%BD%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>常用命令包括：</p><ul><li>pwd</li><li>ls</li><li>cp/mv</li><li>文本查看命令</li></ul><h1 id="2-文本查看命令"><a href="#2-文本查看命令" class="headerlink" title="2. 文本查看命令"></a>2. 文本查看命令</h1><ul><li>cat<ul><li>⽂文本内容显示到终端</li></ul></li><li>head<ul><li>查看⽂文件开头</li></ul></li><li>tail<ul><li>查看⽂文件结尾，常⽤用参数 -f ⽂文件内容更更新后，显示信息同步更更新</li></ul></li><li>wc<ul><li>统计⽂文件内容信息</li></ul></li></ul><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示文件所有内容</span></span><br><span class="line">$ cat test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文件前10行内容</span></span><br><span class="line">$ head -10 test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文件末尾2行内容</span></span><br><span class="line">$ tail -2 test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新显示文件末尾内容</span></span><br><span class="line">$ tail -f test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计文件内容行数</span></span><br><span class="line">$ wc -l test.txt</span><br></pre></td></tr></table></figure><h1 id="3-文件打包和压缩"><a href="#3-文件打包和压缩" class="headerlink" title="3. 文件打包和压缩"></a>3. 文件打包和压缩</h1><ul><li>打包<ul><li>最早的 Linux 备份介质是磁带，使⽤用的命令是 tar</li><li>tar 打包命令<ul><li>c 打包</li><li>x 解包</li><li>f 指定操作类型为⽂文件</li></ul></li></ul></li><li>压缩<ul><li>可以打包后的磁带⽂文件进⾏行行压缩储存，压缩的命令是 gzip 和 bzip2</li><li>经常使⽤用的扩展名是 .tar.gz .tar.bz2 .tgz</li></ul></li><li>解压缩<ul><li>-z gzip 格式压缩和解压缩</li><li>-j bzip2 格式压缩和解压缩</li></ul></li></ul><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将test.txt文件进行打包为文件</span></span><br><span class="line">$ tar cf test.tar test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将test.txt文件进行打包为文件并压缩</span></span><br><span class="line">$ tar czf test.tar.gz test.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将test.tar解压缩到test文件夹下</span></span><br><span class="line">$ tar xf test.tar -C <span class="built_in">test</span>/</span><br></pre></td></tr></table></figure><h1 id="4-强⼤的⽂文本编辑器器-vi"><a href="#4-强⼤的⽂文本编辑器器-vi" class="headerlink" title="4. 强⼤的⽂文本编辑器器 vi"></a>4. 强⼤的⽂文本编辑器器 vi</h1><ul><li><p>模式</p><ul><li>正常模式 (Normal-mode)<ul><li>esc 从其他模式回到正常模式</li></ul></li><li>插⼊模式 (Insert-mode)<ul><li>i I a A o O 进⼊插⼊模式</li></ul></li><li>命令模式 (Command-mode)<ul><li>： 进⼊入命令模式</li></ul></li><li>可视模式 (Visual-mode)<ul><li>v V ctrl+v 进⼊入可视化模式</li></ul></li></ul></li><li><p>基本操作</p><p> | 操作                         | 命令                                                         |<br> | :—————————————- | :—————————————————————————————- |<br> | 复制单行/多行/当前位置至行尾 | Yy / n+yy，其中n表示行数 / y+$                               |<br> | 剪切/当前位置至行尾          | dd / d$                                                      |<br> | 粘贴                         | p                                                            |<br> | 撤销                         | u                                                            |<br> | 重做                         | ctrl + r                                                     |<br> | 删除单个字符                 | x                                                            |<br> | 替换单个字符                 | r                                                            |<br> | 定位指定的⾏                 | G                                                            |<br> | 定位到⾏⾸                   | ^                                                            |<br> | 定位到⾏尾                   | $                                                            |<br> | 写入                         | :w                                                           |<br> | 退出                         | :q                                                           |<br> | 执⾏Shell 命令               | :!                                                           |<br> | 替换                         | :s                                                           |<br> | 查找                         | /                                                            |<br> | 设置命令                     | :set，如：”:set nu”，设置显示行号                            |<br> | 左右上下移动                 | hjkl                                                         |<br> | 在VIM中执行Shell命令         | :!，如：”:!ifconfig”，查看网络IP地址                         |<br> | 查找和移动                   | /和n/N                                                       |<br> | 替换                         | :s（只针对光标所在行），:%s（针对整个文件），如：”:%s/x/X”，将x替换为X，全局替换：”:%s/x/X/g”，在指定行内替换：”:3,5s/x/X/g” |<br> | 可视模式                     | ctrl+v 块可视模式                                            |</p></li></ul><h1 id="5-用户与权限管理理"><a href="#5-用户与权限管理理" class="headerlink" title="5. 用户与权限管理理"></a>5. 用户与权限管理理</h1><ul><li>多用户操作系统的⽬的是隔离<ul><li>用户权限隔离</li><li>系统资源隔离</li><li>root ⽤用户与普通⽤用户的区别</li></ul></li></ul><h2 id="5-1-用户管理理常⽤用命令"><a href="#5-1-用户管理理常⽤用命令" class="headerlink" title="5.1 用户管理理常⽤用命令"></a>5.1 用户管理理常⽤用命令</h2><div class="table-container"><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td>useradd</td><td>新建用户</td></tr><tr><td>userdel</td><td>删除⽤户</td></tr><tr><td>passwd</td><td>修改⽤户密码</td></tr><tr><td>usermod</td><td>修改⽤户属性</td></tr><tr><td>chage</td><td>修改⽤户属性</td></tr><tr><td>id username</td><td>查找某个用户是否存在</td></tr><tr><td>groupadd</td><td>新建用户组</td></tr><tr><td>groupdel</td><td>删除⽤户组</td></tr><tr><td>sudo</td><td>以其他⽤户身份执⾏行行命令</td></tr><tr><td>visudo</td><td>设置需要使用 sudo 的用户（组）</td></tr></tbody></table></div><ul><li>例子</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// 删除用户，保留home目录</span><br><span class="line"><span class="comment"># userdel XXX</span></span><br><span class="line"></span><br><span class="line">// 删除用户，不保留home目录</span><br><span class="line"><span class="comment"># userdel -r XXX</span></span><br><span class="line"></span><br><span class="line">// 修改某一用户的密码</span><br><span class="line"><span class="comment"># passwd XXX</span></span><br><span class="line">// 修改当前用的密码</span><br><span class="line"><span class="comment"># passwd</span></span><br><span class="line"></span><br><span class="line">// 修改用户的home目录</span><br><span class="line"><span class="comment"># usermod -d /home/XXX XXX</span></span><br><span class="line"></span><br><span class="line">// 建立用户组</span><br><span class="line"><span class="comment"># groupadd groupXXX</span></span><br><span class="line"><span class="comment"># usermod -g groupXXX XXX</span></span><br><span class="line">// 新建用户和用户组</span><br><span class="line"><span class="comment"># useradd -g groupXXX XXX</span></span><br><span class="line"></span><br><span class="line">// 切换用户</span><br><span class="line"><span class="comment"># su XXX</span></span><br><span class="line">// 切换用户并跳转至该用户的根目录</span><br><span class="line"><span class="comment"># su - XXX</span></span><br></pre></td></tr></table></figure><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-03-162653.png" alt="image-20191204002646432"></p><p>其中，users代表用户，如果对用户组进行设置，在user前加%。</p><h2 id="5-2-查看文件权限的⽅方法"><a href="#5-2-查看文件权限的⽅方法" class="headerlink" title="5.2 查看文件权限的⽅方法"></a>5.2 查看文件权限的⽅方法</h2><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-12-05-154046.png" alt="image-20191205234045988" style="zoom:30%;"></p><ul><li>类型<ul><li>-表示文件</li><li>d表示文件夹</li><li>b表示块特殊文件</li><li>c表示字符特殊⽂件</li><li>l表示符号链接</li><li>f表示命名管道</li><li>s表示套接字⽂件</li></ul></li><li>权限<ul><li>前三个表示用户的权限、中间三个表示用户组的权限、最后三个表示其他用户权限</li><li>r表示读，可用数字4表示</li><li>w表示写，可用数字2表示</li><li>x表示执行，可用数字1表示</li></ul></li><li>创建新⽂件有默认权限，根据 umask 值计算，属主和属组根据当前进程的⽤户来设定</li><li>修改权限命令<ul><li>chmod 修改⽂件、⽬录权限</li><li>chmod u+x /tmp/testfile</li><li>chmod 755 /tmp/testfile</li><li>chown 更更改属主、属组</li><li>chgrp 可以单独更改属组，不常⽤</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 字符权限</span><br><span class="line"><span class="comment"># chmod u+x /tmp/testfile</span></span><br><span class="line"><span class="comment"># chmod g+x /tmp/testfile</span></span><br><span class="line"><span class="comment"># chmod o+x /tmp/testfile</span></span><br><span class="line"><span class="comment"># chmod a+x /tmp/testfile</span></span><br><span class="line"></span><br><span class="line">// 数字权限</span><br><span class="line"><span class="comment"># chmod 644 file_name</span></span><br></pre></td></tr></table></figure><h2 id="5-3-特殊权限"><a href="#5-3-特殊权限" class="headerlink" title="5.3 特殊权限"></a>5.3 特殊权限</h2><ul><li>SUID<ul><li>⽤于⼆进制可执⾏文件，执⾏命令时取得⽂件属主权限</li><li>/usr/bin/passwd</li></ul></li><li>SGID<ul><li>⽤于⽬录，在该⽬录下创建新的⽂件和⽬录，权限⾃动更改为该目录的属组</li></ul></li><li>SBIT<ul><li>⽤于⽬录，该⽬录下新建的⽂件和⽬录，仅 root 和⾃己可以删除</li></ul></li></ul><h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h1><ul><li><a href="geekbang.org">Linux实战技能100讲</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构与算法（二）-数组</title>
      <link href="/2019/11/24/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%95%B0%E7%BB%84/"/>
      <url>/2019/11/24/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>数组（Array）是一种线性表数据结构。它用一组连续的内存空间，来存储一组具有相同类型的数据。</p><ul><li>线性<ul><li>线性表就是数据排成像一条线一样的结构</li><li>每个线性表上的数据最多只有前和后两个方向</li></ul></li><li>连续的内存空间和相同类型的数据</li></ul><h1 id="2-高效的随机访问"><a href="#2-高效的随机访问" class="headerlink" title="2. 高效的随机访问"></a>2. 高效的随机访问</h1><p>计算机会给每个内存单元分配一个地址，计算机通过地址来访问内存中的数据。当计算机需要随机访问数组中的某个元素时，它会首先通过下面的寻址公式，计算出该元素存储的内存地址：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[i]_address = base_address + i * data_type_size</span><br></pre></td></tr></table></figure><p>其中 data_type_size 表示数组中每个元素的大小。我们举的这个例子里，数组中存储的是 int 类型数据，所以 data_type_size 就为 4 个字节。这个公式非常简单，我就不多做解释了。</p><p>数组支持随机访问，根据下标随机访问的时间复杂度为 O(1)。</p><h1 id="3-低效的“插入”和“删除”"><a href="#3-低效的“插入”和“删除”" class="headerlink" title="3. 低效的“插入”和“删除”"></a>3. 低效的“插入”和“删除”</h1><p>假设数组的长度为 n，现在，如果我们需要将一个数据插入到数组中的第 k 个位置。为了把第 k 个位置腾出来，给新来的数据，我们需要将第 k～n 这部分的元素都顺序地往后挪一位。删除操作跟插入数据类似，如果我们要删除第 k 个位置的数据，为了内存的连续性，也需要搬移数据，不然中间就会出现空洞，内存就不连续了。</p><h1 id="4-数组编码练习"><a href="#4-数组编码练习" class="headerlink" title="4. 数组编码练习"></a>4. 数组编码练习</h1><p>例：实现STL库中vector。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DATA_STRUCTURE_STL_VECTOR_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DATA_STRUCTURE_STL_VECTOR_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span>=<span class="title">std</span>:</span>:allocator&lt;T&gt;&gt; <span class="class"><span class="keyword">class</span> <span class="title">STDVector</span> &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> Tvalue_type;</span><br><span class="line">    <span class="keyword">typedef</span> value_type*iterator;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">const</span> value_type*const_iterator;</span><br><span class="line">    <span class="keyword">typedef</span> value_type&amp;reference;</span><br><span class="line">    <span class="keyword">typedef</span> value_type*pointer;</span><br><span class="line">    <span class="keyword">typedef</span><span class="keyword">size_t</span>size_type;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">ptrdiff_t</span>difference_type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;value_type&gt; _alloc;</span><br><span class="line">    iterator _start;</span><br><span class="line">    iterator _end;</span><br><span class="line">    iterator _end_of_storage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    STDVector() :_start(<span class="number">0</span>), _end(<span class="number">0</span>), _end_of_storage(<span class="number">0</span>)&#123;&#125;</span><br><span class="line">    STDVector(size_type n, <span class="keyword">const</span> T&amp; value);</span><br><span class="line">    STDVector(size_type n);</span><br><span class="line">    STDVector(iterator first, iterator last);</span><br><span class="line">    STDVector(<span class="keyword">const</span> STDVector&amp; v);</span><br><span class="line">    STDVector&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> STDVector&amp; rhs);</span><br><span class="line">    ~STDVector() &#123; _destroy(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">iterator <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _start; &#125;</span><br><span class="line">    <span class="function">iterator <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> _end; &#125;</span><br><span class="line">    <span class="function">const_iterator <span class="title">cbegin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> _start; &#125;</span><br><span class="line">    <span class="function">const_iterator <span class="title">cend</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> _end; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">size_type <span class="title">size</span><span class="params">()</span>  </span>&#123; <span class="keyword">return</span> size_type(end() - begin()); &#125;</span><br><span class="line">    <span class="function">size_type <span class="title">capacity</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> size_type(_end_of_storage - begin()); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> begin() == end(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(STDVector &amp;other)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">reference <span class="title">front</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> *begin(); &#125;</span><br><span class="line">    <span class="function">reference <span class="title">back</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> *(end() - <span class="number">1</span>); &#125;</span><br><span class="line">    reference <span class="keyword">operator</span>[] (size_type n) &#123; <span class="keyword">return</span> *(begin() + n); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert_aux</span><span class="params">(iterator positon, <span class="keyword">const</span> T&amp; x)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">const</span> T&amp; value)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop_back</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(iterator position, size_type n, <span class="keyword">const</span> T&amp; x)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">iterator <span class="title">erase</span><span class="params">(iterator position)</span></span>;</span><br><span class="line">    <span class="function">iterator <span class="title">erase</span><span class="params">(iterator first, iterator last)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; erase(begin(), end()); &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">void</span> _destroy();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">TestSTDVector</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line">STDVector&lt;T, Alloc&gt;::STDVector(size_type n, <span class="keyword">const</span> T&amp; value) &#123;</span><br><span class="line">    _start = _alloc.allocate(n);</span><br><span class="line">    <span class="built_in">std</span>::uninitialized_fill(_start, _start + n, value);</span><br><span class="line">    _end = _end_of_storage = _start + n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line">STDVector&lt;T, Alloc&gt;::STDVector(size_type n) &#123;</span><br><span class="line">    _start = _alloc.allocate(n);</span><br><span class="line">    <span class="built_in">std</span>::uninitialized_fill(_start, _start + n, <span class="number">0</span>);</span><br><span class="line">    _end = _end_of_storage = _start + n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line">STDVector&lt;T, Alloc&gt;::STDVector(iterator first, iterator last) &#123;</span><br><span class="line">    _start = _alloc.allocate(last - first);</span><br><span class="line">    _end = _end_of_storage = <span class="built_in">std</span>::uninitialized_copy(first, last, _start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line">STDVector&lt;T, Alloc&gt;::STDVector(<span class="keyword">const</span> STDVector&amp; v) &#123;</span><br><span class="line">    size_type n = v.cend() - v.cbegin();</span><br><span class="line">    _start = _alloc.allocate(n);</span><br><span class="line">    _end = _end_of_storage = <span class="built_in">std</span>::uninitialized_copy(v.cbegin(), v.cend(), _start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">void</span> STDVector&lt;T, Alloc&gt;::swap(STDVector &amp;other) &#123;</span><br><span class="line">    <span class="built_in">std</span>::swap(_start, other._start);</span><br><span class="line">    <span class="built_in">std</span>::swap(_end, other._end);</span><br><span class="line">    <span class="built_in">std</span>::swap(_end_of_storage, other._end_of_storage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line">STDVector&lt;T, Alloc&gt; &amp;STDVector&lt;T, Alloc&gt;::<span class="keyword">operator</span>=(<span class="keyword">const</span> STDVector &amp;rhs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs)</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    size_type n = rhs.cend() - rhs.cbegin();</span><br><span class="line">    _start = _alloc.allocate(n);</span><br><span class="line">    _end = _end_of_storage = <span class="built_in">std</span>::uninitialized_copy(rhs.cbegin(), rhs.cend(), _start);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">void</span> STDVector&lt;T, Alloc&gt;::insert(iterator position, size_type n, <span class="keyword">const</span> T&amp; x) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_end_of_storage - _end &gt;= n) &#123;</span><br><span class="line">            T x_copy = x;</span><br><span class="line">            <span class="keyword">const</span> size_type elem_after = _end - position;</span><br><span class="line">            iterator old_end = _end;</span><br><span class="line">            <span class="keyword">if</span> (elem_after &gt; n) &#123;</span><br><span class="line">                <span class="built_in">std</span>::uninitialized_copy(_end - n, _end, _end);</span><br><span class="line">                _end = _end + n;</span><br><span class="line">                <span class="built_in">std</span>::copy_backward(position, old_end - n, old_end);</span><br><span class="line">                <span class="built_in">std</span>::fill(position, position + n, x_copy);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">std</span>::uninitialized_fill_n(_end, n - elem_after, x_copy);</span><br><span class="line">                _end += n - elem_after;</span><br><span class="line">                <span class="built_in">std</span>::uninitialized_copy(position, old_end, _end);</span><br><span class="line">                _end += elem_after;</span><br><span class="line">                <span class="built_in">std</span>::fill(position, old_end, x_copy);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> size_type old_size = size();</span><br><span class="line">            <span class="keyword">const</span> size_type len = old_size + <span class="built_in">std</span>::max(old_size, n);</span><br><span class="line">            iterator new_start = _alloc.allocate(len);</span><br><span class="line">            iterator new_end = new_start;</span><br><span class="line">            new_end = <span class="built_in">std</span>::uninitialized_copy(_start, position , new_start);</span><br><span class="line">            new_end = <span class="built_in">std</span>::uninitialized_fill_n(new_end, n, x);</span><br><span class="line">            new_end = <span class="built_in">std</span>::uninitialized_copy(position, _end, new_end);</span><br><span class="line">            _destroy();</span><br><span class="line">            _start = new_start;</span><br><span class="line">            _end = new_end;</span><br><span class="line">            _end_of_storage = new_start + len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">void</span> STDVector&lt;T, Alloc&gt;::insert_aux(iterator positon, <span class="keyword">const</span> T&amp; x) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_end != _end_of_storage) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> size_type old_size = size();</span><br><span class="line">        <span class="keyword">const</span> size_type len = old_size ? <span class="number">2</span> * old_size : <span class="number">1</span>;</span><br><span class="line">        iterator new_start = _alloc.allocate(len);</span><br><span class="line">        iterator new_end = new_start;</span><br><span class="line">        new_end = <span class="built_in">std</span>::uninitialized_copy(_start, positon, new_start);</span><br><span class="line">        _alloc.construct(new_end, x);</span><br><span class="line">        ++ new_end;</span><br><span class="line">        new_end = <span class="built_in">std</span>::uninitialized_copy(positon, _end, new_end);</span><br><span class="line">        _destroy();</span><br><span class="line">        _start = new_start;</span><br><span class="line">        _end = new_end;</span><br><span class="line">        _end_of_storage = new_start + len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">void</span> STDVector&lt;T, Alloc&gt;::push_back(<span class="keyword">const</span> T&amp; value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_end != _end_of_storage) &#123;</span><br><span class="line">        _alloc.construct(_end, value);</span><br><span class="line">        ++ _end;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        insert_aux(end(), value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">void</span> STDVector&lt;T, Alloc&gt;::pop_back() &#123;</span><br><span class="line">    --_end;</span><br><span class="line">    _alloc.destroy(_end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">typename</span> STDVector&lt;T, Alloc&gt;::iterator STDVector&lt;T, Alloc&gt;::erase(iterator position) &#123;</span><br><span class="line">    <span class="keyword">if</span> (position + <span class="number">1</span> != end())</span><br><span class="line">        <span class="built_in">std</span>::copy(position + <span class="number">1</span>, end(), position);</span><br><span class="line">    --_end;</span><br><span class="line">    _alloc.destroy(_end);</span><br><span class="line">    <span class="keyword">return</span> position;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">typename</span> STDVector&lt;T, Alloc&gt;::iterator STDVector&lt;T, Alloc&gt;::erase(iterator first, iterator last) &#123;</span><br><span class="line">    difference_type left = _end - last;</span><br><span class="line">    <span class="built_in">std</span>::copy(last, _end, first);</span><br><span class="line">    <span class="function">iterator <span class="title">it</span><span class="params">(first + left)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (_end != it)</span><br><span class="line">        _alloc.destroy(--_end);</span><br><span class="line">    <span class="keyword">return</span> first;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">Alloc</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">void</span> STDVector&lt;T, Alloc&gt;::_destroy() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_start) &#123;</span><br><span class="line">        <span class="function">iterator <span class="title">it</span><span class="params">(_end)</span></span>;</span><br><span class="line">        <span class="keyword">while</span> (it != _start)</span><br><span class="line">            _alloc.destroy(--it);</span><br><span class="line">    &#125;</span><br><span class="line">    _alloc.deallocate(_start, _end_of_storage - _start);</span><br><span class="line">    _start= _end_of_storage = _end = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//DATA_STRUCTURE_STL_VECTOR_H</span></span></span><br></pre></td></tr></table></figure><p>以上代码参考：<a href="https://github.com/yqtaowhu/DataStructureAndAlgorithm/tree/master/DataStructure/vector" target="_blank" rel="noopener">https://github.com/yqtaowhu/DataStructureAndAlgorithm/tree/master/DataStructure/vector</a></p><h1 id="5-参考"><a href="#5-参考" class="headerlink" title="5. 参考"></a>5. 参考</h1><ul><li>以上内容为《数据结构与算法之美》学习笔记</li><li><a href="https://github.com/yqtaowhu/DataStructureAndAlgorithm/tree/master/DataStructure/vector" target="_blank" rel="noopener">STL的vector实现</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构和算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构和算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构与算法（一）-复杂度分析</title>
      <link href="/2019/11/24/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%80%EF%BC%89-%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90/"/>
      <url>/2019/11/24/data_structure_algorithm/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88%E4%B8%80%EF%BC%89-%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>学习算法的复杂度分析的目的<ul><li>衡量你编写的算法代码的执行效率</li><li>让代码运行得更快，如何让代码更省存储空间</li></ul></li><li>复杂度分析的方法<ul><li>需要一个不用具体的测试数据来测试，就可以粗略地估计算法的执行效率的方法</li><li>时间、空间复杂度分析方法</li></ul></li></ul><h1 id="2-大O表示法"><a href="#2-大O表示法" class="headerlink" title="2. 大O表示法"></a>2. 大O表示法</h1><p>$T(n) = O(f(n))$，其中$T(n)$表示代码执行的时间，n表示数据规模的大小，f(n)表示每行代码执行的次数总和，大O表示T(n)与f(n)成正比。</p><p>大 O 时间复杂度实际上并不具体表示代码真正的执行时间，而是表示代码执行时间随数据规模增长的变化趋势，所以，也叫作渐进时间复杂度（asymptotic time complexity），简称时间复杂度。</p><p>例：</p><p>$T(n) = O(2n + 2)$和$T(n) = O(2n^2 + 2n + 3)$用大O表示法表示为$T(n) = O(n)$和$T(n) = O(n^2)$。</p><h1 id="3-时间复杂度分析"><a href="#3-时间复杂度分析" class="headerlink" title="3. 时间复杂度分析"></a>3. 时间复杂度分析</h1><ul><li>原则<ul><li>只关注循环执行次数最多的一段代码</li><li>加法法则：总复杂度等于量级最大的那段代码的复杂度<ul><li>如果$T1(n) = O(f(n))$，$T2(n) = O(g(n))$，那么$T(n) = T1(n) + T2(n) = max(O(f(n)), O(g(n)) = O(max(f(n), g(n)))$</li><li>如果$T1(n) = O(f(n))$，$T2(n) = O(g(n))$，那么$T(n) = T1(n)<em>T2(n) = O(f(n)</em>g(n))$</li></ul></li></ul></li></ul><p>例1：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> ret = <span class="number">0</span>; </span><br><span class="line">   <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">for</span> (; i &lt; n; ++i) &#123;</span><br><span class="line">     ret = ret + f(i);</span><br><span class="line">   &#125; </span><br><span class="line"> &#125; </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; n; ++i) &#123;</span><br><span class="line">    sum = sum + i;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>单独看 cal() 函数。假设 f() 只是一个普通的操作，那时间复杂度就是，T1(n) = O(n)。但 f() 函数本身不是一个简单的操作，它的时间复杂度是 T2(n) = O(n)，所以，整个 cal() 函数的时间复杂度就是，<script type="math/tex">T(n) = T1(n) * T2(n) = O(n*n) = O(n^2)</script>。</p><ul><li>常见时间复杂度<ul><li>常量阶<ul><li>O(1)</li></ul></li><li>对数阶<ul><li>O(logn)</li></ul></li><li>线性阶<ul><li>O(n)</li></ul></li><li>线性对数阶<ul><li>O(nlogn)</li></ul></li><li>平方阶<ul><li>$O(n^2)$</li></ul></li><li>k次方阶<ul><li>$O(n^k)$</li></ul></li><li>指数阶<ul><li>$O(2^n)$</li></ul></li><li>阶乘阶<ul><li>O(n!)</li></ul></li></ul></li></ul><p>例2：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">int</span> j = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">int</span> sum = i + j;</span><br></pre></td></tr></table></figure><p>时间复杂度为O(1)。一般情况下，只要算法中不存在循环语句、递归语句，即使有成千上万行的代码，其时间复杂度也是Ο(1)。</p><p>例3：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line"> <span class="keyword">while</span> (i &lt;= n)  &#123;</span><br><span class="line">   i = i * <span class="number">2</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>变量 i 的取值就是一个等比数列。通过 $2^x = n$，求解$x=log_2n$，所以，这段代码的时间复杂度就是 $O(log_2n)$。把所有对数阶的时间复杂度都记为$O(logn)$。如果一段代码的时间复杂度是 O(logn)，我们循环执行 n 遍，时间复杂度就是 O(nlogn) 了。</p><p>例4：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> sum_1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; m; ++i) &#123;</span><br><span class="line">    sum_1 = sum_1 + i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> sum_2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> j = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (; j &lt; n; ++j) &#123;</span><br><span class="line">    sum_2 = sum_2 + j;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> sum_1 + sum_2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>复杂度是O(m+n)。</p><h1 id="4-空间复杂度分析"><a href="#4-空间复杂度分析" class="headerlink" title="4. 空间复杂度分析"></a>4. 空间复杂度分析</h1><p>渐进空间复杂度（asymptotic space complexity），表示算法的存储空间与数据规模之间的增长关系。</p><p>例5：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line">  <span class="keyword">for</span> (i; i &lt;n; ++i) &#123;</span><br><span class="line">    a[i] = i * i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">    print out a[i]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>跟时间复杂度分析一样，我们可以看到，第 2 行代码中，我们申请了一个空间存储变量 i，但是它是常量阶的，跟数据规模 n 没有关系，所以我们可以忽略。第 3 行申请了一个大小为 n 的 int 类型数组，除此之外，剩下的代码都没有占用更多的空间，所以整段代码的空间复杂度就是 O(n)。</p><p>常见的空间复杂度就是 O(1)、O(n)、O(n2)，像 O(logn)、O(nlogn) 这样的对数阶复杂度平时都用不到。</p><h1 id="5-最好、最坏情况时间复杂度和平均情况时间复杂度"><a href="#5-最好、最坏情况时间复杂度和平均情况时间复杂度" class="headerlink" title="5. 最好、最坏情况时间复杂度和平均情况时间复杂度"></a>5. 最好、最坏情况时间复杂度和平均情况时间复杂度</h1><ul><li>最好情况时间复杂度就是，在最理想的情况下，执行这段代码的时间复杂度</li><li>最坏情况时间复杂度就是，在最糟糕的情况下，执行这段代码的时间复杂度</li><li>平均情况时间复杂度</li><li>均摊时间复杂度<ul><li>均摊时间复杂度就是一种特殊的平均时间复杂度</li></ul></li></ul><h1 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h1><ul><li>以上内容为《数据结构与算法之美》学习笔记</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据结构与算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（二）-矩阵代数</title>
      <link href="/2019/10/17/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%9F%A9%E9%98%B5%E4%BB%A3%E6%95%B0/"/>
      <url>/2019/10/17/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89-%E7%9F%A9%E9%98%B5%E4%BB%A3%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1-矩阵运算"><a href="#1-矩阵运算" class="headerlink" title="1. 矩阵运算"></a>1. 矩阵运算</h1><h2 id="1-1-矩阵乘法"><a href="#1-1-矩阵乘法" class="headerlink" title="1.1 矩阵乘法"></a>1.1 矩阵乘法</h2><p>若乘积AB有定义，AB的第i行第j列的元素是A的第i行与B的第j列对应元素乘积之和。若$(AB)_{ij}$表示AB的(i, j)元素，A为mxn矩阵，则$(AB)_{ij} = a_{i1}b_{1j} + a_{i2}b_{2j} + \dots + a_{in}b_{nj}$。</p><h1 id="1-2-矩阵乘法的性质"><a href="#1-2-矩阵乘法的性质" class="headerlink" title="1.2 矩阵乘法的性质"></a>1.2 矩阵乘法的性质</h1><p>设A为mxn矩阵，B、C的维数使下列各式的乘积有定义：</p><ul><li>A(BC) = (AB)C</li><li>A(B + C) = AB + AC</li><li>(B + C)A = BA + CA</li><li>r(AB) = (rA)B = A(rB)</li><li>$I_{m}A = A = AI_{n}$</li></ul><p>特别注意：</p><ul><li>一般情况下，$AB\neq BA$</li><li>消去律对矩阵乘法不成立，即若$AB = AC$，一般情况下，B= C并不成立</li><li>若乘积AB是零矩阵，一般情况下，不能断定A = 0或B = 0</li></ul><h2 id="1-3-矩阵的转置"><a href="#1-3-矩阵的转置" class="headerlink" title="1.3 矩阵的转置"></a>1.3 矩阵的转置</h2><p>设A与B表示矩阵，其维数使下列和与积有定义，则：</p><ul><li>$(A^{T})^{T} = A$</li><li>$(A + B)^T = A^T + B^T$</li><li>对任意数r，$(rA)^T = rA^T$</li><li>$(AB)^T = B^TA^T$</li></ul><h1 id="1-4-数值计算的注解"><a href="#1-4-数值计算的注解" class="headerlink" title="1.4 数值计算的注解"></a>1.4 数值计算的注解</h1><p>在计算机上求出AB的最快方法依赖于计算机存储矩阵的方法。标准的高性能算法（如LAPACK）中按列计算AB，正如我们所定义的那样。AB的定义使得我们可以在计算机上用并行算法计算，B的列可单独或分组分配给不同的处理器，因此可以同时计算AB的列。</p><p>代码：</p><ul><li>Python版本</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Matrix_Mul</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a.shape[<span class="number">1</span>] != b.shape[<span class="number">0</span>]:</span><br><span class="line">        print(<span class="string">'这两个矩阵无法做乘法，请检查左边矩阵的列数是否与右边矩阵的行数相等！'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c = np.zeros(a.shape[<span class="number">0</span>]*b.shape[<span class="number">1</span>]).reshape(a.shape[<span class="number">0</span>],b.shape[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(a.shape[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(b.shape[<span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(a.shape[<span class="number">1</span>]):</span><br><span class="line">                    c[i,j] = c[i,j] + a[i,k]*b[k,j]</span><br><span class="line">    <span class="keyword">return</span> c</span><br></pre></td></tr></table></figure><ul><li>C++版本</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">matrix</span>&#123;</span> ll a[M][M];</span><br><span class="line">    ll* <span class="keyword">operator</span> [](<span class="keyword">int</span> x)&#123; <span class="keyword">return</span> a[x]; &#125;</span><br><span class="line">    matrix <span class="keyword">operator</span> *(matrix&amp; b)&#123;</span><br><span class="line">        <span class="keyword">static</span> matrix c;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">3</span>;++i)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">3</span>;++j)</span><br><span class="line">                c[i][j]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">3</span>;++i)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=<span class="number">3</span>;++j)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">3</span>;++k)</span><br><span class="line">                    c[i][j]+=a[i][k]*b[k][j],c[i][j]%=mod;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i,<span class="built_in">putchar</span>(<span class="string">'\n'</span>))</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;++j,<span class="built_in">putchar</span>(<span class="string">' '</span>))</span><br><span class="line">                <span class="built_in">putchar</span>(<span class="string">'0'</span>+a[i][j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;F,T;</span><br></pre></td></tr></table></figure><h2 id="1-5-练习题"><a href="#1-5-练习题" class="headerlink" title="1.5 练习题"></a>1.5 练习题</h2><p>设A为4X4向量，x为$R^4$中的向量。计算$A^2x$的最快方法是什么？计算出乘法的次数。</p><p>答：首先计算Ax，再计算A(Ax)，总计需要32次乘法操作。因为Ax需要16次乘法运算，每个元素4次。A(Ax)也需要16次乘法操作。故总计需要32次乘法操作。</p><h1 id="2-矩阵的逆"><a href="#2-矩阵的逆" class="headerlink" title="2. 矩阵的逆"></a>2. 矩阵的逆</h1><p>类比于实数代数，即实数的倒数（乘法逆），矩阵的逆的定义如下：</p><ul><li>一个nXn矩阵A是可逆的，若存在一个nXn矩阵C使AC = I且CA = I，其中$I = I_n$是nXn的单位矩阵，这时称C是A的逆阵，且C是唯一的，一般将C记为$A^{-1}$，得到$AA^{-1} = I$或者$A^{-1}A = I$。</li><li>不可逆矩阵有时称为奇异矩阵，而可逆矩阵也称为非奇异矩阵。</li></ul><h2 id="2-1-逆矩阵的求法"><a href="#2-1-逆矩阵的求法" class="headerlink" title="2.1 逆矩阵的求法"></a>2.1 逆矩阵的求法</h2><p>下面利用一个例子来说明逆矩阵的求法，并给出矩阵可逆的一些判断条件。</p><p>例：设$A = \left[ \begin{matrix}   a &amp; b \\ c &amp; d \\ \end{matrix} \right]$，若$ad - bc \neq 0$，则A可逆且<script type="math/tex">A^{-1} = \frac{1}{ad - bc}\left[ \begin{matrix}   d & -b \\ -c & a \\ \end{matrix} \right]</script>.</p><p>若$ad - bc = 0$，则A不可逆。其中，$det A = ad - bc$。</p><p>定理: </p><ul><li>若A是nXn可逆矩阵，则对每一$R^n$中的向量b，方程Ax = b有唯一解$x = A^{-1}b$</li><li>若A是可逆矩阵，则$A^{-1}$也可逆且$(A^{-1})^{-1} = A$</li><li>若A和B都是nXn可逆矩阵，AB也可逆，且其逆是A和B的逆矩阵按相反顺序的乘积，即$(AB)^{-1} = b^{-1}A^{-1}$</li><li>若A可逆，则$A^{T}$也可逆，且其逆是$A^{-1}$的转置，即$(A^T)^{-1} = (A^{-1})^T$</li></ul><p>代数余子式：代数余子式是从行列式的公式中提取出来的，它的作用是把n阶行列式化简为n – 1阶行列式。</p><h2 id="2-2-初等矩阵"><a href="#2-2-初等矩阵" class="headerlink" title="2.2 初等矩阵"></a>2.2 初等矩阵</h2><p>把单位矩阵进行一次行变换，就得到初等矩阵。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-26-163027.png" alt="image-20191027003001123"></p><p>定理：</p><ul><li>nXn矩阵A是可逆的，当且仅当A行等价于$I_n$，这时，把A变为$I_n$的一系列初等行变换同时把$I_n$变成$A^{-1}$</li></ul><h2 id="2-3-A-1-的求法"><a href="#2-3-A-1-的求法" class="headerlink" title="2.3 $A^{-1}$的求法"></a>2.3 $A^{-1}$的求法</h2><p>把增广矩阵[A I]进行行化简。若A行等价于I，则[A I]行等价于$[I A^{-1}]$，否则A没有逆。</p><p>线性方程组解释：</p><p>用$e_1, \dots, e_n$表示$I_n$的各列，则把[A I]行变换成$[I A^{-1}]$的过程可看作是解n个方程组，<script type="math/tex">Ax = e_1, Ax = e_2, \dots, Ax = e_n</script>，</p><p>其中这些方程组的“增广列”都放在A的右边，构成矩阵，<script type="math/tex">[A e_1 e_2 \dots e_n] = [A I]</script>。</p><p>方程$AA^{-1} = I$及矩阵乘法的定义说明$A^{-1}$的列正好是上述方程组的解。这一点是很有用的，因为在某些应用问题中，只需要$A^{-1}$的一列或两列，这时只需要解上述方程组的中的相应方程即可。</p><h2 id="2-4-计算机中的矩阵求逆方法"><a href="#2-4-计算机中的矩阵求逆方法" class="headerlink" title="2.4 计算机中的矩阵求逆方法"></a>2.4 计算机中的矩阵求逆方法</h2><p>(1) 数值计算的注解</p><p>在实际中，很少计算$A^{-1}$，除非需要$A^{-1}$的元素。计算$A^{-1}$和$A^{-1}b$总共需要的原酸次数大约是用行变换解方程组Ax = b的3倍，而且行变换可能更为精确。</p><p>(2) 高斯消元构造逆矩阵</p><ul><li>基本思想<ul><li>将原矩阵化成阶梯型矩阵</li><li>朴素运算消成单位矩阵</li></ul></li><li><p>即上文2.2节内容</p></li><li><p>代码：</p><ul><li>C++版本</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n; <span class="keyword">static</span> <span class="keyword">double</span> a[<span class="number">50</span>][<span class="number">50</span>],b[<span class="number">50</span>][<span class="number">50</span>];</span><br><span class="line"><span class="comment">//交换当前行与下一行</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchange</span><span class="params">(<span class="keyword">double</span> a[][<span class="number">50</span>],<span class="keyword">double</span> b[][<span class="number">50</span>],<span class="keyword">int</span> current_line,<span class="keyword">int</span> next_line,<span class="keyword">int</span> all_line_number)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//交换两行</span></span><br><span class="line">    <span class="keyword">int</span> cl=current_line,nl=next_line,n=all_line_number;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)</span><br><span class="line">        swap(a[cl][i],a[nl][i]),</span><br><span class="line">        swap(b[cl][i],b[nl][i]); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">the_data_change_to_1</span><span class="params">(<span class="keyword">double</span> a[][<span class="number">50</span>],<span class="keyword">double</span> b[][<span class="number">50</span>],<span class="keyword">int</span> m,<span class="keyword">int</span> n)</span> </span>&#123; <span class="comment">//将a[m][m]变成1</span></span><br><span class="line">    <span class="keyword">if</span>(a[m][m]) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=m+<span class="number">1</span>; i&lt;n; ++i) a[m][i]=a[m][i]/a[m][m];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i) b[m][i]=b[m][i]/a[m][m];</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">void</span>)(a[m][m]=<span class="number">1</span>); <span class="comment">//change_to_upper_angle_matrix(a,b,m,n);//将a[m][m]之下的元素全部变成0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(m+<span class="number">1</span>&lt;n&amp;&amp;!a[m][m]) exchange(a,b,m,m+<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">if</span>(a[m][m]!=<span class="number">1</span>) the_data_change_to_1(a,b,m,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将a[m][m]之下的元素全部变成0</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change_to_upper_angle_matrix</span><span class="params">(<span class="keyword">double</span> a[][<span class="number">50</span>],<span class="keyword">double</span> b[][<span class="number">50</span>],<span class="keyword">int</span> m,<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(m+<span class="number">1</span>&gt;=n) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=m+<span class="number">1</span>,t; i&lt;n; ++i,a[i][m]=<span class="number">0</span>) &#123; t=a[i][m];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=m; j&lt;n; ++j) a[i][j]=a[i][j]-t*a[m][j];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;n; ++k) b[i][k]=b[i][k]-t*b[m][k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*将上三角矩阵变成单位阵*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change_to_unit_matrix</span><span class="params">(<span class="keyword">double</span> a[][<span class="number">50</span>],<span class="keyword">double</span> b[][<span class="number">50</span>],<span class="keyword">int</span> l,<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=<span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=l<span class="number">-1</span>; i&gt;=<span class="number">0</span>; a[i][l]=<span class="number">0</span>,--i) <span class="comment">//从a[l-1][l]开始向上，让每个元素都变成0</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; ++j)</span><br><span class="line">            b[i][j]=b[i][j]-a[i][l]*b[l][j];</span><br><span class="line">    --l,change_to_unit_matrix(a,b,l,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印结果</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_result</span><span class="params">(<span class="keyword">double</span> b[][<span class="number">50</span>],<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i,<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; j++) <span class="built_in">cout</span>&lt;&lt;b[i][j]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123; <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;n; ++j)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf"</span>,a[i]+j);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i) b[i][i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(a[i][i]!=<span class="number">1</span>) the_data_change_to_1(a,b,i,n);<span class="comment">//将a[i][i]变成 1</span></span><br><span class="line">        <span class="keyword">if</span>(a[i][i]==<span class="number">1</span>) change_to_upper_angle_matrix(a,b,i,n); <span class="comment">//将a[i][i]之下的元素全部变成 0</span></span><br><span class="line">    &#125;</span><br><span class="line">    change_to_unit_matrix(a,b,n<span class="number">-1</span>,n);</span><br><span class="line">    <span class="keyword">return</span> print_result(b,n),<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(3) 解方程组构造（非同阶）逆矩阵</p><ul><li>主要思想同2.3节</li><li>最终构造的方程组也使用高斯消元法进行求解</li><li>该解法时间复杂度为$O(n^4)$</li></ul><h1 id="3-可逆矩阵的特征"><a href="#3-可逆矩阵的特征" class="headerlink" title="3 可逆矩阵的特征"></a>3 可逆矩阵的特征</h1><p>设A为nXn矩阵，则下列命题是等价的，即对某一特定的A，它们同时为真或同时为假：</p><ul><li>A是可逆矩阵</li><li>A等价于nXn单位矩阵</li><li>A有n个主元位置</li><li>方程Ax = 0仅有平凡解</li><li>A的各列线性无关</li><li>线性变换$x\mapsto Ax$是一对一的</li><li>对$R^n$中任意b，方程Ax = b至少有一个解</li><li>A的各列生成$R^n$</li><li>线性变换$x\mapsto Ax$把$R^n$映射到$R^n$上</li><li>存在nXn矩阵C使$CA = I$</li><li>存在nXn矩阵D使$AD = I$</li><li>$A^T$是可逆矩阵</li></ul><h1 id="4-分块矩阵"><a href="#4-分块矩阵" class="headerlink" title="4. 分块矩阵"></a>4. 分块矩阵</h1><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-27-075932.png" alt="image-20191027155815026"></p><h2 id="4-1-分块矩阵的运算"><a href="#4-1-分块矩阵的运算" class="headerlink" title="4.1 分块矩阵的运算"></a>4.1 分块矩阵的运算</h2><ul><li>若矩阵A和B有相同维数且被同样的分块，则A+B的计算按照矩阵相加运算法则一样计算且被同样的分块</li><li>分块矩阵与标量的乘法运算同矩阵与标量的乘法运算法则一致</li><li>分块矩阵的乘法与矩阵的乘法运算法则一致</li></ul><h2 id="4-2-分块矩阵的逆"><a href="#4-2-分块矩阵的逆" class="headerlink" title="4.2 分块矩阵的逆"></a>4.2 分块矩阵的逆</h2><p>分块矩阵的求逆根据分块矩阵的维数和排列不同而计算结果不同，但计算过程一般如下例子所示。</p><p>例：设分块上三角矩阵$A = \left[ \begin{matrix}   A_{11} &amp; A_{22} \\ 0 &amp; A_{22} \\ \end{matrix} \right]$，其中$A_{11}$是pXp矩阵，$A_{22}$是qXq矩阵，A为可逆矩阵，求$A^{-1}$。</p><p>解：设B为$A^{-1}$，那么得到，<script type="math/tex">\left[ \begin{matrix}   A_{11} & A_{22} \\ 0 & A_{22} \\ \end{matrix} \right]\left[ \begin{matrix}   B_{11} & B_{12} \\ B_{21} & B_{22} \\ \end{matrix} \right] = \left[ \begin{matrix}   I_{p} & 0 \\ 0 & I_{q} \\ \end{matrix} \right]</script>，</p><p>得到如下方程组：</p><ul><li>$A_{11}B_{11} + A_{12}B_{21} I_{p}$ (1)</li><li>$A_{11}B_{12} + A_{12}B_{22} = 0$ (2)</li><li>$A_{22}B_{21} = 0$ (3)</li><li>$A_{22}B_{22} = I_{q}$ (4)</li></ul><p>由(4)即$A_{22}$是方阵可知，$A_{22}$可逆。基于$A_{22}$可逆和公式 (4)即可求解上述方程组。解得，<script type="math/tex">A^{-1} = \left[ \begin{matrix}   A_{11} & A_{22} \\ 0 & A_{22} \\ \end{matrix} \right]^{-1} = \left[ \begin{matrix}   A_{11}^{-1} & -A_{11}^{-1}A_{12}A_{22}^{-1} \\ 0 & A_{22}^{-1} \\ \end{matrix} \right]</script>。</p><h1 id="5-矩阵因式分解"><a href="#5-矩阵因式分解" class="headerlink" title="5. 矩阵因式分解"></a>5. 矩阵因式分解</h1><p>矩阵因式分解指的是将矩阵由多个矩阵进行表示。矩阵乘法是数据的综合，矩阵因式分解是数据的分解。矩阵的因式分解的主要意义在于便于计算。矩阵因式分解的方法有很多，例如LU分解、秩分解、QR分解、奇异值分解和谱分解等。</p><h1 id="5-1-LU分解"><a href="#5-1-LU分解" class="headerlink" title="5.1 LU分解"></a>5.1 LU分解</h1><p>给定一系列具有相同系数的方程组：$Ax = b_1, Ax = b_2, \dots, Ax = b_p$，如果A可逆，那么只需要求$A^{-1}b_1, \dots, A^{-1}b_{p}$等。接下来，我们首先对A进行LU分解。这样做的好处分析如下。</p><p>当A = LU时，方程Ax = b可写成LUx = b。另Ux = y，那么得到如下方程组：</p><ul><li>Ly = b</li><li>Ux = y</li></ul><p>这两个方程都比较容易解。</p><p>设A为mXn矩阵，另$A = LU$，其中L为mXm下三角矩阵，主对角元素全为1，U是A的等价的mXn的阶梯型矩阵。如下是矩阵LU分解的一个例子，其中L是可逆的，称为单位下三角矩阵。</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-27-083414.png" alt="image-20191027163408844"></p><p>设A可以化为阶梯形U，化简过程仅用行倍加变换，即把一行的倍数加于它下面的另一行。这样，存在单位下三角初等矩阵$E_1, \dots, E_p$使<script type="math/tex">E_p\dots E_1A = U</script>。</p><p>之后，$A = (E_p\dots E_1)^{-1}U = LU$，其中$L = (E_p\dots E_1)^{-1}$。也就是说L就是使得A化为U的变换的逆。</p><ul><li>如果可能的话，用一系列的倍加变换把A化为阶梯形</li><li>填充L的元素使相同的行变换把L变为I</li></ul><p>例：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-11-02-145415.png" alt="image-20191102225407207"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-11-02-145633.png" alt="image-20191102225430417"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-11-02-145535.png" alt="image-20191102225514477"></p><p>计算复杂度分析，对于nXn稠密矩阵A，n相当大，例如$n\geq 30$：</p><ul><li>计算A的LU分解大约需要$2n^3/3$浮算，而求$A^{-1}$大约需要$2n^3$浮算</li><li>解Ly = b和Ux = y大约需要$2n^2$浮算，因任意nXn三角方程组可以用大约$n^2$浮算解出</li><li>把b乘以$A^{-1}$也需要$2n^2$浮算，但结果可能不如由L和U得出的精确（由于计算$A^{-1}$和$A^{-1}b$的舍入误差）</li><li>若A是稀疏矩阵（大部分元素为0），则L和U可能也是稀疏的，然而$A^{-1}$很可能是稠密的。这时，用LU分解来解方程Ax = b很可能比用$A^{-1}$快很多。</li></ul><h2 id="5-2-QR分解"><a href="#5-2-QR分解" class="headerlink" title="5.2 QR分解"></a>5.2 QR分解</h2><ul><li>是目前求一般矩阵全部特征值的最有效并广泛应用的方法</li><li>将矩阵分解成一个正规正交矩阵Q与上三角形矩阵R</li><li>分解过程中利用Gram−Schmidt正交化</li></ul><p>其中，Gram−Schmidt正交化内容将在后续章节进行总结。</p><p>给定矩阵A，其列向量为$\alpha_1, \alpha_2, \dots, \alpha_n$，利用Gram−Schmidt正交化对矩阵A的列向量进行正交化，得到$\epsilon_1, \epsilon_2, \dots, \epsilon_j$，得到如下矩阵形式：<script type="math/tex">(\epsilon_1, \epsilon_2, \dots, \epsilon_j) = (\alpha_1, \alpha_2, \dots, \alpha_n)\left[ \begin{matrix}   t_{11} & \dots & t_{1n} \\  & \ddots & \vdots \\ & & t_{nn} \\ \end{matrix} \right]</script>,</p><p>其中，$Q = (\epsilon_1, \epsilon_2, \dots, \epsilon_j)$，$R = T^{-1}$。</p><p>求解步骤：</p><ul><li>通过Gram–Schmidt正交化求出正交矩阵Q</li><li>再通过$R = Q^{T}A$得到矩阵R</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gram_schmidt</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="string">"""Gram-schmidt正交化"""</span></span><br><span class="line">    Q = np.zeros_like(A)</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> A.T:</span><br><span class="line">        u = np.copy(a)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, cnt):</span><br><span class="line">            u -= np.dot(np.dot(Q[:, i].T, a), Q[:, i])</span><br><span class="line">        e = u / np.linalg.norm(u)</span><br><span class="line">        Q[:, cnt] = e</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">    R = np.dot(Q.T, A)</span><br><span class="line">    <span class="keyword">return</span> (Q, R)</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    np.set_printoptions(precision=<span class="number">4</span>, suppress=<span class="keyword">True</span>)</span><br><span class="line">    A = np.array([[<span class="number">6</span>, <span class="number">5</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">-1</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">1</span>, <span class="number">-14</span>], [<span class="number">0</span>, <span class="number">4</span>, <span class="number">3</span>]], dtype=float)</span><br><span class="line"></span><br><span class="line">    (Q, R) = gram_schmidt(A)</span><br><span class="line">    print(Q)</span><br><span class="line">    print(R)</span><br><span class="line">    print(np.dot(Q, R))</span><br></pre></td></tr></table></figure><h2 id="5-3-SVD分解"><a href="#5-3-SVD分解" class="headerlink" title="5.3 SVD分解"></a>5.3 SVD分解</h2><p>在学习SVD分解前，先简单描述下如下定义，详细的内容将在后续进行总结。</p><ul><li>特征值<ul><li>$Ax = \lambda x$</li><li>矩阵是线性空间里的变换的描述。矩阵AA与向量相乘，本质上对向量x进行一次线性转换（旋转或拉伸），而该转换的效果为常数c乘以向量x（即只进行拉伸）。当我们求特征值与特征向量的时候，就是为了求矩阵A能使哪些向量（特征向量）只发生拉伸，而拉伸的程度，自然就是特征值λ了</li></ul></li></ul><p>对于一个矩阵A，有一组特征向量；再将这组向量进行正交化单位化，也就是我们学过的Schmidt正交化，就能得到一组正交单位向量。特征值分解，就是将矩阵A分解为如下方式：<script type="math/tex">A = Q\Sigma Q^{-1}</script>，其中，Q是矩阵A的特征向量组成的矩阵，Σ则是一个对角阵，对角线上的元素就是特征值。通过特征值分解得到的前N个特征向量，那么就对应了这个矩阵最主要的N个变化方向。利用这前N个变化方向，就可以近似这个矩阵（变换）。特征值分解可以得到特征值与特征向量，特征值表示的是这个特征到底有多重要，而特征向量表示这个特征是什么，可以将每一个特征向量理解为一个线性的子空间。</p><ul><li>特征值分解最大的问题是只能针对方阵</li><li>为了解决该问题，SVD分解算法出现了</li></ul><p>SVD分解的公式如下：<script type="math/tex">A = U\Sigma V^{T}</script>。</p><p>SVD解决了特征值分解中只能针对方阵而没法对更一般矩阵进行分解的问题。</p><p>在大部分情况下，当我们把矩阵Σ里的奇异值按从大到小的顺序呢排列以后，很容易就会发现，奇异值减小的速度特别快。在很多时候，前10%甚至前1%的奇异值的和就占了全部奇异值和的99%以上。换句话说，大部分奇异值都很小，基本没什么用。因此，可以用前面r个奇异值来对这个矩阵做近似。于是，SVD也可以写为：<script type="math/tex">A_{m\times n} \approx U_{m\times r}\Sigma_{r\times r}V_{r\times n}</script>，其中，$r\ll m$和$r\ll n$。实际在使用SVD的时候，需要我们根据不同的业务场景与需求还有资源情况，合理选择r的大小。本质是在计算精度与空间时间成本之间做个折中。</p><p>SVD算法流程如下：</p><ul><li><p>输入</p><ul><li>样本数据</li></ul></li><li><p>输出</p><ul><li>左奇异矩阵，奇异值矩阵，右奇异矩阵</li></ul></li><li><p>算法流程</p><ul><li><p>计算特征值</p><ul><li>特征值分解$AA^{T}$，其中$A\in R^{m\times n}$为原始样本数据，$AA^{T} = U\Sigma \Sigma^{T}U^{T}$</li><li>得到左奇异矩阵$U\in R^{m\times m}$和奇异矩阵$\Sigma’ \in R^{m\times m}$</li></ul></li><li><p>间接求部分右奇异矩阵</p><ul><li>由$A = U\Sigma’V’$可得<script type="math/tex">V' = (U\Sigma')^{-1}A = (\Sigma')^{-1}U^{T}A</script></li></ul></li><li><p>返回$U$，$\Sigma’$，$V’$</p></li></ul></li></ul><h1 id="6-R-n-子空间"><a href="#6-R-n-子空间" class="headerlink" title="6. $R^{n}$子空间"></a>6. $R^{n}$子空间</h1><ul><li>$R^{n}$中的一个子空间是$R^n$中的集合H，具有以下三个性质<ul><li>零向量属于H</li><li>对H中任意的向量u和v，u + v属于H</li><li>对H中任意向量u和数c，cu属于H</li></ul></li><li>由$v_1, \dots, v_p$张成的子空间定义为$Span\{v_1, \dots, v_p\}$</li><li>矩阵A的列空间是A的各列的线性组合的集合，记做Col A</li><li>矩阵A的零空间是齐次方程Ax = 0的所有解的集合，记为Nul A</li><li>$R^n$中子空间H的一组基是H中一个线性无关集，它生成H</li><li>矩阵A的主元列构成列空间的基</li></ul><h1 id="7-维数和秩"><a href="#7-维数和秩" class="headerlink" title="7. 维数和秩"></a>7. 维数和秩</h1><ul><li>非零子空间H的维数，用dimH表示，是H的任意一个基的向量个数，零子空间的维数定义为零</li><li>如果一个矩阵A有n列，则rank A +dim Nul A = n</li></ul><h1 id="8-参考"><a href="#8-参考" class="headerlink" title="8. 参考"></a>8. 参考</h1><ul><li><a href="https://www.cnblogs.com/Judge/p/10124232.html" target="_blank" rel="noopener">论如何求矩阵的逆?先看看基础芝士！</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown-数学公式</title>
      <link href="/2019/10/03/others/Markdown-%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/"/>
      <url>/2019/10/03/others/Markdown-%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="1-配置"><a href="#1-配置" class="headerlink" title="1. 配置"></a>1. 配置</h1><p>Hexo 的自带的 Markdown 引擎并不支持 LaTeX 公式。 但是 MathJax 支持，因此首先要 启用 MathJax 才能渲染 LaTeX 公式。如果你已经安装了 NexT theme，开启 MathJax 支持非常容易，在最新版的 NexT 主题的 _config.yml 文件里，找到 MathJax 相关部分，使用以下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">math:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Default(true) will load mathjax/katex script on demand</span></span><br><span class="line">  <span class="comment"># That is it only render those page who has 'mathjax: true' in Front Matter.</span></span><br><span class="line">  <span class="comment"># If you set it to false, it will load mathjax/katex srcipt EVERY PAGE.</span></span><br><span class="line">  per_page: <span class="literal">false</span></span><br><span class="line">  engine: mathjax</span><br></pre></td></tr></table></figure><p>但是由于 LaTeX 中的一些符号在 Markdown 中有特殊含义，例如 两个 <code>_</code> 在 Markdown 中用来表示斜体（italic），因此两者的配合使用会产生一些问题。</p><p>解决方案：</p><p>使用 <a href="https://github.com/sun11/hexo-renderer-kramed" target="_blank" rel="noopener">hexo-renderer-kramed</a> 替换 Hexo 默认的渲染器 <strong>hexo-renderer-marked</strong>。<a href="https://github.com/sun11/hexo-renderer-kramed" target="_blank" rel="noopener">hexo-renderer-kramed</a> 是 <strong>hexo-renderer-marked</strong> 的 <strong>Fork 修改版</strong>，仅针对 MathJax 渲染的<strong>语义冲突</strong>问题进行了修改，因此可以放心使用。在 <strong>Hexo 根目录</strong>下执行以下命令替换默认渲染引擎：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure><p>更换渲染引擎后，<strong>整行公式就可以正常显示了</strong>，然而<strong>行内公式还是会遇到</strong><code>&lt;em&gt;</code><strong>标签语义冲突的问题</strong>。在 Markdown 语法中，用$$$$包括起来的内容表示整行公式，用<code>$</code>包括起来的内容表示行内公式。之所以行内公式的渲染依然存在问题，是因为 <a href="https://github.com/sun11/hexo-renderer-kramed" target="_blank" rel="noopener">hexo-renderer-kramed</a> 引擎同样存在语义冲突的问题。在博客根目录下，找到<code>node_modules/kramed/lib/rules/inline.js</code>文件，在<code>inline</code>变量中做出如下修改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var inline = &#123;</span><br><span class="line">  // escape: /^\\([\\`*&#123;&#125;\[\]()<span class="comment">#$+\-.!_&gt;])/, 第 11 行, 将其修改为</span></span><br><span class="line">  escape: /^\\([`*\[\]()<span class="comment">#$+\-.!_&gt;])/,</span></span><br><span class="line">  autolink: /^&lt;([^ &gt;]+(@|:\/)[^ &gt;]+)&gt;/,</span><br><span class="line">  url: noop,</span><br><span class="line">  html: /^&lt;!--[\s\S]*?--&gt;|^&lt;(\w+(?!:\/|[^\w\s@]*@)\b)*?(?:<span class="string">"[^"</span>]*<span class="string">"|'[^']*'|[^'"</span>&gt;])*?&gt;([\s\S]*?)?&lt;\/\1&gt;|^&lt;(\w+(?!:\/|[^\w\s@]*@)\b)(?:<span class="string">"[^"</span>]*<span class="string">"|'[^']*'|[^'"</span>&gt;])*?&gt;/,</span><br><span class="line">  link: /^!?\[(inside)\]\(href\)/,</span><br><span class="line">  reflink: /^!?\[(inside)\]\s*\[([^\]]*)\]/,</span><br><span class="line">  nolink: /^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,</span><br><span class="line">  reffn: /^!?\[\^(inside)\]/,</span><br><span class="line">  strong: /^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,</span><br><span class="line">  // em: /^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/, 第 20 行，将其修改为 </span><br><span class="line">  em: /^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,</span><br><span class="line">  code: /^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,</span><br><span class="line">  br: /^ &#123;2,&#125;\n(?!\s*$)/,</span><br><span class="line">  del: noop,</span><br><span class="line">  text: /^[\s\S]+?(?=[\\&lt;!\[_*`$]| &#123;2,&#125;\n|$)/,</span><br><span class="line">  math: /^\$\$\s*([\s\S]*?[^\$])\s*\$\$(?!\$)/,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>依然可以在 Hexo 中使用<code>*</code>表示<em>斜体</em>，但<strong>用</strong><code>_</code><strong>表示</strong>_斜体_<strong>就不会生效了</strong>。</p><h1 id="2-矩阵"><a href="#2-矩阵" class="headerlink" title="2. 矩阵"></a>2. 矩阵</h1><h2 id="2-1-不带括号的矩阵"><a href="#2-1-不带括号的矩阵" class="headerlink" title="2.1 不带括号的矩阵"></a>2.1 不带括号的矩阵</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">  \begin&#123;matrix&#125;</span><br><span class="line">   1 &amp; 2 &amp; 3 \\</span><br><span class="line">   4 &amp; 5 &amp; 6 \\</span><br><span class="line">   7 &amp; 8 &amp; 9</span><br><span class="line">  \end&#123;matrix&#125; \tag&#123;1&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\begin{matrix}   1 & 2 & 3 \\   4 & 5 & 6 \\   7 & 8 & 9  \end{matrix} \tag{1}</script><h2 id="2-2-带括号-的矩阵"><a href="#2-2-带括号-的矩阵" class="headerlink" title="2.2 带括号{}的矩阵"></a>2.2 带括号{}的矩阵</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line"> \left\&#123;</span><br><span class="line"> \begin&#123;matrix&#125;</span><br><span class="line">   1 &amp; 2 &amp; 3 \\</span><br><span class="line">   4 &amp; 5 &amp; 6 \\</span><br><span class="line">   7 &amp; 8 &amp; 9</span><br><span class="line">  \end&#123;matrix&#125;</span><br><span class="line">  \right\&#125; \tag&#123;2&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\left\{ \begin{matrix}   1 & 2 & 3 \\   4 & 5 & 6 \\   7 & 8 & 9  \end{matrix}  \right\} \tag{2}</script><p>不使用left和right的方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line"> \begin&#123;Bmatrix&#125;</span><br><span class="line">   1 &amp; 2 &amp; 3 \\</span><br><span class="line">   4 &amp; 5 &amp; 6 \\</span><br><span class="line">   7 &amp; 8 &amp; 9</span><br><span class="line">  \end&#123;Bmatrix&#125; \tag&#123;5&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\begin{Bmatrix}   1 & 2 & 3 \\   4 & 5 & 6 \\   7 & 8 & 9  \end{Bmatrix} \tag{5}</script><h2 id="2-3-带括号-的矩阵"><a href="#2-3-带括号-的矩阵" class="headerlink" title="2.3 带括号[]的矩阵"></a>2.3 带括号[]的矩阵</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line"> \left[</span><br><span class="line"> \begin&#123;matrix&#125;</span><br><span class="line">   1 &amp; 2 &amp; 3 \\</span><br><span class="line">   4 &amp; 5 &amp; 6 \\</span><br><span class="line">   7 &amp; 8 &amp; 9</span><br><span class="line">  \end&#123;matrix&#125;</span><br><span class="line">  \right] \tag&#123;3&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & 2 & 3 \\   4 & 5 & 6 \\   7 & 8 & 9  \end{matrix}  \right] \tag{3}</script><p>不使用left和right的方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line"> \begin&#123;bmatrix&#125;</span><br><span class="line">   1 &amp; 2 &amp; 3 \\</span><br><span class="line">   4 &amp; 5 &amp; 6 \\</span><br><span class="line">   7 &amp; 8 &amp; 9</span><br><span class="line">  \end&#123;bmatrix&#125; \tag&#123;4&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\begin{bmatrix}   1 & 2 & 3 \\   4 & 5 & 6 \\   7 & 8 & 9  \end{bmatrix} \tag{4}</script><h2 id="2-4-带省略号的矩阵"><a href="#2-4-带省略号的矩阵" class="headerlink" title="2.4 带省略号的矩阵"></a>2.4 带省略号的矩阵</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\left[</span><br><span class="line">\begin&#123;matrix&#125;</span><br><span class="line"> 1      &amp; 2      &amp; \cdots &amp; 4      \\</span><br><span class="line"> 7      &amp; 6      &amp; \cdots &amp; 5      \\</span><br><span class="line"> \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\</span><br><span class="line"> 8      &amp; 9      &amp; \cdots &amp; 0      \\</span><br><span class="line">\end&#123;matrix&#125;</span><br><span class="line">\right]</span><br><span class="line">$$</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\left[\begin{matrix} 1      & 2      & \cdots & 4      \\ 7      & 6      & \cdots & 5      \\ \vdots & \vdots & \ddots & \vdots \\ 8      & 9      & \cdots & 0      \\\end{matrix}\right]</script><h2 id="2-5-行间矩阵"><a href="#2-5-行间矩阵" class="headerlink" title="2.5 行间矩阵"></a>2.5 行间矩阵</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Test$\bigl(</span><br><span class="line">    \begin&#123;smallmatrix&#125;</span><br><span class="line">l&amp;l\\j&amp;z</span><br><span class="line">\end&#123;smallmatrix&#125;</span><br><span class="line">\bigr)<span class="variable">$Test</span></span><br></pre></td></tr></table></figure><p>效果：</p><p>Test$\bigl(<br>    \begin{smallmatrix}<br>        l&amp;l\\j&amp;z<br>    \end{smallmatrix}<br>\bigr)$Test</p><h1 id="3-方程组"><a href="#3-方程组" class="headerlink" title="3. 方程组"></a>3. 方程组</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\begin&#123;cases&#125;</span><br><span class="line">x+y+z=0 \\</span><br><span class="line">x+2y+3z=0 \\</span><br><span class="line">x+4y+5z=0</span><br><span class="line">\end&#123;cases&#125;</span><br></pre></td></tr></table></figure><p>效果：</p><script type="math/tex; mode=display">\begin{cases}x+y+z=0 \\x+2y+3z=0 \\x+4y+5z=0\end{cases}</script><h1 id="4-Greek-and-Hebrew-Letters"><a href="#4-Greek-and-Hebrew-Letters" class="headerlink" title="4. Greek and Hebrew Letters"></a>4. Greek and Hebrew Letters</h1><div class="table-container"><table><thead><tr><th>$\alpha$</th><th>\alpha</th><th>$\beta$</th><th>\beta</th><th>$\gamma$</th><th>\gamma</th><th>$\chi$</th><th>\chi</th><th>$\delta$</th><th>\delta</th><th>$\epsilon$</th><th>\epsilon</th></tr></thead><tbody><tr><td>$\eta$</td><td>\eta</td><td>$\iota$</td><td>\iota</td><td>$\kappa$</td><td>\kappa</td><td>$\lambda$</td><td>\lambda</td><td>$\mu$</td><td>\mu</td><td>$\nu$</td><td>\nu</td></tr><tr><td>$o$</td><td>o</td><td>$\omega$</td><td>\omega</td><td>$\phi$</td><td>\phi</td><td>$\pi$</td><td>\pi</td><td>$\psi$</td><td>\psi</td><td>$\rho$</td><td>\rho</td></tr><tr><td>$\sigma$</td><td>\sigma</td><td>$\tau$</td><td>\tau</td><td>$\theta$</td><td>\theta</td><td>$\upsilon$</td><td>\upsilon</td><td>$\xi$</td><td>\xi</td><td>$\zeta$</td><td>\zeta</td></tr><tr><td>$\digamma$</td><td>\digamma</td><td>$\varepsilon$</td><td>\varepsilon</td><td>$\varkappa$</td><td>\varkappa</td><td>$\varphi$</td><td>\varphi</td><td>$\varpi$</td><td>\varpi</td><td>$\varrho$</td><td>\varrho</td></tr><tr><td>$\varsigma$</td><td>\varsigma</td><td>$\vartheta$</td><td>\vartheta</td><td>$\Delta$</td><td>\Delta</td><td>$\Gamma$</td><td>\Gamma</td><td>$\Lambda$</td><td>\Lambda</td><td>$\Omega$</td><td>\Omega</td></tr><tr><td>$\Phi$</td><td>\Phi</td><td>$\Pi$</td><td>\Pi</td><td>$\Psi$</td><td>\Psi</td><td>$\Sigma$</td><td>\Sigma</td><td>$\Theta$</td><td>\Theta</td><td>$\Upsilon$</td><td>\Upsilon</td></tr><tr><td>$\Xi$</td><td>\Xi</td><td>$\aleph$</td><td>\aleph</td><td>$\beth$</td><td>\beth</td><td>$\daleth$</td><td>\daleth</td><td>$\gimel$</td><td>\gimel</td><td></td></tr></tbody></table></div><h1 id="5-Binary-Operations-Relation-Symbols"><a href="#5-Binary-Operations-Relation-Symbols" class="headerlink" title="5. Binary Operations / Relation Symbols"></a>5. Binary Operations / Relation Symbols</h1><div class="table-container"><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table></div><h1 id="10-参考"><a href="#10-参考" class="headerlink" title="10. 参考"></a>10. 参考</h1><ul><li><a href="https://abelsu7.top/2018/10/29/hexo-mathjax/" target="_blank" rel="noopener">在 Hexo 中使用 MathJax 渲染数学公式</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性代数及其应用（一）-线性方程组</title>
      <link href="/2019/10/03/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89-%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84/"/>
      <url>/2019/10/03/math/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89-%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h1 id="1-线性方程组"><a href="#1-线性方程组" class="headerlink" title="1. 线性方程组"></a>1. 线性方程组</h1><p>定义：包含未知数的$x_1, x_2, \cdots, x_n$的线性方程组如下所示：</p><script type="math/tex; mode=display">a_1x_1+a_2x_2+\cdots+a_nx_n = b.</script><p>矩阵形式：</p><script type="math/tex; mode=display">x_1 - 2x_2 + x3 = 0 \\2x_2-8x_3 = 8 \\-4x_1 + 5x_2 + 9x_3 = -9</script><p>系数矩阵为：</p><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & -2 & 1 \\   0 & 2 & -8 \\   -4 & 5 & 9  \end{matrix}  \right]</script><p>增广矩阵为：</p><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & -2 & 1 & 0 \\   0 & 2 & -8 & 8 \\   -4 & 5 & 9 & -9 \\  \end{matrix}  \right]</script><h1 id="1-1-线性方程组的解法"><a href="#1-1-线性方程组的解法" class="headerlink" title="1.1 线性方程组的解法"></a>1.1 线性方程组的解法</h1><p>采用等价方程组来求解一个线性方程组。等价方程组可通过如下三种变换得到：</p><ul><li>把某一个方程换成另一个方程的倍数的和</li><li>把某一方程的所有项乘以一个非零常数</li><li>交换两个方程的位置</li></ul><p>以上变换即所谓的“行初等变换”。</p><p>例：</p><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & -2 & 1 & 0 \\   0 & 2 & -8 & 8 \\   -4 & 5 & 9 & -9 \\  \end{matrix}  \right]</script><p>转换为行阶梯形为：</p><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & -2 & 1 & 0 \\   0 & 1 & -4 & 4 \\   0 & 0 & 1 & 3 \\  \end{matrix}  \right] \tag{3}</script><p>和最简形为：</p><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & 0 & 0 & 29 \\   0 & 1 & 0 & 16 \\   0 & 0 & 1 & 3 \\  \end{matrix}  \right] \tag{3}</script><p>相当于：</p><script type="math/tex; mode=display">\begin{cases}x_1 = 29 \\x_2 = 16 \\x_3 = 3\end{cases}</script><h1 id="1-2-存在与唯一性问题"><a href="#1-2-存在与唯一性问题" class="headerlink" title="1.2 存在与唯一性问题"></a>1.2 存在与唯一性问题</h1><ul><li>线性方程组是否相容</li><li>若它有解，解的唯一性</li></ul><h1 id="2-行化简与阶梯型矩阵"><a href="#2-行化简与阶梯型矩阵" class="headerlink" title="2. 行化简与阶梯型矩阵"></a>2. 行化简与阶梯型矩阵</h1><h2 id="2-1-阶梯型定义"><a href="#2-1-阶梯型定义" class="headerlink" title="2.1 阶梯型定义"></a>2.1 阶梯型定义</h2><ul><li>每一非零行在每一零行之上</li><li>某一行的先导元素所在的列位于前一行先导元素的后面</li><li>某一行的先导元素所在的列下方元素都是零。</li></ul><h2 id="2-2-简化阶梯型"><a href="#2-2-简化阶梯型" class="headerlink" title="2.2 简化阶梯型"></a>2.2 简化阶梯型</h2><ul><li>属于阶梯型</li><li>每一非零行的先导元素是1</li><li>每一先导元素1是该元素所在列的唯一非零元素</li></ul><h2 id="2-3-例子"><a href="#2-3-例子" class="headerlink" title="2.3 例子"></a>2.3 例子</h2><ul><li>行阶梯形</li></ul><script type="math/tex; mode=display">\left[ \begin{matrix}   2 & -3 & 2 & 1 \\   0 & 1 & -4 & 8 \\   0 & 0 & 0 & 1  \end{matrix}  \right]</script><ul><li>行最简形</li></ul><script type="math/tex; mode=display">\left[ \begin{matrix}   1 & 0 & 0 & 29 \\   0 & 1 & 0 & 16 \\   0 & 0 & 1 & 3  \end{matrix}  \right]</script><h2 id="2-4-主元位置和主元列"><a href="#2-4-主元位置和主元列" class="headerlink" title="2.4 主元位置和主元列"></a>2.4 主元位置和主元列</h2><p>距震中的主元位置是矩阵A中对应于它的阶梯形中先导元素的位置；主元列是矩阵A中含有主元位置的列。</p><h2 id="2-5-线性方程组的解"><a href="#2-5-线性方程组的解" class="headerlink" title="2.5 线性方程组的解"></a>2.5 线性方程组的解</h2><p>应用行化简法解线性方程组：</p><ul><li>写出方程组的增广矩阵</li><li>应用行化简算法把增广矩阵化为阶梯形。确定方程组是否有解，如果没有解则停止；否则进行下一步。</li><li>继续行化简法得到他的简化阶梯形</li><li>写出由第三步所得矩阵所对应的方程组</li><li>把第四步所得到的每个方程改写为用自由变量表示基本变量的形式。</li></ul><h1 id="3-向量方程"><a href="#3-向量方程" class="headerlink" title="3. 向量方程"></a>3. 向量方程</h1><h2 id="3-1-R-2-中的向量定义"><a href="#3-1-R-2-中的向量定义" class="headerlink" title="3.1 $R^{2}$中的向量定义"></a>3.1 $R^{2}$中的向量定义</h2><ul><li>仅含一列的矩阵称为列向量，或简称向量。</li><li>两个向量相等，当且仅当两个向量对应元素相等。</li><li>向量是实数的有序对。</li><li>所有元素都是零的向量称为零向量。</li></ul><h2 id="3-2-向量的性质"><a href="#3-2-向量的性质" class="headerlink" title="3.2 向量的性质"></a>3.2 向量的性质</h2><ul><li>向量u, v, w和标量c和d</li><li>u + v = v + u</li><li>(u + v) + w = u + (v + w)</li><li>u + 0 = 0 + u</li><li>u + (-u) = -u + u = 0</li></ul><h2 id="3-3-线性组合"><a href="#3-3-线性组合" class="headerlink" title="3.3 线性组合"></a>3.3 线性组合</h2><p>戈丁$R^n$中的向量$v_1, v_2, \dots, v_p$和标量$c_1, c_2, \dots, c_p$，向量$y = c_1v_1 + c_2v_2 + \dots + c_pv_p$称为向量$v_1, v_2, \dots, v_p$以$c_1, c_2, \dots, c_p$为权的线性组合。</p><p>定义$Span\{v_1, v_2, \dots, v_n\}$为由$v_1, v_2, \dots, v_n$的所有线性组合所成的集合。</p><p>要判断向量b是否属于$Span\{v_1, v_2, \dots, v_n\}$，就是判断向量方程：</p><script type="math/tex; mode=display">x_1v_1 + x_2v_2 + \dots + x_nv_n = b</script><p>是否有解。</p><h2 id="3-4-向量方程"><a href="#3-4-向量方程" class="headerlink" title="3.4 向量方程"></a>3.4 向量方程</h2><p>向量方程<script type="math/tex">x_1a_1 + _2a_2 + \dots + x_na_n = b</script>，和增广矩阵为<script type="math/tex">[a_1 a_2 \dots a_n b]</script>的线性方程组有相同的解集。特别地，b可表示为$a_1, a_2, \dots, a_n$的线性组合，当且仅当上述增广矩阵有解。</p><p>线性代数的一个主要思想是研究可以表示为某一固定向量集合$\{v_1, v_2, \dots, v_n\}$的线性组合的所有向量。</p><h1 id="4-矩阵方程"><a href="#4-矩阵方程" class="headerlink" title="4. 矩阵方程"></a>4. 矩阵方程</h1><p>若A是mxn矩阵，它的各列为$a_1, \dots, a_n$。若x是$R^n$中向量，则A与x的积，记为Ax，就是A的各列以x中对应元素为权的线性组合，即：</p><p><script type="math/tex">Ax = [a_1, a_2, \dots, a_n][x_1, x_2, \dots, x_n]^{T} = x_1a_1 +x_2a_2 + \dots + x_na_n</script>。</p><p>例：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-062045.png" alt="image-20191013142032010"></p><h2 id="4-1-向量方程和矩阵方程的区别"><a href="#4-1-向量方程和矩阵方程的区别" class="headerlink" title="4.1 向量方程和矩阵方程的区别"></a>4.1 向量方程和矩阵方程的区别</h2><p>向量方程形如:</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-062408.png" alt="image-20191013142401120"></p><p>矩阵方程形如：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-062414.png" alt="image-20191013142331968"></p><h2 id="4-2-解的存在性"><a href="#4-2-解的存在性" class="headerlink" title="4.2 解的存在性"></a>4.2 解的存在性</h2><p>设A是mxn矩阵，则下列命题是逻辑上等价的。也就是说，对某个A，他们都成立或者都不成立：</p><ul><li>对$R^{m}$中每个b，方程Ax = b有解</li><li>$R^{m}$中的每个b都是A的列的一个线性组合</li><li>A的各列生成$R^m$</li><li>A的每一行都有一个主元位置</li></ul><h1 id="5-线性方程组的解集"><a href="#5-线性方程组的解集" class="headerlink" title="5. 线性方程组的解集"></a>5. 线性方程组的解集</h1><h2 id="5-1-齐次线性方程组"><a href="#5-1-齐次线性方程组" class="headerlink" title="5.1 齐次线性方程组"></a>5.1 齐次线性方程组</h2><p>线性方程组称为齐次的，若它可写成Ax = 0的形式，其中A是mxn矩阵，0是$R^m$中的零向量。这样的方程组至少有一个解，即x = 0。这个解称为它的平凡解。</p><p>齐次方程Ax = 0有非平凡解，当且仅当方程至少有一个自由变量。</p><h2 id="5-2-参数向量形式"><a href="#5-2-参数向量形式" class="headerlink" title="5.2 参数向量形式"></a>5.2 参数向量形式</h2><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-071040.png" alt="image-20191013151029601"></p><p>方程（2）是称为平面的参数向量方程。有时也可写为：</p><p><script type="math/tex">x = sy + tv</script>。</p><h2 id="5-3-非齐次方程组的解"><a href="#5-3-非齐次方程组的解" class="headerlink" title="5.3 非齐次方程组的解"></a>5.3 非齐次方程组的解</h2><p>当非齐次方程组有许多解时，一般可表示为参数向量形式，即由一个向量加上满足对应的齐次方程的一些向量的任意线性组合的形式。</p><p>例：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-074056.png" alt="image-20191013153845394"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-074146.png" alt="image-20191013154102302"></p><p>几何解释：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-075925.png" alt="image-20191013155859814"></p><h1 id="6-线性无关"><a href="#6-线性无关" class="headerlink" title="6. 线性无关"></a>6. 线性无关</h1><h2 id="6-1-定义"><a href="#6-1-定义" class="headerlink" title="6.1 定义"></a>6.1 定义</h2><p>$R^n$中一组向量$\{v_1, \dots, v_p\}$称为线性无关的，若向量方程$x_1v_1 + x_2v_2 + \dots + x_pv_p = 0$仅有平凡解。向量组（集）称为线性无关的，若存在不全为零的权$c_1, \dots, c_p$，使$c_1v_1 + c_2v_2 + \dots + c_pv_p = 0$。</p><h2 id="6-2-矩阵各列的线性无关"><a href="#6-2-矩阵各列的线性无关" class="headerlink" title="6.2 矩阵各列的线性无关"></a>6.2 矩阵各列的线性无关</h2><p>矩阵A的各列线性无关，当且仅当方程Ax = 0仅有平凡解。</p><h2 id="6-3-一个或多个向量的集合"><a href="#6-3-一个或多个向量的集合" class="headerlink" title="6.3 一个或多个向量的集合"></a>6.3 一个或多个向量的集合</h2><ul><li><p>两个向量的集合$\{v_1, v_2\}$线性相关，当且仅当其中一个向量是另一个向量的倍数。这个集合线性无关，当且仅当其中一个向量都不是另一个向量的倍数。</p></li><li><p>更多个向量的集合$S = \{v_1, \dots, v_p\}$线性相关，当且仅当S中至少有一个向量是其他向量的线性组合。</p></li><li><p>若一个向量组的向量个数超过每个向量元素个数，那么这个向量组线性相关。</p></li><li>若向量组$S = \{v_1, \dots, v_p\}$包含零向量，则它线性相关。</li></ul><h1 id="7-线性变换介绍"><a href="#7-线性变换介绍" class="headerlink" title="7. 线性变换介绍"></a>7. 线性变换介绍</h1><h2 id="7-1-矩阵变换"><a href="#7-1-矩阵变换" class="headerlink" title="7.1 矩阵变换"></a>7.1 矩阵变换</h2><p>变换（或映射）T称为线性的，若：</p><ul><li>对T的定义域中一切u, v，T(u + v) = T(u) + T(v)</li><li>对一切u和标量c，T(cu) = cT(u)</li></ul><h2 id="7-2-线性变换的矩阵"><a href="#7-2-线性变换的矩阵" class="headerlink" title="7.2 线性变换的矩阵"></a>7.2 线性变换的矩阵</h2><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-132101.png" alt="image-20191013212009351"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-132459.png" alt="image-20191013212458966"></p><h2 id="7-3-R-2-中的几何线性变换"><a href="#7-3-R-2-中的几何线性变换" class="headerlink" title="7.3 $R^2$中的几何线性变换"></a>7.3 $R^2$中的几何线性变换</h2><p>例：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-133232.png" alt="image-20191013213231663"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-133423.png" alt="image-20191013213325065"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-133344.png" alt="image-20191013213343910"></p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-10-13-133525.png" alt="image-20191013213358029"></p>]]></content>
      
      
      <categories>
          
          <category> 理论 </category>
          
          <category> 数学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Vultr搭建个人主页</title>
      <link href="/2019/07/31/others/%E4%BD%BF%E7%94%A8Vultr%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/"/>
      <url>/2019/07/31/others/%E4%BD%BF%E7%94%A8Vultr%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><ul><li>申请域名</li><li>购买VPS</li><li>环境配置</li><li>个人网站部署<ul><li>静态网站</li><li>PHP网站</li></ul></li></ul><h1 id="2-申请域名"><a href="#2-申请域名" class="headerlink" title="2. 申请域名"></a>2. 申请域名</h1><p>域名是IP的别名。一般而言，我们想要访问一个站点，并不会直接输入IP，而是输入域名来访问。例如，想要访问Google站点的话，只需在浏览器的地址栏内输入”www.google.com”即可。</p><p>域名需要自行付费申请。一般而言，.com是主流域名，价格稍贵。其他新兴域名，例如.cc等，便宜。申请的服务商也很多，诸如阿里云、Godaddy等。</p><h1 id="3-购买VPS"><a href="#3-购买VPS" class="headerlink" title="3. 购买VPS"></a>3. 购买VPS</h1><p>VPS主要用来存放网站的所有内容，包括代码、素材等。VPS服务商也很多，在国际上比较出名的是<a href="www.vultr.com">Vultr</a>和搬瓦工。本教程利用Vultr上的服务器来搭建个人主页。</p><p>Vultr主页上的服务器购买也很简单：注册、充值、选服务。此处选取Centos 6.X作为演示。其中涉及到如何使用SSH登录服务器，请参考<a href="[https://vslam.net/2018/10/21/vultr%E7%9A%84ss%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B/](https://vslam.net/2018/10/21/vultr的ss服务器教程/">vultr的ss服务器教程</a>)。</p><h1 id="4-环境配置"><a href="#4-环境配置" class="headerlink" title="4. 环境配置"></a>4. 环境配置</h1><p>环境：Centos 6.X</p><h2 id="4-1-配置Nginx"><a href="#4-1-配置Nginx" class="headerlink" title="4.1 配置Nginx"></a>4.1 配置Nginx</h2><p>1）在 CentOS 上，可直接使用 yum 来安装 Nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure><p>2）安装完成后，使用 nginx 命令启动 Nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure><p>此时，访问 <a href="http://ip" target="_blank" rel="noopener">http://ip</a> 可以看到 Nginx 的测试页面。如果无法访问，请重试用命令重启 Nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>如果出现如下页面，则配置正确：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-31-164104.png" alt="image-20190801004058752"></p><p>如果还是无法访问，可能是因为端口没有开放的原因。请按照如下解决方案：</p><p>1）本地机器测试nginx是否能正常启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://ip</span><br></pre></td></tr></table></figure><p>这里的ip地址为你本机的ip地址。</p><p>如果出现类似如下结果，证明服务器上nginx配置没问题：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD XHTML 1.1//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;html xmlns=<span class="string">"http://www.w3.org/1999/xhtml"</span> xml:lang=<span class="string">"en"</span>&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Test Page <span class="keyword">for</span> the Nginx HTTP Server on EPEL&lt;/title&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span><br><span class="line">        &lt;style <span class="built_in">type</span>=<span class="string">"text/css"</span>&gt;</span><br><span class="line">            /*&lt;![CDATA[*/</span><br><span class="line">            body &#123;</span><br><span class="line">                background-color: <span class="comment">#fff;</span></span><br><span class="line">                color: <span class="comment">#000;</span></span><br><span class="line">                font-size: 0.9em;</span><br><span class="line">                font-family: sans-serif,helvetica;</span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0;</span><br><span class="line">            &#125;</span><br><span class="line">            :link &#123;</span><br><span class="line">                color: <span class="comment">#c00;</span></span><br><span class="line">            &#125;</span><br><span class="line">            :visited &#123;</span><br><span class="line">                color: <span class="comment">#c00;</span></span><br><span class="line">            &#125;</span><br><span class="line">            a:hover &#123;</span><br><span class="line">                color: <span class="comment">#f50;</span></span><br><span class="line">            &#125;</span><br><span class="line">            h1 &#123;</span><br><span class="line">                text-align: center;</span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0.6em 2em 0.4em;</span><br><span class="line">                background-color: <span class="comment">#294172;</span></span><br><span class="line">                color: <span class="comment">#fff;</span></span><br><span class="line">                font-weight: normal;</span><br><span class="line">                font-size: 1.75em;</span><br><span class="line">                border-bottom: 2px solid <span class="comment">#000;</span></span><br><span class="line">            &#125;</span><br><span class="line">            h1 strong &#123;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                font-size: 1.5em;</span><br><span class="line">            &#125;</span><br><span class="line">            h2 &#123;</span><br><span class="line">                text-align: center;</span><br><span class="line">                background-color: <span class="comment">#3C6EB4;</span></span><br><span class="line">                font-size: 1.1em;</span><br><span class="line">                font-weight: bold;</span><br><span class="line">                color: <span class="comment">#fff;</span></span><br><span class="line">                margin: 0;</span><br><span class="line">                padding: 0.5em;</span><br><span class="line">                border-bottom: 2px solid <span class="comment">#294172;</span></span><br><span class="line">            &#125;</span><br><span class="line">            hr &#123;</span><br><span class="line">                display: none;</span><br><span class="line">            &#125;</span><br><span class="line">            .content &#123;</span><br><span class="line">                padding: 1em 5em;</span><br><span class="line">            &#125;</span><br><span class="line">            .alert &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#000;</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            img &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#fff;</span></span><br><span class="line">                padding: 2px;</span><br><span class="line">                margin: 2px;</span><br><span class="line">            &#125;</span><br><span class="line">            a:hover img &#123;</span><br><span class="line">                border: 2px solid <span class="comment">#294172;</span></span><br><span class="line">            &#125;</span><br><span class="line">            .logos &#123;</span><br><span class="line">                margin: 1em;</span><br><span class="line">                text-align: center;</span><br><span class="line">            &#125;</span><br><span class="line">            /*]]&gt;*/</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Welcome to &lt;strong&gt;nginx&lt;/strong&gt; on EPEL!&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=<span class="string">"content"</span>&gt;</span><br><span class="line">            &lt;p&gt;This page is used to <span class="built_in">test</span> the proper operation of the</span><br><span class="line">            &lt;strong&gt;nginx&lt;/strong&gt; HTTP server after it has been</span><br><span class="line">            installed. If you can <span class="built_in">read</span> this page, it means that the</span><br><span class="line">            web server installed at this site is working</span><br><span class="line">            properly.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=<span class="string">"alert"</span>&gt;</span><br><span class="line"><span class="comment"># Generated by iptables-save v1.4.7 on Sun Aug  4 11:16:46 2019</span></span><br><span class="line">                &lt;h2&gt;Website Administrator&lt;/h2&gt;</span><br><span class="line">                &lt;div class=<span class="string">"content"</span>&gt;</span><br><span class="line">                    &lt;p&gt;This is the default &lt;tt&gt;index.html&lt;/tt&gt; page that</span><br><span class="line">                    is distributed with &lt;strong&gt;nginx&lt;/strong&gt; on</span><br><span class="line">                    EPEL.  It is located <span class="keyword">in</span></span><br><span class="line">                    &lt;tt&gt;/usr/share/nginx/html&lt;/tt&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;p&gt;You should now put your content <span class="keyword">in</span> a location of</span><br><span class="line">                    your choice and edit the &lt;tt&gt;root&lt;/tt&gt; configuration</span><br><span class="line">                    directive <span class="keyword">in</span> the &lt;strong&gt;nginx&lt;/strong&gt;</span><br><span class="line">                    configuration file</span><br><span class="line">                    &lt;tt&gt;/etc/nginx/nginx.conf&lt;/tt&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=<span class="string">"logos"</span>&gt;</span><br><span class="line">                &lt;a href=<span class="string">"http://nginx.net/"</span>&gt;&lt;img</span><br><span class="line">                    src=<span class="string">"nginx-logo.png"</span></span><br><span class="line">                    alt=<span class="string">"[ Powered by nginx ]"</span></span><br><span class="line">                    width=<span class="string">"121"</span> height=<span class="string">"32"</span> /&gt;&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">                &lt;a href=<span class="string">"http://fedoraproject.org/"</span>&gt;&lt;img</span><br><span class="line">                    src=<span class="string">"poweredby.png"</span></span><br><span class="line">                    alt=<span class="string">"[ Powered by Fedora EPEL ]"</span></span><br><span class="line">                    width=<span class="string">"88"</span> height=<span class="string">"31"</span> /&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>2）防火墙、端口开启设置</p><p>（1）打开80端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure><p>添加：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure><p>（2）重启防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables status</span><br></pre></td></tr></table></figure><p>在进行ip访问，应该能够成功了。</p><h2 id="4-2-配置静态服务器访问路径"><a href="#4-2-配置静态服务器访问路径" class="headerlink" title="4.2 配置静态服务器访问路径"></a>4.2 配置静态服务器访问路径</h2><p>外网用户访问服务器的 Web 服务由 Nginx 提供，Nginx 需要配置静态资源的路径信息才能通过 url 正确访问到服务器上的静态资源。nginx后发现配置文件只有一个,/etc/nginx/nginx.conf。所有的配置包括虚拟目录也在此文件中配置, 这样当虚拟主机多了管理就有些不方便了。我们把配置文件拆分开来,在/etc/nginx/conf.d/ 文件建立对应的域名配置文件,比如 /etc/nginx/conf.d/123.com.conf。</p><p>1）新建配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch new_file.conf &amp;&amp; vi new_file.conf</span><br></pre></td></tr></table></figure><p>2）添加配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  server_name ip; // 你的域名或者 ip</span><br><span class="line">  root /www/website; // 你的克隆到的项目路径</span><br><span class="line">  index index.html; // 显示首页</span><br><span class="line">  location ~* ^.+\.(jpg|jpeg|gif|png|ico|css|js|pdf|txt)&#123;</span><br><span class="line">    root /www/website;</span><br><span class="line">  &#125; // 静态文件访问</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，路径/www/website为你的源文件存放地址。</p><p>3）重启Nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
          <category> 网站搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他 </tag>
            
            <tag> 网站搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOS开发-CocoaPods教程</title>
      <link href="/2019/07/28/programmings/iOS/IOS%E5%BC%80%E5%8F%91-CocoaPods%E6%95%99%E7%A8%8B/"/>
      <url>/2019/07/28/programmings/iOS/IOS%E5%BC%80%E5%8F%91-CocoaPods%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="CocoaPods简介"><a href="#CocoaPods简介" class="headerlink" title="CocoaPods简介"></a>CocoaPods简介</h1><p>CocoaPods是iOS的包管理工具。在开发iOS项目时，经常会使用第三方开源库，手动引入流程复杂，并且库之间还存在依赖关系，更增加了手动管理的难度。开源库如果升级了，你也想用最新版本，还需要重新手动导入，这大大增加了工作量。但用了CocoaPods后，安装和升级都只是一句命令的事情，让你可以专于业务本身。</p><h1 id="CocoaPods安装"><a href="#CocoaPods安装" class="headerlink" title="CocoaPods安装"></a>CocoaPods安装</h1><h2 id="安装Ruby"><a href="#安装Ruby" class="headerlink" title="安装Ruby"></a>安装Ruby</h2><p>CocoaPods基于Ruby语言开发而成，因此安装CocoaPods前需要安装Ruby环境。幸运的是Mac系统默认自带Ruby环境，如果没有请自行查找安装。检测是否安装Ruby：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gem -v</span><br><span class="line">2.0.14</span><br></pre></td></tr></table></figure><p>安装则会提示当前Ruby版本。gem介绍：gem是一个管理Ruby库和程序的标准包，它通过Ruby Gem（如 <a href="http://rubygems.org/" target="_blank" rel="noopener">http://rubygems.org/</a> ）源来查找、安装、升级和卸载软件包，非常的便捷。</p><h2 id="更换gem源"><a href="#更换gem源" class="headerlink" title="更换gem源"></a>更换gem源</h2><p>因为国内网络的问题导致gem源间歇性中断，原因你懂的。因此我们需要更换gem源，使用淘宝的gem源<a href="https://ruby.taobao.org/。" target="_blank" rel="noopener">https://ruby.taobao.org/。</a></p><p>第一步：移动默认的源:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem sources --remove https://rubygems.org/</span><br></pre></td></tr></table></figure><p>第二步：指定淘宝的源:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem sources -a https://ruby.taobao.org/</span><br></pre></td></tr></table></figure><p>第三步：查看指定的源是不是淘宝源:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gem sources -l</span><br><span class="line">*** CURRENT SOURCES ***</span><br><span class="line"></span><br><span class="line">https://ruby.taobao.org/</span><br></pre></td></tr></table></figure><p>如果是<a href="https://ruby.taobao.org/，则更换成功。" target="_blank" rel="noopener">https://ruby.taobao.org/，则更换成功。</a></p><h2 id="安装CocoaPods"><a href="#安装CocoaPods" class="headerlink" title="安装CocoaPods"></a>安装CocoaPods</h2><p>确认改成淘宝源后执行以下命令进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods</span><br></pre></td></tr></table></figure><p>稍等片刻即可安装完成，输入以下命令检测是否安装成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pod --version</span><br><span class="line">0.39.0</span><br></pre></td></tr></table></figure><p>成功则会提示CocoaPods版本。</p><h1 id="CocoaPods使用实例"><a href="#CocoaPods使用实例" class="headerlink" title="CocoaPods使用实例"></a>CocoaPods使用实例</h1><p>首先新建一个iOS工程MyDemo，在该工程中演示CocoaPods的使用。</p><ol><li><p>进入工程的根目录，创建Podfile文件.</p></li><li><p>根据需要，我们可以在Podfile文件中写入我们需要的第三方库，这里以AFNetworking和MJRefresh为例，Podfile内容如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">platform :ios, &apos;7.0&apos;</span><br><span class="line">pod &apos;AFNetworking&apos;, &apos;~&gt; 3.0&apos;</span><br><span class="line">pod &apos;MJRefresh&apos;,&apos;~&gt; 3.1&apos;</span><br><span class="line"># 这段代码的意思是，当前类库支持的iOS最低版本是iOS 7.0, 要下载的两个类库的版本分别为 3.0、3.1。</span><br></pre></td></tr></table></figure></li><li><p>这时候，你就可以利用CocoPods下载AFNetworking和MJRefresh类库了。在终端中进入工程根目录，运行以下命令：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /Users/myl/Desktop/IOS/MyDemo</span><br><span class="line">$ pod install</span><br><span class="line">Analyzing dependencies</span><br><span class="line">Downloading dependencies</span><br><span class="line">Installing AFNetworking (3.0.4)</span><br><span class="line">Installing MJRefresh (3.1.0)</span><br><span class="line">Generating Pods project</span><br><span class="line">Integrating client project</span><br><span class="line"></span><br><span class="line">[!] Please close any current Xcode sessions and use `MyDemo.xcworkspace` <span class="keyword">for</span> this project from now on.</span><br><span class="line">Sending stats</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> IOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> IOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zotero教程</title>
      <link href="/2019/06/17/science/Zotero%E6%95%99%E7%A8%8B/"/>
      <url>/2019/06/17/science/Zotero%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Zotero简介"><a href="#Zotero简介" class="headerlink" title="Zotero简介"></a>Zotero简介</h1><p><a href="https://www.zotero.org/" target="_blank" rel="noopener">Zotero</a>是一个集成式的参考文献管理软件，支持一键导出为bib格式文献库或者一键插入Word文档。</p><h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><h2 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h2><p>详见官网：<a href="https://www.zotero.org/" target="_blank" rel="noopener">Zotero</a></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="账户"><a href="#账户" class="headerlink" title="账户"></a>账户</h3><p>打开Zotero，找到[首选项]或偏好。在同步一栏输入注册的账号，这样，文献库可以同步到[Zotero]官网。</p><h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>由于Zotero自带的云存储只有300M（虽然存储条目数据绰绰有余，但是面对众多文献pdf附件就只能两手一摊了）因此只能另外找地方来存储这些pdf。</p><p>（1）Dropbox设置</p><p>通常来说，Dropbox默认的同步文件夹名为Dropbox。<br>（2）设置Zotero首选项</p><p>打开 编辑 - 首选项 ，切换至 同步 标签，取消勾选 文件同步 中的两个复选框。这一步的目的是不让附件自动同步到Zotero的云空间上。</p><p>仅一台电脑：打开 编辑 - 首选项 ，切换至 高级 标签，再切换至 文件和文件夹 子标签，在 链接附件的根目录 中选择一个文件夹。这个文件夹需要建在Onedrive（或其他云盘）文件夹里，用来存储pdf文件。比如：\Users\xxx\OneDrive\My Zotero\My Reference。</p><p>多台电脑：需要保持两台电脑及以上电脑对Zotero数据的同步，确保可以随时同步查看我自己添加的笔记，文献的 pdf 等各种文件。</p><p>如果你只是简单将Zotero的数据存储位置改到网盘里的话，同时在两台电脑打开Zotero并操作，很容易导致两台电脑的数据不一致。网盘不知道该以哪台电脑的数据库为准。如此会在Zotero文件夹下形成几十个冲突的zotero.sqlite文件。不甚优雅。还可能导致数据库损坏。</p><p>我们可以利用 Zotero 官方的数据同步功能来同步数据库，使用symlink（符号链接）的形式同步文件。符号链接是一种软链接，由一个文件夹指向另一个文件夹，此处及Zotero文件夹指向Dropbox文件夹。操作系统访问符号链接所在文件夹时，会自动跳转到所指向的源文件夹，仿佛直接在访问源文件夹。</p><p>例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="string">"/Users/XXX/网盘路径/Zotero/storage"</span> <span class="string">"/Users/XXX/本地路径/Zotero"</span></span><br></pre></td></tr></table></figure><p>（3）设置 ZotFile 首选项</p><p>ZotFile是一个Zotero的附件管理插件。由于Zotero默认保存附件的机制是：每添加一个附件，就在storage文件夹中自动随机生成一串字母数字作为文件夹名，然后将pdf附件保存在该文件夹中。这样的后果就是我们无法方便地对附件归类，并且不方便搜寻特定的附件。ZotFile可按照特定规则自动修改文件名，并可按照分类规则自动创建文件夹，将符合该规则的附件放在同一个文件夹下。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://dango.rocks/blog/2019/03/25/Zotero_ZotFile_iCloud/" target="_blank" rel="noopener">迁移到 Zotero + ZotFile + OneDrive</a></li><li><a href="https://ffffuturexu.github.io/hexo-blog/2018/02/26/zotero-setting/" target="_blank" rel="noopener">文献管理工具 Zotero 的同步设置</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 学术 </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 学术 </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AFNetworking库教程</title>
      <link href="/2019/05/12/programmings/iOS/AFNetworking%E5%BA%93%E6%95%99%E7%A8%8B/"/>
      <url>/2019/05/12/programmings/iOS/AFNetworking%E5%BA%93%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。</p><p>超文本传输协议（HyperText Transfer Protocol，HTTP）是从服务器传输数据到客户端的传输协议。</p><p>HTTP是一个基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。HTTP协议工作于客户端-服务端架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。Web服务器根据接收到的请求后，向客户端发送响应信息。</p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>支持客户/服务器模式；</li><li>简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。</li><li>灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。</li><li>无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</li><li>无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。</li></ul><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p>HTTP使用统一资源标识符（Uniform Resource Identifiers, URI）来传输数据和建立连接。URL是一种特殊类型的URI，包含了用于查找某个资源的足够的信息。URL,全称是UniformResourceLocator, 中文叫统一资源定位符,是互联网上用来标识某一处资源的地址。</p><p>完整的URL包括以下几部分：</p><p>实例：<a href="http://www.aspxfans.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name" target="_blank" rel="noopener">http://www.aspxfans.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name</a></p><ul><li>协议部分：该URL的协议部分为“http：”，这代表网页使用的是HTTP协议。在Internet中可以使用多种协议，如HTTP，FTP等等本例中使用的是HTTP协议。在”HTTP”后面的“//”为分隔符；</li><li>域名部分：该URL的域名部分为“www.aspxfans.com”。一个URL中，也可以使用IP地址作为域名使用；</li><li>端口部分：跟在域名后面的是端口，域名和端口之间使用“:”作为分隔符。端口不是一个URL必须的部分，如果省略端口部分，将采用默认端口；</li><li>虚拟目录部分：从域名后的第一个“/”开始到最后一个“/”为止，是虚拟目录部分。虚拟目录也不是一个URL必须的部分。本例中的虚拟目录是“/news/”；</li><li>文件名部分：从域名后的最后一个“/”开始到“？”为止，是文件名部分，如果没有“?”,则是从域名后的最后一个“/”开始到“#”为止，是文件部分，如果没有“？”和“#”，那么从域名后的最后一个“/”开始到结束，都是文件名部分。本例中的文件名是“index.asp”。文件名部分也不是一个URL必须的部分，如果省略该部分，则使用默认的文件名；</li><li>锚部分：从“#”开始到最后，都是锚部分。本例中的锚部分是“name”。锚部分也不是一个URL必须的部分；</li><li>参数部分：从“？”开始到“#”为止之间的部分为参数部分，又称搜索部分、查询部分。本例中的参数部分为“boardID=5&amp;ID=24618&amp;page=1”。参数可以允许有多个参数，参数与参数之间用“&amp;”作为分隔符。</li></ul><h2 id="请求消息Request"><a href="#请求消息Request" class="headerlink" title="请求消息Request"></a>请求消息Request</h2><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /562f25980001b1b106000338.jpg HTTP/1.1</span><br><span class="line">Host    img.mukewang.com</span><br><span class="line">User-Agent  Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36</span><br><span class="line">Accept  image/webp,image/*,*/*;q=0.8</span><br><span class="line">Referer http://www.imooc.com/</span><br><span class="line">Accept-Encoding gzip, deflate, sdch</span><br><span class="line">Accept-Language zh-CN,zh;q=0.8</span><br></pre></td></tr></table></figure><ul><li>请求行，用来说明请求类型,要访问的资源以及所使用的HTTP版本.GET说明请求类型为GET,[/562f25980001b1b106000338.jpg]为要访问的资源，该行的最后一部分说明使用的是HTTP1.1版本。</li><li>求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息。从第二行起为请求头部，HOST将指出请求的目的地.User-Agent,服务器端和客户端脚本都能访问它,它是浏览器类型检测逻辑的重要基础.该信息由你的浏览器来定义,并且在每个请求中自动发送等等；<ul><li>Accept: 客户端接受哪些 Mine 类型。如 Accept: text/html</li><li>Accept-Encoding: 支持的编码类型。如 gzip, deflate, sdch</li><li>Accept-Language: 可接受的语言。如 en-US,en;q=0.8</li><li>User-Agent:一个标识客户端的字符串。如 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML，like Gecko) Chrome/38.0.2125.101 Safari/537.36</li><li>Cookie: Cookie。如 sessionid=c8422b97-98e2-4bc6-aa31-9b667d6ca4a5; theme=4;</li><li>Referer: 从那个页面到的该页面。</li></ul></li><li>空行，请求头部后面的空行是必须的；</li><li>请求数据也叫主体，可以添加任意的其他数据。</li></ul><h2 id="响应消息Response"><a href="#响应消息Response" class="headerlink" title="响应消息Response"></a>响应消息Response</h2><p>一般情况下，服务器接收并处理客户端发过来的请求后会返回一个HTTP的响应消息。HTTP响应也由四个部分组成，分别是：状态行、消息报头、空行和响应正文。</p><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Fri, 22 May 2009 06:07:21 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">      &lt;head&gt;&lt;/head&gt;</span><br><span class="line">      &lt;body&gt;</span><br><span class="line">            &lt;!--body goes here--&gt;</span><br><span class="line">      &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>状态行，由HTTP协议版本号， 状态码， 状态消息 三部分组成。第一行为状态行，（HTTP/1.1）表明HTTP版本为1.1版本，状态码为200，状态消息为（ok）</li><li>消息报头，用来说明客户端要使用的一些附加信息,Date:生成响应的日期和时间；Content-Type:指定了MIME类型的HTML(text/html),编码类型是UTF-8</li><li>空行，消息报头后面的空行是必须的</li><li>响应正文，服务器返回给客户端的文本信息。</li></ul><h3 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3><p>HTTP 状态码（HTTP Status Code）是用以表示网页服务器 HTTP 响应状态的3位数字代码。<br>所有的状态码的第一个数字代表了响应的五种状态之一:</p><ul><li>1xx：代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行 结束。</li><li>2xx：代表请求接收、理解并且接受。</li><li>3xx：代表需要客户端采取进一步的操作才能完成请求。通常，这些状态码用来重定向，后续的请求地址（重定向目 标）在本次响应的Location域中指明。当且仅当后续的请求所使用的方法是GET或者HEAD时，用户浏览器才可以 在没有用户介入的情况下自动提交所需要的后续请求。</li><li>4xx：代表了客户端看起来可能发生了错误，妨碍了服务器的处理。除非响应的是一个HEAD请求，否则服务器就应 该返回一个解释当前错误状况的实体，以及这是临时的还是永久性的状况。</li><li>5xx：代表了服务器在处理请求的过程中有错误或者异常状态发生，，也有可能是服务器意识到以当前的软硬件资源 无法完成对请求的处理。</li></ul><p>常见状态码有：</p><ul><li>200: 请求已经成功，请求所希望的响应头或者数据体将随着此响应返回</li><li>202: 服务器已接受请求，但尚未处理。正如它可能被拒绝一样，最终该请求可能会也可能不会被执行。在异步操作的场合下，没有比发送这个状态码更方便的做法了</li><li>204: 服务器成功处理了请求，但不需要返回任何实体内容，并且希望返回更新了的元信息</li><li>304: 被请求的资源内容没有发生更改</li><li>400: 包含语法错误，无法被服务器解析</li><li>403: 服务器已经接收请求，但是拒绝执行</li><li>404: 请求失败，请求所希望得到的资源未在服务器上发现</li><li>408: 请求超时。客户端可以再次提交这一请求而无需任何修改</li><li>500: 服务器内部错误，无法处理请求</li><li>502: 作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效响应</li><li>504: 作为网关或者代理工作的服务器尝试执行请求时，未能及时从上游服务器（URI标识出的服务器，例如HTTP、FTP、LDAP）或者辅助服务器（例如DNS）收到响应</li></ul><h3 id="响应头字段"><a href="#响应头字段" class="headerlink" title="响应头字段"></a>响应头字段</h3><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Date: Mon, 27 Jul 2009 12:28:53 GMT</span><br><span class="line">Server: Apache/2.2.14 (Win32)</span><br><span class="line">Last-Modified: Wed, 22 Jul 2009 19:15:56 GMT</span><br><span class="line">Content-Length: 88</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Connection: Closed</span><br></pre></td></tr></table></figure><p>常见响应头有：</p><ul><li>Content-Encoding: 数据的编码类型。如 Content-Encoding: gzip</li><li>Server: 服务器的名称。如 Server:thin 1.5.0 codename Knife</li><li>Location:  通知客户端新的资源位置。如 Location: <a href="http://www.github.com/login" target="_blank" rel="noopener">http://www.github.com/login</a></li><li>Content-Type: 响应数据的类型。如 Content-Type:text/html; charset=UTF-8</li><li>Content-Encoding: 响应数据的编码格式。如 gzip。客户端会根据该值对响应内容解码。</li></ul><h2 id="HTTP请求方法"><a href="#HTTP请求方法" class="headerlink" title="HTTP请求方法"></a>HTTP请求方法</h2><p>根据HTTP标准，HTTP请求可以使用多种请求方法。HTTP1.0定义了三种请求方法： GET, POST 和 HEAD方法。</p><p>HTTP1.1新增了五种请求方法：OPTIONS, PUT, DELETE, TRACE 和 CONNECT 方法。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET  请求指定的页面信息，并返回实体主体。</span><br><span class="line">HEAD     类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</span><br><span class="line">POST     向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。</span><br><span class="line">PUT  从客户端向服务器传送的数据取代指定的文档的内容。</span><br><span class="line">DELETE   请求服务器删除指定的页面。</span><br><span class="line">CONNECT  HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</span><br><span class="line">OPTIONS  允许客户端查看服务器的性能。</span><br><span class="line">TRACE    回显服务器收到的请求，主要用于测试或诊断。</span><br></pre></td></tr></table></figure><h2 id="HTTP工作原理"><a href="#HTTP工作原理" class="headerlink" title="HTTP工作原理"></a>HTTP工作原理</h2><p>步骤：</p><p>1）客户端连接到Web服务器</p><p>一个HTTP客户端，通常是浏览器，与Web服务器的HTTP端口（默认为80）建立一个TCP套接字连接。例如：<a href="http://www.vslam.net" target="_blank" rel="noopener">http://www.vslam.net</a>.</p><p>2）发送HTTP请求</p><p>通过TCP套接字，客户端向Web服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据4部分组成。</p><p>3）服务器接受请求并返回HTTP响应</p><p>Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据4部分组成。</p><p>4）释放连接TCP连接</p><p>若connection 模式为close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放TCP连接;若connection 模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;</p><p>5）客户端浏览器解析HTML内容</p><p>客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。</p><p>例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：</p><p>1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;</p><p>2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;</p><p>3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;</p><p>4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;</p><p>5、释放 TCP连接;</p><p>6、浏览器将该 html 文本并显示内容;</p><h2 id="GET和POST请求的区别"><a href="#GET和POST请求的区别" class="headerlink" title="GET和POST请求的区别"></a>GET和POST请求的区别</h2><p>例子：</p><p>GET请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /books/?sex=man&amp;name=Professional HTTP/1.1</span><br><span class="line">Host: www.wrox.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)</span><br><span class="line">Gecko/20050225 Firefox/1.0.1</span><br><span class="line">Connection: Keep-Alive</span><br></pre></td></tr></table></figure><p>注意最后一行是空行。</p><p>POST请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: www.wrox.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)</span><br><span class="line">Gecko/20050225 Firefox/1.0.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 40</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line"></span><br><span class="line">name=Professional%20Ajax&amp;publisher=Wiley</span><br></pre></td></tr></table></figure><p>1）GET提交，请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，多个参数用&amp;连接；例 如：login.action?name=hyddd&amp;password=idontknow&amp;verify=%E4%BD%A0 %E5%A5%BD。如果数据是英文字母/数字，原样发送，如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密，得出如： %E4%BD%A0%E5%A5%BD，其中％XX中的XX为该符号以16进制表示的ASCII。</p><p>2）POST提交：把提交的数据放置在是HTTP包的包体中。</p><p>因此，GET提交的数据会在地址栏中显示出来，而POST提交，地址栏不会改变</p><h2 id="命令行-HTTP-客户端"><a href="#命令行-HTTP-客户端" class="headerlink" title="命令行 HTTP 客户端"></a>命令行 HTTP 客户端</h2><p><a href="https://link.jianshu.com/?t=https://github.com/jkbrzt/httpie" target="_blank" rel="noopener">HTTPie</a> 类似 cURL，但其 api 相比 cURL 更友好。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.jianshu.com/p/80e25cb1d81a" target="_blank" rel="noopener">关于HTTP协议，一篇就够了</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 环境配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 环境配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac下更换Homebrew镜像源</title>
      <link href="/2019/05/12/programmings/linux/Mac%E4%B8%8B%E6%9B%B4%E6%8D%A2Homebrew%E9%95%9C%E5%83%8F%E6%BA%90/"/>
      <url>/2019/05/12/programmings/linux/Mac%E4%B8%8B%E6%9B%B4%E6%8D%A2Homebrew%E9%95%9C%E5%83%8F%E6%BA%90/</url>
      
        <content type="html"><![CDATA[<h1 id="1-使用中科大源"><a href="#1-使用中科大源" class="headerlink" title="1. 使用中科大源"></a>1. 使用中科大源</h1><p>(1) 替换默认源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/brew.git</span><br></pre></td></tr></table></figure><p>(2) 替换homebrew-core.git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">brew update</span><br></pre></td></tr></table></figure><p>(3) 替换Homebrew Bottles源</p><blockquote><p>Homebrew是OS X系统的一款开源的包管理器。出于节省时间的考虑，Homebrew默认从Homebrew Bottles源中下载二进制代码包安装。Homebrew Bottles是Homebrew提供的二进制代码包，目前镜像站收录了以下仓库：<br>homebrew/homebrew-core<br>homebrew/homebrew-dupes<br>homebrew/homebrew-games<br>homebrew/homebrew-gui<br>homebrew/homebrew-python<br>homebrew/homebrew-php<br>homebrew/homebrew-science<br>homebrew/homebrew-versions<br>homebrew/homebrew-x11</p></blockquote><p>对于bash用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><p>对于zsh用户:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure><h1 id="2-使用清华源"><a href="#2-使用清华源" class="headerlink" title="2. 使用清华源"></a>2. 使用清华源</h1><p>(1) 替换默认源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">brew update</span><br></pre></td></tr></table></figure><p>(2) 使用homebrew-science或者homebrew-python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-science"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-science.git</span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-python"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-python.git</span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">brew update</span><br></pre></td></tr></table></figure><p>(3) 替换Homebrew Bottles源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><h1 id="3-切换回官方源"><a href="#3-切换回官方源" class="headerlink" title="3. 切换回官方源"></a>3. 切换回官方源</h1><p>(1) 重置brew.git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://github.com/Homebrew/brew.git</span><br></pre></td></tr></table></figure><p>(2) 重置homebrew-core.git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://github.com/Homebrew/homebrew-core.git</span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line">brew update</span><br></pre></td></tr></table></figure><p>(3) 注释掉bash配置文件里的有关Homebrew Bottles即可恢复官方源。 重启bash或让bash重读配置文件。</p><h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ul><li><a href="https://blog.csdn.net/lwplwf/article/details/79097565" target="_blank" rel="noopener">Mac下更换Homebrew镜像源</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 环境配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 环境配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++空类</title>
      <link href="/2019/05/12/programmings/c_plus_plus/C-%E7%A9%BA%E7%B1%BB/"/>
      <url>/2019/05/12/programmings/c_plus_plus/C-%E7%A9%BA%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>C++的空类是指这个类不带任何数据，即类中没有非静态(non-static)数据成员变量，没有虚函数(virtual function)，也没有虚基类(virtual base class)。</p><p>直观地看，空类对象不使用任何空间，因为没有任何隶属对象的数据需要存储。然而，C++标准规定，凡是一个独立的(非附属)对象都必须具有非零大小。换句话说，++空类的大小不为0。</p><p>C++标准指出，不允许一个对象（当然包括类对象）的大小为0，不同的对象不能具有相同的地址。这是由于：</p><ul><li>new需要分配不同的内存地址，不能分配内存大小为0的空间</li><li>避免除以 sizeof(T)时得到除以0错误</li></ul><p>故使用一个字节来区分空类。</p><p>为了验证这个结论，可以先来看测试程序的输出。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoMembers</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    NoMembers n;  <span class="comment">// Object of type NoMembers.</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"The size of an object of empty class is: "</span></span><br><span class="line">         &lt;&lt; <span class="keyword">sizeof</span>(n) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出:</span><br><span class="line">he size of an object of empty <span class="class"><span class="keyword">class</span> <span class="title">is</span>:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>值得注意的是，这并不代表一个空的基类也需要加一个字节到子类中去。这种情况下，空类并不是独立的，它附属于子类。子类继承空类后，子类如果有自己的数据成员，而空基类的一个字节并不会加到子类中去。例如，</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Empty</span> &#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">D</span> :</span> <span class="keyword">public</span> Empty &#123;<span class="keyword">int</span> a;&#125;;</span><br></pre></td></tr></table></figure><p>sizeof(D)为4。</p><p>再来看另一种情况，一个类包含一个空类对象数据成员。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Empty</span> &#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldsAnInt</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    Empty e;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>大多数编译器中，你会发现 sizeof(HoldsAnInt) 输出为8。这是由于，Empty类的大小虽然为1，然而为了内存对齐，编译器会为HoldsAnInt额外加上一些字节，使得HoldsAnInt被放大到足够又可以存放一个int。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编程-设计模式教程</title>
      <link href="/2019/05/12/programmings/c_plus_plus/%E7%BC%96%E7%A8%8B-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%95%99%E7%A8%8B/"/>
      <url>/2019/05/12/programmings/c_plus_plus/%E7%BC%96%E7%A8%8B-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p>确保某个类只有一个实例,并且自行实例化并向整个系统提供这个实例。</p><p>1）特点</p><ul><li>单例类只能有一个实例。</li><li>单例类必须自己创建自己的唯一实例。</li><li>单例类必须给所有其他对象提供这一实例。</li></ul><p>2）应用场景</p><ul><li>频繁访问数据库或文件的对象。</li><li>工具类对象；</li><li>创建对象时耗时过多或耗费资源过多，但又经常用到的对象；</li></ul><p>3）优点</p><ul><li>内存中只存在一个对象，节省了系统资源。</li><li>避免对资源的多重占用，例如一个文件操作，由于只有一个实例存在内存中，避免对同一资源文件的同时操作。</li></ul><p>4）缺点</p><ul><li>获取对象时不能用new</li><li>单例对象如果持有Context，那么很容易引发内存泄露。</li><li>单例模式一般没有接口，扩展很困难，若要扩展，只能修改代码来实现。</li></ul><p>5）实现</p><p>（1）推荐方案</p><p>Java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//第一次调用getInstance方法时才加载SingletonHolder并初始化sInstance</span></span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.sInstance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//静态内部类</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton sInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C++:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// version 1.2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Singleton() &#123; &#125;;</span><br><span class="line">~Singleton() &#123; &#125;;</span><br><span class="line">Singleton(<span class="keyword">const</span> Singleton&amp;);</span><br><span class="line">Singleton&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Singleton&amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">static</span> Singleton&amp; <span class="title">getInstance</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"><span class="keyword">static</span> Singleton instance;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>（2) 饿汉式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单例类.   </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;<span class="comment">//构造方法为private,防止外部代码直接通过new来构造多个对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton single = <span class="keyword">new</span> Singleton();  <span class="comment">//在类初始化时，已经自行实例化,所以是线程安全的。</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  <span class="comment">//通过getInstance()方法获取实例对象</span></span><br><span class="line">        <span class="keyword">return</span> single;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>优点：写法简单，线程安全。</li><li>缺点：没有懒加载的效果，如果没有使用过的话会造成内存浪费。</li></ul><p>（3) 懒汉式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton single = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (single == <span class="keyword">null</span>) &#123;</span><br><span class="line">            single = <span class="keyword">new</span> Singleton();  <span class="comment">//在第一次调用getInstance()时才实例化，实现懒加载,所以叫懒汉式</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> single;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>优点：实现了懒加载的效果。</li><li>缺点：线程不安全。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单例类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton single = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="comment">//加上synchronized同步 </span></span><br><span class="line">        <span class="keyword">if</span> (single == <span class="keyword">null</span>) &#123;</span><br><span class="line">            single = <span class="keyword">new</span> Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> single;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>优点：实现了懒加载的效果，线程安全。</li><li>缺点：使用synchronized会造成不必要的同步开销，而且大部分时候我们是用不到同步的.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton; <span class="comment">//volatile 能够防止代码的重排序，保证得到的对象是初始化过</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;  <span class="comment">//第一次检查，避免不必要的同步</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;  <span class="comment">//同步</span></span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;   <span class="comment">//第二次检查，为null时才创建实例</span></span><br><span class="line">                    singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>优点：懒加载，线程安全，效率较高</li><li>缺点：volatile影响一点性能，高并发下有一定的缺陷，某些情况下DCL会失效，虽然概率较小。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-grep教程</title>
      <link href="/2019/02/15/programmings/linux/linux-grep%E6%95%99%E7%A8%8B/"/>
      <url>/2019/02/15/programmings/linux/linux-grep%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>Linux系统中grep命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹 配的行打印出来。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。</p><p>grep的工作方式是这样的，它在一个或多个文件中搜索字符串模板。如果模板包括空格，则必须被引用，模板后的所有字符串被看作文件名。搜索的结果被送到标准输出，不影响原文件内容。</p><p>grep可用于shell脚本，因为grep通过返回一个状态值来说明搜索的状态，如果模板搜索成功，则返回0，如果搜索不成功，则返回1，如果搜索的文件不存在，则返回2。我们利用这些返回值就可进行一些自动化的文本处理工作。</p><h1 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h1><h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [option] pattern file</span><br></pre></td></tr></table></figure><h2 id="命令功能"><a href="#命令功能" class="headerlink" title="命令功能"></a>命令功能</h2><p>用于过滤/搜索的特定字符。可使用正则表达式能多种命令配合使用，使用上十分灵活。</p><h2 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-a  --text   <span class="comment">#不要忽略二进制的数据。   </span></span><br><span class="line">-A&lt;显示行数&gt;   --after-context=&lt;显示行数&gt;   <span class="comment">#除了显示符合范本样式的那一列之外，并显示该行之后的内容。   </span></span><br><span class="line">-b   --byte-offset   <span class="comment">#在显示符合样式的那一行之前，标示出该行第一个字符的编号。   </span></span><br><span class="line">-B&lt;显示行数&gt;   --before-context=&lt;显示行数&gt;   <span class="comment">#除了显示符合样式的那一行之外，并显示该行之前的内容。   </span></span><br><span class="line">-c    --count   <span class="comment">#计算符合样式的列数。   </span></span><br><span class="line">-C&lt;显示行数&gt;    --context=&lt;显示行数&gt;或-&lt;显示行数&gt;   <span class="comment">#除了显示符合样式的那一行之外，并显示该行之前后的内容。   </span></span><br><span class="line">-d &lt;动作&gt;      --directories=&lt;动作&gt;   <span class="comment">#当指定要查找的是目录而非文件时，必须使用这项参数，否则grep指令将回报信息并停止动作。   </span></span><br><span class="line">-e&lt;范本样式&gt;  --regexp=&lt;范本样式&gt;   <span class="comment">#指定字符串做为查找文件内容的样式。   </span></span><br><span class="line">-E      --extended-regexp   <span class="comment">#将样式为延伸的普通表示法来使用。   </span></span><br><span class="line">-f&lt;规则文件&gt;  --file=&lt;规则文件&gt;   <span class="comment">#指定规则文件，其内容含有一个或多个规则样式，让grep查找符合规则条件的文件内容，格式为每行一个规则样式。   </span></span><br><span class="line">-F   --fixed-regexp   <span class="comment">#将样式视为固定字符串的列表。   </span></span><br><span class="line">-G   --basic-regexp   <span class="comment">#将样式视为普通的表示法来使用。   </span></span><br><span class="line">-h   --no-filename   <span class="comment">#在显示符合样式的那一行之前，不标示该行所属的文件名称。   </span></span><br><span class="line">-H   --with-filename   <span class="comment">#在显示符合样式的那一行之前，表示该行所属的文件名称。   </span></span><br><span class="line">-i    --ignore-case   <span class="comment">#忽略字符大小写的差别。   </span></span><br><span class="line">-l    --file-with-matches   <span class="comment">#列出文件内容符合指定的样式的文件名称。   </span></span><br><span class="line">-L  --files-without-match   <span class="comment">#列出文件内容不符合指定的样式的文件名称。   </span></span><br><span class="line">-n   --line-number   <span class="comment">#在显示符合样式的那一行之前，标示出该行的列数编号。   </span></span><br><span class="line">-q   --quiet或--silent   <span class="comment">#不显示任何信息。   </span></span><br><span class="line">-r   --recursive   <span class="comment">#此参数的效果和指定“-d recurse”参数相同。   </span></span><br><span class="line">-s   --no-messages   <span class="comment">#不显示错误信息。   </span></span><br><span class="line">-v   --revert-match   <span class="comment">#显示不包含匹配文本的所有行。   </span></span><br><span class="line">-V   --version   <span class="comment">#显示版本信息。   </span></span><br><span class="line">-w   --word-regexp   <span class="comment">#只显示全字符合的列。   </span></span><br><span class="line">-x    --line-regexp   <span class="comment">#只显示全列符合的列。   </span></span><br><span class="line">-y   <span class="comment">#此参数的效果和指定“-i”参数相同。</span></span><br></pre></td></tr></table></figure><h2 id="规则表达式"><a href="#规则表达式" class="headerlink" title="规则表达式"></a>规则表达式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">^  <span class="comment">#锚定行的开始 如：'^grep'匹配所有以grep开头的行。    </span></span><br><span class="line">$  <span class="comment">#锚定行的结束 如：'grep$'匹配所有以grep结尾的行。    </span></span><br><span class="line">.  <span class="comment">#匹配一个非换行符的字符 如：'gr.p'匹配gr后接一个任意字符，然后是p。    </span></span><br><span class="line">*  <span class="comment">#匹配零个或多个先前字符 如：'*grep'匹配所有一个或多个空格后紧跟grep的行。    </span></span><br><span class="line">.*   <span class="comment">#一起用代表任意字符。   </span></span><br><span class="line">[]   <span class="comment">#匹配一个指定范围内的字符，如'[Gg]rep'匹配Grep和grep。    </span></span><br><span class="line">[^]  <span class="comment">#匹配一个不在指定范围内的字符，如：'[^A-FH-Z]rep'匹配不包含A-R和T-Z的一个字母开头，紧跟rep的行。    </span></span><br><span class="line">\(..\)  <span class="comment">#标记匹配字符，如'\(love\)'，love被标记为1。    </span></span><br><span class="line">\&lt;      <span class="comment">#锚定单词的开始，如:'\&lt;grep'匹配包含以grep开头的单词的行。    </span></span><br><span class="line">\&gt;      <span class="comment">#锚定单词的结束，如'grep\&gt;'匹配包含以grep结尾的单词的行。    </span></span><br><span class="line">x\&#123;m\&#125;  <span class="comment">#重复字符x，m次，如：'0\&#123;5\&#125;'匹配包含5个o的行。    </span></span><br><span class="line">x\&#123;m,\&#125;  <span class="comment">#重复字符x,至少m次，如：'o\&#123;5,\&#125;'匹配至少有5个o的行。    </span></span><br><span class="line">x\&#123;m,n\&#125;  <span class="comment">#重复字符x，至少m次，不多于n次，如：'o\&#123;5,10\&#125;'匹配5--10个o的行。   </span></span><br><span class="line">\w    <span class="comment">#匹配文字和数字字符，也就是[A-Za-z0-9]，如：'G\w*p'匹配以G后跟零个或多个文字或数字字符，然后是p。   </span></span><br><span class="line">\W    <span class="comment">#\w的反置形式，匹配一个或多个非单词字符，如点号句号等。   </span></span><br><span class="line">\b    <span class="comment">#单词锁定符，如: '\bgrep\b'只匹配grep。  </span></span><br><span class="line"></span><br><span class="line">POSIX字符:</span><br><span class="line">为了在不同国家的字符编码中保持一至，POSIX(The Portable Operating System Interface)增加了特殊的字符类，如[:alnum:]是[A-Za-z0-9]的另一个写法。要把它们放到[]号内才能成为正则表达式，如[A- Za-z0-9]或[[:alnum:]]。在linux下的grep除fgrep外，都支持POSIX的字符类。</span><br><span class="line"></span><br><span class="line">[:alnum:]    <span class="comment">#文字数字字符   </span></span><br><span class="line">[:alpha:]    <span class="comment">#文字字符   </span></span><br><span class="line">[:digit:]    <span class="comment">#数字字符   </span></span><br><span class="line">[:graph:]    <span class="comment">#非空字符（非空格、控制字符）   </span></span><br><span class="line">[:lower:]    <span class="comment">#小写字符   </span></span><br><span class="line">[:cntrl:]    <span class="comment">#控制字符   </span></span><br><span class="line">[:<span class="built_in">print</span>:]    <span class="comment">#非空字符（包括空格）   </span></span><br><span class="line">[:punct:]    <span class="comment">#标点符号   </span></span><br><span class="line">[:space:]    <span class="comment">#所有空白字符（新行，空格，制表符）   </span></span><br><span class="line">[:upper:]    <span class="comment">#大写字符   </span></span><br><span class="line">[:xdigit:]   <span class="comment">#十六进制数字（0-9，a-f，A-F）</span></span><br></pre></td></tr></table></figure><h1 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h1><h2 id="查找文件中制定行的内容哦并输出到制定文件中"><a href="#查找文件中制定行的内容哦并输出到制定文件中" class="headerlink" title="查找文件中制定行的内容哦并输出到制定文件中"></a>查找文件中制定行的内容哦并输出到制定文件中</h2><p>被找文件：images.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id x y z qw qx qy qz image</span></span><br><span class="line">1 1 1 1 1 0 0 0 00.JPG</span><br><span class="line">2 2 2 2 2 2 2 2 2 2 2 2 2 2</span><br><span class="line">3 1 2 2 1 0 0 0 11.JPG</span><br><span class="line">4 2 3 3 3 3 3 3 3 3 3 3 3 3</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>此处想要查找和的得到包含JPG行的内容，使用如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'JPG$'</span> images.txt &gt; image.txt</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://www.cnblogs.com/peida/archive/2012/12/17/2821195.html" target="_blank" rel="noopener">每天一个linux命令（39）：grep 命令</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android开发之使用网络时间</title>
      <link href="/2018/11/23/programmings/linux/Android%E5%BC%80%E5%8F%91%E4%B9%8B%E4%BD%BF%E7%94%A8%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4/"/>
      <url>/2018/11/23/programmings/linux/Android%E5%BC%80%E5%8F%91%E4%B9%8B%E4%BD%BF%E7%94%A8%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="使用truetime-android第三方库实现"><a href="#使用truetime-android第三方库实现" class="headerlink" title="使用truetime-android第三方库实现"></a>使用truetime-android第三方库实现</h1><p>github地址：<a href="https://github.com/instacart/truetime-android" target="_blank" rel="noopener">https://github.com/instacart/truetime-android</a></p><h2 id="配置教程"><a href="#配置教程" class="headerlink" title="配置教程"></a>配置教程</h2><p>详见：github的<a href="https://github.com/instacart/truetime-android/wiki/How-to-use-this-library" target="_blank" rel="noopener">wiki</a>，也可阅读本文实例教程。</p><p>Add this to your application’s build.gradle file:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">"https://jitpack.io"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    implementation <span class="string">'com.github.instacart.truetime-android:library-extension-rx:&lt;release-version&gt;'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// or if you want the vanilla version of Truetime:</span></span><br><span class="line">    implementation <span class="string">'com.github.instacart.truetime-android:library:&lt;release-version&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="string">"https://jitpack.io"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="function">implementation <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span></span><br><span class="line"><span class="function">    implementation 'com.android.support:appcompat-v7:28.0.0-rc02'</span></span><br><span class="line"><span class="function">    implementation 'com.android.support.constraint:constraint-layout:1.1.2'</span></span><br><span class="line"><span class="function">    implementation 'com.github.instacart.truetime-android:library:3.3'</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><p>Importing ‘com.github.instacart.truetime-android:library:<release-version>‘ should be sufficient for this.</release-version></p><p>Then you must initialize it in onCreate() in your class that extendsandroid.app.Application.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TrueTime.build().initialize();</span><br></pre></td></tr></table></figure><p>例子：</p><p>APP.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TrueTime.build().withNtpHost(<span class="string">"time.ustc.edu.cn"</span>).initialize();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将APP.java添加到AndroidManifest.xml</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">android:name=<span class="string">".App"</span></span><br><span class="line">&lt;/application&gt;</span><br></pre></td></tr></table></figure><p>使用Date noReallyThisIsTheTrueDateAndTime = TrueTime.now();来获取网络时间。</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AR引擎调研</title>
      <link href="/2018/11/17/slam/AR%E5%BC%95%E6%93%8E%E8%B0%83%E7%A0%94/"/>
      <url>/2018/11/17/slam/AR%E5%BC%95%E6%93%8E%E8%B0%83%E7%A0%94/</url>
      
        <content type="html"><![CDATA[<h1 id="SLAM-AR"><a href="#SLAM-AR" class="headerlink" title="SLAM AR"></a>SLAM AR</h1><p>ARKit （好）<br>ARCore（好）<br>网易洞见（好）<br>EasyAR 2.1.0 Pro（一般）<br>ARToolKit （差）<br>Wikitude（较好）<br>Maxst（好）</p><h1 id="ARKit"><a href="#ARKit" class="headerlink" title="ARKit"></a>ARKit</h1><h1 id="ARCore"><a href="#ARCore" class="headerlink" title="ARCore"></a>ARCore</h1><ul><li><p>条件</p><ul><li>Android SDK 7.0 (API level 24) or higher</li><li>minSdk 19</li><li>Google Pixel and Pixel XL。Samsung Galaxy S8 (SM-G950U, SM-G950N, SM-G950FD, SM-G950FD, SM-G950W, SM-G950U1)</li></ul></li><li><p>功能点与特点</p><ul><li>支持平面监测</li><li>支持环境光照预估</li><li>支持直接识别 frame 增加锚点</li><li>demo 中未见目标图像识别</li><li>支持机型暂时较少</li><li>移动手机，模型显示稳定</li></ul></li><li><p>价格</p><ul><li>免费</li></ul></li></ul><h1 id="网易洞见"><a href="#网易洞见" class="headerlink" title="网易洞见"></a>网易洞见</h1><ul><li><p>条件</p><ul><li>无机型限制</li></ul></li><li><p>功能点与特点</p><ul><li>支持 Android、iOS</li><li>支持指定目标图像识别</li><li>支持即时场景投放，显示效果好</li><li>支持 SLAM</li><li>对机器有要求，红米 Note 4 有卡顿（官方demo）</li></ul></li><li><p>价格</p><ul><li>收费</li></ul></li></ul><h1 id="EasyAR"><a href="#EasyAR" class="headerlink" title="EasyAR"></a>EasyAR</h1><ul><li><p>条件</p><ul><li>无机型限制</li></ul></li><li><p>功能点与特点</p><ul><li>支持平台 Android，iOS，Unity</li><li>支持单图和多图识别，可设置跟踪器数目，支持三维模型跟踪</li><li>支持即时视频帧图像识别</li><li>支持二维码识别</li><li>视频播放</li><li>支持录屏</li><li>2.1 专业版支持平面监测</li><li>容易上手，API 设计友好</li></ul></li><li><p>价格</p><ul><li>v1.3.1 免费，无水印，仅支持图像识别</li><li>v2.0.0，v2.1.0 专业版收费，支持 3D 物体识别，环境感知，云识别，app 云打包。￥2999/一个APP，一次性收费，永久使用</li><li>云端图库识别，根据日活沟通联系价格</li></ul></li><li><p>结论</p><ul><li><strong><em>设备能运行demo，有slam，效果很不稳定，demo没显示相机图像</em></strong></li></ul></li></ul><h1 id="Maxst"><a href="#Maxst" class="headerlink" title="Maxst"></a>Maxst</h1><ul><li><p>条件</p><ul><li>无机型限制</li></ul></li><li><p>功能与特点</p><ul><li>支持平台：Android，iOS，Windows，Mac OS</li><li>支持指定图像识别</li><li>支持视频播放</li><li>支持即时视频图像识别</li><li>视频增强显示</li><li>支持 SLAM</li><li>支持二维码和条形码扫描</li><li>集成效果较好，模型显示较稳定</li><li>集成简单，文档清晰</li></ul></li><li><p>价格</p><ul><li>收费版：499（支持查看，社区支持），（增加邮件支持）</li><li>免费版：有水印，功能与收费版误差别</li></ul></li><li><p>结论</p><ul><li><strong><em>无尺度信息，不可用</em></strong></li><li>MAXST构建的坐标系，坐标原点位置可以选择相机或者Target</li><li>MAXST的SLAM是基于视觉的，在初始化的时候就确定下来图片上的特征点，相机离开这些特征点会导致SLAM丢失，此时需要重新初始化</li><li>通过MAXST的接口获取特征点，返回的特征点数据是二维信息，不具备深度信息，不像ARCore返回的是三维坐标</li><li>VisualSLAM Demo定位效果还不错，想用来测距，后来发现每次初始化的位置不一样，建立坐标系大小不同，所以没有绝对的距离信息，不能用于直接测量距离</li><li>InstantTracker Demo不需要初始化即可找到平面了，有点神奇，不过不是很准，而且放置的物体不是很稳定</li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.zybuluo.com/zyl06/note/926425" target="_blank" rel="noopener">Android AR 简单调研</a></li><li><a href="https://blog.csdn.net/killfunst/article/details/82389460" target="_blank" rel="noopener">玩各种各样的AR库，最终选择了MAXST</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> AR </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> AR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线性方程组Ax=b求解</title>
      <link href="/2018/11/11/math/%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84Ax-b%E6%B1%82%E8%A7%A3/"/>
      <url>/2018/11/11/math/%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84Ax-b%E6%B1%82%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="线性方程组"><a href="#线性方程组" class="headerlink" title="线性方程组"></a>线性方程组</h1><p>有多个未知数，并且每个未知数的次数均为一次，这样多个未知数组成的方程组为线性方程组。</p><h1 id="高斯消元法"><a href="#高斯消元法" class="headerlink" title="高斯消元法"></a>高斯消元法</h1><p>高斯消元主要用来求解线性方程组，也可以求解矩阵的秩，矩阵的逆。在ACM中是一个有力的数学武器。时间复杂度是n^3，主要与方程组的个数，未知数的个数有关。高斯消元的过程就是手算解方程组的过程。加减消元，消去未知数，如果有多个未知数，就一直消去，直到得到类似kx=b（k和b为常数，x为未知数）的式子，就可以求解出未知数x，然后我们回代，依次求解出各个未知数的值，就解完了方程组。 </p><p>总共分两步： </p><ol><li>加减消元 </li><li>回代求未知数值</li></ol><h2 id="C-实现1"><a href="#C-实现1" class="headerlink" title="C++实现1"></a>C++实现1</h2><p>首先，我们对于每一行找到第一个不为零的元素，并且将这一行置为1 <em> </em> <em> </em>的形式，用这一行乘上倍数加到之后的每一行。</p><p>然后，我们从最后一行开始，选择主元，加到之前的每一行上，使得该列的元素都为零。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> e     0.00000001</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 50</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>    n;<span class="comment">//规模nXn</span></span><br><span class="line"><span class="keyword">double</span> a[maxn][maxn];<span class="comment">//系数矩阵</span></span><br><span class="line"><span class="keyword">double</span> b[maxn];<span class="comment">//b矩阵</span></span><br><span class="line"><span class="keyword">double</span> m[maxn][maxn];<span class="comment">//中间变量矩阵</span></span><br><span class="line"><span class="keyword">double</span> x[maxn];<span class="comment">//最终解</span></span><br><span class="line"><span class="keyword">int</span>    H=<span class="number">1</span>;<span class="comment">//扩大H被结算（优化）</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">读取数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入系数矩阵规模n:= "</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|-----------------------------\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|请输入系数矩阵,如：\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|1.1348 3.8326 1.1651 3.4017\n"</span>; </span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|0.5301 1.7875 2.5330 1.5435\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|3.4129 4.9317 8.7643 1.3142\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|1.2371 4.9998 10.6721 0.0147\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|-----------------------------\n"</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="built_in">cin</span>&gt;&gt;a[i][j];</span><br><span class="line">            a[i][j]*=H;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|-----------------------------\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|请输入b矩阵，如：\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|9.5342 6.3941 18.4231 16.9237\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|-----------------------------\n"</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;b[i];</span><br><span class="line">        b[i]*=H;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">中间矩阵输出</span></span><br><span class="line"><span class="comment">参数：消元次数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">PrintProc</span><span class="params">(<span class="keyword">int</span> cases)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--------第%d次消元结果如下：\n"</span>,cases);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;setw(<span class="number">10</span>)&lt;&lt;a[i][j]&lt;&lt;<span class="string">' '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;setw(<span class="number">10</span>)&lt;&lt;b[i]&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"END THIS SHOW-------------\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">显示结果</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|-----------------------------\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|结果为：\n"</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"x[%d]=  %lf\n"</span>,i,x[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"|-----------------------------\n\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">顺序消元法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShunXuXiaoYuan</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//消元计算</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;n;k++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=k+<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            m[i][k]=a[i][k]/a[k][k];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=k+<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                a[i][j]-=m[i][k]*a[k][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=k+<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            b[i]-=m[i][k]*b[k];</span><br><span class="line">        &#125;</span><br><span class="line">        PrintProc(k);<span class="comment">//输出中间计算过程</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//回代求解</span></span><br><span class="line">    x[n]=b[n]/a[n][n];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">        x[i]=b[i];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">            x[i]-=a[i][j]*x[j];</span><br><span class="line">        x[i]/=a[i][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出结果</span></span><br><span class="line">    Print();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">列主消元</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LieZhuXiaoYuan</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;n;k++)&#123;</span><br><span class="line">        <span class="comment">//选主元[这一列的绝对值最大值]</span></span><br><span class="line">        <span class="keyword">double</span> ab_max=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span>       max_ik;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=k;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(a[i][k])&gt;ab_max)&#123;</span><br><span class="line">                ab_max=<span class="built_in">abs</span>(a[i][k]);</span><br><span class="line">                max_ik=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//交换行处理[先判断是否为0矩阵]</span></span><br><span class="line">        <span class="keyword">if</span>(ab_max&lt;e)&#123;<span class="comment">//0矩阵情况</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">"det A=0\n"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(max_ik!=k)&#123;<span class="comment">//是否是当前行，不是交换</span></span><br><span class="line">            <span class="keyword">double</span> temp;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                temp=a[max_ik][j];</span><br><span class="line">                a[max_ik][j]=a[k][j];</span><br><span class="line">                a[k][j]=temp;</span><br><span class="line">            &#125;</span><br><span class="line">            temp=b[max_ik];</span><br><span class="line">            b[max_ik]=b[k];</span><br><span class="line">            b[k]=temp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//消元计算</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=k+<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            a[i][k]/=a[k][k];</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=k+<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                a[i][j]-=a[i][k]*a[k][j];</span><br><span class="line">            &#125;</span><br><span class="line">            b[i]-=a[i][k]*b[k];</span><br><span class="line">        &#125;</span><br><span class="line">        PrintProc(k);<span class="comment">//输出中间计算过程</span></span><br><span class="line">        <span class="keyword">if</span>(k&lt;n<span class="number">-1</span>)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">abs</span>(a[n][n])&lt;e)&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;<span class="string">"det A=0\n"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//回代求解</span></span><br><span class="line">                x[n]=b[n]/a[n][n];</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=n<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">                    x[i]=b[i];</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">                        x[i]-=a[i][j]*x[j];</span><br><span class="line">                    x[i]/=a[i][i];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//输出结果</span></span><br><span class="line">                Print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">主函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        read();</span><br><span class="line">        LieZhuXiaoYuan();</span><br><span class="line">        <span class="comment">//ShunXuXiaoYuan();</span></span><br><span class="line">    &#125;<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">书上高斯消元的例子：</span></span><br><span class="line"><span class="comment">1 1 1 </span></span><br><span class="line"><span class="comment">1 3 -2</span></span><br><span class="line"><span class="comment">2 -2 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">6 1 1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">书上列主消元的例子：</span></span><br><span class="line"><span class="comment">-0.002 2 2</span></span><br><span class="line"><span class="comment">1 0.78125 0</span></span><br><span class="line"><span class="comment">3.996 5.5625 4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">0.4 1.3816 7.4178</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="C-实现2"><a href="#C-实现2" class="headerlink" title="C++实现2"></a>C++实现2</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">50</span>;</span><br><span class="line">    <span class="keyword">int</span> a[MAXN][MAXN];<span class="comment">//增广矩阵</span></span><br><span class="line">    <span class="keyword">int</span> x[MAXN];<span class="comment">//解集</span></span><br><span class="line">    <span class="keyword">bool</span> free_x[MAXN];<span class="comment">//标记是否是不确定的变元</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b == <span class="number">0</span>) <span class="keyword">return</span> a; <span class="keyword">else</span> <span class="keyword">return</span> gcd(b,a%b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lcm</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a/gcd(a,b)*b;<span class="comment">//先除后乘防溢出</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 高斯消元法解方程组(Gauss-Jordan elimination).(-2表示有浮点数解，但无整数解，</span></span><br><span class="line">    <span class="comment">//-1表示无解，0表示唯一解，大于0表示无穷解，并返回自由变元的个数)</span></span><br><span class="line">    <span class="comment">//有equ个方程，var个变元。增广矩阵行数为equ,分别为0到equ-1,列数为var+1,分别为0到var.</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Gauss</span><span class="params">(<span class="keyword">int</span> equ,<span class="keyword">int</span> var)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i,j,k;</span><br><span class="line">        <span class="keyword">int</span> max_r;<span class="comment">// 当前这列绝对值最大的行.</span></span><br><span class="line">        <span class="keyword">int</span> col;<span class="comment">//当前处理的列</span></span><br><span class="line">        <span class="keyword">int</span> ta,tb;</span><br><span class="line">        <span class="keyword">int</span> LCM;</span><br><span class="line">        <span class="keyword">int</span> temp;</span><br><span class="line">        <span class="keyword">int</span> free_x_num;</span><br><span class="line">        <span class="keyword">int</span> free_index;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=var;i++)&#123;</span><br><span class="line">            x[i]=<span class="number">0</span>;</span><br><span class="line">            free_x[i]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换为阶梯阵.</span></span><br><span class="line">        col=<span class="number">0</span>; <span class="comment">// 当前处理的列</span></span><br><span class="line">        <span class="keyword">for</span>(k = <span class="number">0</span>;k &lt; equ &amp;&amp; col &lt; var;k++,col++)&#123;<span class="comment">// 枚举当前处理的行.</span></span><br><span class="line">        <span class="comment">// 找到该col列元素绝对值最大的那行与第k行交换.(为了在除法时减小误差)</span></span><br><span class="line">            max_r=k;</span><br><span class="line">            <span class="keyword">for</span>(i=k+<span class="number">1</span>;i&lt;equ;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">abs</span>(a[i][col])&gt;<span class="built_in">abs</span>(a[max_r][col])) max_r=i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(max_r!=k)&#123;<span class="comment">// 与第k行交换.</span></span><br><span class="line">                <span class="keyword">for</span>(j=k;j&lt;var+<span class="number">1</span>;j++) swap(a[k][j],a[max_r][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(a[k][col]==<span class="number">0</span>)&#123;<span class="comment">// 说明该col列第k行以下全是0了，则处理当前行的下一列.</span></span><br><span class="line">                k--;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(i=k+<span class="number">1</span>;i&lt;equ;i++)&#123;<span class="comment">// 枚举要删去的行.</span></span><br><span class="line">                <span class="keyword">if</span>(a[i][col]!=<span class="number">0</span>)&#123;</span><br><span class="line">                    LCM = lcm(<span class="built_in">abs</span>(a[i][col]),<span class="built_in">abs</span>(a[k][col]));</span><br><span class="line">                    ta = LCM/<span class="built_in">abs</span>(a[i][col]);</span><br><span class="line">                    tb = LCM/<span class="built_in">abs</span>(a[k][col]);</span><br><span class="line">                    <span class="keyword">if</span>(a[i][col]*a[k][col]&lt;<span class="number">0</span>)tb=-tb;<span class="comment">//异号的情况是相加</span></span><br><span class="line">                    <span class="keyword">for</span>(j=col;j&lt;var+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                        a[i][j] = a[i][j]*ta-a[k][j]*tb;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1. 无解的情况: 化简的增广阵中存在(0, 0, ..., a)这样的行(a != 0).</span></span><br><span class="line">        <span class="keyword">for</span> (i = k; i &lt; equ; i++)&#123; <span class="comment">// 对于无穷解来说，如果要判断哪些是自由变元，那么初等行变换中的交换就会影响，则要记录交换.</span></span><br><span class="line">            <span class="keyword">if</span> (a[i][col] != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. 无穷解的情况: 在var * (var + 1)的增广阵中出现(0, 0, ..., 0)这样的行，即说明没有形成严格的上三角阵.</span></span><br><span class="line">        <span class="comment">// 且出现的行数即为自由变元的个数.</span></span><br><span class="line">        <span class="keyword">if</span> (k &lt; var)&#123;</span><br><span class="line">            <span class="keyword">return</span> var - k; <span class="comment">// 自由变元有var - k个.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 唯一解的情况: 在var * (var + 1)的增广阵中形成严格的上三角阵.</span></span><br><span class="line">        <span class="comment">// 计算出Xn-1, Xn-2 ... X0.</span></span><br><span class="line">        <span class="keyword">for</span> (i = var - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            temp = a[i][var];</span><br><span class="line">            <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt; var; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (a[i][j] != <span class="number">0</span>) temp -= a[i][j] * x[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (temp % a[i][i] != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-2</span>; <span class="comment">// 说明有浮点数解，但无整数解.</span></span><br><span class="line">            x[i] = temp / a[i][i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//    freopen("in.txt", "r", stdin);</span></span><br><span class="line">    <span class="comment">//    freopen("out.txt","w",stdout);</span></span><br><span class="line">        <span class="keyword">int</span> i, j;</span><br><span class="line">        <span class="keyword">int</span> equ,var;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;equ, &amp;var) != EOF)&#123;</span><br><span class="line">            <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="keyword">sizeof</span>(a));</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; equ; i++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; var + <span class="number">1</span>; j++)&#123;</span><br><span class="line">                    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;a[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> free_num = Gauss(equ,var);</span><br><span class="line">            <span class="keyword">if</span> (free_num == <span class="number">-1</span>) <span class="built_in">printf</span>(<span class="string">"无解!\n"</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (free_num == <span class="number">-2</span>) <span class="built_in">printf</span>(<span class="string">"有浮点数解，无整数解!\n"</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (free_num &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"无穷多解! 自由变元个数为%d\n"</span>, free_num);</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; var; i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (free_x[i]) <span class="built_in">printf</span>(<span class="string">"x%d 是不确定的\n"</span>, i + <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"x%d: %d\n"</span>, i + <span class="number">1</span>, x[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; var; i++)&#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"x%d: %d\n"</span>, i + <span class="number">1</span>, x[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="QR-分解"><a href="#QR-分解" class="headerlink" title="QR 分解"></a>QR 分解</h1><h2 id="QR-分解的形式"><a href="#QR-分解的形式" class="headerlink" title="QR 分解的形式"></a>QR 分解的形式</h2><p>QR 分解是把矩阵分解成一个正交矩阵与一个上三角矩阵的积。QR 分解经常用来解线性最小二乘法问题。QR 分解也是特定特征值算法即QR算法的基础。</p><h2 id="QR-分解的求解"><a href="#QR-分解的求解" class="headerlink" title="QR 分解的求解"></a>QR 分解的求解</h2><p>QR 分解的实际计算有很多方法，例如 Givens 旋转、Householder 变换，以及 Gram-Schmidt 正交化等等。每一种方法都有其优点和不足</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/pengwill97/article/details/77200372" target="_blank" rel="noopener">高斯消元快速入门</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 线性方程组求解 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 线性方程组求解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习-SVM调参</title>
      <link href="/2018/11/07/machine_learning/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-SVM%E8%B0%83%E5%8F%82/"/>
      <url>/2018/11/07/machine_learning/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-SVM%E8%B0%83%E5%8F%82/</url>
      
        <content type="html"><![CDATA[<h1 id="1-SVM参数"><a href="#1-SVM参数" class="headerlink" title="1. SVM参数"></a>1. SVM参数</h1><p>SVM 怎样能得到好的结果：</p><ol><li>对数据做归一化（simple scaling） </li><li>应用 RBF kernel </li><li>用cross-validation和grid-search 得到最优的c和g </li><li>用得到的最优c和g训练训练数据 </li><li>测试</li></ol><h1 id="2-关于svm的C以及核函数参数设置"><a href="#2-关于svm的C以及核函数参数设置" class="headerlink" title="2. 关于svm的C以及核函数参数设置"></a>2. 关于svm的C以及核函数参数设置</h1><h2 id="参数C"><a href="#参数C" class="headerlink" title="参数C"></a>参数C</h2><p>C一般可以选择为：10^t , t=[- 4，4]就是0.0001 到10000。选择的越大，表示对错误例惩罚程度越大，可能会导致模型过拟合。</p><h2 id="核函数"><a href="#核函数" class="headerlink" title="核函数"></a>核函数</h2><p>（1）线性核函数 </p><p>（无其他参数） </p><p>（2）多项式核函数 </p><p>（重点是阶数的选择，即d，一般选择1-11：1 3 5 7 9 11，也可以选择2,4，6…） </p><p>（3）RBF核函数 </p><p>（径向基RBF内核，exp{-|xi-xj|^2/均方差}，其中均方差反映了数据波动的大小。gamma参数通常可选择下面几个数的倒数：0.1 0.2 0.4 0.6 0.8 1.6 3.2 6.4 12.8，默认的是类别数的倒数，即1/k，2分类的话就是0.5） </p><p>（4）sigmoid核函数 又叫做S形内核<br>两个参数g以及r：g一般可选1 2 3 4，r选0.2 0.4 0.6 0.8 1 </p><p><strong>说明</strong>：</p><p>（1）对于线性核函数，没有专门需要设置的参数 </p><p>（2）对于多项式核函数，有三个参数。-d用来设置多项式核函数的最高此项次数，也就是公式中的d，默认值是3。-g用来设置核函数中的gamma参数设置，也就是公式中的第一个r(gamma)，默认值是1/k（k是类别数）。-r用来设置核函数中的coef0，也就是公式中的第二个r，默认值是0。 </p><p>（3）对于RBF核函数，有一个参数。-g用来设置核函数中的gamma参数设置，也就是公式中的第一个r(gamma)，默认值是1/k（k是类别数）。 </p><p>（4）对于sigmoid核函数，有两个参数。-g用来设置核函数中的gamma参数设置，也就是公式中的第一个r(gamma)，默认值是1/k（k是类别数）。-r用来设置核函数中的coef0，也就是公式中的第二个r，默认值是0。</p><h2 id="Grid-Search"><a href="#Grid-Search" class="headerlink" title="Grid Search"></a>Grid Search</h2><p>使用grid Search虽然比较简单，而且看起来很naïve。但是他确实有两个优点：</p><ul><li>可以得到全局最优 </li><li>(C,gamma)相互独立，便于并行化进行</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 机器学习 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 机器学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vultr的ss服务器教程</title>
      <link href="/2018/10/21/others/vultr%E7%9A%84ss%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2018/10/21/others/vultr%E7%9A%84ss%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="创建服务器"><a href="#创建服务器" class="headerlink" title="创建服务器"></a>创建服务器</h1><p>登录<a href="https://www.vultr.com/" target="_blank" rel="noopener">vultr</a>，注册账号并充值。</p><p>选择vps操作系统时，不要选centos7系统！点击图中的CentOS几个字，会弹出centos6，然后选中centos6！entos7默认的防火墙可能会干扰ssr的正常连接！</p><p>开通服务器时，当出现了ip，不要立马去ping或者用xshell去连接，再等5分钟之后，有个缓冲时间。完成购买后，找到系统的密码记下来，部署服务器时需要用到。</p><h1 id="删除服务器"><a href="#删除服务器" class="headerlink" title="删除服务器"></a>删除服务器</h1><p>点击菜单栏Servers，可以看到开通的所有的服务器。找到server destroy，即可删除服务器。</p><h1 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h1><h2 id="ssh登录"><a href="#ssh登录" class="headerlink" title="ssh登录"></a>ssh登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p [PORT] [username]@[ip]</span><br></pre></td></tr></table></figure><h2 id="更改默认端口"><a href="#更改默认端口" class="headerlink" title="更改默认端口"></a>更改默认端口</h2><p>(1) 登陆 SSH 修改配置文件，输入如下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>(2) 能够看到#port 22，代表默认端口 22。先将Port 22 前面的 # 号去掉，并另起一行。如定义SSH端口号为33322，则输入：Port 33322。自定义端口选择建议在万位的端口（如：10000-65535之间）。</p><p>保留22是为了防止个别防火墙屏蔽了其它端口导致无法连接VPS（如没单独指定22，新指定的33322端口防火墙也没放行，那么可能无法通过SSH连接VPS或服务器）。为了防止不必要问题的产生，所以要给自己保留条“后路”。</p><p>(3) 以上修改完后，重启 SSH 服务，并退出当前连接的 SSH 端口。命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure><p>(4) 开启端口防火墙。Vi 编辑器打开防火墙列表的命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure><p>按下键盘的 a，进入 vi 命令的编辑状态，回车另起一行使用上下键和 delete 键配合添加 12366 端口。不需要明白那些命令是什么意思，照着 22 端口原样输入一遍，只把端口从 22 改为 12366 就可以了，注意 linux 是区分大小写的。添加新端口之后，按下键盘的“ESC”退出当前状态，再输入:“:wq”命令保存退出。</p><p>(5) 重启防火墙</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br></pre></td></tr></table></figure><p>(6) 检查防火墙状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables status</span><br></pre></td></tr></table></figure><p>(7) 重启服务器。</p><p>(8) 屏蔽22端口</p><p>当以上步骤没有问题，既能够通过自定义的端口来登录VPS后，可将sshd_config中的22端口注释并重启SSH服务即可。</p><h1 id="部署VPS服务器"><a href="#部署VPS服务器" class="headerlink" title="部署VPS服务器"></a>部署VPS服务器</h1><p>mac用户登录服务器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@ip <span class="comment"># “ip”替换成你VPS的ip,按回车键，然后复制粘贴密码，按回车键即可登录。</span></span><br></pre></td></tr></table></figure><p>（1）连接成功后，就可以复制粘贴代码部署了。</p><p>CentOS6/Debian6/Ubuntu14 ShadowsocksR一键部署管理脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br><span class="line">wget –no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh</span><br></pre></td></tr></table></figure><p>按回车键，脚本会自动安装，以后只需要运行这个快捷命令就可以进入界面设置，快捷管理命令为：bash ssr.sh。</p><p>（2）出现管理界面后，输入数字1来安装SSR服务端。如果输入1后不能进入下一步，那么请退出，重新连接vps服务器，然后输入快捷管理命令bash ssr.sh 再尝试。</p><p>（3）依次输入自己想设置的端口和密码 (密码建议用复杂点的字母组合，端口号为40-65535之间的数字)，回车键用于确认。</p><p>注：关于端口的设置，总的网络总端口有6万多个，理论上可以任意设置，但不要以0开头！但是有的地区需要设置特殊的端口才有效，一些特殊的端口比如80、143、443、1433、3306、3389、8080。</p><p>（4）选择想设置的加密方式，比如7，按回车键确认：aes-256-cfb。</p><p>（5）接下来是选择协议插件。</p><p>（6）选择并确认后，提示你是否选择兼容原版，这里的原版指的是SS客户端（SS客户端没有协议和混淆的选项），可以根据需求进行选择，演示选择y，之后进行混淆插件的设置。</p><p>注意：如果协议是origin，那么混淆也必须是plain；如果协议不是origin，那么混淆可以是任意的。有的地区需要把混淆设置成plain才好用。因为混淆不总是有效果，要看各地区的策略，有时候不混淆（plain）让其看起来像随机数据更好。（特别注意：tls 1.2_ticket_auth容易受到干扰！请选择除tls开头以外的其它混淆！！！）</p><p>（7）进行混淆插件的设置后，会依次提示你对设备数、单线程限速和端口总限速进行设置，默认值是不进行限制，个人使用的话，选择默认即可，即直接敲回车键。</p><p>注意：关于限制设备数，这个协议必须是非原版且不兼容原版才有效，也就是必须使用SSR协议的情况下，才有效！</p><p>（8）之后代码就正式自动部署了，提示你下载文件，输入：y。</p><p>（9）部署完成，就可以看到自己设置的SSR账号信息，包括IP、端口、密码、加密方式、协议插件、混淆插件，这些信息需要填入你的SSR客户端。如果之后想修改账号信息，直接输入快捷管理命令：bash ssr.sh 进入管理界面，选择相应的数字来进行一键修改。</p><p>注：此脚本是开机自动启动，部署一次即可。最后可以重启服务器确保部署生效（一般情况不重启也可以）。重启需要在命令栏里输入reboot ，输入命令后稍微等待一会服务器就会自动重启，一般重启过程需要2～5分钟，重启过程中Xshell会自动断开连接，等VPS重启好后才可以用Xshell软件进行连接。如果部署过程中卡在某个位置超过10分钟，可以用xshell软件断开，然后重新连接你的ip，再复制代码进行部署。</p><p>备用配置脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh</span><br><span class="line">chmod +x shadowsocksR.sh</span><br><span class="line">./shadowsocksR.sh 2&gt;&amp;1 | tee shadowsocksR.log</span><br></pre></td></tr></table></figure><h1 id="一键加速VPS服务器"><a href="#一键加速VPS服务器" class="headerlink" title="一键加速VPS服务器"></a>一键加速VPS服务器</h1><p>此加速教程为谷歌BBR加速,Vultr的服务器框架可以装BBR加速，加速后对速度的提升很明显，所以推荐部署加速脚本。该加速方法是开机自动启动，部署一次就可以了。</p><p>（1）谷歌BBR加速教程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget</span><br><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br><span class="line">chmod +x bbr.sh</span><br><span class="line">./bbr.sh</span><br></pre></td></tr></table></figure><p>把上面整个代码复制后粘贴进去，不动的时候按回车，然后耐心等待，最后重启vps服务器即可。</p><p>(2) 服务器重启成功并重新连接服务器后，输入命令lsmod | grep bbr 如果出现tcp_bbr字样表示bbr已安装并启动成功。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://github.com/Alvin9999/new-pac/wiki/%E8%87%AA%E5%BB%BAss%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%99%E7%A8%8B" target="_blank" rel="noopener">自建ss服务器教程</a></li><li><a href="https://segmentfault.com/a/1190000015558387" target="_blank" rel="noopener">超详细 Vultr（VPS）搭建 SS / 新手图文指导教程</a></li><li><a href="http://blog.51cto.com/13916921/2314289?source=dra" target="_blank" rel="noopener">搬瓦工VPS搭建SS-R以及开启魔改锐速/BBR全套教程</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 环境配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 环境配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git常见问题</title>
      <link href="/2018/09/25/programmings/linux/git%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
      <url>/2018/09/25/programmings/linux/git%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="git合并常见问题"><a href="#git合并常见问题" class="headerlink" title="git合并常见问题"></a>git合并常见问题</h1><h2 id="合并失败后报错："><a href="#合并失败后报错：" class="headerlink" title="合并失败后报错："></a>合并失败后报错：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">error: unable to index file OCARKitTest/ThirdParty/CocoaAsyncSocket</span><br><span class="line">fatal: updating files failed</span><br></pre></td></tr></table></figure><p>解决方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git rm --cached -r OCARKitTest/ThirdParty/</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m &quot;&quot;</span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure><h2 id="摆错二"><a href="#摆错二" class="headerlink" title="摆错二"></a>摆错二</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git checkout devel</span><br><span class="line">error: The following untracked working tree files would be overwritten by checkout:</span><br><span class="line">OCARKitTest/OCARKitTest.xcodeproj/project.xcworkspace/contents.xcworkspacedata</span><br><span class="line">OCARKitTest/OCARKitTest.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist</span><br><span class="line">Please move or remove them before you switch branches.</span><br><span class="line">Aborting</span><br></pre></td></tr></table></figure><p>通过错误提示可知，是由于一些untracked working tree files引起的问题。所以只要解决了这些untracked的文件就能解决这个问题。</p><p>解决方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clean  -d  -fx .</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git本地分支关联远程分支</title>
      <link href="/2018/09/23/programmings/linux/git%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF/"/>
      <url>/2018/09/23/programmings/linux/git%E6%9C%AC%E5%9C%B0%E5%88%86%E6%94%AF%E5%85%B3%E8%81%94%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>本地新建分支，同步刅远程分支并关联远程分支。</p><h1 id="新建本地分支"><a href="#新建本地分支" class="headerlink" title="新建本地分支"></a>新建本地分支</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b devel</span><br></pre></td></tr></table></figure><h1 id="同步远程分支"><a href="#同步远程分支" class="headerlink" title="同步远程分支"></a>同步远程分支</h1><p>将本地新建分支push到自己的本地远程origin上，因为只在本地创建了一个新的分支，远程    origin 上还没有该分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin devel</span><br></pre></td></tr></table></figure><h1 id="关联远程分支"><a href="#关联远程分支" class="headerlink" title="关联远程分支"></a>关联远程分支</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --set-upstream-to=origin/devel</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++多线程教程</title>
      <link href="/2018/09/14/programmings/c_plus_plus/C-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%99%E7%A8%8B/"/>
      <url>/2018/09/14/programmings/c_plus_plus/C-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><h1 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h1><p>并发指的是两个或多个独立的活动在同一时段内发生。生活中并发的例子并不少，例如在跑步的时候你可能同时在听音乐；在看电脑显示器的同时你的手指在敲击键盘。这时我们称我们大脑并发地处理这些事件，只不过我们大脑的处理是有次重点的：有时候你会更关注你呼吸的频率，而有时候你更多地被美妙的音乐旋律所吸引。这时我们可以说大脑是一种并发设计的结构。这种次重点在计算机程序设计中，体现为某一个时刻只能处理一个操作。</p><p>与并发相近的另一个概念是并行。它们两者存在很大的差别。并行就是同时执行，计算机在同一时刻，在某个时间点上处理两个或以上的操作。判断一个程序是否并行执行，只需要看某个时刻上是否多两个或以上的工作单位在运行。一个程序如果是单线程的，那么它无法并行地运行。利用多线程与多进程可以使得计算机并行地处理程序（当然 ，前提是该计算机有多个处理核心）。</p><p>并发：同一时间段内可以交替处理多个操作。</p><p>并行：同一时刻内同时处理多个操作。</p><p>并发的程序设计，提供了一种方式让我们能够设计出一种方案将问题（非必须地）并行地解决。如果我们将程序的结构设计为可以并发执行的，那么在支持并行的机器上，我们可以将程序并行地执行。因此，并发重点指的是程序的设计结构，而并行指的是程序运行的状态。并发编程，是一种将一个程序分解成小片段独立执行的程序设计方法。</p><h1 id="并发的基本方式途径"><a href="#并发的基本方式途径" class="headerlink" title="并发的基本方式途径"></a>并发的基本方式途径</h1><p>C++标准并没有提供对多进程并发的原生支持，所以C++的多进程并发要靠其他API——这需要依赖相关平台。<br>C++11 标准提供了一个新的线程库，内容包括了管理线程、保护共享数据、线程间的同步操作、低级原子操作等各种类。标准极大地提高了程序的可移植性，以前的多线程依赖于具体的平台，而现在有了统一的接口进行实现。</p><p>C++11 新标准中引入了几个头文件来支持多线程编程：</p><p>&lt; thread &gt; :包含std::thread类以及std::this_thread命名空间。管理线程的函数和类在 中声明.<br>&lt; atomic &gt; :包含std::atomic和std::atomic_flag类，以及一套C风格的原子类型和与C兼容的原子操作的函数。<br>&lt; mutex &gt; :包含了与互斥量相关的类以及其他类型和函数<br>&lt; future &gt; :包含两个Provider类（std::promise和std::package_task）和两个Future类（std::future和std::shared_future）以及相关的类型和函数。<br>&lt; condition_variable &gt; :包含与条件变量相关的类，包括std::condition_variable和std::condition_variable_any。</p><h2 id="初试多线程"><a href="#初试多线程" class="headerlink" title="初试多线程"></a>初试多线程</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"hello world"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span><span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"hello world"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">thread <span class="title">t</span> <span class="params">(hello)</span></span>;</span><br><span class="line">    t.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>旭日东升<br>C++11 并发编程基础（一）：并发、并行与C++多线程<br>正文</p><p>C++11标准在标准库中为多线程提供了组件，这意味着使用C++编写与平台无关的多线程程序成为可能，而C++程序的可移植性也得到了有力的保证。另外，并发编程可提高应用的性能，这对对性能锱铢必较的C++程序员来说是值得关注的。</p><p>回到顶部</p><ol><li>何为并发<br>并发指的是两个或多个独立的活动在同一时段内发生。生活中并发的例子并不少，例如在跑步的时候你可能同时在听音乐；在看电脑显示器的同时你的手指在敲击键盘。这时我们称我们大脑并发地处理这些事件，只不过我们大脑的处理是有次重点的：有时候你会更关注你呼吸的频率，而有时候你更多地被美妙的音乐旋律所吸引。这时我们可以说大脑是一种并发设计的结构。这种次重点在计算机程序设计中，体现为某一个时刻只能处理一个操作。</li></ol><p>与并发相近的另一个概念是并行。它们两者存在很大的差别。并行就是同时执行，计算机在同一时刻，在某个时间点上处理两个或以上的操作。判断一个程序是否并行执行，只需要看某个时刻上是否多两个或以上的工作单位在运行。一个程序如果是单线程的，那么它无法并行地运行。利用多线程与多进程可以使得计算机并行地处理程序（当然 ，前提是该计算机有多个处理核心）。</p><p>并发：同一时间段内可以交替处理多个操作：</p><p>图中整个安检系统是一个并发设计的结构。两个安检队列队首的人竞争这一个安检窗口，两个队列可能约定交替着进行安检，也可能是大家同时竞争安检窗口（通信）。后一种方式可能引起冲突：因为无法同时进行两个安检操作。在逻辑上看来，这个安检窗口是同时处理这两个队列。</p><p>并行：同一时刻内同时处理多个操作：</p><p>图中整个安检系统是一个并行的系统。在这里，每个队列都有自己的安检窗口，两个队列中间没有竞争关系，队列中的某个排队者只需等待队列前面的人安检完成，然后再轮到自己安检。在物理上，安检窗口同时处理这两个队列。</p><p>并发的程序设计，提供了一种方式让我们能够设计出一种方案将问题（非必须地）并行地解决。如果我们将程序的结构设计为可以并发执行的，那么在支持并行的机器上，我们可以将程序并行地执行。因此，并发重点指的是程序的设计结构，而并行指的是程序运行的状态。并发编程，是一种将一个程序分解成小片段独立执行的程序设计方法。</p><p>回到顶部<br>2.并发的基本方式途径<br>多线程与多进程是并发的两种途径。<br>想象两个场景：</p><p>场景一：你和小伙伴要开发一个项目，但小伙伴们放寒假都回家了，你们只能通过QQ聊天、手机通话、发送思维导图等方式来进行交流，总之你们无法很方便地进行沟通。好处是你们各自工作时可以互不打扰。<br>场景二：你和小伙伴放假都呆在学校实验室中开发项目，你们可以聚在一起使用头脑风暴，可以使用白板进行观点的阐述，总之你们沟通变得更方便有效了。有点遗憾的是你在思考时可能有小伙伴过来问你问题，你受到了打扰。<br>这两个场景描绘了并发的两种基本途径。每个小伙伴代表一个线程，工作地点代表一个处理器。场景一中每个小伙伴是一个单线程的进程，他们拥有独立的处理器，多个进程同时执行；场景二中只有一个处理器，所有小伙伴都是属于同一进程的线程。</p><p>2.1 多进程并发<br>多个进程独立地运行，它们之间通过进程间常规的通信渠道传递讯息（信号，套接字，文件，管道等），这种进程间通信不是设置复杂就是速度慢，这是因为为了避免一个进程去修改另一个进程，操作系统在进程间提供了一定的保护措施，当然，这也使得编写安全的并发代码更容易。<br>运行多个进程也需要固定的开销：进程的启动时间，进程管理的资源消耗。</p><p>2.2 多线程并发<br>在当个进程中运行多个线程也可以并发。线程就像轻量级的进程，每个线程相互独立运行，但它们共享地址空间，所有线程访问到的大部分数据如指针、对象引用或其他数据可以在线程之间进行传递，它们都可以访问全局变量。进程之间通常共享内存，但这种共享通常难以建立且难以管理，缺少线程间数据的保护。因此，在多线程编程中，我们必须确保每个线程锁访问到的数据是一致的。</p><p>回到顶部</p><ol><li>C++中的并发与多线程<br>C++标准并没有提供对多进程并发的原生支持，所以C++的多进程并发要靠其他API——这需要依赖相关平台。<br>C++11 标准提供了一个新的线程库，内容包括了管理线程、保护共享数据、线程间的同步操作、低级原子操作等各种类。标准极大地提高了程序的可移植性，以前的多线程依赖于具体的平台，而现在有了统一的接口进行实现。</li></ol><p>C++11 新标准中引入了几个头文件来支持多线程编程：</p><p>&lt; thread &gt; :包含std::thread类以及std::this_thread命名空间。管理线程的函数和类在 中声明.<br>&lt; atomic &gt; :包含std::atomic和std::atomic_flag类，以及一套C风格的原子类型和与C兼容的原子操作的函数。<br>&lt; mutex &gt; :包含了与互斥量相关的类以及其他类型和函数<br>&lt; future &gt; :包含两个Provider类（std::promise和std::package_task）和两个Future类（std::future和std::shared_future）以及相关的类型和函数。<br>&lt; condition_variable &gt; :包含与条件变量相关的类，包括std::condition_variable和std::condition_variable_any。</p><p>3.1 初试多线程<br>我们从一个hello开始。在单线程时：</p><p>1 # include<iostream><br>2 using namespace std;<br>3 int main()<br>4 {<br>5     cout&lt;&lt;”hello world”&lt;&lt;endl;<br>6 }</iostream></p><p>在这里，进行由一个线程组成，该线程的初始函数是main。我们启动第二个线程来打印hello world：</p><p>按 Ctrl+C 复制代码</p><h1 id="include"><a href="#include" class="headerlink" title="include"></a>include<iostream></iostream></h1><h1 id="include-1"><a href="#include-1" class="headerlink" title="include"></a>include<thread></thread></h1><p>using namespace std;<br>void hello()<br>{<br>    cout&lt;&lt;”hello world”&lt;&lt;endl;<br>}<br>int main()<br>{<br>    thread t (hello);<br>    t.join();<br>}<br>按 Ctrl+C 复制代码</p><p>在这里，我们将打印hello world的语句放在函数hello中。每个线程都必须有一个初始函数，新线程的执行开始于初始函数。对于第一段程序来说，它的初始函数是main，对于我们新创建的线程，可以在std::thread()对象的构造函数中指定。<br>在第二段程序里，程序由两个线程组成：初始线程始于main，新线程始于hello。这里将新线程t的初始函数指定为hello。<br>新线程启动之后会与初始进程一并运行，初始线程可以等待或不等待新进程的运行结束——如果需要等待线程，则新线程实例需要使用join(),否则可以使用detach()。如果不等待新线程，则初始线程自顾自地运行到main()结束。<br>关于&lt; thread &gt; 我们将在下一篇中进行详解。<br>由于我们的初始线程并没有做什么事情，启动新线程后，新线程将打印出hello world。</p><h1 id="使用互斥"><a href="#使用互斥" class="headerlink" title="使用互斥"></a>使用互斥</h1><p>C++中通过实例化std::mutex创建互斥量，通过调用成员函数lock()进行上锁，unlock()进行解锁。不过，不推荐实践中直接去调用成员函数，因为调用成员函数就意味着，必须记住在每个函数出口都要去调用unlock()，也包括异常的情况。C++标准库为互斥量提供了一个RAII语法的模板类std::lock_guard，其会在构造的时候提供已锁的互斥量，并在析构的时候进行解锁，从而保证了一个已锁的互斥量总是会被正确的解锁。下面的程序清单中，展示了如何在多线程程序中，使用std::mutex构造的std::lock_guard实例，对一个列表进行访问保护。std::mutex和std::lock_guard都在<mutex>头文件中声明。</mutex></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; some_list;    <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">std</span>::mutex some_mutex;    <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_to_list</span><span class="params">(<span class="keyword">int</span> new_value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; guard(some_mutex);    <span class="comment">// 3</span></span><br><span class="line">  some_list.push_back(new_value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">list_contains</span><span class="params">(<span class="keyword">int</span> value_to_find)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; guard(some_mutex);    <span class="comment">// 4</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::find(some_list.begin(),some_list.end(),value_to_find) != some_list.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当其中一个成员函数返回的是保护数据的指针或引用时，会破坏对数据的保护。具有访问能力的指针或引用可以访问(并可能修改)被保护的数据，而不会被互斥锁限制。互斥量保护的数据需要对接口的设计相当谨慎，要确保互斥量能锁住任何对保护数据的访问，并且不留后门。</p><h1 id="使用锁"><a href="#使用锁" class="headerlink" title="使用锁"></a>使用锁</h1><p>试想有一个玩具，这个玩具由两部分组成，必须拿到这两个部分，才能够玩。例如，一个玩具鼓，需要一个鼓锤和一个鼓才能玩。现在有两个小孩，他们都很喜欢玩这个玩具。当其中一个孩子拿到了鼓和鼓锤时，那就可以尽情的玩耍了。当另一孩子想要玩，他就得等待另一孩子玩完才行。再试想，鼓和鼓锤被放在不同的玩具箱里，并且两个孩子在同一时间里都想要去敲鼓。之后，他们就去玩具箱里面找这个鼓。其中一个找到了鼓，并且另外一个找到了鼓锤。现在问题就来了，除非其中一个孩子决定让另一个先玩，他可以把自己的那部分给另外一个孩子；但当他们都紧握着自己所有的部分而不给予，那么这个鼓谁都没法玩。</p><p>很幸运，C++标准库有办法解决这个问题，std::lock——可以一次性锁住多个(两个以上)的互斥量，并且没有副作用(死锁风险)。</p><p>如何避免死锁？</p><p>避免嵌套锁<br>第一个建议往往是最简单的：一个线程已获得一个锁时，再别去获取第二个。如果能坚持这个建议，因为每个线程只持有一个锁，锁上就不会产生死锁。</p><p>使用固定顺序获取锁<br>当硬性条件要求你获取两个以上(包括两个)的锁，并且不能使用std::lock单独操作来获取它们;那么最好在每个线程上，用固定的顺序获取它们获取它们(锁)。</p><h1 id="同步等待"><a href="#同步等待" class="headerlink" title="同步等待"></a>同步等待</h1><p>假设你在旅游，而且正在一辆在夜间运行的火车上。在夜间，如何在正确的站点下车呢？一种方法是整晚都要醒着，然后注意到了哪一站。这样，你就不会错过你要到达的站点，但是这样会让你感到很疲倦。另外，你可以看一下时间表，估计一下火车到达目的地的时间，然后在一个稍早的时间点上设置闹铃，然后你就可以安心的睡会了。这个方法听起来也很不错，也没有错过你要下车的站点，但是当火车晚点的时候，你就要被过早的叫醒了。当然，闹钟的电池也可能会没电了，并导致你睡过站。理想的方式是，无论是早或晚，只要当火车到站的时候，有人或其他东西能把你唤醒，就好了。</p><p>C++标准库对条件变量有两套实现：std::condition_variable和std::condition_variable_any。这两个实现都包含在<condition_variable>头文件的声明中。两者都需要与一个互斥量一起才能工作(互斥量是为了同步)；前者仅限于与std::mutex一起工作，而后者可以和任何满足最低标准的互斥量一起工作，从而加上了_any的后缀。因为std::condition_variable_any更加通用，这就可能从体积、性能，以及系统资源的使用方面产生额外的开销，所以std::condition_variable一般作为首选的类型，当对灵活性有硬性要求时，我们才会去考虑std::condition_variable_any。</condition_variable></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/overlord_bingo/article/details/60955751" target="_blank" rel="noopener">C/C++ Linux下多线程编程 #include <pthread.h></pthread.h></a></li><li><a href="https://www.cnblogs.com/lpxblog/p/5190438.html" target="_blank" rel="noopener">++11 并发编程基础（一）：并发、并行与C++多线程</a></li><li><a href="https://www.jianshu.com/p/0589ae74ad72" target="_blank" rel="noopener">Linux多线程服务器编程基础 C++ 11 并发编程学习</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C++宏定义教程</title>
      <link href="/2018/09/14/programmings/c_plus_plus/C-%E5%AE%8F%E5%AE%9A%E4%B9%89%E6%95%99%E7%A8%8B/"/>
      <url>/2018/09/14/programmings/c_plus_plus/C-%E5%AE%8F%E5%AE%9A%E4%B9%89%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><h1 id="define基本用法"><a href="#define基本用法" class="headerlink" title="#define基本用法"></a>#define基本用法</h1><p>#define命令是C语言中的一个宏定义命令，它用来将一个标识符(宏名)定义为一个字符串，该标识符被称为宏名，被定义的字符串称为替换文本。程序编译之前，编译的时候所有的宏名都会被定义的字符串替换，这便是宏替换。</p><p>理解宏定义的关键在于 “替换”。</p><p>该命令有两种格式：一种是简单的宏定义，另一种是带参数的宏定义。</p><h2 id="简单的宏定义："><a href="#简单的宏定义：" class="headerlink" title="简单的宏定义："></a>简单的宏定义：</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.14</span></span><br><span class="line"><span class="keyword">float</span> pi2 = PI * <span class="number">2</span>;<span class="comment">//pi2 = 6.28</span></span><br></pre></td></tr></table></figure><h2 id="带参数的宏定义"><a href="#带参数的宏定义" class="headerlink" title="带参数的宏定义"></a>带参数的宏定义</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> <span class="meta-string">&lt;宏名&gt; (&lt;参数表&gt;) &lt;宏体&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AddOne(x) (x+1) </span></span><br><span class="line"><span class="keyword">float</span> pi2 = PI * <span class="number">2</span>;<span class="comment">//pi2 = 6.28</span></span><br><span class="line">pi2 = AddOne(pi2);<span class="comment">// pi2 = 7.28</span></span><br></pre></td></tr></table></figure><h1 id="宏定义的特点"><a href="#宏定义的特点" class="headerlink" title="宏定义的特点"></a>宏定义的特点</h1><p>1）宏名一般用大写，且末尾不加分号。</p><p>（2）宏定义的参数是无类型的，不做语法检查，不做表达式求解，只做替换。</p><p>（3）宏定义通常在文件的最开头，可以使用#undef 宏名 命令终止宏定义的作用域。</p><p>(4）宏定义可以嵌套，但字符串” “中永远不包含宏。</p><p>（5）宏展开使源程序变长，函数调用不会；宏展开不占运行时间，只占编译时间，函数调用占运行时间（分配内存、保留现场、值传递、返回值）。</p><p>（6）函数调用在编译后程序运行时进行，并且分配内存。宏替换在编译前进行，不分配内存。</p><p>（7）使用宏可提高程序的通用性和易读性，减少不一致性，减少输入错误和便于修改。例如：数组大小常用宏定义，常量pi常用宏定义。</p><h1 id="宏替换发生的时机"><a href="#宏替换发生的时机" class="headerlink" title="宏替换发生的时机"></a>宏替换发生的时机</h1><p>为了能够真正理解#define的作用，让我们来了解一下对C语言源程序的处理过程。当我们在一个集成的开发环境如Turbo C中将编写好的源程序进行编译时，实际经过了预处理、编译、汇编和连接几个过程。其中预处理器产生编译器的输出，它实现以下的功能：</p><p>（1）文件包含</p><p>可以把源程序中的#include 扩展为文件正文，即把包含的.h文件找到并展开到#include 所在处。</p><p>（2）条件编译</p><p>预处理器根据#if和#ifdef等编译命令及其后的条件，将源程序中的某部分包含进来或排除在外，通常把排除在外的语句转换成空行。</p><p>（3）宏展开</p><p>预处理器将源程序文件中出现的对宏的引用展开成相应的宏定义，即本文所说的#define的功能，由预处理器来完成。经过预处理器处理的源程序与之前的源程序有所有不同，在这个阶段所进行的工作只是纯粹的替换与展开，没有任何计算功能，所以在学习#define命令时只要能真正理解这一点，这样才不会对此命令引起误解并误用。</p><h1 id="宏替换错误举例"><a href="#宏替换错误举例" class="headerlink" title="宏替换错误举例"></a>宏替换错误举例</h1><p>只要严格遵守“直接替换”，就不会出现下面的问题</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Square(x) x*x</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">float</span> temp = Square(<span class="number">3</span>+<span class="number">3</span>);</span><br><span class="line"><span class="comment">//程序的本意可能是要计算6*6=36，但由于宏定义执行的是直接替换，本身并不做计算，因此实际的结果为 3+3*3+3=15</span></span><br><span class="line"><span class="comment">//想要避免这个问题，只需要修改如下：</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Square(x) ((x)*(x))</span></span><br></pre></td></tr></table></figure><h1 id="define中的三个特殊符号：-，-，"><a href="#define中的三个特殊符号：-，-，" class="headerlink" title="define中的三个特殊符号：##，#，#@"></a>define中的三个特殊符号：##，#，#@</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*x连接y，例如：int n = Conn(123,456); 结果就是n=123456;char* str = Conn("asdf", "adf"); /*结果就是 str = "asdfadf";*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Conn(x,y) x##y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*给x加上单引号，结果返回是一个const char。例如：char a = ToChar(1);结果就是a='1';做个越界试验char a = ToChar(123);结果就错了;但是如果你的参数超过四个字符，编译器就给给你报错了！error C2015: too many characters in constant   ：P */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ToChar(x) #@x</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// x加双引号,例如：char* str = ToString(123132);就成了str="123132";</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ToString(x) #x</span></span><br></pre></td></tr></table></figure><h1 id="常用宏定义"><a href="#常用宏定义" class="headerlink" title="常用宏定义"></a>常用宏定义</h1><p>(1) 防止一个头文件被重复包含</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> BODYDEF_H </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BODYDEF_H </span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//头文件内容 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>(2) 得到指定地址上的一个字节或字</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM_B( x ) ( *( (byte *) (x) ) ) </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MEM_W( x ) ( *( (word *) (x) ) )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//例如：</span></span><br><span class="line"><span class="keyword">int</span> bTest = <span class="number">0x123456</span>;</span><br><span class="line"></span><br><span class="line">byte m = MEM_B((&amp;bTest));<span class="comment">/*m=0x56*/</span></span><br><span class="line"><span class="keyword">int</span> n = MEM_W((&amp;bTest));<span class="comment">/*n=0x3456*/</span></span><br></pre></td></tr></table></figure><p>(3) 得到一个field在结构体(struct)中的偏移量</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OFFSETOF( type, field ) ( (size_t) &amp;(( type *) 0)-&gt; field )</span></span><br></pre></td></tr></table></figure><p>(4) 得到一个结构体中field所占用的字节数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FSIZ( type, field ) sizeof( ((type *) 0)-&gt;field )</span></span><br></pre></td></tr></table></figure><p>(5) 得到一个变量的地址（word宽度）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> B_PTR( var ) ( (byte *) (void *) &amp;(var) ) </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> W_PTR( var ) ( (word *) (void *) &amp;(var) )</span></span><br></pre></td></tr></table></figure><p>(6) 将一个字母转换为大写</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define UPCASE( c ) ( ((c) &gt;= ''a'' &amp;&amp; (c) &lt;= ''z'') ? ((c) - 0x20) : (c) )</span><br></pre></td></tr></table></figure><p>(7) 防止溢出的一个方法</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INC_SAT( val ) (val = ((val)+1 &gt; (val)) ? (val)+1 : (val))</span></span><br></pre></td></tr></table></figure><p>(8) 返回数组元素的个数</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARR_SIZE( a ) ( sizeof( (a) ) / sizeof( (a[0]) ) )</span></span><br></pre></td></tr></table></figure><p>(9) 使用一些宏跟踪调试</p><p>ANSI标准说明了五个预定义的宏名。它们是：</p><p><strong>LINE</strong>：在源代码中插入当前源代码行号；</p><p><strong>FILE</strong>：在源文件中插入当前源文件名；</p><p><strong>DATE</strong>：在源文件中插入当前的编译日期</p><p><strong>TIME</strong>：在源文件中插入当前编译时间；</p><p><strong>STDC</strong>：当要求程序严格遵循ANSI C标准时该标识被赋值为1；</p><p>__cplusplus：当编写C++程序时该标识符被定义</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/shuzfan/article/details/52860664" target="_blank" rel="noopener">C++ 宏定义</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2D-3D-S数据集介绍</title>
      <link href="/2018/09/14/machine_learning/2D-3D-S%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D/"/>
      <url>/2018/09/14/machine_learning/2D-3D-S%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>数据集详情地址：<a href="http://3Dsemantics.stanford.edu/" target="_blank" rel="noopener">http://3Dsemantics.stanford.edu/</a></p><p>该数据集构建的主要目标是为场景理解、深度估计、法线估计、实体检测、分割和场景重建提供研究数据集，推动该领域的发展。</p><h1 id="相关数据集介绍"><a href="#相关数据集介绍" class="headerlink" title="相关数据集介绍"></a>相关数据集介绍</h1><p>现有的基于RGB-D数据集包括NYU Depth v2、SUN RGBD和SceneNN。然而，这些数据集对于处理特定的任务和2.5D的场景有限。</p><h1 id="采集和处理"><a href="#采集和处理" class="headerlink" title="采集和处理"></a>采集和处理</h1><h2 id="3D模式"><a href="#3D模式" class="headerlink" title="3D模式"></a>3D模式</h2><p>3D模式主要包含点云和mesh。文章利用Matterport Camera得到3D textured Mesh model，然后利用采样方法得到3D点运数据。此外，文章将点运数据与颜色进行对应来生成colored点云数据。</p><p>语义标记：文章对点云数据中的每个Mesh和Voxel进行语义信息的标记。语义主要包括ceiling, floor, wall, beam, column, window, door, table, chair, sofa, bookcase, board and clutter。此外，语义信息被投影到RGB图像中。进一步地，文章划分数据为如下室内场景：office, conference room, hallway, auditorium, open space, lobby, lounge, pantry, copy room, storage and WC。每个对象被存储在文件名为“class instanceNum roomType roomNum areaNum”中。</p><blockquote><p>The dataset contains colored point clouds and textured meshes for each scanned area. 3D semantic annotations for objects and scenes are offered for both modalities, with point-level and face-level labels correspondingly. The annotations were initially performed on the point cloud and then projected onto the closest surface on the 3D mesh model. Faces in the 3D mesh that account for no projected points belong to non-annotated parts of the dataset and are labeled with a default null value. We also provide the tightest axis-aligned bounding box of each object instance and further voxelize it into a 6x6x6 grid with binary occupancy and point correspondence.</p></blockquote><p>该数据集包含每个扫描区域的带有颜色信息的点云和纹理mesh，分别提供点粒度和面粒度的实体和场景的语义信息。最初，语义信息被提取自点云数据，之后映射到最相邻的三维mesh上。不能够被点云映射的面的语义信息置为空值。该数据集也提供了每隔实体样例的tightest axis-aligned bounding box和使用6x6x6二进制的网格来进行体素化表达。</p><h3 id="技术细节"><a href="#技术细节" class="headerlink" title="技术细节"></a>技术细节</h3><p>该数据集包含颜色点云和3D mesh。</p><h4 id="颜色点云数据"><a href="#颜色点云数据" class="headerlink" title="颜色点云数据"></a>颜色点云数据</h4><blockquote><p>The raw colored 3D point clouds along with both object and scene instance-level annotations per point, (tightest) axis-aligned bounding boxes and voxels with binary occupancy and point correpsondence are stored in the Area_#_PointCloud.mat file. The variables are stored in the form of nested structs</p></blockquote><p>具有实体和场景粒度的语义信息、axis-aligned bounding boex和具有点对应的二进制占据体素的三维点云数据被存储在“Area_#_PointCloud.mat”文件中。变量被存储为嵌套结构体：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- Area: --&gt; name: the area name as: Area_#</span><br><span class="line">--&gt; Disjoint-Space: <span class="class"><span class="keyword">struct</span> <span class="title">with</span> <span class="title">information</span> <span class="title">on</span> <span class="title">the</span> <span class="title">individual</span> <span class="title">spaces</span> <span class="title">in</span> <span class="title">the</span> <span class="title">building</span>.</span></span><br></pre></td></tr></table></figure><p>使用matlab读取后结构体显示如下：</p><p><img src alt></p><p>其中，Disjoint_Space结构体为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Disjoint_Space:--&gt; name: the name of that space, <span class="function">with per area global <span class="title">index</span> <span class="params">(e.g. conferenceRoom_1, offie_13, etc.)</span></span></span><br><span class="line">--&gt;AlignmentAngle: rotation angle around Z axis, to align spaces based on the CVPR2016 paper *3D Semantic Parsing of Large-Scale Indoor Spaces*. </span><br><span class="line">--&gt; color: a unique RGB color value [<span class="number">0</span>,<span class="number">1</span>] <span class="keyword">for</span> that room, mainly <span class="keyword">for</span> visualization purposes</span><br><span class="line">--&gt; object: a <span class="class"><span class="keyword">struct</span> <span class="title">that</span> <span class="title">contains</span> <span class="title">all</span> <span class="title">objects</span> <span class="title">in</span> <span class="title">that</span> <span class="title">space</span>.</span></span><br></pre></td></tr></table></figure><p>使用matlab读取后结构体显示如下：</p><p><img src alt></p><p>object结构体为：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- object:--&gt; name: the name of the object, wiith per space indexing* (e.g. chair<span class="number">-1</span>, wall_3, clutter_13, etc.)</span><br><span class="line">--&gt; points: the X,Y,Z coordinates of the <span class="number">3</span>D points that comprise <span class="keyword">this</span> object</span><br><span class="line">--&gt; RGB_color: the raw RGB color value [<span class="number">0</span>,<span class="number">255</span>] associated with each point.</span><br><span class="line">--&gt; global_name: the name of the object, with per area global index**</span><br><span class="line">--&gt; Bbox: [Xmin Xmax Ymin Ymax Zmin Zmax] of the object's boudning box</span><br><span class="line">--&gt; Voxels: [Xmin Xmax Ymin Ymax Zmin Zmax] <span class="keyword">for</span> each voxel in a <span class="number">6</span>x6x6 grid</span><br><span class="line">--&gt; Voxel_Occupancy: <span class="function">binary occupancy per <span class="title">voxel</span> <span class="params">(<span class="number">0</span>: empty, <span class="number">1</span>: contains points)</span></span></span><br><span class="line">--&gt; Points_per_Voxel: the object points that correspond to each voxel (in XYZ coordinates)</span><br></pre></td></tr></table></figure><p><img src alt></p><h4 id="3D-Semantic-mesh"><a href="#3D-Semantic-mesh" class="headerlink" title="3D Semantic mesh"></a>3D Semantic mesh</h4><blockquote><p>The 3D semantic mesh is labeled with instance-level per-face annotations. The mesh is stored in semantic.obj and semantic.mtl where face labels are stored as face’s material’s name. In Blender, for example, the material label can be retrieved with:</p></blockquote><p>三维语义mesh被使用具有实例粒度的每个面元的注释。mesh被存储在”semantic.obj”和”semantic.mtl”文件中。其中，面元标签被存储在面元的名字。在Blender中，标签可悲解析如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mesh_material_idx = mesh.data.polygons[ face_idx ].material_index</span><br><span class="line">material = mesh.data.materials[ mesh_material_idx ]</span><br><span class="line">label = material.name   # final label!</span><br></pre></td></tr></table></figure><p>标签格式如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class_instanceNum_roomType_roomNum_areaNum</span><br></pre></td></tr></table></figure><p>When using the mesh’s color, the material’s color should be remapped for the task at hand as the default color is designed for visualizations. One way to encode the label in the color is to set</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">material.diffuse_color = get_color( labels.index( material.name ) )</span><br></pre></td></tr></table></figure><p>by using labels from /assets/semantic_labels.json and get_color( color ) from /assets/utils.py.</p><h2 id="2D模态"><a href="#2D模态" class="headerlink" title="2D模态"></a>2D模态</h2><p>RGB图像：采集朝向：yaw角约[-180, 180], pitch角约为以0为均值15度为方差的高斯分布，roll角一直是0度。FOV角为以75度为均值和-30度为标准差的半高斯分布。为了过滤掉白墙等图像，文章基于语义信息商来过滤掉近70%的图像。</p><p>语义信息商的计算方法如下：首先，对于每一幅图像对13类别的语义信息进行像素统计。再利用像素分布计算香农商。最后，将低于15%的图像过滤掉。</p><p>此外，我们保留60%的图像。剩下的25%的图像我们通过半高斯分布采样方法来筛选。如此，文章保证了图像的多样性。</p><blockquote><p>The dataset contains densely sampled RGB images per scan location. These images were sampled from equirectangular images that were generated per scan location and modality using the raw data captured by the scanner. All images in the dataset are stored in full high-definition at 1080x1080 resolution. For more details on the random sampling of RGB images read section 4.2 in the paper. We provide the camera metadata for each generated image.</p><p>We also provide depth images that were computed on the 3D mesh instead of directly on the 3D mesh, as well as surface normal images. 2D semantic annotations are computed for each image by projecting the 3D mesh labels on the image plane. Due to certain geo- metric artifacts present at the mesh model mainly because of the level of detail in the reconstruction, the 2D annotations occasionally present small local misalignment to the underlying pixels, especially for points that have a short distance to the camera. This issue can be easily addressed by fusing image content with the projected annotations using graphical models. The dataset also includes 3D coordinate encoded images where each pixel encodes the X, Y, Z location of the point in the world coordinate system. Last, an equirectangular projection is also provided per scan location and modality.</p></blockquote><p>该数据集包含了每个采集区域的稠密的RGB图像。作者使用扫描仪输出的全景图像来生成这些图像。在数据集里的所有的图像的分辨率均为1080x1080。细节请参考论文。</p><p>此外，数据集也包含深度图像。作者使用三维mesh的语义信息，通过映射到图像平面来得到图像中的语义信息。数据集中每幅图像的三维坐标X,Y,Z均在世界坐标系下。</p><h3 id="技术细节-1"><a href="#技术细节-1" class="headerlink" title="技术细节"></a>技术细节</h3><h4 id="pose"><a href="#pose" class="headerlink" title="pose"></a>pose</h4><blockquote><p>The pose files contain camera metadata for each image and are given in the /pose subdirectories. They have filenames which are globally unique due to the fact that camera uuids are not shared between areas. They are stored in json files, and contain</p></blockquote><p>pose文件包含每一幅图像的camera元数据，被给定在“/pose”子文件夹下。他们有一个全局的文件名，被存储在json文件中。</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"camera_k_matrix"</span>:  # The <span class="number">3</span>x3 camera K matrix. Stored as a list-of-lists, </span><br><span class="line">  "field_of_view_rads": #  The Camera's field of view, in radians, </span><br><span class="line">  "camera_original_rotation": #  The camera's initial XYZ-Euler rotation in the .obj, </span><br><span class="line">  "rotation_from_original_to_point": </span><br><span class="line">  #  Apply this to the original rotation in order to orient the camera for the corresponding picture, </span><br><span class="line">  "point_uuid": #  alias for camera_uuid, </span><br><span class="line">  "camera_location": #  XYZ location of the camera, </span><br><span class="line">  "frame_num": #  The frame_num in the filename, </span><br><span class="line">  "camera_rt_matrix": #  The 4x3 camera RT matrix, stored as a list-of-lists, </span><br><span class="line">  "final_camera_rotation": #  The camera Euler in the corresponding picture, </span><br><span class="line">  "camera_uuid": #  The globally unique identifier for the camera location, </span><br><span class="line">  "room": #  The room that this camera is in. Stored as roomType_roomNum_areaNum </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="RGB"><a href="#RGB" class="headerlink" title="RGB"></a>RGB</h4><blockquote><p>RGB images are in the /rgb folder and contain synthesized but accurate RGB images of the scene.</p></blockquote><p>RGB图像被存储在“/rgb”文件夹中。</p><h4 id="Depth"><a href="#Depth" class="headerlink" title="Depth"></a>Depth</h4><blockquote><p>Depth images are stored as 16-bit PNGs and have a maximum depth of 128m and a sensitivity of 1/512m. Missing values are encoded with the value 2^16 - 1. Note that while depth is defined relative to the plane of the camera in the data (z-depth), it is defined as the distance from the point-center of the camera in the panoramics.</p></blockquote><h4 id="Global-XYZ"><a href="#Global-XYZ" class="headerlink" title="Global XYZ"></a>Global XYZ</h4><blockquote><p>Global XYZ images contain the ground-truth location of each pixel in the mesh. They are stored as 16-bit 3-channel OpenEXR files and a convenience readin function is provided in /assets/utils.py. These can be used for generating point correspondences, e.g. for optical flow. Missing values are encoded as #000000.</p></blockquote><h4 id="Normal"><a href="#Normal" class="headerlink" title="Normal"></a>Normal</h4><blockquote><p>Normals are 127.5-centered per-channel surface normal images. For panoramic images, these normals are relative to the global corodinate system. Since the global coordinate system is impossible to determine from a sampled image, the normal images in /data have their normals defined relative to the direction the camera is facing. The normals axis-color convention is the same one used by NYU RGB-D. Areas where the mesh is missing have pixel color #808080.</p></blockquote><h4 id="Semantic"><a href="#Semantic" class="headerlink" title="Semantic"></a>Semantic</h4><blockquote><p>Semantic images come in two variants, semantic and semantic_pretty. They both include information from the point cloud annotations, but only the semantic version should be used for learning. The labels can be found in assets/semantic_labels.json, and images can be parsed using some of the convenience functions in utils.py. Specifically: The semantic images are encoded as 3-channel 8-bit PNGs which are interpreted as 24-bit base-256 integers which are an index into the labels array in semantic_labels.json.</p></blockquote><p>Let’s say that you’ve loaded the image into memory and it’s stored as a numpy array called img and want the label for the pixel at (1500, 2000) which is the leftmost sofa chair in this image. utils.py provides get_index, load_labels and parse_labels for extracting the label information. Here is what your code might look like:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.misc <span class="keyword">import</span> imread</span><br><span class="line"><span class="keyword">from</span> assets.utils <span class="keyword">import</span> *  <span class="comment"># Assets should be downloaded from this repo</span></span><br><span class="line">labels = load_labels( <span class="string">'/path/to/assets/semantic_labels.json'</span> )</span><br><span class="line"></span><br><span class="line">img = imread(  <span class="string">'/path/to/image.png'</span> )</span><br><span class="line">pix = img[ <span class="number">1500</span>,<span class="number">2000</span> ]</span><br><span class="line">instance_label = labels[ get_index( pix ) ]</span><br><span class="line">instance_label_as_dict = parse_label( instance_label )</span><br><span class="line"><span class="keyword">print</span> instance_label_as_dict</span><br></pre></td></tr></table></figure><p>Gives {‘instance_num’: 5, ‘instance_class’: u’sofa’, ‘room_num’: 3, ‘room_type’: u’office’, ‘area_num’: 3} Here we can see that this is the 5th instance of class ‘sofa’ in area 3.</p><p>Finally, note that pixels where the data is missing are encoded with the color #0D0D0D which is larger than the len( labels ).</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 数据集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 数据集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法-元素最近邻快速查找</title>
      <link href="/2018/09/11/data_structure_algorithm/%E7%AE%97%E6%B3%95-%E5%85%83%E7%B4%A0%E6%9C%80%E8%BF%91%E9%82%BB%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE/"/>
      <url>/2018/09/11/data_structure_algorithm/%E7%AE%97%E6%B3%95-%E5%85%83%E7%B4%A0%E6%9C%80%E8%BF%91%E9%82%BB%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE/</url>
      
        <content type="html"><![CDATA[<p><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>需求：给定一个元素，在指定集合中输出n个最近邻的元素。如果集合中没有重复元素，那么只有一个元素输出；如果集合中由重复元素，那么可能存在多个最近邻元素输出。</p><h1 id="求解"><a href="#求解" class="headerlink" title="求解"></a>求解</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReadCsvData</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    time = []</span><br><span class="line">    loc = []</span><br><span class="line">    <span class="keyword">with</span> open(file_name,<span class="string">'r'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">        reader = csv.reader(csvfile)</span><br><span class="line">        rows= [row <span class="keyword">for</span> row <span class="keyword">in</span> reader]</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> rows:</span><br><span class="line">            data = np.array(data)</span><br><span class="line">            time.append(float(data[<span class="number">0</span>]))</span><br><span class="line">            loc.append([float(data[<span class="number">1</span>]), float(data[<span class="number">2</span>]), float(data[<span class="number">3</span>])])</span><br><span class="line">    time = np.array(time)</span><br><span class="line">    loc = np.array(loc)</span><br><span class="line">    <span class="keyword">return</span> time, loc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">searchInsert</span><span class="params">(nums, target)</span>:</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    end = len(nums) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> start &lt;= end:</span><br><span class="line">        mid = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> nums[mid] == target:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> nums[mid] &lt; target:</span><br><span class="line">            start = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = mid - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> end + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rIndex</span><span class="params">(nums, target)</span>:</span></span><br><span class="line">    n = len(nums)</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>: <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    mid = searchInsert(nums, target)</span><br><span class="line">    rlist = []  <span class="comment"># 保持索引</span></span><br><span class="line">    i, j = <span class="number">-1</span>, n</span><br><span class="line">    left, rigth = <span class="number">0</span>, <span class="number">0</span>  <span class="comment"># 左右扩展的标志</span></span><br><span class="line">    mxg = float(<span class="string">'-inf'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; mid &lt; n:  <span class="comment"># 如果找到了</span></span><br><span class="line">        i, j = mid<span class="number">-1</span>, mid</span><br><span class="line">        mxg = min(abs(nums[i] - target), abs(nums[j] - target))</span><br><span class="line">        left, rigth = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> mid == <span class="number">0</span>:  <span class="comment"># 小于最左边的数字</span></span><br><span class="line">        j = mid</span><br><span class="line">        mxg = abs(nums[j] - target)</span><br><span class="line">        left, rigth = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> mid == n:  <span class="comment"># 大于最右边的数字</span></span><br><span class="line">        i = mid<span class="number">-1</span></span><br><span class="line">        mxg = abs(nums[i] - target)</span><br><span class="line">        left, rigth = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> left == <span class="number">1</span> <span class="keyword">or</span> rigth == <span class="number">1</span>:  <span class="comment"># 两边查找</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">-1</span>: left = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> j == n: rigth = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> left == <span class="number">1</span> <span class="keyword">and</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">            le = abs(nums[i] - target)</span><br><span class="line">            <span class="keyword">if</span> le == mxg:</span><br><span class="line">                rlist = [i] + rlist</span><br><span class="line">                i -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> rigth == <span class="number">1</span> <span class="keyword">and</span> j &lt; len(nums):</span><br><span class="line">            ri = abs(nums[j] - target)</span><br><span class="line">            <span class="keyword">if</span> mxg == ri:</span><br><span class="line">                rlist = rlist + [j]</span><br><span class="line">                j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rigth = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> rlist</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">################# File path #######################</span></span><br><span class="line">    gt_path = <span class="string">"../data/ADVIO/advio-02/ground-truth/pose.csv"</span></span><br><span class="line">    ARKit_path = <span class="string">"../data/ADVIO/advio-02/iphone/arkit.csv"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">################# Read data #######################</span></span><br><span class="line">    time_gt = []</span><br><span class="line">    loc_gt = []</span><br><span class="line">    time_ARKit = []</span><br><span class="line">    loc_ARKit = []</span><br><span class="line">    errors = []</span><br><span class="line">    time_gt, loc_gt = ReadCsvData(gt_path)</span><br><span class="line">    time_ARKit, loc_ARKit = ReadCsvData(ARKit_path)</span><br><span class="line">    <span class="keyword">print</span> len(time_gt), len(time_ARKit)</span><br><span class="line">    <span class="keyword">if</span> len(time_gt) &lt; len(time_ARKit):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(time_gt)):</span><br><span class="line">            index = rIndex(time_ARKit, time_gt[i])[<span class="number">0</span>]</span><br><span class="line">            error = math.sqrt((loc_gt[i][<span class="number">0</span>] - loc_ARKit[index][<span class="number">0</span>])**<span class="number">2</span> + (loc_gt[i][<span class="number">1</span>] - loc_ARKit[index][<span class="number">1</span>])**<span class="number">2</span> + (loc_gt[i][<span class="number">2</span>] - loc_ARKit[index][<span class="number">2</span>])**<span class="number">2</span>)</span><br><span class="line">            errors.append(error)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(time_ARKit)):</span><br><span class="line">            index = rIndex(time_gt, time_ARKit[i])[<span class="number">0</span>]</span><br><span class="line">            error = math.sqrt((loc_gt[index][<span class="number">0</span>] - loc_ARKit[i][<span class="number">0</span>])**<span class="number">2</span> + (loc_gt[index][<span class="number">1</span>] - loc_ARKit[i][<span class="number">1</span>])**<span class="number">2</span> + (loc_gt[index][<span class="number">2</span>] - loc_ARKit[i][<span class="number">2</span>])**<span class="number">2</span>)</span><br><span class="line">            errors.append(error)</span><br><span class="line">    errors = np.array(errors)</span><br><span class="line">    <span class="keyword">print</span> errors</span><br><span class="line">    plt.figure(<span class="number">1</span>)</span><br><span class="line">    plt.plot(loc_gt[:, <span class="number">0</span>], loc_gt[:, <span class="number">2</span>], c = <span class="string">'r'</span>)</span><br><span class="line">    plt.plot(loc_ARKit[:, <span class="number">0</span>], loc_ARKit[:, <span class="number">2</span>], c = <span class="string">'b'</span>)</span><br><span class="line">    plt.xlabel(<span class="string">"X (m)"</span>)</span><br><span class="line">    plt.ylabel(<span class="string">"Y (m)"</span>)</span><br><span class="line">    plt.legend([<span class="string">"Groud-truth"</span>, <span class="string">"ARKit"</span>])</span><br><span class="line">    plt.figure(<span class="number">2</span>)</span><br><span class="line">    plt.plot(errors, c = <span class="string">'b'</span>)</span><br><span class="line">    plt.xlabel(<span class="string">'Index'</span>)</span><br><span class="line">    plt.ylabel(<span class="string">'Error (m)'</span>)</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++回调机制教程</title>
      <link href="/2018/09/09/programmings/c_plus_plus/C-%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6%E6%95%99%E7%A8%8B/"/>
      <url>/2018/09/09/programmings/c_plus_plus/C-%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>在 C++ 开发过程中，经常会遇到需要一个类在遇到某种情况下（比如触发了一个行为等等）需要驱使另一类去做某些行为的需求（也就是回调机制）。本文参考如下博文：<a href="https://blog.csdn.net/u012814856/article/details/73294124" target="_blank" rel="noopener">C++简单实现回调机制</a>进行讲解。</p><h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p>A和B的打招呼程序。</p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote><p>现在有两个人，一位是 A 先生，另一位是 B 先生。<br>现在要求当 A 先生给 B 先生打了招呼之后，B 先生立马回复 A，向 A 问好。</p></blockquote><h2 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h2><p>这个过程抽象为三个类进行模拟：</p><div class="table-container"><table><thead><tr><th>角色</th><th>功能</th></tr></thead><tbody><tr><td>A</td><td>向B打招呼</td></tr><tr><td>B</td><td>当A向自己打招呼时，向A打招呼</td></tr><tr><td>main</td><td>创造A和B对象和控制A和B的行为</td></tr></tbody></table></div><p>当我们看到上述的分析后，应该想到这么三个内容：</p><p>A 的作用：A 在这里干了什么呢？他是触发一次回调行为的触发点，也就是因为 A 进行了打招呼的行为，才有了 B 的回复的行为。也就是说：A 是触发方</p><p>B 的作用：B 在这里干的就多了。他在得知 A 向自己打招呼了之后，进行了回复。也就是说：B 是驱使方</p><p>回复事件：这是我们的回调行为本身，当 A 进行了打招呼的行为，B 进行了回调事件指定的行为</p><p>主过程：它掌控着时空，提供上述所有行为的必要条件</p><p>那么分析至此，我们已经拥有了写出这个程序的一切条件，接下来让我们一步一步分析一步一步实现吧。</p><h1 id="实现：A、B、Event、main"><a href="#实现：A、B、Event、main" class="headerlink" title="实现：A、B、Event、main"></a>实现：A、B、Event、main</h1><p>首先，我们需要定义一个抽象的事件类，用来定义回复事件：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// event class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CEvent</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">hiReply</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这个类是这个方法的核心：</p><blockquote><p>这个事件类是一个抽象的类：<br>1.驱使方应该继承这个类并实现其内的具体功能<br>2.触发方应该将此类包含为一个私有变量，当遇到触发事件的时候，通过此指针（父类指针）调用其具体实现的方法（由驱使方实现）<br>3.还需要注意的一点是，为了方便调用，这个类中的方法需要全部声明为公有的，也就是需要在前面加 public 修饰</p></blockquote><p>然后，我们需要实现 A 类，也就是事件触发方：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// person A class , call an event</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    A() : m_pEvent(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"A: hello B"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">nullptr</span> != m_pEvent) &#123;</span><br><span class="line">            m_pEvent-&gt;hiReply();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setEvent</span><span class="params">(CEvent *event)</span> </span>&#123;</span><br><span class="line">        m_pEvent = event;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    CEvent *m_pEvent;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这个类是触发方：</p><ul><li><p>将事件类作为其私有变量：用来接收 B （事件类的子类）的指针，用于实现多态方法调用</p></li><li><p>实现了 sayHi() 方法：用来触发 B 的回复行为。可以看到在这个函数里，我们使用了事件类对象调用其抽象方法进行了向 B 的事件通知</p></li><li><p>实现了 setEvent() 方法：用来传递 B 的指针，将其赋值给事件类的指针（父类指针），方便在 sayHi() 方法中多态调用回调方法</p></li></ul><p>接下来，我们需要实现 B 类，也就是驱使方：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// person B class , implement the event function</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> CEvent &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"B: hello A"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hiReply</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"B: I'm fine, thanks, and you ?"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>B 类中，我们继承了事件类，并且实现了里面的方法。</p><p>最后，让我们看看世界的主宰–主过程里干了什么：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    A a;</span><br><span class="line">    B b;</span><br><span class="line">    a.setEvent((CEvent*)&amp;b);</span><br><span class="line">    a.sayHi();</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，主过程里我们干了这几件事：</p><p>绑定事件关系：将 b 的指针（事件类子类）传递给了 a 的私有变量 m_pEvent（事件类父类），具有了多态调用的必要条件；这里需要注意的是我们子类向父类的强制转换的写法 (CEvent*)&amp;b，不这么写的话，编译器会报错；想要详细了解 C++ 中父类和子类的转换的可以点击这里 C++中子类和父类之间的相互转化，这篇博客质量还是可以的</p><p>触发事件：让 a 向 b 打招呼</p><p>让我们运行下这个程序，看看运行结果：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A: hello B</span><br><span class="line">B: I am fine.</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="demo完整代码实现"><a href="#demo完整代码实现" class="headerlink" title="demo完整代码实现"></a>demo完整代码实现</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// event class</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CEvent</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">hiReply</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// person A class , call an event</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">A() : m_pEvent(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sayHi</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"A: hello B"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">nullptr</span> != m_pEvent) &#123;</span><br><span class="line">m_pEvent-&gt;hiReply();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setEvent</span><span class="params">(CEvent *event)</span> </span>&#123;</span><br><span class="line">m_pEvent = event;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">CEvent *m_pEvent;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// person B class , implement the event function</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> CEvent &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hiReply</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">"B: I'm fine, thanks, and you ?"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A a;</span><br><span class="line">B b;</span><br><span class="line">a.setEvent((CEvent*)&amp;b);</span><br><span class="line">a.sayHi();</span><br><span class="line">system(<span class="string">"pause"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="应用总结"><a href="#应用总结" class="headerlink" title="应用总结"></a>应用总结</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>A持续set数据给B，B接收到数据后，将计算结果持续通知出去，采用回调机制。</p><h3 id="设计流程"><a href="#设计流程" class="headerlink" title="设计流程"></a>设计流程</h3><p>(1) 编写回调接口</p><p>StepInterface.h:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StepInterface</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">virtual</span> ~StepInterface() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">NotifyStep</span><span class="params">(<span class="keyword">int</span> step, <span class="keyword">float</span> diff)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>(2) 实现A</p><p>A.h和A.cpp:</p><ul><li>继承回调接口</li><li>实现回调接口所声明的方法（NotifyXXX），即有了回调数据该干啥</li><li>将A的对象设置给B的回调监听器</li></ul><p>A.h:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"StepInterface.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"B.h"</span></span></span><br><span class="line"></span><br><span class="line">Class A : <span class="keyword">public</span> StepInterface &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">A();</span><br><span class="line">B b;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">NotifyStep</span><span class="params">(<span class="keyword">int</span> step, <span class="keyword">float</span> diff)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>A.cpp:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"A.h"</span></span></span><br><span class="line"></span><br><span class="line">A::A() &#123;</span><br><span class="line">b.setStepListener(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A::NotifyStep(<span class="keyword">int</span> step, <span class="keyword">float</span> diff) &#123;</span><br><span class="line"><span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2) 实现B</p><p>B.h和B.cpp:</p><ul><li>实例化接口抽象类</li><li>声明回调接口监听器</li><li>实现回调接口监听器</li><li>将计算结果回调给A</li></ul><p>B.h:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"StepInterface.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">B() &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetStepListener</span><span class="params">(StepInterface* frame)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">otherMethods</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">StepInterface* callR;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>B.cpp:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"B.h"</span></span></span><br><span class="line"></span><br><span class="line">B::SetStepListener(StepInterface* frame)&#123;</span><br><span class="line">callR = frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">B::otherMethod() &#123;</span><br><span class="line"><span class="keyword">int</span> step = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">float</span> diff = <span class="number">0.0</span>;</span><br><span class="line">callR-&gt;NotifyStep(step, diff);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/u012814856/article/details/73294124" target="_blank" rel="noopener">C++简单实现回调机制</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apolloScape竞赛</title>
      <link href="/2018/09/09/programmings/linux/apolloScape%E7%AB%9E%E8%B5%9B/"/>
      <url>/2018/09/09/programmings/linux/apolloScape%E7%AB%9E%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><h1 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h1><p>百度ApolloScape重磅发布了自动驾驶开放数据集。自动驾驶开发测试中，海量、高质的真实数据是必不可缺的“原料”。但是，少有团队有能力开发并维持一个适用的自动驾驶平台，定期校准并收集新数据。</p><p>据介绍，Apollo开放平台此次发布的ApolloScape不仅开放了比Cityscapes等同类数据集大10倍以上的数据量，包括感知、仿真场景、路网数据等数十万帧逐像素语义分割标注的高分辨率图像数据，进一步涵盖更复杂的环境、天气和交通状况等。从数据难度上来看，ApolloScape数据集涵盖了更复杂的道路状况（例如，单张图像中多达162辆交通工具或80名行人），同时开放数据集采用了逐像素语义分割标注的方式，是目前环境最复杂、标注最精准、数据量最大的自动驾驶数据集。</p><p>Apollo开放平台还将与加州大学伯克利分校在CVPR 2018（IEEE国际计算机视觉与模式识别会议）期间联合举办自动驾驶研讨会（Workshop on Autonomous Driving），并将基于ApolloScape的大规模数据集定义了多项任务挑战，为全球自动驾驶开发者和研究人员提供共同探索前沿领域技术突破及应用创新的平台。</p><h1 id="参考一：PoseNet-implementation-for-self-driving-car-localization-using-Pytorch-on-Apolloscape-dataset"><a href="#参考一：PoseNet-implementation-for-self-driving-car-localization-using-Pytorch-on-Apolloscape-dataset" class="headerlink" title="参考一：PoseNet implementation for self-driving car localization using Pytorch on Apolloscape dataset"></a>参考一：<a href="https://capsulesbot.com/blog/2018/08/24/apolloscape-posenet-pytorch.html" target="_blank" rel="noopener">PoseNet implementation for self-driving car localization using Pytorch on Apolloscape dataset</a></h1><p>This article covers the very beginning of the journey and includes the reading and visualization of the Apolloscape dataset for localization task. Implement PoseNet [2] architecture for monocular image pose prediction and visualize results. I use Python and Pytorch for the task.</p><p>NOTE: If you want to jump straight to the code here is the GitHub repo. It’s is still an ongoing work where I intend to implement Vidloc [7], Pose Graph Optimization [3,8] and Structure from Motion [9] pipelines for Apolloscape Dataset in the context of the localization task.</p><h2 id="Apolloscape-Pytorch-Dataset"><a href="#Apolloscape-Pytorch-Dataset" class="headerlink" title="Apolloscape Pytorch Dataset"></a>Apolloscape Pytorch Dataset</h2><p>For Pytorch I need to have a Dataset object that prepares and feeds the data to the loader and then to the model. I want to have a robust dataset class that can:</p><ul><li>support stereo and mono images</li><li>support train/validation splits that came along with data or generate a new one</li><li>support pose normalization</li><li>support different pose representations (needed mainly for visualization and experiments with loss functions)</li><li>support filtering by record id</li><li>support general Apolloscape folder structure layout</li></ul><p>I am not putting here the full listing of the Apolloscape dataset and concentrate solely on how to use it and what data we can get from it. For the full source code, please refer to the Github file datasets/apolloscape.py.</p><p>Here how to create a dataset:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets.apolloscape <span class="keyword">import</span> Apolloscape</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to unpacked data folders</span></span><br><span class="line">APOLLO_PATH = <span class="string">"./data/apolloscape"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Resize transform that is applied on every image read</span></span><br><span class="line">transform = transforms.Compose([transforms.Resize(<span class="number">250</span>)])</span><br><span class="line"></span><br><span class="line">apollo_dataset = Apolloscape(root=os.path.join(APOLLO_PATH), road=<span class="string">"zpark-sample"</span>,</span><br><span class="line">                             transform=transform, train=<span class="keyword">True</span>, pose_format=<span class="string">'quat'</span>,</span><br><span class="line">                             stereo=<span class="keyword">True</span>)</span><br><span class="line">print(apollo_dataset)</span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Dataset: Apolloscape</span><br><span class="line">    Road: zpark-sample</span><br><span class="line">    Record: <span class="keyword">None</span></span><br><span class="line">    Train: <span class="keyword">None</span></span><br><span class="line">    Normalize Poses: <span class="keyword">False</span></span><br><span class="line">    Stereo: <span class="keyword">True</span></span><br><span class="line">    Length: <span class="number">1499</span> of <span class="number">1499</span></span><br><span class="line">    Cameras: [<span class="string">'Camera_2'</span>, <span class="string">'Camera_1'</span>]</span><br><span class="line">    Records: [<span class="string">'Record001'</span>, <span class="string">'Record002'</span>, <span class="string">'Record003'</span>, <span class="string">'Record004'</span>, <span class="string">'Record006'</span>, <span class="string">'Record007'</span>, <span class="string">'Record008'</span>, <span class="string">'Record009'</span>, <span class="string">'Record010'</span>, <span class="string">'Record011'</span>, <span class="string">'Record012'</span>, <span class="string">'Record013'</span>, <span class="string">'Record014'</span>]</span><br></pre></td></tr></table></figure><p>POLLO_PATH is a folder with unpacked Apolloscape datasets, e.g. $APOLLO_PATH/road02_seg or $APOLLO_PATH/zpark. Download data from Apolloscape page and unpack iot. Let’s assume that we’ve also created a symlink ./data/apolloscape that points to $APOLLO_PATH folder.</p><p>We can view the list of available records with a number of data samples in each:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Show records with numbers of data points</span></span><br><span class="line">recs_num = apollo_dataset.get_records_counts()</span><br><span class="line">recs_num = sorted(recs_num.items(), key=<span class="keyword">lambda</span> kv: kv[<span class="number">1</span>], reverse=<span class="keyword">True</span>)</span><br><span class="line">print(<span class="string">"Records:"</span>)</span><br><span class="line">print(<span class="string">"\n"</span>.join([<span class="string">"\t&#123;&#125; - &#123;&#125;"</span>.format(r[<span class="number">0</span>], r[<span class="number">1</span>]) <span class="keyword">for</span> r <span class="keyword">in</span> recs_num ]))</span><br></pre></td></tr></table></figure><p>output:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Records:</span><br><span class="line">Record008 - <span class="number">122</span></span><br><span class="line">Record007 - <span class="number">121</span></span><br><span class="line">Record006 - <span class="number">121</span></span><br><span class="line">Record012 - <span class="number">121</span></span><br><span class="line">Record001 - <span class="number">121</span></span><br><span class="line">Record009 - <span class="number">121</span></span><br><span class="line">Record010 - <span class="number">121</span></span><br><span class="line">Record003 - <span class="number">121</span></span><br><span class="line">Record013 - <span class="number">120</span></span><br><span class="line">Record004 - <span class="number">120</span></span><br><span class="line">Record002 - <span class="number">120</span></span><br><span class="line">Record011 - <span class="number">120</span></span><br><span class="line">Record014 - <span class="number">50</span></span><br></pre></td></tr></table></figure><p>We can draw a route for one record with a sampled camera image:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.common <span class="keyword">import</span> draw_record</span><br><span class="line"></span><br><span class="line"><span class="comment"># Draw path of a record with a sampled datapoint</span></span><br><span class="line">record = <span class="string">'Record008'</span></span><br><span class="line">draw_record(apollo_dataset, record)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>output:</p><p>Alternatively, we can see all records at once in one chart:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Draw all records for current dataset</span></span><br><span class="line">draw_record(apollo_dataset)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>output:</p><p>Another option is to see it in a video:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.common <span class="keyword">import</span> make_video</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate and save video for the record</span></span><br><span class="line">outfile = <span class="string">"./output_data/videos/video_&#123;&#125;_&#123;&#125;.mp4"</span>.format(apollo_dataset.road, apollo_dataset.record)</span><br><span class="line">make_video(apollo_dataset, outfile=outfile)</span><br></pre></td></tr></table></figure><p>Output (cut gif version of the generated video):</p><p>For the PoseNet training we will use mono images with zero-mean normalized poses and camera images center-cropped to 250px:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Resize and CenterCrop</span></span><br><span class="line">transform = transforms.Compose([</span><br><span class="line">    transforms.Resize(<span class="number">260</span>),</span><br><span class="line">    transforms.CenterCrop(<span class="number">250</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create train dataset with mono images, normalized poses, enabled cache_transform</span></span><br><span class="line">train_dataset = Apolloscape(root=os.path.join(APOLLO_PATH), road=<span class="string">"zpark-sample"</span>,</span><br><span class="line">                             transform=transform, train=<span class="keyword">True</span>, pose_format=<span class="string">'quat'</span>,</span><br><span class="line">                             normalize_poses=<span class="keyword">True</span>, cache_transform=<span class="keyword">True</span>,</span><br><span class="line">                             stereo=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Draw path of a single record (mono with normalized poses)</span></span><br><span class="line">record = <span class="string">'Record008'</span></span><br><span class="line">draw_record(apollo_dataset, record)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>Output:</p><p>Implemented Apolloscape Pytorch dataset also supports cache_transform option which is when enabled saves all transformed pickled images to a disk and retrieves it later for the subsequent epochs without the need to redo convert and transform operations every image read event. Cache saves up to 50% of the time during training time though it’s not working with image augmentation transforms like torchvision.transforms.ColorJitter.</p><p>Also, we can get the mean and the standard deviation that we need later to recover true poses translations:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">poses_mean = train_dataset.poses_mean</span><br><span class="line">poses_std = train_dataset.poses_std</span><br><span class="line">print(<span class="string">'Translation poses_mean = &#123;&#125; in meters'</span>.format(poses_mean))</span><br><span class="line">print(<span class="string">'Translation poses_std  = &#123;&#125; in meters'</span>.format(poses_std))</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Translation poses_mean = [  <span class="number">449.95782055</span> <span class="number">-2251.24771214</span>    <span class="number">40.17147932</span>] <span class="keyword">in</span> meters</span><br><span class="line">Translation poses_std  = [<span class="number">123.39589457</span> <span class="number">252.42350964</span>   <span class="number">0.28021513</span>] <span class="keyword">in</span> meters</span><br></pre></td></tr></table></figure><p>You can find all mentioned examples in Apolloscape_View_Records.ipynb notebook.</p><p>And now let’s turn to something useful and more interesting, for example, training PoseNet deep convolutional network to regress poses from camera images.</p><h2 id="PoseNet-localization-task"><a href="#PoseNet-localization-task" class="headerlink" title="PoseNet localization task"></a>PoseNet localization task</h2><p>参考：<a href="https://capsulesbot.com/blog/2018/08/24/apolloscape-posenet-pytorch.html" target="_blank" rel="noopener">PoseNet implementation for self-driving car localization using Pytorch on Apolloscape dataset</a></p><p>A Pytorch implementation of the PoseNet model using a mono image:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PoseNet</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, feature_extractor, num_features=<span class="number">128</span>, dropout=<span class="number">0.5</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 track_running_stats=False, pretrained=False)</span>:</span></span><br><span class="line">        super(PoseNet, self).__init__()</span><br><span class="line">        self.dropout = dropout</span><br><span class="line">        self.feature_extractor = feature_extractor</span><br><span class="line">        self.feature_extractor.avgpool = torch.nn.AdaptiveAvgPool2d(<span class="number">1</span>)</span><br><span class="line">        fc_in_features = self.feature_extractor.fc.in_features</span><br><span class="line">        self.feature_extractor.fc = torch.nn.Linear(fc_in_features, num_features)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Translation</span></span><br><span class="line">        self.fc_xyz = torch.nn.Linear(num_features, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Rotation in quaternions</span></span><br><span class="line">        self.fc_quat = torch.nn.Linear(num_features, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract_features</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x_features = self.feature_extractor(x)</span><br><span class="line">        x_features = F.relu(x_features)</span><br><span class="line">        <span class="keyword">if</span> self.dropout &gt; <span class="number">0</span>:</span><br><span class="line">            x_features = F.dropout(x_features, p=self.dropout, training=self.training)</span><br><span class="line">        <span class="keyword">return</span> x_features</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        x_features = self.extract_features(x)</span><br><span class="line">        x_translations = self.fc_xyz(x_features)</span><br><span class="line">        x_rotations = self.fc_quat(x_features)</span><br><span class="line">        x_poses = torch.cat((x_translations, x_rotations), dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x_poses</span><br></pre></td></tr></table></figure><p>For further experiments I’ve also implemented stereo version (currently it’s simply processes two images in parallel without any additional constraints), option to switch off stats tracking for BatchNorm layers and Kaiming He normal for weight initialization [4]. Full source code is here models/posenet.py</p><h2 id="PoseNet-Loss-Functions"><a href="#PoseNet-Loss-Functions" class="headerlink" title="PoseNet Loss Functions"></a>PoseNet Loss Functions</h2><p>For more details on where it came from and intro to Bayesian Deep Learning (BDL) you can refer to an excellent post by Alex Kendall where he explains different types of uncertainties and its implications to the multi-task models. And even more results you can find in papers “Multi-task learning using uncertainty to weigh losses for scene geometry and semantics.” [5] and “What uncertainties do we need in Bayesian deep learning for computer vision?.” [6].</p><p>Pytorch implementation for both versions of a loss function is the following:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PoseNetCriterion</span><span class="params">(torch.nn.Module)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, beta = <span class="number">512.0</span>, learn_beta=False, sx=<span class="number">0.0</span>, sq=<span class="number">-3.0</span>)</span>:</span></span><br><span class="line">        super(PoseNetCriterion, self).__init__()</span><br><span class="line">        self.loss_fn = torch.nn.L1Loss()</span><br><span class="line">        self.learn_beta = learn_beta</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> learn_beta:</span><br><span class="line">            self.beta = beta</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.beta = <span class="number">1.0</span></span><br><span class="line">        self.sx = torch.nn.Parameter(torch.Tensor([sx]), requires_grad=learn_beta)</span><br><span class="line">        self.sq = torch.nn.Parameter(torch.Tensor([sq]), requires_grad=learn_beta)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        <span class="comment"># Translation loss</span></span><br><span class="line">        loss = torch.exp(-self.sx) * self.loss_fn(x[:, :<span class="number">3</span>], y[:, :<span class="number">3</span>])</span><br><span class="line">        <span class="comment"># Rotation loss</span></span><br><span class="line">        loss += torch.exp(-self.sq) * self.beta * self.loss_fn(x[:, <span class="number">3</span>:], y[:, <span class="number">3</span>:]) + self.sq</span><br><span class="line">        <span class="keyword">return</span> loss</span><br></pre></td></tr></table></figure><p>If learn_beta param is False it’s a simple weighted sum version of the loss and if learn_beta is True it’s using sx and sq params with enabled gradients that trains together with other network parameter with the same optimizer.</p><h2 id="PoseNet-Training-Implementation-Details"><a href="#PoseNet-Training-Implementation-Details" class="headerlink" title="PoseNet Training Implementation Details"></a>PoseNet Training Implementation Details</h2><p>Now let’s combine it all to the training loop. I use torch.optim.Adam optimizer with learning rate 1e-5, ResNet34 pretrained on ImageNet as a feature extractor and 2048 features on the last FC layer before pose regressors.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms, models</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> Dataset, DataLoader</span><br><span class="line"><span class="keyword">from</span> datasets.apolloscape <span class="keyword">import</span> Apolloscape</span><br><span class="line"><span class="keyword">from</span> utils.common <span class="keyword">import</span> save_checkpoint</span><br><span class="line"><span class="keyword">from</span> models.posenet <span class="keyword">import</span> PoseNet, PoseNetCriterion</span><br><span class="line"></span><br><span class="line">APOLLO_PATH = <span class="string">"./data/apolloscape"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ImageNet normalization params because we are using pre-trained</span></span><br><span class="line"><span class="comment"># feature extractor</span></span><br><span class="line">normalize = transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">                                     std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Resize data before using</span></span><br><span class="line">transform = transforms.Compose([</span><br><span class="line">    transforms.Resize(<span class="number">260</span>),</span><br><span class="line">    transforms.CenterCrop(<span class="number">250</span>),</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">    normalize</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create datasets</span></span><br><span class="line">train_dataset = Apolloscape(root=os.path.join(APOLLO_PATH), road=<span class="string">"zpark-sample"</span>,</span><br><span class="line">    transform=transform, normalize_poses=<span class="keyword">True</span>, pose_format=<span class="string">'quat'</span>, train=<span class="keyword">True</span>, cache_transform=<span class="keyword">True</span>, stereo=<span class="keyword">False</span>)</span><br><span class="line">val_dataset = Apolloscape(root=os.path.join(APOLLO_PATH), road=<span class="string">"zpark-sample"</span>,</span><br><span class="line">    transform=transform, normalize_poses=<span class="keyword">True</span>, pose_format=<span class="string">'quat'</span>, train=<span class="keyword">False</span>, cache_transform=<span class="keyword">True</span>, stereo=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dataloaders</span></span><br><span class="line">train_dataloader = DataLoader(train_dataset, batch_size=<span class="number">80</span>, shuffle=<span class="keyword">True</span>)</span><br><span class="line">val_dataloader = DataLoader(val_dataset, batch_size=<span class="number">80</span>, shuffle=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Select primary device</span></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    device = torch.device(<span class="string">'cuda'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    device = torch.device(<span class="string">'cpu'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create pretrained feature extractor</span></span><br><span class="line">feature_extractor = models.resnet34(pretrained=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Num features for the last layer before pose regressor</span></span><br><span class="line">num_features = <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create model</span></span><br><span class="line">model = PoseNet(feature_extractor, num_features=num_features, pretrained=<span class="keyword">True</span>)</span><br><span class="line">model = model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Criterion</span></span><br><span class="line">criterion = PoseNetCriterion(stereo=<span class="keyword">False</span>, learn_beta=<span class="keyword">True</span>)</span><br><span class="line">criterion = criterion.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add all params for optimization</span></span><br><span class="line">param_list = [&#123;<span class="string">'params'</span>: model.parameters()&#125;]</span><br><span class="line"><span class="keyword">if</span> criterion.learn_beta:</span><br><span class="line">    <span class="comment"># Add sx and sq from loss function to optimizer params</span></span><br><span class="line">    param_list.append(&#123;<span class="string">'params'</span>: criterion.parameters()&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create optimizer</span></span><br><span class="line">optimizer = optim.Adam(params=param_list, lr=<span class="number">1e-5</span>, weight_decay=<span class="number">0.0005</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Epochs to train</span></span><br><span class="line">n_epochs = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Main training loop</span></span><br><span class="line">val_freq = <span class="number">200</span></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> range(<span class="number">0</span>, n_epochs):</span><br><span class="line">    train(train_dataloader, model, criterion, optimizer, e, n_epochs, log_freq=<span class="number">0</span>,</span><br><span class="line">         poses_mean=train_dataset.poses_mean, poses_std=train_dataset.poses_std,</span><br><span class="line">         stereo=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">if</span> e % val_freq == <span class="number">0</span>:</span><br><span class="line">        validate(val_dataloader, model, criterion, e, log_freq=<span class="number">0</span>,</span><br><span class="line">            stereo=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save checkpoint</span></span><br><span class="line">save_checkpoint(model, optimizer, criterion, <span class="string">'zpark_experiment'</span>, n_epochs)</span><br></pre></td></tr></table></figure><p>A little bit simplified train function below with error calculation that is used solely for logging purposes:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(train_loader, model, criterion, optimizer, epoch, max_epoch,</span></span></span><br><span class="line"><span class="function"><span class="params">          log_freq=<span class="number">1</span>, print_sum=True, poses_mean=None, poses_std=None,</span></span></span><br><span class="line"><span class="function"><span class="params">          stereo=True)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># switch model to training</span></span><br><span class="line">    model.train()</span><br><span class="line"></span><br><span class="line">    losses = AverageMeter()</span><br><span class="line"></span><br><span class="line">    epoch_time = time.time()</span><br><span class="line"></span><br><span class="line">    gt_poses = np.empty((<span class="number">0</span>, <span class="number">7</span>))</span><br><span class="line">    pred_poses = np.empty((<span class="number">0</span>, <span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="keyword">for</span> idx, (batch_images, batch_poses) <span class="keyword">in</span> enumerate(train_loader):</span><br><span class="line">        data_time = (time.time() - end)</span><br><span class="line"></span><br><span class="line">        batch_images = batch_images.to(device)</span><br><span class="line">        batch_poses = batch_poses.to(device)</span><br><span class="line"></span><br><span class="line">        out = model(batch_images)</span><br><span class="line">        loss = criterion(out, batch_poses)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Training step</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line"></span><br><span class="line">        losses.update(loss.data[<span class="number">0</span>], len(batch_images) * batch_images[<span class="number">0</span>].size(<span class="number">0</span>) <span class="keyword">if</span> stereo</span><br><span class="line">                <span class="keyword">else</span> batch_images.size(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># move data to cpu &amp; numpy</span></span><br><span class="line">        bp = batch_poses.detach().cpu().numpy()</span><br><span class="line">        outp = out.detach().cpu().numpy()</span><br><span class="line">        gt_poses = np.vstack((gt_poses, bp))</span><br><span class="line">        pred_poses = np.vstack((pred_poses, outp))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get final times</span></span><br><span class="line">        batch_time = (time.time() - end)</span><br><span class="line">        end = time.time()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> log_freq != <span class="number">0</span> <span class="keyword">and</span> idx % log_freq == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">'Epoch: [&#123;&#125;/&#123;&#125;]\tBatch: [&#123;&#125;/&#123;&#125;]\t'</span></span><br><span class="line">                  <span class="string">'Time: &#123;batch_time:.3f&#125;\t'</span></span><br><span class="line">                  <span class="string">'Data Time: &#123;data_time:.3f&#125;\t'</span></span><br><span class="line">                  <span class="string">'Loss: &#123;losses.val:.3f&#125;\t'</span></span><br><span class="line">                  <span class="string">'Avg Loss: &#123;losses.avg:.3f&#125;\t'</span>.format(</span><br><span class="line">                   epoch, max_epoch - <span class="number">1</span>, idx, len(train_loader) - <span class="number">1</span>,</span><br><span class="line">                   batch_time=batch_time, data_time=data_time, losses=losses))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># un-normalize translation</span></span><br><span class="line">    unnorm = (poses_mean <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>) <span class="keyword">and</span> (poses_std <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">if</span> unnorm:</span><br><span class="line">        gt_poses[:, :<span class="number">3</span>] = gt_poses[:, :<span class="number">3</span>] * poses_std + poses_mean</span><br><span class="line">        pred_poses[:, :<span class="number">3</span>] = pred_poses[:, :<span class="number">3</span>] * poses_std + poses_mean</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Translation error</span></span><br><span class="line">    t_loss = np.asarray([np.linalg.norm(p - t) <span class="keyword">for</span> p, t <span class="keyword">in</span> zip(pred_poses[:, :<span class="number">3</span>], gt_poses[:, :<span class="number">3</span>])])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Rotation error</span></span><br><span class="line">    q_loss = np.asarray([quaternion_angular_error(p, t) <span class="keyword">for</span> p, t <span class="keyword">in</span> zip(pred_poses[:, <span class="number">3</span>:], gt_poses[:, <span class="number">3</span>:])])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> print_sum:</span><br><span class="line">        print(<span class="string">'Ep: [&#123;&#125;/&#123;&#125;]\tTrain Loss: &#123;:.3f&#125;\tTe: &#123;:.3f&#125;\tRe: &#123;:.3f&#125;\t Et: &#123;:.2f&#125;s\t&#123;criterion_sx:.5f&#125;:&#123;criterion_sq:.5f&#125;'</span>.format(</span><br><span class="line">            epoch, max_epoch - <span class="number">1</span>, losses.avg, np.mean(t_loss), np.mean(q_loss),</span><br><span class="line">            (time.time() - epoch_time), criterion_sx=criterion.sx.data[<span class="number">0</span>], criterion_sq=criterion.sq.data[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure><p>validate function is similar to train except model.eval()/model.train() modes, logging and error calculations. Please refer to /utils/training.py on GitHub for full-versions of train and validate functions.</p><p>The training converges after about 1-2k epochs. On my machine, with GTX 1080 Ti it takes about 22 seconds per epoch on ZPark sample train dataset with 2242 images pre-processed and scaled to 250x250 pixels. Total training time – 6-12 hours.</p><h2 id="PoseNet-Results-on-Apolloscape-dataset-ZPark-sample-road"><a href="#PoseNet-Results-on-Apolloscape-dataset-ZPark-sample-road" class="headerlink" title="PoseNet Results on Apolloscape dataset. ZPark sample road."></a>PoseNet Results on Apolloscape dataset. ZPark sample road.</h2><p>After 2k epochs of training, the model was managed to get a prediction of pose translation with a mean 40.6 meters and rotation with a mean 1.69 degrees.</p><h2 id="Further-development"><a href="#Further-development" class="headerlink" title="Further development"></a>Further development</h2><p>Established results are far from one that can be used in autonomous navigation where a system needs to now its location within accuracy of 15cm. Such precision is vital for a car to act safely, correctly predict the behaviors of others and plan actions accordingly. In any case, it’s a good baseline and building blocks of the pipeline to work with Apolloscape dataset that I can develop and improve further.</p><p>There many things to try next:</p><ul><li>Use temporal nature of a video.</li><li>Rely on geometrical features of stereo cameras.</li><li>Pose graph optimization techniques.</li><li>Loss based on 3D reprojection errors.</li><li>Structure from motion methods to build 3D map representation.</li></ul><p>And what’s more importantly, all above-mentioned methods need no additional information but that we already have in ZPark sample road from Apolloscape dataset.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><ol><li>Kendall, Alex, and Roberto Cipolla. “Geometric loss functions for camera pose regression with deep learning.” (2017).</li></ol></li><li><ol><li>Kendall, Alex, Matthew Grimes, and Roberto Cipolla. “Posenet: A convolutional network for real-time 6-dof camera relocalization.” (2015).</li></ol></li><li><ol><li>Brahmbhatt, Samarth, et al. “Mapnet: Geometry-aware learning of maps for camera localization.” (2017).</li></ol></li><li><ol><li>He, Kaiming, et al. “Delving deep into rectifiers: Surpassing human-level performance on imagenet classification.” (2015).</li></ol></li><li><ol><li>Kendall, Alex, Yarin Gal, and Roberto Cipolla. “Multi-task learning using uncertainty to weigh losses for scene geometry and semantics.” (2017).</li></ol></li><li><ol><li>Kendall, Alex, and Yarin Gal. “What uncertainties do we need in bayesian deep learning for computer vision?.” (2017).</li></ol></li><li><ol><li>Clark, Ronald, et al. “VidLoc: A deep spatio-temporal model for 6-dof video-clip relocalization.” (2017).</li></ol></li><li><ol><li>Calafiore, Giuseppe, Luca Carlone, and Frank Dellaert. “Pose graph optimization in the complex domain: Lagrangian duality, conditions for zero duality gap, and optimal solutions.” (2015).</li></ol></li><li><ol><li>Martinec, Daniel, and Tomas Pajdla. “Robust rotation and translation estimation in multiview reconstruction.” (2007).</li></ol></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://capsulesbot.com/blog/2018/08/24/apolloscape-posenet-pytorch.html" target="_blank" rel="noopener">PoseNet implementation for self-driving car localization using Pytorch on Apolloscape dataset</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 竞赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 竞赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS免费搭建ss教程</title>
      <link href="/2018/06/11/others/AWS%E5%85%8D%E8%B4%B9%E6%90%AD%E5%BB%BAss%E6%95%99%E7%A8%8B/"/>
      <url>/2018/06/11/others/AWS%E5%85%8D%E8%B4%B9%E6%90%AD%E5%BB%BAss%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="注册免费的AWS服务器"><a href="#注册免费的AWS服务器" class="headerlink" title="注册免费的AWS服务器"></a>注册免费的AWS服务器</h1><p>注册地址：<a href="https://aws.amazon.com/cn/ec2/pricing/?sc_channel=PS&amp;sc_campaign=acquisition_CN&amp;sc_publisher=baidu&amp;sc_category=pc&amp;sc_medium=ec2_b&amp;sc_content=ec2_e&amp;sc_detail=ec2&amp;sc_segment=100009040&amp;sc_matchtype=phrase&amp;sc_country=CN&amp;s_kwcid=AL!4422!88!5666095499!!17798814222&amp;ef_id=WjtnMQAAAdinHin@:20180611133737:s" target="_blank" rel="noopener">ec2 免费试用全球云服务-亚马逊AWS</a></p><p>填写注册信息、输入信用卡（成功后扣除1美元）、电话语音确认。</p><p>上述过程成功后，即可进入EC2创建服务器实例。如下图所示：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_1.jpeg" alt></p><h1 id="创建服务器实例"><a href="#创建服务器实例" class="headerlink" title="创建服务器实例"></a>创建服务器实例</h1><p>选择Ubuntu16.04 LTS系统：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_2.jpeg" alt></p><p>选择实例类型：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_3.jpeg" alt></p><p>根据自己的需求添加存储，免费用户最大30GB存储：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_4.jpeg" alt></p><p>创建秘钥对：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_5.jpeg" alt></p><p>编辑安全组规则：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_6.jpeg" alt></p><h1 id="登录实例并配置ss环境"><a href="#登录实例并配置ss环境" class="headerlink" title="登录实例并配置ss环境"></a>登录实例并配置ss环境</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod 400 XXX.pem <span class="comment"># 更改秘钥权限</span></span><br><span class="line">$ ssh -i XXX.pem ubuntu@[IP] <span class="comment"># 利用公有IP登录实例</span></span><br></pre></td></tr></table></figure><p>安装Shadowsocks:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取root权限</span></span><br><span class="line">sudo -s</span><br><span class="line"><span class="comment"># 更新apt-get</span></span><br><span class="line">apt-get update</span><br><span class="line"><span class="comment"># 安装python包管理工具</span></span><br><span class="line">apt-get install python-setuptools</span><br><span class="line">apt-get install python-pip</span><br><span class="line"><span class="comment"># 安装shadowsocks</span></span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure><p>创建配置文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/shadowsocks</span><br><span class="line">vim /etc/shadowsocks/ss.json</span><br></pre></td></tr></table></figure><p>配置文件内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"server_port"</span>:443, //ss连接服务器的端口</span><br><span class="line">    <span class="string">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"local_port"</span>:1080,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"abcd1234"</span>, // 设置ss连接时的密码</span><br><span class="line">    <span class="string">"timeout"</span>:300,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="string">"fast_open"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="string">"workers"</span>: 1</span><br><span class="line">&#125;/Users/xiaoqiangteng/programmings/growing-up/xiaoqiangteng.github.io/<span class="built_in">source</span>/_posts/vultr的ss服务器教程.md</span><br></pre></td></tr></table></figure><p>启动Shadowsocks:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">启动：sudo /usr/<span class="built_in">local</span>/bin/ssserver -c /etc/shadowsocks/ss.json -d start</span><br><span class="line"></span><br><span class="line">停止：sudo /usr/<span class="built_in">local</span>/bin/ssserver -c /etc/shadowsocks/ss.json -d stop  </span><br><span class="line">重启：sudo /usr/<span class="built_in">local</span>/bin/ssserver -c /etc/shadowsocks/ss.json -d restart</span><br></pre></td></tr></table></figure><h1 id="配置自动切换模式"><a href="#配置自动切换模式" class="headerlink" title="配置自动切换模式"></a>配置自动切换模式</h1><p>配置好 ss 情景模式后虽然可以使用 Chrome 浏览器科学上网了，但是这样的话无论你访问什么网站都会走代理，有时候访问国内的一些网站反而会很慢，这时候自动切换模式就解决了这个问题。下面介绍一下如何配置自动切换模式。</p><p>点击左侧的 自动切换，或者自己新建情景模式，类型选择第二个 自动切换模式。然后做如下配置：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-27-AWS_SS_7.jpeg" alt></p><p>导入在线规则列表，类型选择AutoProxy，可以选择导入gfwlist - <a href="https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt" target="_blank" rel="noopener">https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt</a> 或者自己自定义的AutoProxy文件。</p><p>保存设置并更新情景模式，若更新失败则开启全局代理后更新。</p><p>设置规则匹配则使用代理模式，否则直接连接。保存退出。</p><h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ul><li><a href="https://blog.csdn.net/miracleswang/article/details/78959305" target="_blank" rel="noopener">https://blog.csdn.net/miracleswang/article/details/78959305</a></li><li><a href="https://blog.csdn.net/kntanchao/article/details/79191149" target="_blank" rel="noopener">https://blog.csdn.net/kntanchao/article/details/79191149</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> AWS </category>
          
          <category> SS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> AWS </tag>
            
            <tag> ss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[darknet系列]yolov3训练自己的数据集</title>
      <link href="/2018/06/09/machine_learning/darknet%E7%B3%BB%E5%88%97-yolov3%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86/"/>
      <url>/2018/06/09/machine_learning/darknet%E7%B3%BB%E5%88%97-yolov3%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h1><p>darknet版本： 2018年6月 <a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">yolov3</a></p><p>系统配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu 16.04</span><br><span class="line">12GB Titan GPU</span><br></pre></td></tr></table></figure><p>数据集：ILSVRC2015 (ILSVRC2015转VOC数据格式详见：<a href="http://mapstec.com/2018/04/05/ILSVRC2015%E6%95%B0%E6%8D%AE%E9%9B%86%E8%BD%ACVOC2007%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/" target="_blank" rel="noopener">http://mapstec.com/2018/04/05/ILSVRC2015%E6%95%B0%E6%8D%AE%E9%9B%86%E8%BD%ACVOC2007%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/</a>)</p><h1 id="darknet配置"><a href="#darknet配置" class="headerlink" title="darknet配置"></a>darknet配置</h1><p>下载工程:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/pjreddie/darknet</span><br></pre></td></tr></table></figure><p>修改Makefile,参考我的makefile文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">GPU=1</span><br><span class="line">CUDNN=0</span><br><span class="line">OPENCV=1</span><br><span class="line">OPENMP=0</span><br><span class="line">DEBUG=0</span><br><span class="line"></span><br><span class="line">ARCH= -gencode arch=compute_30,code=sm_30 \</span><br><span class="line">      -gencode arch=compute_35,code=sm_35 \</span><br><span class="line">      -gencode arch=compute_50,code=[sm_50,compute_50] \</span><br><span class="line">      -gencode arch=compute_52,code=[sm_52,compute_52]</span><br><span class="line"><span class="comment">#      -gencode arch=compute_20,code=[sm_20,sm_21] \ This one is deprecated?</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is what I use, uncomment if you know your arch and want to specify</span></span><br><span class="line"><span class="comment"># ARCH= -gencode arch=compute_52,code=compute_52</span></span><br><span class="line"></span><br><span class="line">VPATH=./src/:./examples</span><br><span class="line">SLIB=libdarknet.so</span><br><span class="line">ALIB=libdarknet.a</span><br><span class="line">EXEC=darknet</span><br><span class="line">OBJDIR=./obj/</span><br><span class="line"></span><br><span class="line">CC=gcc</span><br><span class="line">NVCC=/usr/<span class="built_in">local</span>/cuda-8.0/bin/nvcc </span><br><span class="line">AR=ar</span><br><span class="line">ARFLAGS=rcs</span><br><span class="line">OPTS=-Ofast</span><br><span class="line">LDFLAGS= -lm -pthread </span><br><span class="line">COMMON= -Iinclude/ -Isrc/</span><br><span class="line">CFLAGS=-Wall -Wno-unused-result -Wno-unknown-pragmas -Wfatal-errors -fPIC</span><br><span class="line"></span><br><span class="line">ifeq ($(OPENMP), 1) </span><br><span class="line">CFLAGS+= -fopenmp</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifeq ($(DEBUG), 1) </span><br><span class="line">OPTS=-O0 -g</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">CFLAGS+=$(OPTS)</span><br><span class="line"></span><br><span class="line">ifeq ($(OPENCV), 1) </span><br><span class="line">COMMON+= -DOPENCV</span><br><span class="line">CFLAGS+= -DOPENCV</span><br><span class="line">LDFLAGS+= `pkg-config --libs opencv` </span><br><span class="line">COMMON+= `pkg-config --cflags opencv` </span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifeq ($(GPU), 1) </span><br><span class="line">COMMON+= -DGPU -I/usr/<span class="built_in">local</span>/cuda/include/</span><br><span class="line">CFLAGS+= -DGPU</span><br><span class="line">LDFLAGS+= -L/usr/<span class="built_in">local</span>/cuda/lib64 -lcuda -lcudart -lcublas -lcurand</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifeq ($(CUDNN), 1) </span><br><span class="line">COMMON+= -DCUDNN </span><br><span class="line">CFLAGS+= -DCUDNN</span><br><span class="line">LDFLAGS+= -lcudnn</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">OBJ=gemm.o utils.o cuda.o deconvolutional_layer.o convolutional_layer.o list.o image.o activations.o im2col.o col2im.o blas.o crop_layer.o dropout_layer.o maxpool_layer.o softmax_layer.o data.o matrix.o network.o connected_layer.o cost_layer.o parser.o option_list.o detection_layer.o route_layer.o upsample_layer.o box.o normalization_layer.o avgpool_layer.o layer.o local_layer.o shortcut_layer.o logistic_layer.o activation_layer.o rnn_layer.o gru_layer.o crnn_layer.o demo.o batchnorm_layer.o region_layer.o reorg_layer.o tree.o  lstm_layer.o l2norm_layer.o yolo_layer.o</span><br><span class="line">EXECOBJA=captcha.o lsd.o super.o art.o tag.o cifar.o go.o rnn.o segmenter.o regressor.o classifier.o coco.o yolo.o detector.o nightmare.o darknet.o</span><br><span class="line">ifeq ($(GPU), 1) </span><br><span class="line">LDFLAGS+= -lstdc++ </span><br><span class="line">OBJ+=convolutional_kernels.o deconvolutional_kernels.o activation_kernels.o im2col_kernels.o col2im_kernels.o blas_kernels.o crop_layer_kernels.o dropout_layer_kernels.o maxpool_layer_kernels.o avgpool_layer_kernels.o</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">EXECOBJ = $(addprefix $(OBJDIR), $(EXECOBJA))</span><br><span class="line">OBJS = $(addprefix $(OBJDIR), $(OBJ))</span><br><span class="line">DEPS = $(wildcard src/*.h) Makefile include/darknet.h</span><br><span class="line"></span><br><span class="line"><span class="comment">#all: obj backup results $(SLIB) $(ALIB) $(EXEC)</span></span><br><span class="line">all: obj  results $(SLIB) $(ALIB) $(EXEC)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$(EXEC): $(EXECOBJ) $(ALIB)</span><br><span class="line">$(CC) $(COMMON) $(CFLAGS) $^ -o <span class="variable">$@</span> $(LDFLAGS) $(ALIB)</span><br><span class="line"></span><br><span class="line">$(ALIB): $(OBJS)</span><br><span class="line">$(AR) $(ARFLAGS) <span class="variable">$@</span> $^</span><br><span class="line"></span><br><span class="line">$(SLIB): $(OBJS)</span><br><span class="line">$(CC) $(CFLAGS) -shared $^ -o <span class="variable">$@</span> $(LDFLAGS)</span><br><span class="line"></span><br><span class="line">$(OBJDIR)%.o: %.c $(DEPS)</span><br><span class="line">$(CC) $(COMMON) $(CFLAGS) -c $&lt; -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">$(OBJDIR)%.o: %.cu $(DEPS)</span><br><span class="line">$(NVCC) $(ARCH) $(COMMON) --compiler-options <span class="string">"<span class="variable">$(CFLAGS)</span>"</span> -c $&lt; -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">obj:</span><br><span class="line">mkdir -p obj</span><br><span class="line">backup:</span><br><span class="line">mkdir -p backup</span><br><span class="line">results:</span><br><span class="line">mkdir -p results</span><br><span class="line"></span><br><span class="line">.PHONY: clean</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">rm -rf $(OBJS) $(SLIB) $(ALIB) $(EXEC) $(EXECOBJ) $(OBJDIR)/*</span><br></pre></td></tr></table></figure><p>编译darknet：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure><p>配置完以后可以下载作者的预训练模型测试一下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://pjreddie.com/media/files/yolov3.weights</span><br></pre></td></tr></table></figure><p>下载之后用图片进行测试：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./darknet detect cfg/yolov3.cfg yolov3.weights data/dog.jpg</span><br></pre></td></tr></table></figure><h1 id="制作自己的数据集"><a href="#制作自己的数据集" class="headerlink" title="制作自己的数据集"></a>制作自己的数据集</h1><p>本教授使用Imagenet数据集作为训练数据集，详细制作过程参考：<a href="http://mapstec.com/2018/04/05/ILSVRC2015%E6%95%B0%E6%8D%AE%E9%9B%86%E8%BD%ACVOC2007%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/" target="_blank" rel="noopener">http://mapstec.com/2018/04/05/ILSVRC2015%E6%95%B0%E6%8D%AE%E9%9B%86%E8%BD%ACVOC2007%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/</a></p><h1 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h1><p>按darknet的说明编译好后，接下来在darknet-master/scripts文件夹中新建文件夹VOCdevkit，然后将整个VOC2007文件夹都拷到VOCdevkit文件夹下。</p><p>然后，需要利用scripts文件夹中的voc_label.py文件生成一系列训练文件和label，具体操作如下：</p><p>首先需要修改voc_label.py中的代码，这里主要修改数据集名，以及类别信息，我的是VOC2007，并且所有样本用来训练，没有val或test，有1000类目标，因此按如下设置：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir, getcwd</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> join</span><br><span class="line"></span><br><span class="line"><span class="comment">#sets=[('2012', 'train'), ('2012', 'val'), ('2007', 'train'), ('2007', 'val'), ('2007', 'test')]</span></span><br><span class="line">sets = [(<span class="string">'2007'</span>, <span class="string">'train'</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># classes = ["aeroplane", "bicycle", "bird", "boat", "bottle", "bus", "car", "cat", "chair", "cow", "diningtable", "dog", "horse", "motorbike", "person", "pottedplant", "sheep", "sofa", "train", "tvmonitor"]</span></span><br><span class="line">classes = [<span class="string">"tench"</span>,<span class="string">"goldfish"</span>,<span class="string">"great_white_shark"</span>,<span class="string">"tiger_shark"</span>,<span class="string">"hammerhead"</span>,<span class="string">"electric_ray"</span>,<span class="string">"stingray"</span>,<span class="string">"cock"</span>,<span class="string">"hen"</span>,<span class="string">"ostrich"</span>,<span class="string">"brambling"</span>,<span class="string">"goldfinch"</span>,<span class="string">"house_finch"</span>,<span class="string">"junco"</span>,<span class="string">"indigo_bunting"</span>,<span class="string">"robin"</span>,<span class="string">"bulbul"</span>,<span class="string">"jay"</span>,<span class="string">"magpie"</span>,<span class="string">"chickadee"</span>,<span class="string">"water_ouzel"</span>,<span class="string">"kite"</span>,<span class="string">"bald_eagle"</span>,<span class="string">"vulture"</span>,<span class="string">"great_grey_owl"</span>,<span class="string">"European_fire_salamander"</span>,<span class="string">"common_newt"</span>,<span class="string">"eft"</span>,<span class="string">"spotted_salamander"</span>,<span class="string">"axolotl"</span>,<span class="string">"bullfrog"</span>,<span class="string">"tree_frog"</span>,<span class="string">"tailed_frog"</span>,<span class="string">"loggerhead"</span>,<span class="string">"leatherback_turtle"</span>,<span class="string">"mud_turtle"</span>,<span class="string">"terrapin"</span>,<span class="string">"box_turtle"</span>,<span class="string">"banded_gecko"</span>,<span class="string">"common_iguana"</span>,<span class="string">"American_chameleon"</span>,<span class="string">"whiptail"</span>,<span class="string">"agama"</span>,<span class="string">"frilled_lizard"</span>,<span class="string">"alligator_lizard"</span>,<span class="string">"Gila_monster"</span>,<span class="string">"green_lizard"</span>,<span class="string">"African_chameleon"</span>,<span class="string">"Komodo_dragon"</span>,<span class="string">"African_crocodile"</span>,<span class="string">"American_alligator"</span>,<span class="string">"triceratops"</span>,<span class="string">"thunder_snake"</span>,<span class="string">"ringneck_snake"</span>,<span class="string">"hognose_snake"</span>,<span class="string">"green_snake"</span>,<span class="string">"king_snake"</span>,<span class="string">"garter_snake"</span>,<span class="string">"water_snake"</span>,<span class="string">"vine_snake"</span>,<span class="string">"night_snake"</span>,<span class="string">"boa_constrictor"</span>,<span class="string">"rock_python"</span>,<span class="string">"Indian_cobra"</span>,<span class="string">"green_mamba"</span>,<span class="string">"sea_snake"</span>,<span class="string">"horned_viper"</span>,<span class="string">"diamondback"</span>,<span class="string">"sidewinder"</span>,<span class="string">"trilobite"</span>,<span class="string">"harvestman"</span>,<span class="string">"scorpion"</span>,<span class="string">"black_and_gold_garden_spider"</span>,<span class="string">"barn_spider"</span>,<span class="string">"garden_spider"</span>,<span class="string">"black_widow"</span>,<span class="string">"tarantula"</span>,<span class="string">"wolf_spider"</span>,<span class="string">"tick"</span>,<span class="string">"centipede"</span>,<span class="string">"black_grouse"</span>,<span class="string">"ptarmigan"</span>,<span class="string">"ruffed_grouse"</span>,<span class="string">"prairie_chicken"</span>,<span class="string">"peacock"</span>,<span class="string">"quail"</span>,<span class="string">"partridge"</span>,<span class="string">"African_grey"</span>,<span class="string">"macaw"</span>,<span class="string">"sulphur-crested_cockatoo"</span>,<span class="string">"lorikeet"</span>,<span class="string">"coucal"</span>,<span class="string">"bee_eater"</span>,<span class="string">"hornbill"</span>,<span class="string">"hummingbird"</span>,<span class="string">"jacamar"</span>,<span class="string">"toucan"</span>,<span class="string">"drake"</span>,<span class="string">"red-breasted_merganser"</span>,<span class="string">"goose"</span>,<span class="string">"black_swan"</span>,<span class="string">"tusker"</span>,<span class="string">"echidna"</span>,<span class="string">"platypus"</span>,<span class="string">"wallaby"</span>,<span class="string">"koala"</span>,<span class="string">"wombat"</span>,<span class="string">"jellyfish"</span>,<span class="string">"sea_anemone"</span>,<span class="string">"brain_coral"</span>,<span class="string">"flatworm"</span>,<span class="string">"nematode"</span>,<span class="string">"conch"</span>,<span class="string">"snail"</span>,<span class="string">"slug"</span>,<span class="string">"sea_slug"</span>,<span class="string">"chiton"</span>,<span class="string">"chambered_nautilus"</span>,<span class="string">"Dungeness_crab"</span>,<span class="string">"rock_crab"</span>,<span class="string">"fiddler_crab"</span>,<span class="string">"king_crab"</span>,<span class="string">"American_lobster"</span>,<span class="string">"spiny_lobster"</span>,<span class="string">"crayfish"</span>,<span class="string">"hermit_crab"</span>,<span class="string">"isopod"</span>,<span class="string">"white_stork"</span>,<span class="string">"black_stork"</span>,<span class="string">"spoonbill"</span>,<span class="string">"flamingo"</span>,<span class="string">"little_blue_heron"</span>,<span class="string">"American_egret"</span>,<span class="string">"bittern"</span>,<span class="string">"crane"</span>,<span class="string">"limpkin"</span>,<span class="string">"European_gallinule"</span>,<span class="string">"American_coot"</span>,<span class="string">"bustard"</span>,<span class="string">"ruddy_turnstone"</span>,<span class="string">"red-backed_sandpiper"</span>,<span class="string">"redshank"</span>,<span class="string">"dowitcher"</span>,<span class="string">"oystercatcher"</span>,<span class="string">"pelican"</span>,<span class="string">"king_penguin"</span>,<span class="string">"albatross"</span>,<span class="string">"grey_whale"</span>,<span class="string">"killer_whale"</span>,<span class="string">"dugong"</span>,<span class="string">"sea_lion"</span>,<span class="string">"Chihuahua"</span>,<span class="string">"Japanese_spaniel"</span>,<span class="string">"Maltese_dog"</span>,<span class="string">"Pekinese"</span>,<span class="string">"Shih-Tzu"</span>,<span class="string">"Blenheim_spaniel"</span>,<span class="string">"papillon"</span>,<span class="string">"toy_terrier"</span>,<span class="string">"Rhodesian_ridgeback"</span>,<span class="string">"Afghan_hound"</span>,<span class="string">"basset"</span>,<span class="string">"beagle"</span>,<span class="string">"bloodhound"</span>,<span class="string">"bluetick"</span>,<span class="string">"black-and-tan_coonhound"</span>,<span class="string">"Walker_hound"</span>,<span class="string">"English_foxhound"</span>,<span class="string">"redbone"</span>,<span class="string">"borzoi"</span>,<span class="string">"Irish_wolfhound"</span>,<span class="string">"Italian_greyhound"</span>,<span class="string">"whippet"</span>,<span class="string">"Ibizan_hound"</span>,<span class="string">"Norwegian_elkhound"</span>,<span class="string">"otterhound"</span>,<span class="string">"Saluki"</span>,<span class="string">"Scottish_deerhound"</span>,<span class="string">"Weimaraner"</span>,<span class="string">"Staffordshire_bullterrier"</span>,<span class="string">"American_Staffordshire_terrier"</span>,<span class="string">"Bedlington_terrier"</span>,<span class="string">"Border_terrier"</span>,<span class="string">"Kerry_blue_terrier"</span>,<span class="string">"Irish_terrier"</span>,<span class="string">"Norfolk_terrier"</span>,<span class="string">"Norwich_terrier"</span>,<span class="string">"Yorkshire_terrier"</span>,<span class="string">"wire-haired_fox_terrier"</span>,<span class="string">"Lakeland_terrier"</span>,<span class="string">"Sealyham_terrier"</span>,<span class="string">"Airedale"</span>,<span class="string">"cairn"</span>,<span class="string">"Australian_terrier"</span>,<span class="string">"Dandie_Dinmont"</span>,<span class="string">"Boston_bull"</span>,<span class="string">"miniature_schnauzer"</span>,<span class="string">"giant_schnauzer"</span>,<span class="string">"standard_schnauzer"</span>,<span class="string">"Scotch_terrier"</span>,<span class="string">"Tibetan_terrier"</span>,<span class="string">"silky_terrier"</span>,<span class="string">"soft-coated_wheaten_terrier"</span>,<span class="string">"West_Highland_white_terrier"</span>,<span class="string">"Lhasa"</span>,<span class="string">"flat-coated_retriever"</span>,<span class="string">"curly-coated_retriever"</span>,<span class="string">"golden_retriever"</span>,<span class="string">"Labrador_retriever"</span>,<span class="string">"Chesapeake_Bay_retriever"</span>,<span class="string">"German_short-haired_pointer"</span>,<span class="string">"vizsla"</span>,<span class="string">"English_setter"</span>,<span class="string">"Irish_setter"</span>,<span class="string">"Gordon_setter"</span>,<span class="string">"Brittany_spaniel"</span>,<span class="string">"clumber"</span>,<span class="string">"English_springer"</span>,<span class="string">"Welsh_springer_spaniel"</span>,<span class="string">"cocker_spaniel"</span>,<span class="string">"Sussex_spaniel"</span>,<span class="string">"Irish_water_spaniel"</span>,<span class="string">"kuvasz"</span>,<span class="string">"schipperke"</span>,<span class="string">"groenendael"</span>,<span class="string">"malinois"</span>,<span class="string">"briard"</span>,<span class="string">"kelpie"</span>,<span class="string">"komondor"</span>,<span class="string">"Old_English_sheepdog"</span>,<span class="string">"Shetland_sheepdog"</span>,<span class="string">"collie"</span>,<span class="string">"Border_collie"</span>,<span class="string">"Bouvier_des_Flandres"</span>,<span class="string">"Rottweiler"</span>,<span class="string">"German_shepherd"</span>,<span class="string">"Doberman"</span>,<span class="string">"miniature_pinscher"</span>,<span class="string">"Greater_Swiss_Mountain_dog"</span>,<span class="string">"Bernese_mountain_dog"</span>,<span class="string">"Appenzeller"</span>,<span class="string">"EntleBucher"</span>,<span class="string">"boxer"</span>,<span class="string">"bull_mastiff"</span>,<span class="string">"Tibetan_mastiff"</span>,<span class="string">"French_bulldog"</span>,<span class="string">"Great_Dane"</span>,<span class="string">"Saint_Bernard"</span>,<span class="string">"Eskimo_dog"</span>,<span class="string">"malamute"</span>,<span class="string">"Siberian_husky"</span>,<span class="string">"dalmatian"</span>,<span class="string">"affenpinscher"</span>,<span class="string">"basenji"</span>,<span class="string">"pug"</span>,<span class="string">"Leonberg"</span>,<span class="string">"Newfoundland"</span>,<span class="string">"Great_Pyrenees"</span>,<span class="string">"Samoyed"</span>,<span class="string">"Pomeranian"</span>,<span class="string">"chow"</span>,<span class="string">"keeshond"</span>,<span class="string">"Brabancon_griffon"</span>,<span class="string">"Pembroke"</span>,<span class="string">"Cardigan"</span>,<span class="string">"toy_poodle"</span>,<span class="string">"miniature_poodle"</span>,<span class="string">"standard_poodle"</span>,<span class="string">"Mexican_hairless"</span>,<span class="string">"timber_wolf"</span>,<span class="string">"white_wolf"</span>,<span class="string">"red_wolf"</span>,<span class="string">"coyote"</span>,<span class="string">"dingo"</span>,<span class="string">"dhole"</span>,<span class="string">"African_hunting_dog"</span>,<span class="string">"hyena"</span>,<span class="string">"red_fox"</span>,<span class="string">"kit_fox"</span>,<span class="string">"Arctic_fox"</span>,<span class="string">"grey_fox"</span>,<span class="string">"tabby"</span>,<span class="string">"tiger_cat"</span>,<span class="string">"Persian_cat"</span>,<span class="string">"Siamese_cat"</span>,<span class="string">"Egyptian_cat"</span>,<span class="string">"cougar"</span>,<span class="string">"lynx"</span>,<span class="string">"leopard"</span>,<span class="string">"snow_leopard"</span>,<span class="string">"jaguar"</span>,<span class="string">"lion"</span>,<span class="string">"tiger"</span>,<span class="string">"cheetah"</span>,<span class="string">"brown_bear"</span>,<span class="string">"American_black_bear"</span>,<span class="string">"ice_bear"</span>,<span class="string">"sloth_bear"</span>,<span class="string">"mongoose"</span>,<span class="string">"meerkat"</span>,<span class="string">"tiger_beetle"</span>,<span class="string">"ladybug"</span>,<span class="string">"ground_beetle"</span>,<span class="string">"long-horned_beetle"</span>,<span class="string">"leaf_beetle"</span>,<span class="string">"dung_beetle"</span>,<span class="string">"rhinoceros_beetle"</span>,<span class="string">"weevil"</span>,<span class="string">"fly"</span>,<span class="string">"bee"</span>,<span class="string">"ant"</span>,<span class="string">"grasshopper"</span>,<span class="string">"cricket"</span>,<span class="string">"walking_stick"</span>,<span class="string">"cockroach"</span>,<span class="string">"mantis"</span>,<span class="string">"cicada"</span>,<span class="string">"leafhopper"</span>,<span class="string">"lacewing"</span>,<span class="string">"dragonfly"</span>,<span class="string">"damselfly"</span>,<span class="string">"admiral"</span>,<span class="string">"ringlet"</span>,<span class="string">"monarch"</span>,<span class="string">"cabbage_butterfly"</span>,<span class="string">"sulphur_butterfly"</span>,<span class="string">"lycaenid"</span>,<span class="string">"starfish"</span>,<span class="string">"sea_urchin"</span>,<span class="string">"sea_cucumber"</span>,<span class="string">"wood_rabbit"</span>,<span class="string">"hare"</span>,<span class="string">"Angora"</span>,<span class="string">"hamster"</span>,<span class="string">"porcupine"</span>,<span class="string">"fox_squirrel"</span>,<span class="string">"marmot"</span>,<span class="string">"beaver"</span>,<span class="string">"guinea_pig"</span>,<span class="string">"sorrel"</span>,<span class="string">"zebra"</span>,<span class="string">"hog"</span>,<span class="string">"wild_boar"</span>,<span class="string">"warthog"</span>,<span class="string">"hippopotamus"</span>,<span class="string">"ox"</span>,<span class="string">"water_buffalo"</span>,<span class="string">"bison"</span>,<span class="string">"ram"</span>,<span class="string">"bighorn"</span>,<span class="string">"ibex"</span>,<span class="string">"hartebeest"</span>,<span class="string">"impala"</span>,<span class="string">"gazelle"</span>,<span class="string">"Arabian_camel"</span>,<span class="string">"llama"</span>,<span class="string">"weasel"</span>,<span class="string">"mink"</span>,<span class="string">"polecat"</span>,<span class="string">"black-footed_ferret"</span>,<span class="string">"otter"</span>,<span class="string">"skunk"</span>,<span class="string">"badger"</span>,<span class="string">"armadillo"</span>,<span class="string">"three-toed_sloth"</span>,<span class="string">"orangutan"</span>,<span class="string">"gorilla"</span>,<span class="string">"chimpanzee"</span>,<span class="string">"gibbon"</span>,<span class="string">"siamang"</span>,<span class="string">"guenon"</span>,<span class="string">"patas"</span>,<span class="string">"baboon"</span>,<span class="string">"macaque"</span>,<span class="string">"langur"</span>,<span class="string">"colobus"</span>,<span class="string">"proboscis_monkey"</span>,<span class="string">"marmoset"</span>,<span class="string">"capuchin"</span>,<span class="string">"howler_monkey"</span>,<span class="string">"titi"</span>,<span class="string">"spider_monkey"</span>,<span class="string">"squirrel_monkey"</span>,<span class="string">"Madagascar_cat"</span>,<span class="string">"indri"</span>,<span class="string">"Indian_elephant"</span>,<span class="string">"African_elephant"</span>,<span class="string">"lesser_panda"</span>,<span class="string">"giant_panda"</span>,<span class="string">"barracouta"</span>,<span class="string">"eel"</span>,<span class="string">"coho"</span>,<span class="string">"rock_beauty"</span>,<span class="string">"anemone_fish"</span>,<span class="string">"sturgeon"</span>,<span class="string">"gar"</span>,<span class="string">"lionfish"</span>,<span class="string">"puffer"</span>,<span class="string">"abacus"</span>,<span class="string">"abaya"</span>,<span class="string">"academic_gown"</span>,<span class="string">"accordion"</span>,<span class="string">"acoustic_guitar"</span>,<span class="string">"aircraft_carrier"</span>,<span class="string">"airliner"</span>,<span class="string">"airship"</span>,<span class="string">"altar"</span>,<span class="string">"ambulance"</span>,<span class="string">"amphibian"</span>,<span class="string">"analog_clock"</span>,<span class="string">"apiary"</span>,<span class="string">"apron"</span>,<span class="string">"ashcan"</span>,<span class="string">"assault_rifle"</span>,<span class="string">"backpack"</span>,<span class="string">"bakery"</span>,<span class="string">"balance_beam"</span>,<span class="string">"balloon"</span>,<span class="string">"ballpoint"</span>,<span class="string">"Band_Aid"</span>,<span class="string">"banjo"</span>,<span class="string">"bannister"</span>,<span class="string">"barbell"</span>,<span class="string">"barber_chair"</span>,<span class="string">"barbershop"</span>,<span class="string">"barn"</span>,<span class="string">"barometer"</span>,<span class="string">"barrel"</span>,<span class="string">"barrow"</span>,<span class="string">"baseball"</span>,<span class="string">"basketball"</span>,<span class="string">"bassinet"</span>,<span class="string">"bassoon"</span>,<span class="string">"bathing_cap"</span>,<span class="string">"bath_towel"</span>,<span class="string">"bathtub"</span>,<span class="string">"beach_wagon"</span>,<span class="string">"beacon"</span>,<span class="string">"beaker"</span>,<span class="string">"bearskin"</span>,<span class="string">"beer_bottle"</span>,<span class="string">"beer_glass"</span>,<span class="string">"bell_cote"</span>,<span class="string">"bib"</span>,<span class="string">"bicycle-built-for-two"</span>,<span class="string">"bikini"</span>,<span class="string">"binder"</span>,<span class="string">"binoculars"</span>,<span class="string">"birdhouse"</span>,<span class="string">"boathouse"</span>,<span class="string">"bobsled"</span>,<span class="string">"bolo_tie"</span>,<span class="string">"bonnet"</span>,<span class="string">"bookcase"</span>,<span class="string">"bookshop"</span>,<span class="string">"bottlecap"</span>,<span class="string">"bow"</span>,<span class="string">"bow_tie"</span>,<span class="string">"brass"</span>,<span class="string">"brassiere"</span>,<span class="string">"breakwater"</span>,<span class="string">"breastplate"</span>,<span class="string">"broom"</span>,<span class="string">"bucket"</span>,<span class="string">"buckle"</span>,<span class="string">"bulletproof_vest"</span>,<span class="string">"bullet_train"</span>,<span class="string">"butcher_shop"</span>,<span class="string">"cab"</span>,<span class="string">"caldron"</span>,<span class="string">"candle"</span>,<span class="string">"cannon"</span>,<span class="string">"canoe"</span>,<span class="string">"can_opener"</span>,<span class="string">"cardigan"</span>,<span class="string">"car_mirror"</span>,<span class="string">"carousel"</span>,<span class="string">"carpenters_kit"</span>,<span class="string">"carton"</span>,<span class="string">"car_wheel"</span>,<span class="string">"cash_machine"</span>,<span class="string">"cassette"</span>,<span class="string">"cassette_player"</span>,<span class="string">"castle"</span>,<span class="string">"catamaran"</span>,<span class="string">"CD_player"</span>,<span class="string">"cello"</span>,<span class="string">"cellular_telephone"</span>,<span class="string">"chain"</span>,<span class="string">"chainlink_fence"</span>,<span class="string">"chain_mail"</span>,<span class="string">"chain_saw"</span>,<span class="string">"chest"</span>,<span class="string">"chiffonier"</span>,<span class="string">"chime"</span>,<span class="string">"china_cabinet"</span>,<span class="string">"Christmas_stocking"</span>,<span class="string">"church"</span>,<span class="string">"cinema"</span>,<span class="string">"cleaver"</span>,<span class="string">"cliff_dwelling"</span>,<span class="string">"cloak"</span>,<span class="string">"clog"</span>,<span class="string">"cocktail_shaker"</span>,<span class="string">"coffee_mug"</span>,<span class="string">"coffeepot"</span>,<span class="string">"coil"</span>,<span class="string">"combination_lock"</span>,<span class="string">"computer_keyboard"</span>,<span class="string">"confectionery"</span>,<span class="string">"container_ship"</span>,<span class="string">"convertible"</span>,<span class="string">"corkscrew"</span>,<span class="string">"cornet"</span>,<span class="string">"cowboy_boot"</span>,<span class="string">"cowboy_hat"</span>,<span class="string">"cradle"</span>,<span class="string">"crane"</span>,<span class="string">"crash_helmet"</span>,<span class="string">"crate"</span>,<span class="string">"crib"</span>,<span class="string">"Crock_Pot"</span>,<span class="string">"croquet_ball"</span>,<span class="string">"crutch"</span>,<span class="string">"cuirass"</span>,<span class="string">"dam"</span>,<span class="string">"desk"</span>,<span class="string">"desktop_computer"</span>,<span class="string">"dial_telephone"</span>,<span class="string">"diaper"</span>,<span class="string">"digital_clock"</span>,<span class="string">"digital_watch"</span>,<span class="string">"dining_table"</span>,<span class="string">"dishrag"</span>,<span class="string">"dishwasher"</span>,<span class="string">"disk_brake"</span>,<span class="string">"dock"</span>,<span class="string">"dogsled"</span>,<span class="string">"dome"</span>,<span class="string">"doormat"</span>,<span class="string">"drilling_platform"</span>,<span class="string">"drum"</span>,<span class="string">"drumstick"</span>,<span class="string">"dumbbell"</span>,<span class="string">"Dutch_oven"</span>,<span class="string">"electric_fan"</span>,<span class="string">"electric_guitar"</span>,<span class="string">"electric_locomotive"</span>,<span class="string">"entertainment_center"</span>,<span class="string">"envelope"</span>,<span class="string">"espresso_maker"</span>,<span class="string">"face_powder"</span>,<span class="string">"feather_boa"</span>,<span class="string">"file"</span>,<span class="string">"fireboat"</span>,<span class="string">"fire_engine"</span>,<span class="string">"fire_screen"</span>,<span class="string">"flagpole"</span>,<span class="string">"flute"</span>,<span class="string">"folding_chair"</span>,<span class="string">"football_helmet"</span>,<span class="string">"forklift"</span>,<span class="string">"fountain"</span>,<span class="string">"fountain_pen"</span>,<span class="string">"four-poster"</span>,<span class="string">"freight_car"</span>,<span class="string">"French_horn"</span>,<span class="string">"frying_pan"</span>,<span class="string">"fur_coat"</span>,<span class="string">"garbage_truck"</span>,<span class="string">"gasmask"</span>,<span class="string">"gas_pump"</span>,<span class="string">"goblet"</span>,<span class="string">"go-kart"</span>,<span class="string">"golf_ball"</span>,<span class="string">"golfcart"</span>,<span class="string">"gondola"</span>,<span class="string">"gong"</span>,<span class="string">"gown"</span>,<span class="string">"grand_piano"</span>,<span class="string">"greenhouse"</span>,<span class="string">"grille"</span>,<span class="string">"grocery_store"</span>,<span class="string">"guillotine"</span>,<span class="string">"hair_slide"</span>,<span class="string">"hair_spray"</span>,<span class="string">"half_track"</span>,<span class="string">"hammer"</span>,<span class="string">"hamper"</span>,<span class="string">"hand_blower"</span>,<span class="string">"hand-held_computer"</span>,<span class="string">"handkerchief"</span>,<span class="string">"hard_disc"</span>,<span class="string">"harmonica"</span>,<span class="string">"harp"</span>,<span class="string">"harvester"</span>,<span class="string">"hatchet"</span>,<span class="string">"holster"</span>,<span class="string">"home_theater"</span>,<span class="string">"honeycomb"</span>,<span class="string">"hook"</span>,<span class="string">"hoopskirt"</span>,<span class="string">"horizontal_bar"</span>,<span class="string">"horse_cart"</span>,<span class="string">"hourglass"</span>,<span class="string">"iPod"</span>,<span class="string">"iron"</span>,<span class="string">"jack-o-lantern"</span>,<span class="string">"jean"</span>,<span class="string">"jeep"</span>,<span class="string">"jersey"</span>,<span class="string">"jigsaw_puzzle"</span>,<span class="string">"jinrikisha"</span>,<span class="string">"joystick"</span>,<span class="string">"kimono"</span>,<span class="string">"knee_pad"</span>,<span class="string">"knot"</span>,<span class="string">"lab_coat"</span>,<span class="string">"ladle"</span>,<span class="string">"lampshade"</span>,<span class="string">"laptop"</span>,<span class="string">"lawn_mower"</span>,<span class="string">"lens_cap"</span>,<span class="string">"letter_opener"</span>,<span class="string">"library"</span>,<span class="string">"lifeboat"</span>,<span class="string">"lighter"</span>,<span class="string">"limousine"</span>,<span class="string">"liner"</span>,<span class="string">"lipstick"</span>,<span class="string">"Loafer"</span>,<span class="string">"lotion"</span>,<span class="string">"loudspeaker"</span>,<span class="string">"loupe"</span>,<span class="string">"lumbermill"</span>,<span class="string">"magnetic_compass"</span>,<span class="string">"mailbag"</span>,<span class="string">"mailbox"</span>,<span class="string">"maillot"</span>,<span class="string">"maillot"</span>,<span class="string">"manhole_cover"</span>,<span class="string">"maraca"</span>,<span class="string">"marimba"</span>,<span class="string">"mask"</span>,<span class="string">"matchstick"</span>,<span class="string">"maypole"</span>,<span class="string">"maze"</span>,<span class="string">"measuring_cup"</span>,<span class="string">"medicine_chest"</span>,<span class="string">"megalith"</span>,<span class="string">"microphone"</span>,<span class="string">"microwave"</span>,<span class="string">"military_uniform"</span>,<span class="string">"milk_can"</span>,<span class="string">"minibus"</span>,<span class="string">"miniskirt"</span>,<span class="string">"minivan"</span>,<span class="string">"missile"</span>,<span class="string">"mitten"</span>,<span class="string">"mixing_bowl"</span>,<span class="string">"mobile_home"</span>,<span class="string">"Model_T"</span>,<span class="string">"modem"</span>,<span class="string">"monastery"</span>,<span class="string">"monitor"</span>,<span class="string">"moped"</span>,<span class="string">"mortar"</span>,<span class="string">"mortarboard"</span>,<span class="string">"mosque"</span>,<span class="string">"mosquito_net"</span>,<span class="string">"motor_scooter"</span>,<span class="string">"mountain_bike"</span>,<span class="string">"mountain_tent"</span>,<span class="string">"mouse"</span>,<span class="string">"mousetrap"</span>,<span class="string">"moving_van"</span>,<span class="string">"muzzle"</span>,<span class="string">"nail"</span>,<span class="string">"neck_brace"</span>,<span class="string">"necklace"</span>,<span class="string">"nipple"</span>,<span class="string">"notebook"</span>,<span class="string">"obelisk"</span>,<span class="string">"oboe"</span>,<span class="string">"ocarina"</span>,<span class="string">"odometer"</span>,<span class="string">"oil_filter"</span>,<span class="string">"organ"</span>,<span class="string">"oscilloscope"</span>,<span class="string">"overskirt"</span>,<span class="string">"oxcart"</span>,<span class="string">"oxygen_mask"</span>,<span class="string">"packet"</span>,<span class="string">"paddle"</span>,<span class="string">"paddlewheel"</span>,<span class="string">"padlock"</span>,<span class="string">"paintbrush"</span>,<span class="string">"pajama"</span>,<span class="string">"palace"</span>,<span class="string">"panpipe"</span>,<span class="string">"paper_towel"</span>,<span class="string">"parachute"</span>,<span class="string">"parallel_bars"</span>,<span class="string">"park_bench"</span>,<span class="string">"parking_meter"</span>,<span class="string">"passenger_car"</span>,<span class="string">"patio"</span>,<span class="string">"pay-phone"</span>,<span class="string">"pedestal"</span>,<span class="string">"pencil_box"</span>,<span class="string">"pencil_sharpener"</span>,<span class="string">"perfume"</span>,<span class="string">"Petri_dish"</span>,<span class="string">"photocopier"</span>,<span class="string">"pick"</span>,<span class="string">"pickelhaube"</span>,<span class="string">"picket_fence"</span>,<span class="string">"pickup"</span>,<span class="string">"pier"</span>,<span class="string">"piggy_bank"</span>,<span class="string">"pill_bottle"</span>,<span class="string">"pillow"</span>,<span class="string">"ping-pong_ball"</span>,<span class="string">"pinwheel"</span>,<span class="string">"pirate"</span>,<span class="string">"pitcher"</span>,<span class="string">"plane"</span>,<span class="string">"planetarium"</span>,<span class="string">"plastic_bag"</span>,<span class="string">"plate_rack"</span>,<span class="string">"plow"</span>,<span class="string">"plunger"</span>,<span class="string">"Polaroid_camera"</span>,<span class="string">"pole"</span>,<span class="string">"police_van"</span>,<span class="string">"poncho"</span>,<span class="string">"pool_table"</span>,<span class="string">"pop_bottle"</span>,<span class="string">"pot"</span>,<span class="string">"potters_wheel"</span>,<span class="string">"power_drill"</span>,<span class="string">"prayer_rug"</span>,<span class="string">"printer"</span>,<span class="string">"prison"</span>,<span class="string">"projectile"</span>,<span class="string">"projector"</span>,<span class="string">"puck"</span>,<span class="string">"punching_bag"</span>,<span class="string">"purse"</span>,<span class="string">"quill"</span>,<span class="string">"quilt"</span>,<span class="string">"racer"</span>,<span class="string">"racket"</span>,<span class="string">"radiator"</span>,<span class="string">"radio"</span>,<span class="string">"radio_telescope"</span>,<span class="string">"rain_barrel"</span>,<span class="string">"recreational_vehicle"</span>,<span class="string">"reel"</span>,<span class="string">"reflex_camera"</span>,<span class="string">"refrigerator"</span>,<span class="string">"remote_control"</span>,<span class="string">"restaurant"</span>,<span class="string">"revolver"</span>,<span class="string">"rifle"</span>,<span class="string">"rocking_chair"</span>,<span class="string">"rotisserie"</span>,<span class="string">"rubber_eraser"</span>,<span class="string">"rugby_ball"</span>,<span class="string">"rule"</span>,<span class="string">"running_shoe"</span>,<span class="string">"safe"</span>,<span class="string">"safety_pin"</span>,<span class="string">"saltshaker"</span>,<span class="string">"sandal"</span>,<span class="string">"sarong"</span>,<span class="string">"sax"</span>,<span class="string">"scabbard"</span>,<span class="string">"scale"</span>,<span class="string">"school_bus"</span>,<span class="string">"schooner"</span>,<span class="string">"scoreboard"</span>,<span class="string">"screen"</span>,<span class="string">"screw"</span>,<span class="string">"screwdriver"</span>,<span class="string">"seat_belt"</span>,<span class="string">"sewing_machine"</span>,<span class="string">"shield"</span>,<span class="string">"shoe_shop"</span>,<span class="string">"shoji"</span>,<span class="string">"shopping_basket"</span>,<span class="string">"shopping_cart"</span>,<span class="string">"shovel"</span>,<span class="string">"shower_cap"</span>,<span class="string">"shower_curtain"</span>,<span class="string">"ski"</span>,<span class="string">"ski_mask"</span>,<span class="string">"sleeping_bag"</span>,<span class="string">"slide_rule"</span>,<span class="string">"sliding_door"</span>,<span class="string">"slot"</span>,<span class="string">"snorkel"</span>,<span class="string">"snowmobile"</span>,<span class="string">"snowplow"</span>,<span class="string">"soap_dispenser"</span>,<span class="string">"soccer_ball"</span>,<span class="string">"sock"</span>,<span class="string">"solar_dish"</span>,<span class="string">"sombrero"</span>,<span class="string">"soup_bowl"</span>,<span class="string">"space_bar"</span>,<span class="string">"space_heater"</span>,<span class="string">"space_shuttle"</span>,<span class="string">"spatula"</span>,<span class="string">"speedboat"</span>,<span class="string">"spider_web"</span>,<span class="string">"spindle"</span>,<span class="string">"sports_car"</span>,<span class="string">"spotlight"</span>,<span class="string">"stage"</span>,<span class="string">"steam_locomotive"</span>,<span class="string">"steel_arch_bridge"</span>,<span class="string">"steel_drum"</span>,<span class="string">"stethoscope"</span>,<span class="string">"stole"</span>,<span class="string">"stone_wall"</span>,<span class="string">"stopwatch"</span>,<span class="string">"stove"</span>,<span class="string">"strainer"</span>,<span class="string">"streetcar"</span>,<span class="string">"stretcher"</span>,<span class="string">"studio_couch"</span>,<span class="string">"stupa"</span>,<span class="string">"submarine"</span>,<span class="string">"suit"</span>,<span class="string">"sundial"</span>,<span class="string">"sunglass"</span>,<span class="string">"sunglasses"</span>,<span class="string">"sunscreen"</span>,<span class="string">"suspension_bridge"</span>,<span class="string">"swab"</span>,<span class="string">"sweatshirt"</span>,<span class="string">"swimming_trunks"</span>,<span class="string">"swing"</span>,<span class="string">"switch"</span>,<span class="string">"syringe"</span>,<span class="string">"table_lamp"</span>,<span class="string">"tank"</span>,<span class="string">"tape_player"</span>,<span class="string">"teapot"</span>,<span class="string">"teddy"</span>,<span class="string">"television"</span>,<span class="string">"tennis_ball"</span>,<span class="string">"thatch"</span>,<span class="string">"theater_curtain"</span>,<span class="string">"thimble"</span>,<span class="string">"thresher"</span>,<span class="string">"throne"</span>,<span class="string">"tile_roof"</span>,<span class="string">"toaster"</span>,<span class="string">"tobacco_shop"</span>,<span class="string">"toilet_seat"</span>,<span class="string">"torch"</span>,<span class="string">"totem_pole"</span>,<span class="string">"tow_truck"</span>,<span class="string">"toyshop"</span>,<span class="string">"tractor"</span>,<span class="string">"trailer_truck"</span>,<span class="string">"tray"</span>,<span class="string">"trench_coat"</span>,<span class="string">"tricycle"</span>,<span class="string">"trimaran"</span>,<span class="string">"tripod"</span>,<span class="string">"triumphal_arch"</span>,<span class="string">"trolleybus"</span>,<span class="string">"trombone"</span>,<span class="string">"tub"</span>,<span class="string">"turnstile"</span>,<span class="string">"typewriter_keyboard"</span>,<span class="string">"umbrella"</span>,<span class="string">"unicycle"</span>,<span class="string">"upright"</span>,<span class="string">"vacuum"</span>,<span class="string">"vase"</span>,<span class="string">"vault"</span>,<span class="string">"velvet"</span>,<span class="string">"vending_machine"</span>,<span class="string">"vestment"</span>,<span class="string">"viaduct"</span>,<span class="string">"violin"</span>,<span class="string">"volleyball"</span>,<span class="string">"waffle_iron"</span>,<span class="string">"wall_clock"</span>,<span class="string">"wallet"</span>,<span class="string">"wardrobe"</span>,<span class="string">"warplane"</span>,<span class="string">"washbasin"</span>,<span class="string">"washer"</span>,<span class="string">"water_bottle"</span>,<span class="string">"water_jug"</span>,<span class="string">"water_tower"</span>,<span class="string">"whiskey_jug"</span>,<span class="string">"whistle"</span>,<span class="string">"wig"</span>,<span class="string">"window_screen"</span>,<span class="string">"window_shade"</span>,<span class="string">"Windsor_tie"</span>,<span class="string">"wine_bottle"</span>,<span class="string">"wing"</span>,<span class="string">"wok"</span>,<span class="string">"wooden_spoon"</span>,<span class="string">"wool"</span>,<span class="string">"worm_fence"</span>,<span class="string">"wreck"</span>,<span class="string">"yawl"</span>,<span class="string">"yurt"</span>,<span class="string">"web_site"</span>,<span class="string">"comic_book"</span>,<span class="string">"crossword_puzzle"</span>,<span class="string">"street_sign"</span>,<span class="string">"traffic_light"</span>,<span class="string">"book_jacket"</span>,<span class="string">"menu"</span>,<span class="string">"plate"</span>,<span class="string">"guacamole"</span>,<span class="string">"consomme"</span>,<span class="string">"hot_pot"</span>,<span class="string">"trifle"</span>,<span class="string">"ice_cream"</span>,<span class="string">"ice_lolly"</span>,<span class="string">"French_loaf"</span>,<span class="string">"bagel"</span>,<span class="string">"pretzel"</span>,<span class="string">"cheeseburger"</span>,<span class="string">"hotdog"</span>,<span class="string">"mashed_potato"</span>,<span class="string">"head_cabbage"</span>,<span class="string">"broccoli"</span>,<span class="string">"cauliflower"</span>,<span class="string">"zucchini"</span>,<span class="string">"spaghetti_squash"</span>,<span class="string">"acorn_squash"</span>,<span class="string">"butternut_squash"</span>,<span class="string">"cucumber"</span>,<span class="string">"artichoke"</span>,<span class="string">"bell_pepper"</span>,<span class="string">"cardoon"</span>,<span class="string">"mushroom"</span>,<span class="string">"Granny_Smith"</span>,<span class="string">"strawberry"</span>,<span class="string">"orange"</span>,<span class="string">"lemon"</span>,<span class="string">"fig"</span>,<span class="string">"pineapple"</span>,<span class="string">"banana"</span>,<span class="string">"jackfruit"</span>,<span class="string">"custard_apple"</span>,<span class="string">"pomegranate"</span>,<span class="string">"hay"</span>,<span class="string">"carbonara"</span>,<span class="string">"chocolate_sauce"</span>,<span class="string">"dough"</span>,<span class="string">"meat_loaf"</span>,<span class="string">"pizza"</span>,<span class="string">"potpie"</span>,<span class="string">"burrito"</span>,<span class="string">"red_wine"</span>,<span class="string">"espresso"</span>,<span class="string">"cup"</span>,<span class="string">"eggnog"</span>,<span class="string">"alp"</span>,<span class="string">"bubble"</span>,<span class="string">"cliff"</span>,<span class="string">"coral_reef"</span>,<span class="string">"geyser"</span>,<span class="string">"lakeside"</span>,<span class="string">"promontory"</span>,<span class="string">"sandbar"</span>,<span class="string">"seashore"</span>,<span class="string">"valley"</span>,<span class="string">"volcano"</span>,<span class="string">"ballplayer"</span>,<span class="string">"groom"</span>,<span class="string">"scuba_diver"</span>,<span class="string">"rapeseed"</span>,<span class="string">"daisy"</span>,<span class="string">"yellow_ladys_slipper"</span>,<span class="string">"corn"</span>,<span class="string">"acorn"</span>,<span class="string">"hip"</span>,<span class="string">"buckeye"</span>,<span class="string">"coral_fungus"</span>,<span class="string">"agaric"</span>,<span class="string">"gyromitra"</span>,<span class="string">"stinkhorn"</span>,<span class="string">"earthstar"</span>,<span class="string">"hen-of-the-woods"</span>,<span class="string">"bolete"</span>,<span class="string">"ear"</span>,<span class="string">"toilet_tissue"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(size, box)</span>:</span></span><br><span class="line">    dw = <span class="number">1.</span>/(size[<span class="number">0</span>])</span><br><span class="line">    dh = <span class="number">1.</span>/(size[<span class="number">1</span>])</span><br><span class="line">    x = (box[<span class="number">0</span>] + box[<span class="number">1</span>])/<span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    y = (box[<span class="number">2</span>] + box[<span class="number">3</span>])/<span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    w = box[<span class="number">1</span>] - box[<span class="number">0</span>]</span><br><span class="line">    h = box[<span class="number">3</span>] - box[<span class="number">2</span>]</span><br><span class="line">    x = x*dw</span><br><span class="line">    w = w*dw</span><br><span class="line">    y = y*dh</span><br><span class="line">    h = h*dh</span><br><span class="line">    <span class="keyword">return</span> (x,y,w,h)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_annotation</span><span class="params">(year, image_id)</span>:</span></span><br><span class="line">    in_file = open(<span class="string">'VOCdevkit/VOC%s/Annotations/%s.xml'</span>%(year, image_id))</span><br><span class="line">    out_file = open(<span class="string">'VOCdevkit/VOC%s/labels/%s.txt'</span>%(year, image_id), <span class="string">'w'</span>)</span><br><span class="line">    tree=ET.parse(in_file)</span><br><span class="line">    root = tree.getroot()</span><br><span class="line">    size = root.find(<span class="string">'size'</span>)</span><br><span class="line">    w = int(size.find(<span class="string">'width'</span>).text)</span><br><span class="line">    h = int(size.find(<span class="string">'height'</span>).text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> root.iter(<span class="string">'object'</span>):</span><br><span class="line">        difficult = obj.find(<span class="string">'difficult'</span>).text</span><br><span class="line">        cls = obj.find(<span class="string">'name'</span>).text</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> classes <span class="keyword">or</span> int(difficult)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        cls_id = classes.index(cls)</span><br><span class="line">        xmlbox = obj.find(<span class="string">'bndbox'</span>)</span><br><span class="line">        b = (float(xmlbox.find(<span class="string">'xmin'</span>).text), float(xmlbox.find(<span class="string">'xmax'</span>).text), float(xmlbox.find(<span class="string">'ymin'</span>).text), float(xmlbox.find(<span class="string">'ymax'</span>).text))</span><br><span class="line">        bb = convert((w,h), b)</span><br><span class="line">        out_file.write(str(cls_id) + <span class="string">" "</span> + <span class="string">" "</span>.join([str(a) <span class="keyword">for</span> a <span class="keyword">in</span> bb]) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">wd = getcwd()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> year, image_set <span class="keyword">in</span> sets:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'VOCdevkit/VOC%s/labels/'</span>%(year)):</span><br><span class="line">        os.makedirs(<span class="string">'VOCdevkit/VOC%s/labels/'</span>%(year))</span><br><span class="line">    image_ids = open(<span class="string">'VOCdevkit/VOC%s/ImageSets/Main/%s.txt'</span>%(year, image_set)).read().strip().split()</span><br><span class="line">    list_file = open(<span class="string">'%s_%s.txt'</span>%(year, image_set), <span class="string">'w'</span>)</span><br><span class="line">    <span class="keyword">for</span> image_id <span class="keyword">in</span> image_ids:</span><br><span class="line">        list_file.write(<span class="string">'%s/VOCdevkit/VOC%s/JPEGImages/%s.JPEG\n'</span>%(wd, year, image_id))</span><br><span class="line">        convert_annotation(year, image_id)</span><br><span class="line">    list_file.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#os.system("cat 2007_train.txt 2007_val.txt 2012_train.txt 2012_val.txt &gt; train.txt")</span></span><br><span class="line"><span class="comment">#os.system("cat 2007_train.txt 2007_val.txt 2007_test.txt 2012_train.txt 2012_val.txt &gt; train.all.txt")</span></span><br></pre></td></tr></table></figure><p>修改好后在该目录下运行命令：python voc_label.py，之后则在文件夹scripts\VOCdevkit\VOC2007下生成了文件夹lable。这里包含了类别和对应归一化后的位置（i guess，如有错请指正）。同时在scripts\下应该也生成了train_2007.txt这个文件，里面包含了所有训练样本的绝对路径。</p><p>修改.data文件，以cfg/voc.data为例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 classes= 20</span><br><span class="line">2 train  = &lt;path-to-voc&gt;/train.txt</span><br><span class="line">3 valid  = &lt;path-to-voc&gt;2007_test.txt</span><br><span class="line">4 names = data/voc.names</span><br><span class="line">5 backup = backup</span><br></pre></td></tr></table></figure><p>使用自己的路径替换<path-to-voc>，例如我的配置如下：</path-to-voc></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">classes= 1000</span><br><span class="line">train  = /home/teng/programmings/semap/darknet/scripts/2007_train.txt</span><br><span class="line">names = /home/teng/programmings/semap/darknet/data/voc.names</span><br><span class="line">backup = /home/teng/programmings/semap/darknet/backup</span><br></pre></td></tr></table></figure><p>修改.names文件，即训练的label：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tench</span><br><span class="line">goldfish</span><br><span class="line">great_white_shark</span><br><span class="line">...</span><br><span class="line">bolete</span><br><span class="line">ear</span><br><span class="line">toilet_tissue</span><br></pre></td></tr></table></figure><h1 id="配置文件修改"><a href="#配置文件修改" class="headerlink" title="配置文件修改"></a>配置文件修改</h1><p>做好了上述准备，就可以根据不同的网络设置（cfg文件）来训练了。在文件夹cfg中有很多cfg文件，应该跟caffe中的prototxt文件是一个意思。这里以yolo-voc.cfg为例，主要修改参数如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[net]</span><br><span class="line"><span class="comment"># Testing</span></span><br><span class="line"><span class="comment"># batch=1</span></span><br><span class="line"><span class="comment"># subdivisions=1    #训练时候把上面Testing的参数注释</span></span><br><span class="line"><span class="comment"># Training</span></span><br><span class="line">batch=64</span><br><span class="line">subdivisions=32     <span class="comment">#这个参数根据自己GPU的显存进行修改，显存不够就改大一些</span></span><br><span class="line">...                 <span class="comment">#因为训练时每批的数量 = batch/subdivisions</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">learning_rate=0.001  <span class="comment">#根据自己的需求还有训练速度学习率可以调整一下</span></span><br><span class="line">burn_in=1000</span><br><span class="line">max_batches = 30000  <span class="comment">#根据自己的需求还有训练速度max_batches可以调整一下</span></span><br><span class="line">policy=steps</span><br><span class="line">steps=10000,20000    <span class="comment">#跟着max_batches做相应调整</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">[convolutional]</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">filters=30         <span class="comment">#filters = 3*(classes + 5)</span></span><br><span class="line">activation=linear</span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask = 0,1,2</span><br><span class="line">anchors = 10,13,  16,30,  33,23,  30,61,  62,45,  59,119,  116,90,  156,198,  373,326</span><br><span class="line">classes=5          <span class="comment">#修改类别数</span></span><br><span class="line">num=9</span><br><span class="line">jitter=.3</span><br><span class="line">ignore_thresh = .5</span><br><span class="line">truth_thresh = 1</span><br><span class="line">random=1           <span class="comment">#显存小的话 =0</span></span><br><span class="line"><span class="comment">#这个文件的最下面有3个YOLO层，这里我才放上来了一个，这三个地方的classes做相应修改</span></span><br><span class="line"><span class="comment">#每个YOLO层的上一层的convolutional层的filters也要修改</span></span><br></pre></td></tr></table></figure><h1 id="开始训练"><a href="#开始训练" class="headerlink" title="开始训练"></a>开始训练</h1><p>下载预训练模型（权重）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://pjreddie.com/media/files/darknet53.conv.74</span><br></pre></td></tr></table></figure><p>训练：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./darknet detector train cfg/voc.data cfg/yolov3-voc.cfg darknet53.conv.74</span><br></pre></td></tr></table></figure><h1 id="训练过程参数详解"><a href="#训练过程参数详解" class="headerlink" title="训练过程参数详解"></a>训练过程参数详解</h1><p>Region xx: cfg文件中yolo-layer的索引；</p><p>Avg IOU:当前迭代中，预测的box与标注的box的平均交并比，越大越好，期望数值为1；</p><p>Class: 标注物体的分类准确率，越大越好，期望数值为1；</p><p>obj: 越大越好，期望数值为1；</p><p>No obj: 越小越好；</p><p>.5R: 以IOU=0.5为阈值时候的recall; recall = 检出的正样本/实际的正样本</p><p>0.75R: 以IOU=0.75为阈值时候的recall;</p><p>count:正样本数目。</p><h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ul><li><a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">https://pjreddie.com/darknet/yolo/</a></li><li><a href="https://blog.csdn.net/lilai619/article/details/79695109" target="_blank" rel="noopener">https://blog.csdn.net/lilai619/article/details/79695109</a></li><li><a href="https://zhuanlan.zhihu.com/p/35490655" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/35490655</a></li><li><a href="https://blog.csdn.net/ch_liu23/article/details/53558549" target="_blank" rel="noopener">https://blog.csdn.net/ch_liu23/article/details/53558549</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 深度学习 </category>
          
          <category> yolo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 深度学习 </tag>
            
            <tag> yolo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell-批量重命名的方法总览</title>
      <link href="/2018/06/05/programmings/linux/Shell-%E6%89%B9%E9%87%8F%E9%87%8D%E5%91%BD%E5%90%8D%E7%9A%84%E6%96%B9%E6%B3%95%E6%80%BB%E8%A7%88/"/>
      <url>/2018/06/05/programmings/linux/Shell-%E6%89%B9%E9%87%8F%E9%87%8D%E5%91%BD%E5%90%8D%E7%9A%84%E6%96%B9%E6%B3%95%E6%80%BB%E8%A7%88/</url>
      
        <content type="html"><![CDATA[<h1 id="删除所有的-bak-后缀"><a href="#删除所有的-bak-后缀" class="headerlink" title="删除所有的 .bak 后缀"></a>删除所有的 .bak 后缀</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="string">'s/\.bak$//'</span> *.bak</span><br></pre></td></tr></table></figure><h1 id="把-JPEG-文件后缀修改为-jpg"><a href="#把-JPEG-文件后缀修改为-jpg" class="headerlink" title="把 .JPEG 文件后缀修改为 .jpg"></a>把 .JPEG 文件后缀修改为 .jpg</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="string">'s/\.JPEG$/\.jpg/'</span> *.JPEG</span><br></pre></td></tr></table></figure><h1 id="把所有文件的文件名改为小写"><a href="#把所有文件的文件名改为小写" class="headerlink" title="把所有文件的文件名改为小写"></a>把所有文件的文件名改为小写</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="string">'y/A-Z/a-z/'</span> *</span><br></pre></td></tr></table></figure><h1 id="将-abcd-jpg-重命名为-abcd-efg-jpg"><a href="#将-abcd-jpg-重命名为-abcd-efg-jpg" class="headerlink" title="将 abcd.jpg 重命名为 abcd_efg.jpg"></a>将 abcd.jpg 重命名为 abcd_efg.jpg</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> *.jpg; <span class="keyword">do</span> mv <span class="string">"<span class="variable">$var</span>"</span> <span class="string">"<span class="variable">$&#123;var%.jpg&#125;</span>_efg.jpg"</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="将-abcd-efg-jpg-重命名为-abcd-lmn-jpg"><a href="#将-abcd-efg-jpg-重命名为-abcd-lmn-jpg" class="headerlink" title="将 abcd_efg.jpg 重命名为 abcd_lmn.jpg"></a>将 abcd_efg.jpg 重命名为 abcd_lmn.jpg</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> *.jpg; <span class="keyword">do</span> mv <span class="string">"<span class="variable">$var</span>"</span> <span class="string">"<span class="variable">$&#123;var%_efg.jpg&#125;</span>_lmn.jpg"</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="把文件名中所有小写字母改为大写字母"><a href="#把文件名中所有小写字母改为大写字母" class="headerlink" title="把文件名中所有小写字母改为大写字母"></a>把文件名中所有小写字母改为大写字母</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> `ls`; <span class="keyword">do</span> mv -f <span class="string">"<span class="variable">$var</span>"</span> `<span class="built_in">echo</span> <span class="string">"<span class="variable">$var</span>"</span> |tr a-z A-Z`; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="把格式-jpg-的文件改为-0-jpg"><a href="#把格式-jpg-的文件改为-0-jpg" class="headerlink" title="把格式 *_?.jpg 的文件改为 *_0?.jpg"></a>把格式 *_?.jpg 的文件改为 *_0?.jpg</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> `ls *_?.jpg`; <span class="keyword">do</span> mv <span class="string">"<span class="variable">$var</span>"</span> `<span class="built_in">echo</span> <span class="string">"<span class="variable">$var</span>"</span> |awk -F <span class="string">'_'</span> <span class="string">'&#123;print $1 "_0" $2&#125;'</span>`; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="把文件名的后四个字母变为-vzomik"><a href="#把文件名的后四个字母变为-vzomik" class="headerlink" title="把文件名的后四个字母变为 vzomik"></a>把文件名的后四个字母变为 vzomik</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> `ls`; <span class="keyword">do</span> mv -f <span class="string">"<span class="variable">$var</span>"</span> `<span class="built_in">echo</span> <span class="string">"<span class="variable">$var</span>"</span> |sed <span class="string">'s/....$/vzomik/'</span>`; <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h1 id="把-txt变成-txt-bak-的后缀"><a href="#把-txt变成-txt-bak-的后缀" class="headerlink" title="把.txt变成.txt_bak 的后缀"></a>把.txt变成.txt_bak 的后缀</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls *.txt|xargs -n1 -i&#123;&#125; mv &#123;&#125; &#123;&#125;_bak</span><br><span class="line"><span class="comment"># xargs -n1 –i&#123;&#125; 类似for循环，-n1意思是一个一个对象的去处理，-i&#123;&#125; 把前面的对象使用&#123;&#125;取代，mv &#123;&#125; &#123;&#125;_bak 相当于 mv 1.txt 1.txt_bak</span></span><br><span class="line"></span><br><span class="line">$ find ./*.txt -<span class="built_in">exec</span> mv &#123;&#125; &#123;&#125;_bak \;  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个命令中也是把&#123;&#125;作为前面find出来的文件的替代符，后面的”\”为”;”的脱意符，不然shell会把分号作为该行命令的结尾.</span></span><br></pre></td></tr></table></figure><h1 id="批量替换文件名"><a href="#批量替换文件名" class="headerlink" title="批量替换文件名"></a>批量替换文件名</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">oldext=<span class="string">"JPG"</span></span><br><span class="line">newext=<span class="string">"jpg"</span></span><br><span class="line">dir=$(<span class="built_in">eval</span> <span class="built_in">pwd</span>)</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> $(ls <span class="variable">$dir</span> | grep .<span class="variable">$oldext</span>)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        name=$(ls <span class="variable">$file</span> | cut -d. -f1)</span><br><span class="line">        mv <span class="variable">$file</span> <span class="variable">$&#123;name&#125;</span>.<span class="variable">$newext</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"change JPG=====&gt;jpg done!"</span></span><br></pre></td></tr></table></figure><p>1.变量oldext和newext分别指定旧的扩展名和新的扩展名。dir指定文件所在目录；</p><p>2.“ls $dir | grep .$oldext”用来在指定目录dir中获取扩展名为旧扩展名的所有文件；</p><p>3.在循环体内先利用cut命令将文件名中“.”之前的字符串剪切出来，并赋值给name变量；接着将当前的文件名重命名为新的文件名。</p><p>通过这个脚本，所有照片的扩展名都成功修改。为了使这个脚本更具有通用型，我们可以增加几条read命令实现脚本和用户之间的交互。改进版的脚本如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"old extension:"</span> oldext</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"new extension:"</span> newext</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"The directory:"</span> dir</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$dir</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> $(ls <span class="variable">$dir</span> | grep .<span class="variable">$oldext</span>)</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        name=$(ls <span class="variable">$file</span> | cut -d. -f1)</span><br><span class="line">        mv <span class="variable">$file</span> <span class="variable">$&#123;name&#125;</span>.<span class="variable">$newext</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$name</span>.<span class="variable">$oldext</span> ====&gt; <span class="variable">$name</span>.<span class="variable">$newext</span>"</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"all files has been modified."</span></span><br></pre></td></tr></table></figure><p>修改后的脚本可以批量修改任意扩展名。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://edsionte.com/techblog/archives/category/shell%e7%bc%96%e7%a8%8b" target="_blank" rel="noopener">http://edsionte.com/techblog/archives/category/shell%e7%bc%96%e7%a8%8b</a></li><li><a href="https://my.oschina.net/musings/blog/380939" target="_blank" rel="noopener">https://my.oschina.net/musings/blog/380939</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Shell </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>colmap-posenet教程</title>
      <link href="/2018/05/17/machine_learning/colmap-posenet%E6%95%99%E7%A8%8B/"/>
      <url>/2018/05/17/machine_learning/colmap-posenet%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Colmap-教程"><a href="#Colmap-教程" class="headerlink" title="Colmap 教程"></a>Colmap 教程</h1><h1 id="Posenet-教程"><a href="#Posenet-教程" class="headerlink" title="Posenet 教程"></a>Posenet 教程</h1><h2 id="转换colmap数据至文本文件"><a href="#转换colmap数据至文本文件" class="headerlink" title="转换colmap数据至文本文件"></a>转换colmap数据至文本文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./colmap-path/build/src/exe/model_converter --input_path ./ --output_path ./ --ouput_type TXT</span><br></pre></td></tr></table></figure><h2 id="根据TXT文件生成posenet的训练数据集和测试数据集"><a href="#根据TXT文件生成posenet的训练数据集和测试数据集" class="headerlink" title="根据TXT文件生成posenet的训练数据集和测试数据集"></a>根据TXT文件生成posenet的训练数据集和测试数据集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on 2017年11月26日</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: teng</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReadLog</span><span class="params">(log_file)</span>:</span></span><br><span class="line">    lines = []</span><br><span class="line">    <span class="keyword">with</span> open(log_file, <span class="string">'r'</span>) <span class="keyword">as</span> fin:</span><br><span class="line">        lines=fin.readlines()</span><br><span class="line">    <span class="keyword">return</span> lines</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    imagesFile = []</span><br><span class="line">    q = []</span><br><span class="line">    loc = []</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    count_data = <span class="number">0</span></span><br><span class="line">    lines = ReadLog(<span class="string">'images.txt'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines[<span class="number">4</span>:]:</span><br><span class="line">        <span class="keyword">if</span> count % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            data = line.strip().split()</span><br><span class="line">            imagesFile.append(str(data[<span class="number">9</span>]))</span><br><span class="line">            q.append([float(data[<span class="number">1</span>]), float(data[<span class="number">2</span>]), float(data[<span class="number">3</span>]), float(data[<span class="number">4</span>])])</span><br><span class="line">            loc.append([float(data[<span class="number">5</span>]), float(data[<span class="number">6</span>]), float(data[<span class="number">7</span>])])</span><br><span class="line">            count_data += <span class="number">1</span></span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    randomTest = []</span><br><span class="line">    randomVal = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(count_data/<span class="number">10</span>)):</span><br><span class="line">        randomTest.append(random.randint(<span class="number">0</span>, count_data<span class="number">-1</span>))</span><br><span class="line">        randomVal.append(random.randint(<span class="number">0</span>, count_data<span class="number">-1</span>))</span><br><span class="line">     </span><br><span class="line">    output = open(<span class="string">'train.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">    output1 = open(<span class="string">'test.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">    output2 = open(<span class="string">'val.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(loc)):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> randomTest:</span><br><span class="line">            output1.write(<span class="string">"images/"</span> + str(imagesFile[i]) + <span class="string">" "</span> + str(loc[i][<span class="number">0</span>]) + <span class="string">" "</span> + \</span><br><span class="line">            str(loc[i][<span class="number">1</span>]) + <span class="string">" "</span> + str(loc[i][<span class="number">2</span>]) + <span class="string">" "</span> + \</span><br><span class="line">                                str(q[i][<span class="number">0</span>]) + <span class="string">" "</span> + str(q[i][<span class="number">1</span>]) + <span class="string">" "</span> + \</span><br><span class="line">                                str(q[i][<span class="number">2</span>]) + <span class="string">" "</span> + str(q[i][<span class="number">3</span>]) + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">elif</span> i <span class="keyword">in</span> randomVal:</span><br><span class="line">            output2.write(<span class="string">"images/"</span> + str(imagesFile[i]) + <span class="string">" "</span> + str(loc[i][<span class="number">0</span>]) + <span class="string">" "</span> + \</span><br><span class="line">            str(loc[i][<span class="number">1</span>]) + <span class="string">" "</span> + str(loc[i][<span class="number">2</span>]) + <span class="string">" "</span> + \</span><br><span class="line">                                str(q[i][<span class="number">0</span>]) + <span class="string">" "</span> + str(q[i][<span class="number">1</span>]) + <span class="string">" "</span> + \</span><br><span class="line">                                str(q[i][<span class="number">2</span>]) + <span class="string">" "</span> + str(q[i][<span class="number">3</span>]) + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output.write(<span class="string">"images/"</span> + str(imagesFile[i]) + <span class="string">" "</span> + str(loc[i][<span class="number">0</span>]) + <span class="string">" "</span> + \</span><br><span class="line">            str(loc[i][<span class="number">1</span>]) + <span class="string">" "</span> + str(loc[i][<span class="number">2</span>]) + <span class="string">" "</span> + \</span><br><span class="line">                                str(q[i][<span class="number">0</span>]) + <span class="string">" "</span> + str(q[i][<span class="number">1</span>]) + <span class="string">" "</span> + \</span><br><span class="line">                                str(q[i][<span class="number">2</span>]) + <span class="string">" "</span> + str(q[i][<span class="number">3</span>]) + <span class="string">"\n"</span>)</span><br><span class="line">    output.close()</span><br><span class="line">    output1.close()</span><br><span class="line">    output2.close()</span><br></pre></td></tr></table></figure><h1 id="posenet-教程"><a href="#posenet-教程" class="headerlink" title="posenet 教程"></a>posenet 教程</h1><h2 id="生成lmdb文件"><a href="#生成lmdb文件" class="headerlink" title="生成lmdb文件"></a>生成lmdb文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">caffe_root = <span class="string">'/home/teng/programmings/semap/caffe-posenet/'</span>  <span class="comment"># Change to your directory to caffe-posenet</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.insert(<span class="number">0</span>, caffe_root + <span class="string">'python'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> lmdb</span><br><span class="line"><span class="keyword">import</span> caffe</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">directory = <span class="string">'/home/teng/programmings/semap/caffe-posenet/posenet/models/611/'</span></span><br><span class="line">dataset = <span class="string">'train.txt'</span></span><br><span class="line"></span><br><span class="line">poses = []</span><br><span class="line">images = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(directory+dataset) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        fname, p0,p1,p2,p3,p4,p5,p6 = line.split()</span><br><span class="line">        p0 = float(p0)</span><br><span class="line">        p1 = float(p1)</span><br><span class="line">        p2 = float(p2)</span><br><span class="line">        p3 = float(p3)</span><br><span class="line">        p4 = float(p4)</span><br><span class="line">        p5 = float(p5)</span><br><span class="line">        p6 = float(p6)</span><br><span class="line">        poses.append((p0,p1,p2,p3,p4,p5,p6))</span><br><span class="line">        images.append(directory+fname)</span><br><span class="line"></span><br><span class="line">r = list(range(len(images)))</span><br><span class="line"><span class="keyword">print</span> r</span><br><span class="line"><span class="keyword">print</span> <span class="string">'r = \n'</span></span><br><span class="line">random.shuffle(r)</span><br><span class="line"><span class="keyword">print</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Creating PoseNet Dataset.'</span></span><br><span class="line">env = lmdb.open(<span class="string">'train_lmdb'</span>, map_size=int(<span class="number">1e12</span>))</span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">    print(<span class="string">'i = &#123;&#125;, r = &#123;&#125;'</span>).format(i, len(r))</span><br><span class="line">    <span class="keyword">if</span> (count+<span class="number">1</span>) % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Saving image: '</span>, count+<span class="number">1</span></span><br><span class="line">    X = cv2.imread(images[i])</span><br><span class="line">    print(<span class="string">'images[i] = \n X = &#123;&#125;'</span>).format(images[i], X)</span><br><span class="line">    X = cv2.resize(X, (<span class="number">455</span>,<span class="number">256</span>))    <span class="comment"># to reproduce PoseNet results, please resize the images so that the shortest side is 256 pixels</span></span><br><span class="line">    X = np.transpose(X,(<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">    im_dat = caffe.io.array_to_datum(np.array(X).astype(np.uint8))</span><br><span class="line">    im_dat.float_data.extend(poses[i])</span><br><span class="line">    str_id = <span class="string">'&#123;:0&gt;10d&#125;'</span>.format(count)</span><br><span class="line">    <span class="keyword">with</span> env.begin(write=<span class="keyword">True</span>) <span class="keyword">as</span> txn:</span><br><span class="line">        txn.put(str_id, im_dat.SerializeToString())</span><br><span class="line">    count = count+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">env.close()</span><br></pre></td></tr></table></figure><h3 id="test文件"><a href="#test文件" class="headerlink" title="test文件"></a>test文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">caffe_root = <span class="string">'/home/teng/programmings/semap/caffe-posenet/'</span>  <span class="comment"># Change to your directory to caffe-posenet</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.insert(<span class="number">0</span>, caffe_root + <span class="string">'python'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> lmdb</span><br><span class="line"><span class="keyword">import</span> caffe</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">directory = <span class="string">'/home/teng/programmings/semap/caffe-posenet/posenet/models/611/'</span></span><br><span class="line">dataset = <span class="string">'test.txt'</span></span><br><span class="line"></span><br><span class="line">poses = []</span><br><span class="line">images = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(directory+dataset) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        fname, p0,p1,p2,p3,p4,p5,p6 = line.split()</span><br><span class="line">        p0 = float(p0)</span><br><span class="line">        p1 = float(p1)</span><br><span class="line">        p2 = float(p2)</span><br><span class="line">        p3 = float(p3)</span><br><span class="line">        p4 = float(p4)</span><br><span class="line">        p5 = float(p5)</span><br><span class="line">        p6 = float(p6)</span><br><span class="line">        poses.append((p0,p1,p2,p3,p4,p5,p6))</span><br><span class="line">        images.append(directory+fname)</span><br><span class="line"></span><br><span class="line">r = list(range(len(images)))</span><br><span class="line"><span class="keyword">print</span> r</span><br><span class="line"><span class="keyword">print</span> <span class="string">'r = \n'</span></span><br><span class="line">random.shuffle(r)</span><br><span class="line"><span class="keyword">print</span> r</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Creating PoseNet Dataset.'</span></span><br><span class="line">env = lmdb.open(<span class="string">'test_lmdb'</span>, map_size=int(<span class="number">1e12</span>))</span><br><span class="line"></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">    print(<span class="string">'i = &#123;&#125;, r = &#123;&#125;'</span>).format(i, len(r))</span><br><span class="line">    <span class="keyword">if</span> (count+<span class="number">1</span>) % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Saving image: '</span>, count+<span class="number">1</span></span><br><span class="line">    X = cv2.imread(images[i])</span><br><span class="line">    print(<span class="string">'images[i] = \n X = &#123;&#125;'</span>).format(images[i], X)</span><br><span class="line">    X = cv2.resize(X, (<span class="number">455</span>,<span class="number">256</span>))    <span class="comment"># to reproduce PoseNet results, please resize the images so that the shortest side is 256 pixels</span></span><br><span class="line">    X = np.transpose(X,(<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">    im_dat = caffe.io.array_to_datum(np.array(X).astype(np.uint8))</span><br><span class="line">    im_dat.float_data.extend(poses[i])</span><br><span class="line">    str_id = <span class="string">'&#123;:0&gt;10d&#125;'</span>.format(count)</span><br><span class="line">    <span class="keyword">with</span> env.begin(write=<span class="keyword">True</span>) <span class="keyword">as</span> txn:</span><br><span class="line">        txn.put(str_id, im_dat.SerializeToString())</span><br><span class="line">    count = count+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">env.close()</span><br></pre></td></tr></table></figure><h2 id="计算均值文件"><a href="#计算均值文件" class="headerlink" title="计算均值文件"></a>计算均值文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./caffe-posenet-path/build/tools/compute_image_mean train_lmdb/ train.binaryproto</span><br><span class="line">$ ./caffe-posenet-path/biuld/tools/compute_image_mean test_lmdb/ test.binaryproto</span><br></pre></td></tr></table></figure><h2 id="修改训练配置文件"><a href="#修改训练配置文件" class="headerlink" title="修改训练配置文件"></a>修改训练配置文件</h2><h3 id="修改-train-bayesian-posenet-prototxt"><a href="#修改-train-bayesian-posenet-prototxt" class="headerlink" title="修改 train_bayesian_posenet.prototxt"></a>修改 train_bayesian_posenet.prototxt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">name: <span class="string">"GoogLeNet"</span></span><br><span class="line">layers &#123;</span><br><span class="line">  top: <span class="string">"data"</span></span><br><span class="line">  top: <span class="string">"label"</span></span><br><span class="line">  name: <span class="string">"data"</span></span><br><span class="line">  <span class="built_in">type</span>: DATA</span><br><span class="line">  data_param &#123;</span><br><span class="line">    <span class="built_in">source</span>: <span class="string">"/home/teng/programmings/semap/caffe-posenet/posenet/models/611/lmdb/train_lmdb/"</span> <span class="comment"># revised</span></span><br><span class="line">    batch_size: 64</span><br><span class="line">    backend: LMDB</span><br><span class="line">  &#125;</span><br><span class="line">  include &#123;</span><br><span class="line">    phase: TRAIN</span><br><span class="line">  &#125;</span><br><span class="line">  transform_param &#123;</span><br><span class="line">    mirror: <span class="literal">false</span></span><br><span class="line">    crop_size: 224</span><br><span class="line">    mean_file: <span class="string">"/home/teng/programmings/semap/caffe-posenet/posenet/models/611/lmdb/train.binaryproto"</span> <span class="comment"># revised</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layers &#123;</span><br><span class="line">  top: <span class="string">"data"</span></span><br><span class="line">  top: <span class="string">"label"</span></span><br><span class="line">  name: <span class="string">"data"</span></span><br><span class="line">  <span class="built_in">type</span>: DATA</span><br><span class="line">  data_param &#123;</span><br><span class="line">    <span class="built_in">source</span>: <span class="string">"/home/teng/programmings/semap/caffe-posenet/posenet/models/611/lmdb/test_lmdb"</span> <span class="comment"># revised</span></span><br><span class="line">    batch_size: 32</span><br><span class="line">    backend: LMDB</span><br><span class="line">  &#125;</span><br><span class="line">  include &#123;</span><br><span class="line">    phase: TEST</span><br><span class="line">  &#125;</span><br><span class="line">  transform_param &#123;</span><br><span class="line">    mirror: <span class="literal">false</span></span><br><span class="line">    crop_size: 224</span><br><span class="line">    mean_file: <span class="string">"/home/teng/programmings/semap/caffe-posenet/posenet/models/611/lmdb/test.binaryproto"</span> <span class="comment"># revised</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layers &#123;</span><br><span class="line">    name: <span class="string">"slice_label"</span></span><br><span class="line">    <span class="built_in">type</span>: SLICE</span><br><span class="line">    bottom: <span class="string">"label"</span></span><br><span class="line">    top: <span class="string">"label_xyz"</span></span><br><span class="line">    top: <span class="string">"label_wpqr"</span></span><br><span class="line">    slice_param &#123;</span><br><span class="line">        slice_dim: 1</span><br><span class="line">        slice_point: 3</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="修改-solver-bayesian-posenet-prototxt"><a href="#修改-solver-bayesian-posenet-prototxt" class="headerlink" title="修改 solver_bayesian_posenet.prototxt"></a>修改 solver_bayesian_posenet.prototxt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">net: <span class="string">"/home/teng/programmings/semap/caffe-posenet/posenet/models/611/train/ train_bayesian_posenet.prototxt"</span> <span class="comment">#训练或者测试配置文件</span></span><br><span class="line">test_initialization: <span class="literal">false</span></span><br><span class="line">test_iter: 7 <span class="comment">#完成一次测试需要的迭代次数</span></span><br><span class="line">test_interval: 36 <span class="comment">#测试间隔</span></span><br><span class="line">base_lr: 0.00001 <span class="comment">#基础学习率</span></span><br><span class="line">lr_policy: <span class="string">"step"</span> <span class="comment">#学习率变化规律</span></span><br><span class="line">gamma: 0.9 <span class="comment">#学习率变化指数</span></span><br><span class="line">stepsize: 20000 <span class="comment">#学习率变化频率</span></span><br><span class="line">momentum: 0.9 <span class="comment">#动量</span></span><br><span class="line">display: 20 <span class="comment">#屏幕显示间隔</span></span><br><span class="line">max_iter: 120000 <span class="comment">#最大迭代次数</span></span><br><span class="line">solver_type: SGD</span><br><span class="line">weight_decay: 0.005 <span class="comment">#权重衰减</span></span><br><span class="line">snapshot: 5000 <span class="comment">#保存模型间隔</span></span><br><span class="line">snapshot_prefix: <span class="string">"/home/teng/programmings/semap/caffe-posenet/posenet/models/611/train/models/posenet"</span> <span class="comment">#权重衰减</span></span><br><span class="line">solver_mode: GPU <span class="comment">#是否使用GPU</span></span><br></pre></td></tr></table></figure><p>解释：</p><p>训练样本</p><p>总共:2280个</p><p>batch_szie:64</p><p>将所有样本处理完一次（称为一代，即epoch)需要：2280/64=36 次迭代才能完成</p><p>所以这里将test_interval设置为36，即处理完一次所有的训练数据后，才去进行测试。所以这个数要大于等于36.<br>如果想训练100代，则最大迭代次数为3600；</p><p>测试样本</p><p>同理，如果有212个测试样本，batch_size为32，那么需要7次才能完整的测试一次。 所以test_iter为7；这个数要大于等于7.</p><p>学习率</p><p>学习率变化规律我们设置为随着迭代次数的增加，慢慢变低。总共迭代120000次，我们将变化6次，所以stepsize设置为120000/6=20000，即每迭代20000次，我们就降低一次学习率。</p><h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./caffe-posenet-path/build/tools/caffe train -solver=examples/mnist/lenet_solver.prototxt 2&gt;&amp;1 | tee <span class="built_in">log</span></span><br><span class="line"><span class="comment"># 从中断点的 snapshot 继续训练</span></span><br><span class="line">$ ./caffe-posenet-path/build/tools/caffe train -solver examples/mnist/lenet_solver.prototxt -snapshot examples/mnist/lenet_iter_5000.solverstate</span><br><span class="line"><span class="comment"># 观察各个阶段的运行时间可以使用</span></span><br><span class="line">$ ./caffe-posenet-path/build/tools/caffe time -model examples/mnist/lenet_train_test.prototxt -iterations 10</span><br><span class="line"><span class="comment"># 使用已有模型提取特征</span></span><br><span class="line">$ ./caffe-posenet-path/build/tools/extract_features.bin models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel examples/feature_extraction/train_val.prototxt fc7 examples/temp_features 10 lmdb</span><br></pre></td></tr></table></figure><p>1） fc7表示提取全连接第七层特征，conv5表示提取第五个卷积层的特征， examples/temp_features表示存放结果的目录（目录不需要提前构建）</p><p>2.）10：输入的包的数量，我们test时的batchsize是50，这里输入10，表示会提取50*10=500张图片的特征</p><p>3.）imageNet网络有很多层（data conv1 conv2 conv3 conv4 conv5 fc6 fc7 fc8 prob），我们可以选取任意一层；fc7是最后一层特征，fc8输出的就是softmax的输出了，所以提取fc7层</p><p>4.）lmdb：输出的数据格式是lmdb，还可以是leveldb</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> colmap-posenet </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> colmap-posenet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-深度学习环境配置-Centos</title>
      <link href="/2018/04/08/machine_learning/linux-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-Centos/"/>
      <url>/2018/04/08/machine_learning/linux-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-Centos/</url>
      
        <content type="html"><![CDATA[<h1 id="Centos-7-环境安装"><a href="#Centos-7-环境安装" class="headerlink" title="Centos 7 环境安装"></a>Centos 7 环境安装</h1><p>下载<a href="https://www.centos.org/download/" target="_blank" rel="noopener">Centos 7</a>安装镜像，制作启动优盘。</p><p>Install CentOS 7 安装CentOS 7。</p><ul><li><p>第一步，配置日期、语言和键盘。</p></li><li><p>第二步，选择-系统-安装位置，进入磁盘分区界面。选择-其它存储选项-分区-我要配置分区，点左上角的“完成”，进入下面的界面:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分区前先规划好:</span></span><br><span class="line"><span class="comment"># swap #交换分区，一般设置为内存的2倍</span></span><br><span class="line"><span class="comment"># / #剩余所有空间</span></span><br><span class="line"><span class="comment"># 挂载点：swap, 期望容量：2048</span></span><br></pre></td></tr></table></figure><p>点左上角的“完成”，接受更改。</p><ul><li><p>第三步，在这步中，你可以通过选择列表中安全配置来设置你的系统“安全策略Security Policy”，点击选择配置按钮来选择你想要的安全配置并点击“应用安全策略Apply security policy”按钮到 On。点击“完成Done”按钮后继续安装流程。</p></li><li><p>第四步，点击“软件选择Software Selection”按钮来配置你的基础机器环境。左边的列表是你可以选择安装桌面环境（Gnome、KDE Plasma 或者创意工作站）或者安装一个服务器环境（Web 服务器、计算节点、虚拟化主机、基础设施服务器、带图形界面的服务器或者文件及打印服务器）或者执行一个最小化的安装。为了随后能自定义你的系统，选择最小化安装并附加兼容库，点击“完成Done”按钮继续。对于完整的 Gnome 或者 KDE 桌面环境。选择：</p><ul><li>GNOM Applications</li><li>Internet Applications</li><li>Compatibility Libries</li><li>Compatibility Libries</li></ul></li><li><p>第五步，设置你的主机名并启用网络服务。点击“网络和主机名Network &amp; Hostname”，在主机名中输入你的 FQDN（完整限定网域名称），如果你在局域网中有一个 DHCP 服务器，将以太网按钮从 OFF 切换到 ON 来激活网络接口。为了静态配置你的网络接口，点击“配置Configure”按钮，添加 IP 设置，并点击“保存Save”按钮来应用更改。完成后，点击“完成Done”按钮来回到主安装菜单。</p></li><li><p>第六步，最后检查下所有到目前为止的配置，如果一切没问题，点击“开始安装Begin Installation”按钮开始安装</p></li></ul><h1 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h1><h2 id="Centos-7-更换阿里源"><a href="#Centos-7-更换阿里源" class="headerlink" title="Centos 7 更换阿里源"></a>Centos 7 更换阿里源</h2><p>备份</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure><p>下载新的CentOS-Base.repo 到/etc/yum.repos.d/</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 5</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 6</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># CentOS 7</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>之后运行yum makecache生成缓存.</p><h2 id="安装常用工具"><a href="#安装常用工具" class="headerlink" title="安装常用工具"></a>安装常用工具</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nano vim wget curl net-tools lsof gcc gcc-c++ll</span><br></pre></td></tr></table></figure><p>等待安装完成即可。如果提示有错可以执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>重建缓存即可。</p><h1 id="NVIDIA显卡驱动安装"><a href="#NVIDIA显卡驱动安装" class="headerlink" title="NVIDIA显卡驱动安装"></a>NVIDIA显卡驱动安装</h1><h2 id="检查是否安装了GPU"><a href="#检查是否安装了GPU" class="headerlink" title="检查是否安装了GPU"></a>检查是否安装了GPU</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i nvidia</span><br></pre></td></tr></table></figure><h2 id="安装kernel-devel和kernel-headers"><a href="#安装kernel-devel和kernel-headers" class="headerlink" title="安装kernel-devel和kernel-headers"></a>安装kernel-devel和kernel-headers</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install kernel-devel  </span><br><span class="line">yum install kernel-headers</span><br></pre></td></tr></table></figure><h2 id="修改-etc-modprobe-d-blacklist-conf-文件，以阻止-nouveau-模块的加载"><a href="#修改-etc-modprobe-d-blacklist-conf-文件，以阻止-nouveau-模块的加载" class="headerlink" title="修改/etc/modprobe.d/blacklist.conf 文件，以阻止 nouveau 模块的加载"></a>修改/etc/modprobe.d/blacklist.conf 文件，以阻止 nouveau 模块的加载</h2><p>方法： 添加blacklist nouveau，注释掉blacklist nvidiafb（如果存在）<br>blacklist.conf不存在时，执行下面的脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo -e "blacklist nouveau\noptions nouveau modeset=0" &gt; /etc/modprobe.d/blacklist.conf</span></span><br></pre></td></tr></table></figure><h2 id="重新建立initramfs-image文件"><a href="#重新建立initramfs-image文件" class="headerlink" title="重新建立initramfs image文件"></a>重新建立initramfs image文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.bak</span></span><br><span class="line"><span class="comment"># dracut /boot/initramfs-$(uname -r).img $(uname -r)</span></span><br></pre></td></tr></table></figure><h2 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + Alt +F2    <span class="comment">#纯文本命令模式  </span></span><br><span class="line">登陆----获取root权限  </span><br><span class="line">init 3  </span><br><span class="line">切换至安装包文件夹  </span><br><span class="line">./NVIDIA-Linux-x86_64-375.66.run   <span class="comment">#根据提示安装  </span></span><br><span class="line">cuda_8.0.61_375.26_linux.run   <span class="comment">#根据提示安装</span></span><br></pre></td></tr></table></figure><h2 id="安装cuda"><a href="#安装cuda" class="headerlink" title="安装cuda"></a>安装cuda</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -i cuda-repo-rhel7-8-0-local-ga2-8.0.61-1.x86_64.rpm</span><br><span class="line">$ sudo yum clean all</span><br><span class="line">$ sudo yum install cuda</span><br></pre></td></tr></table></figure><p>报错了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error: Package: 1:nvidia-kmod-375.26-2.el7.x86_64 (cuda-8-0-local-ga2)</span><br><span class="line">           Requires: dkms</span><br><span class="line"> You could try using --skip-broken to work around the problem</span><br><span class="line"> You could try running: rpm -Va --nofiles --nodigest</span><br></pre></td></tr></table></figure><p>缺少2个包，装第一个：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/yum.repos.d/linuxtech.testing.repo</span><br></pre></td></tr></table></figure><p>输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[linuxtech-testing]</span><br><span class="line">name=LinuxTECH Testing</span><br><span class="line">baseurl=http://pkgrepo.linuxtech.net/el6/testing/</span><br><span class="line">enabled=0</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://pkgrepo.linuxtech.net/el6/release/RPM-GPG-KEY-LinuxTECH.NET</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum --enablerepo=linuxtech-testing install libvdpau</span><br></pre></td></tr></table></figure><p>第二个：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install --enablerepo=epel dkms</span><br></pre></td></tr></table></figure><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gedit ~/.bashrc </span><br><span class="line"><span class="comment">#写入bashrc文件保存  </span></span><br><span class="line"><span class="comment">#gpu driver  </span></span><br><span class="line"><span class="built_in">export</span> CUDA_HOME=/usr/<span class="built_in">local</span>/cuda-8.0  </span><br><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda-8.0/bin:<span class="variable">$PATH</span>  </span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/cuda-8.0/lib64:<span class="variable">$LD_LIBRARY_PATH</span>  </span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="string">"/usr/local/cuda-8.0/lib:<span class="variable">$&#123;LD_LIBRARY_PATH&#125;</span>"</span> </span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://my.oschina.net/u/2449787/blog/778145" target="_blank" rel="noopener">https://my.oschina.net/u/2449787/blog/778145</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Linux </category>
          
          <category> 环境配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Linux </tag>
            
            <tag> 环境配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git教程</title>
      <link href="/2018/04/06/programmings/linux/git%E6%95%99%E7%A8%8B/"/>
      <url>/2018/04/06/programmings/linux/git%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Github常用命令总结"><a href="#Github常用命令总结" class="headerlink" title="Github常用命令总结"></a>Github常用命令总结</h1><h2 id="远程仓库的使用"><a href="#远程仓库的使用" class="headerlink" title="远程仓库的使用"></a>远程仓库的使用</h2><p>本小节将远程仓库变为自己可推送数据的仓库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://github.com/schacon/ticgit.git</span><br><span class="line">$ <span class="built_in">cd</span> grit</span><br><span class="line">$ git remote -v</span><br><span class="line">$ git remote add pb git://github.com/paulboone/ticgit.git</span><br><span class="line">$ git fetch pb</span><br><span class="line">$ git push origin master</span><br><span class="line">$ git remote show origin</span><br></pre></td></tr></table></figure><h1 id="Git命令总结"><a href="#Git命令总结" class="headerlink" title="Git命令总结"></a>Git命令总结</h1><ul><li>git init  命令把这个目录变成Git可以管理的仓库</li><li>git add  文件添加到仓库</li><li>git commit  文件提交到仓库</li><li>git log  历史记录</li><li>git log —pretty=oneline  历史记录</li><li>HEAD  当前版本</li><li>HEAD^  上一个版本</li><li>HEAD^^  上上一个版本</li><li>HEAD~100  往上100个版本</li><li>git reset —hard HEAD^  回退到上一个版本</li><li>git reflog  记录你的每一次命令</li><li>git diff HEAD — readme.txt  查看工作区和版本库里面最新版本的区别</li><li>git status  版本的状态</li><li>git checkout — file  丢弃工作区的修改</li><li>git reset HEAD file  暂存区的修改撤销掉（unstage），重新放回工作区</li><li>git reset  既可以回退版本，也可以把暂存区的修改回退到工作区</li><li>git rm  从版本库中删除该文件</li><li>git remote add origin git@github.com:michaelliao/learngit.git  关联远程库</li><li>git push -u origin master  本地库的所有内容推送到远程库上</li><li>git push  本地库的内容推送到远程</li><li>git push origin master  推送最新修改</li><li>git clone git@github.com:michaelliao/gitskills.git  克隆一个本地库</li><li>git checkout -b dev  创建dev分支，然后切换到dev分支</li><li>git branch  查看当前分支</li><li>git checkout master  切换回master分支</li><li>git merge dev  把dev分支的工作成果合并到master分支上</li><li>git merge  合并指定分支到当前分支</li><li>git branch -d dev  删除dev分支</li><li>git branch <name>  创建分支</name></li><li>git checkout <name>  切换分支</name></li><li>git log —grap  分支合并图</li><li>git merge —no-ff -m “merge with no-ff” dev  强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息</li><li>git stash  把当前工作现场“储藏”起来，等以后恢复现场后继续工作</li><li>git stash list  工作现场</li><li>git stash apply  恢复stash内容并不删除</li><li>git stash drop  删除工作现场</li><li>git stash pop  恢复的同时把stash内容也删了</li><li>git branch -D <name>  丢弃一个没有被合并过的分支</name></li><li>git remote  查看远程库的信息</li><li>git remote -v  显示更详细的信息</li><li>git pull  最新的提交从origin/dev抓下来</li><li>git branch —set-upstream dev origin/dev  git pull也失败了，原因是没有指定本地dev分支与远程origin/dev分支的链接，根据提示，设置dev和origin/dev的链接，建立本地分支和远程分支的关联</li><li>git checkout -b branch-name origin/branch-name  在本地创建和远程分支对应的分支，本地和远程分支的名称最好一致</li><li>git tag <name>  打一个新标签</name></li><li>git tag  查看所有标签</li><li>git log —pretty=oneline —abbrev-commit  找到历史提交的commit id</li><li>git show <tagname>  查看标签信息</tagname></li><li>git tag -a <tagname> -m “blablabla…”  指定标签信息</tagname></li><li>git tag -s <tagname> -m “blablabla…”  用PGP签名标签</tagname></li><li>git push origin <tagname>  推送某个标签到远程</tagname></li><li>git push origin —tags  一次性推送全部尚未推送到远程的本地标签</li><li>git tag -d <tagname>  删除一个本地标签</tagname></li><li>git push origin :refs/tags/<tagname>  删除一个远程标签</tagname></li><li>git config —global alias.st status  告诉Git，以后st就表示status </li></ul><h1 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h1><ul><li><p>Linux上安装Git</p><p>  $ sudo apt-get install git</p></li><li><p>Mac OS X上安装Git</p><p>  $ brew install git</p></li><li><p>Windows上安装Git</p><p>  在Windows上使用Git，可以从Git官网直接下载安装程序，（网速慢的同学请移步国内镜像），然后按默认选项安装即可。</p><p>  安装完成后，在开始菜单里找到“Git”-&gt;“Git Bash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功！</p></li><li><p>安装完成后，还需要最后一步设置，在命令行输入：</p><p>  $ git config —global user.name “Your Name”</p><p>  $ git config —global user.email “email@example.com”</p><p>  因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。你也许会担心，如果有人故意冒充别人怎么办？这个不必担心，首先我们相信大家都是善良无知的群众，其次，真的有冒充的也是有办法可查的。</p><p>  注意git config命令的—global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p></li></ul><h1 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h1><p>版本库又名仓库，英文名repository。首先，选择一个合适的地方，创建一个空目录：</p><pre><code>$ mkdir learngit$ cd learngit$ pwd/Users/michael/learngit</code></pre><p>第二步，通过git init命令把这个目录变成Git可以管理的仓库：</p><pre><code>$ git initInitialized empty Git repository in /Users/michael/learngit/.git/</code></pre><p>瞬间Git就把仓库建好了，而且告诉你是一个空的仓库（empty Git repository），细心的读者可以发现当前目录下多了一个.git的目录，这个目录是Git来跟踪管理版本库的，没事千万不要手动修改这个目录里面的文件，不然改乱了，就把Git仓库给破坏了。</p><p>如果你没有看到.git目录，那是因为这个目录默认是隐藏的，用ls -ah命令就可以看见。</p><p>把文件添加到版本库,现在我们编写一个readme.txt文件，内容如下：</p><pre><code>Git is a version control system.Git is free software.</code></pre><p>用命令git add告诉Git，把文件添加到仓库：</p><pre><code>$ git add readme.txt</code></pre><p>执行上面的命令，没有任何显示，这就对了，Unix的哲学是“没有消息就是好消息”，说明添加成功。</p><p>用命令git commit告诉Git，把文件提交到仓库：</p><pre><code>$ git commit -m &quot;wrote a readme file&quot;[master (root-commit) cb926e7] wrote a readme file1 file changed, 2 insertions(+)create mode 100644 readme.txt</code></pre><p>简单解释一下git commit命令，-m后面输入的是本次提交的说明，可以输入任意内容，当然最好是有意义的，这样你就能从历史记录里方便地找到改动记录。</p><p>git commit命令执行成功后会告诉你，1个文件被改动（我们新添加的readme.txt文件），插入了两行内容（readme.txt有两行内容）。</p><p>为什么Git添加文件需要add，commit一共两步呢？因为commit可以一次提交很多文件，所以你可以多次add不同的文件，比如：</p><pre><code>$ git add file1.txt$ git add file2.txt file3.txt$ git commit -m &quot;add 3 files.&quot;</code></pre><h1 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h1><p>在实际工作中，我们脑子里怎么可能记得一个几千行的文件每次都改了什么内容，不然要版本控制系统干什么。版本控制系统肯定有某个命令可以告诉我们历史记录，在Git中，我们用git log命令查看</p><pre><code>$ git logcommit 3628164fb26d48395383f8f31179f24e0882e1e0Author: Michael Liao &lt;askxuefeng@gmail.com&gt;Date:   Tue Aug 20 15:11:49 2013 +0800append GPLcommit ea34578d5496d7dd233c827ed32a8cd576c5ee85Author: Michael Liao &lt;askxuefeng@gmail.com&gt;Date:   Tue Aug 20 14:53:12 2013 +0800add distributedcommit cb926e7ea50ad11b8f9e909c05226233bf755030Author: Michael Liao &lt;askxuefeng@gmail.com&gt;Date:   Mon Aug 19 17:51:55 2013 +0800wrote a readme file</code></pre><p>git log命令显示从最近到最远的提交日志，我们可以看到3次提交，最近的一次是append GPL，上一次是add distributed，最早的一次是wrote a readme file。<br>如果嫌输出信息太多，看得眼花缭乱的，可以试试加上—pretty=oneline参数：</p><pre><code>$ git log --pretty=oneline3628164fb26d48395383f8f31179f24e0882e1e0 append GPLea34578d5496d7dd233c827ed32a8cd576c5ee85 add distributedcb926e7ea50ad11b8f9e909c05226233bf755030 wrote a readme file</code></pre><p>需要友情提示的是，你看到的一大串类似3628164…882e1e0的是commit id（版本号），和SVN不一样，Git的commit id不是1，2，3……递增的数字，而是一个SHA1计算出来的一个非常大的数字，用十六进制表示，而且你看到的commit id和我的肯定不一样，以你自己的为准。为什么commit id需要用这么一大串数字表示呢？因为Git是分布式的版本控制系统，后面我们还要研究多人在同一个版本库里工作，如果大家都用1，2，3……作为版本号，那肯定就冲突了。</p><p>好了，现在我们启动时光穿梭机，准备把readme.txt回退到上一个版本，也就是“add distributed”的那个版本，怎么做呢？</p><p>首先，Git必须知道当前版本是哪个版本，在Git中，用HEAD表示当前版本，也就是最新的提交3628164…882e1e0（注意我的提交ID和你的肯定不一样），上一个版本就是HEAD^，上上一个版本就是HEAD^^，当然往上100个版本写100个^比较容易数不过来，所以写成HEAD~100。</p><p>现在，我们要把当前版本“append GPL”回退到上一个版本“add distributed”，就可以使用git reset命令：</p><pre><code>$ git reset --hard HEAD^HEAD is now at ea34578 add distributed</code></pre><p>看看readme.txt的内容是不是版本add distributed：</p><pre><code>$ cat readme.txtGit is a distributed version control system.Git is free software.</code></pre><p>现在，你回退到了某个版本，关掉了电脑，第二天早上就后悔了，想恢复到新版本怎么办？找不到新版本的commit id怎么办？</p><p>在Git中，总是有后悔药可以吃的。当你用$ git reset —hard HEAD^回退到add distributed版本时，再想恢复到append GPL，就必须找到append GPL的commit id。Git提供了一个命令git reflog用来记录你的每一次命令：</p><pre><code>$ git reflogea34578 HEAD@{0}: reset: moving to HEAD^3628164 HEAD@{1}: commit: append GPLea34578 HEAD@{2}: commit: add distributedcb926e7 HEAD@{3}: commit (initial): wrote a readme file</code></pre><h1 id="撤销修改"><a href="#撤销修改" class="headerlink" title="撤销修改"></a>撤销修改</h1><ul><li><p>场景1：当你改乱了工作区某个文件的内容，想直接丢弃工作区的修改时，用命令git checkout — file。</p></li><li><p>场景2：当你不但改乱了工作区某个文件的内容，还添加到了暂存区时，想丢弃修改，分两步，第一步用命令git reset HEAD file，就回到了场景1，第二步按场景1操作。</p></li><li><p>场景3：已经提交了不合适的修改到版本库时，想要撤销本次提交，参考版本回退一节，不过前提是没有推送到远程库。</p></li></ul><h1 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h1><p>一般情况下，你通常直接在文件管理器中把没用的文件删了，或者用rm命令删了</p><p>这个时候，Git知道你删除了文件，因此，工作区和版本库就不一致了，git status命令会立刻告诉你哪些文件被删除了</p><p>现在你有两个选择，一是确实要从版本库中删除该文件，那就用命令git rm删掉，并且git commit：</p><pre><code>$ git rm test.txtrm &#39;test.txt&#39;$ git commit -m &quot;remove test.txt&quot;[master d17efd8] remove test.txt 1 file changed, 1 deletion(-) delete mode 100644 test.txt</code></pre><p> 现在，文件就从版本库中被删除了。</p><p>另一种情况是删错了，因为版本库里还有呢，所以可以很轻松地把误删的文件恢复到最新版本：</p><pre><code>$ git checkout -- test.txt</code></pre><p>git checkout其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。</p><h1 id="添加远程库"><a href="#添加远程库" class="headerlink" title="添加远程库"></a>添加远程库</h1><p>在Repository name填入learngit，其他保持默认设置，点击“Create repository”按钮，就成功地创建了一个新的Git仓库</p><p>目前，在GitHub上的这个learngit仓库还是空的，GitHub告诉我们，可以从这个仓库克隆出新的仓库，也可以把一个已有的本地仓库与之关联，然后，把本地仓库的内容推送到GitHub仓库。</p><p>现在，我们根据GitHub的提示，在本地的learngit仓库下运行命令：</p><pre><code>$ git remote add origin git@github.com:michaelliao/learngit.git</code></pre><p>添加后，远程库的名字就是origin，这是Git默认的叫法，也可以改成别的，但是origin这个名字一看就知道是远程库。</p><p>下一步，就可以把本地库的所有内容推送到远程库上：</p><pre><code>$ git push -u origin masterCounting objects: 19, done.Delta compression using up to 4 threads.Compressing objects: 100% (19/19), done.Writing objects: 100% (19/19), 13.73 KiB, done.</code></pre><p>   Total 23 (delta 6), reused 0 (delta 0)<br>   To git@github.com:michaelliao/learngit.git</p><pre><code> * [new branch]      master -&gt; master Branch master set up to track remote branch master from origin.</code></pre><p>把本地库的内容推送到远程，用git push命令，实际上是把当前分支master推送到远程。</p><p>由于远程库是空的，我们第一次推送master分支时，加上了-u参数，Git不但会把本地的master分支内容推送的远程新的master分支，还会把本地的master分支和远程的master分支关联起来，在以后的推送或者拉取时就可以简化命令。</p><p>从现在起，只要本地作了提交，就可以通过命令：</p><pre><code>$ git push origin master</code></pre><p>把本地master分支的最新修改推送至GitHub</p><h2 id="创建与合并分支"><a href="#创建与合并分支" class="headerlink" title="创建与合并分支"></a>创建与合并分支</h2><ol><li>原理：</li></ol><p>在版本回退里，你已经知道，每次提交，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。HEAD严格来说不是指向提交，而是指向master，master才是指向提交的，所以，HEAD指向的就是当前分支。</p><p>一开始的时候，master分支是一条线，Git用master指向最新的提交，再用HEAD指向master，就能确定当前分支，以及当前分支的提交点，每次提交，master分支都会向前移动一步，这样，随着你不断提交，master分支的线也越来越长</p><p>当我们创建新的分支，例如dev时，Git新建了一个指针叫dev，指向master相同的提交，再把HEAD指向dev，就表示当前分支在dev，你看，Git创建一个分支很快，因为除了增加一个dev指针，改改HEAD的指向，工作区的文件都没有任何变化！不过，从现在开始，对工作区的修改和提交就是针对dev分支了，比如新提交一次后，dev指针往前移动一步，而master指针不变</p><p>假如我们在dev上的工作完成了，就可以把dev合并到master上。Git怎么合并呢？最简单的方法，就是直接把master指向dev的当前提交，就完成了合并，所以Git合并分支也很快！就改改指针，工作区内容也不变！合并完分支后，甚至可以删除dev分支。删除dev分支就是把dev指针给删掉，删掉后，我们就剩下了一条master分支：</p><ol><li>实战</li></ol><p>首先，我们创建dev分支，然后切换到dev分支：</p><pre><code>$ git checkout -b devSwitched to a new branch &#39;dev&#39;</code></pre><p>git checkout命令加上-b参数表示创建并切换，相当于以下两条命令：</p><pre><code>$ git branch dev$ git checkout devSwitched to branch &#39;dev&#39;</code></pre><p>然后，用git branch命令查看当前分支</p><pre><code>$ git branch* dev  master</code></pre><p>git branch命令会列出所有分支，当前分支前面会标一个*号。</p><p>然后，我们就可以在dev分支上正常提交</p><pre><code>$ git add readme.txt $ git commit -m &quot;branch test&quot;[dev fec145a] branch test 1 file changed, 1 insertion(+)</code></pre><p>现在，dev分支的工作完成，我们就可以切换回master分支</p><pre><code>$ git checkout masterSwitched to branch &#39;master&#39;</code></pre><p>切换回master分支后，再查看一个readme.txt文件，刚才添加的内容不见了！因为那个提交是在dev分支上，而master分支此刻的提交点并没有变</p><p>现在，我们把dev分支的工作成果合并到master分支上：</p><pre><code>$ git merge devUpdating d17efd8..fec145aFast-forward readme.txt |    1 + 1 file changed, 1 insertion(+)</code></pre><p>git merge命令用于合并指定分支到当前分支。合并后，再查看readme.txt的内容，就可以看到，和dev分支的最新提交是完全一样的。</p><p>注意到上面的Fast-forward信息，Git告诉我们，这次合并是“快进模式”，也就是直接把master指向dev的当前提交，所以合并速度非常快。</p><p>当然，也不是每次合并都能Fast-forward，我们后面会讲其他方式的合并。</p><p>合并完成后，就可以放心地删除dev分支了：</p><pre><code>$ git branch -d devDeleted branch dev (was fec145a).</code></pre><p>删除后，查看branch，就只剩下master分支了：</p><pre><code>$ git branch* master</code></pre><p>因为创建、合并和删除分支非常快，所以Git鼓励你使用分支完成某个任务，合并后再删掉分支，这和直接在master分支上工作效果是一样的，但过程更安全。</p><ol><li>小结</li></ol><p>Git鼓励大量使用分支：</p><p>查看分支：git branch</p><p>创建分支：git branch <name></name></p><p>切换分支：git checkout <name></name></p><p>创建+切换分支：git checkout -b <name></name></p><p>合并某分支到当前分支：git merge <name></name></p><p>删除分支：git branch -d <name></name></p><h2 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h2><p>当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。</p><p>用git log —graph命令可以看到分支合并图。</p><h2 id="分支管理策略"><a href="#分支管理策略" class="headerlink" title="分支管理策略"></a>分支管理策略</h2><p>通常，合并分支时，如果可能，Git会用Fast forward模式，但这种模式下，删除分支后，会丢掉分支信息。</p><p>如果要强制禁用Fast forward模式，Git就会在merge时生成一个新的commit，这样，从分支历史上就可以看出分支信息。</p><p>下面我们实战一下—no-ff方式的git merge：</p><p>首先，仍然创建并切换dev分支：</p><pre><code>$ git checkout -b devSwitched to a new branch &#39;dev&#39;</code></pre><p>修改readme.txt文件，并提交一个新的commit：</p><pre><code>$ git add readme.txt $ git commit -m &quot;add merge&quot;[dev 6224937] add merge 1 file changed, 1 insertion(+)</code></pre><p>现在，我们切换回master：</p><p>   $ git checkout master<br>   Switched to branch ‘master’<br>准备合并dev分支，请注意—no-ff参数，表示禁用Fast forward：</p><pre><code>$ git merge --no-ff -m &quot;merge with no-ff&quot; devMerge made by the &#39;recursive&#39; strategy. readme.txt |    1 + 1 file changed, 1 insertion(+)</code></pre><p>因为本次合并要创建一个新的commit，所以加上-m参数，把commit描述写进去。</p><p>合并后，我们用git log看看分支历史：</p><pre><code> $ git log --graph --pretty=oneline --abbrev-commit*   7825a50 merge with no-ff|\| * 6224937 add merge|/*   59bc1cb conflict fixed...</code></pre><p>可以看到，不使用Fast forward模式，merge后就像这样：</p><p>分支策略<br>在实际开发中，我们应该按照几个基本原则进行分支管理：</p><p>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面干活；</p><p>那在哪干活呢？干活都在dev分支上，也就是说，dev分支是不稳定的，到某个时候，比如1.0版本发布时，再把dev分支合并到master上，在master分支发布1.0版本；</p><p>你和你的小伙伴们每个人都在dev分支上干活，每个人都有自己的分支，时不时地往dev分支上合并就可以了。</p><h2 id="Bug分支"><a href="#Bug分支" class="headerlink" title="Bug分支"></a>Bug分支</h2><p>软件开发中，bug就像家常便饭一样。有了bug就需要修复，在Git中，由于分支是如此的强大，所以，每个bug都可以通过一个新的临时分支来修复，修复后，合并分支，然后将临时分支删除。当你接到一个修复一个代号101的bug的任务时，很自然地，你想创建一个分支issue-101来修复它，但是，等等，当前正在dev上进行的工作还没有提交，并不是你不想提交，而是工作只进行到一半，还没法提交，预计完成还需1天时间。但是，必须在两个小时内修复该bug，怎么办？</p><p>幸好，Git还提供了一个stash功能，可以把当前工作现场“储藏”起来，等以后恢复现场后继续工作：</p><pre><code>$ git stashSaved working directory and index state WIP on dev: 6224937 add mergeHEAD is now at 6224937 add merge</code></pre><p>现在，用git status查看工作区，就是干净的（除非有没有被Git管理的文件），因此可以放心地创建分支来修复bug。</p><p>首先确定要在哪个分支上修复bug，假定需要在master分支上修复，就从master创建临时分支：</p><pre><code>$ git checkout masterSwitched to branch &#39;master&#39;Your branch is ahead of &#39;origin/master&#39; by 6 commits.$ git checkout -b issue-101Switched to a new branch &#39;issue-101&#39;</code></pre><p>现在修复bug，需要把“Git is free software …”改为“Git is a free software …”，然后提交：</p><pre><code>$ git add readme.txt $ git commit -m &quot;fix bug 101&quot;[issue-101 cc17032] fix bug 101 1 file changed, 1 insertion(+), 1 deletion(-)</code></pre><p>修复完成后，切换到master分支，并完成合并，最后删除issue-101分支：</p><pre><code>$ git checkout masterSwitched to branch &#39;master&#39;Your branch is ahead of &#39;origin/master&#39; by 2 commits.$ git merge --no-ff -m &quot;merged bug fix 101&quot; issue-101Merge made by the &#39;recursive&#39; strategy. readme.txt |    2 +- 1 file changed, 1 insertion(+), 1 deletion(-)$ git branch -d issue-101Deleted branch issue-101 (was cc17032).</code></pre><p>太棒了，原计划两个小时的bug修复只花了5分钟！现在，是时候接着回到dev分支干活了！</p><pre><code>$ git checkout devSwitched to branch &#39;dev&#39;$ git status# On branch devnothing to commit (working directory clean)</code></pre><p>工作区是干净的，刚才的工作现场存到哪去了？用git stash list命令看看：</p><pre><code>$ git stash liststash@{0}: WIP on dev: 6224937 add merge</code></pre><p>工作现场还在，Git把stash内容存在某个地方了，但是需要恢复一下，有两个办法：</p><p>一是用git stash apply恢复，但是恢复后，stash内容并不删除，你需要用git stash drop来删除；</p><p>另一种方式是用git stash pop，恢复的同时把stash内容也删了：</p><pre><code>$ git stash pop# On branch dev# Changes to be committed:#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)##       new file:   hello.py## Changes not staged for commit:#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)##       modified:   readme.txt#Dropped refs/stash@{0} (f624f8e5f082f2df2bed8a4e09c12fd2943bdd40)</code></pre><p>再用git stash list查看，就看不到任何stash内容了：</p><pre><code>$ git stash list</code></pre><p>你可以多次stash，恢复的时候，先用git stash list查看，然后恢复指定的stash，用命令：</p><pre><code>$ git stash apply stash@{0}</code></pre><h2 id="Feature分支"><a href="#Feature分支" class="headerlink" title="Feature分支"></a>Feature分支</h2><p>软件开发中，总有无穷无尽的新的功能要不断添加进来。</p><p>添加一个新功能时，你肯定不希望因为一些实验性质的代码，把主分支搞乱了，所以，每添加一个新功能，最好新建一个feature分支，在上面开发，完成后，合并，最后，删除该feature分支。</p><p>现在，你终于接到了一个新任务：开发代号为Vulcan的新功能，该功能计划用于下一代星际飞船。</p><p>于是准备开发：</p><pre><code>$ git checkout -b feature-vulcanSwitched to a new branch &#39;feature-vulcan&#39;</code></pre><p>5分钟后，开发完毕：</p><pre><code>$ git add vulcan.py$ git status# On branch feature-vulcan# Changes to be committed:#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)##       new file:   vulcan.py#$ git commit -m &quot;add feature vulcan&quot;[feature-vulcan 756d4af] add feature vulcan 1 file changed, 2 insertions(+) create mode 100644 vulcan.py</code></pre><p>切回dev，准备合并：</p><pre><code>$ git checkout dev</code></pre><p>一切顺利的话，feature分支和bug分支是类似的，合并，然后删除。</p><p>但是，就在此时，接到上级命令，因经费不足，新功能必须取消！虽然白干了，但是这个分支还是必须就地销毁：</p><pre><code>$ git branch -d feature-vulcanerror: The branch &#39;feature-vulcan&#39; is not fully merged.If you are sure you want to delete it, run &#39;git branch -D feature-vulcan&#39;.</code></pre><p>销毁失败。Git友情提醒，feature-vulcan分支还没有被合并，如果删除，将丢失掉修改，如果要强行删除，需要使用命令git branch -D feature-vulcan。</p><p>现在我们强行删除：</p><pre><code>$ git branch -D feature-vulcanDeleted branch feature-vulcan (was 756d4af).</code></pre><h2 id="多人协作"><a href="#多人协作" class="headerlink" title="多人协作"></a>多人协作</h2><p>当你从远程仓库克隆时，实际上Git自动把本地的master分支和远程的master分支对应起来了，并且，远程仓库的默认名称是origin。</p><p>要查看远程库的信息，用git remote：</p><pre><code>$ git remoteorigin</code></pre><p>或者，用git remote -v显示更详细的信息</p><p>推送分支，就是把该分支上的所有本地提交推送到远程库。推送时，要指定本地分支，这样，Git就会把该分支推送到远程库对应的远程分支上：</p><pre><code>$ git push origin master</code></pre><p>如果要推送其他分支，比如dev，就改成：</p><pre><code>$ git push origin dev</code></pre><p>当你的小伙伴从远程库clone时，默认情况下，你的小伙伴只能看到本地的master分支。不信可以用git branch命令看看：</p><pre><code>$ git branch* master* </code></pre><p>现在，你的小伙伴要在dev分支上开发，就必须创建远程origin的dev分支到本地，于是他用这个命令创建本地dev分支：</p><pre><code>$ git checkout -b dev origin/dev</code></pre><p>现在，他就可以在dev上继续修改，然后，时不时地把dev分支push到远程</p><p>你的小伙伴已经向origin/dev分支推送了他的提交，而碰巧你也对同样的文件作了修改，并试图推送：</p><pre><code>$ git add hello.py $ git commit -m &quot;add coding: utf-8&quot;[dev bd6ae48] add coding: utf-8 1 file changed, 1 insertion(+) $ git push origin devTo git@github.com:michaelliao/learngit.git ! [rejected]        dev -&gt; dev (non-fast-forward)error: failed to push some refs to &#39;git@github.com:michaelliao/learngit.git&#39;hint: Updates were rejected because the tip of your current branch is behindhint: its remote counterpart. Merge the remote changes (e.g. &#39;git pull&#39;)hint: before pushing again.hint: See the &#39;Note about fast-forwards&#39; in &#39;git push --help&#39; for details.</code></pre><p>推送失败，因为你的小伙伴的最新提交和你试图推送的提交有冲突，解决办法也很简单，Git已经提示我们，先用git pull把最新的提交从origin/dev抓下来，然后，在本地合并，解决冲突，再推送：</p><pre><code>$ git pullremote: Counting objects: 5, done.remote: Compressing objects: 100% (2/2), done.remote: Total 3 (delta 0), reused 3 (delta 0)Unpacking objects: 100% (3/3), done.From github.com:michaelliao/learngit   fc38031..291bea8  dev        -&gt; origin/devThere is no tracking information for the current branch.Please specify which branch you want to merge with.See git-pull(1) for details    git pull &lt;remote&gt; &lt;branch&gt;If you wish to set tracking information for this branch you can do so with:    git branch --set-upstream dev origin/&lt;branch&gt;</code></pre><p>git pull也失败了，原因是没有指定本地dev分支与远程origin/dev分支的链接，根据提示，设置dev和origin/dev的链接：</p><pre><code>$ git branch --set-upstream dev origin/devBranch dev set up to track remote branch dev from origin.</code></pre><p>再pull：</p><pre><code>$ git pullAuto-merging hello.pyCONFLICT (content): Merge conflict in hello.pyAutomatic merge failed; fix conflicts and then commit the result.</code></pre><p>这回git pull成功，但是合并有冲突，需要手动解决，解决的方法和分支管理中的解决冲突完全一样。解决后，提交，再push：</p><pre><code>$ git commit -m &quot;merge &amp; fix hello.py&quot;[dev adca45d] merge &amp; fix hello.py$ git push origin devCounting objects: 10, done.Delta compression using up to 4 threads.Compressing objects: 100% (5/5), done.Writing objects: 100% (6/6), 747 bytes, done.Total 6 (delta 0), reused 0 (delta 0)To git@github.com:michaelliao/learngit.git   291bea8..adca45d  dev -&gt; dev</code></pre><p>因此，多人协作的工作模式通常是这样：</p><p>首先，可以试图用git push origin branch-name推送自己的修改；</p><ol><li><p>如果推送失败，则因为远程分支比你的本地更新，需要先用git pull试图合并；</p></li><li><p>如果合并有冲突，则解决冲突，并在本地提交；</p></li><li><p>没有冲突或者解决掉冲突后，再用git push origin branch-name推送就能成功！</p></li><li><p>如果git pull提示“no tracking information”，则说明本地分支和远程分支的链接关系没有创建，用命令git branch —set-upstream branch-name origin/branch-name。</p></li></ol><p>这就是多人协作的工作模式，一旦熟悉了，就非常简单。</p><p>小结</p><ul><li><p>查看远程库信息，使用git remote -v；</p></li><li><p>本地新建的分支如果不推送到远程，对其他人就是不可见的；</p></li><li><p>从本地推送分支，使用git push origin branch-name，如果推送失败，先用git pull抓取远程的新提交；</p></li><li><p>在本地创建和远程分支对应的分支，使用git checkout -b branch-name origin/branch-name，本地和远程分支的名称最好一致；</p></li><li><p>建立本地分支和远程分支的关联，使用git branch —set-upstream branch-name origin/branch-name；</p></li><li><p>从远程抓取分支，使用git pull，如果有冲突，要先处理冲突。</p></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000</a></li><li><a href="https://git-scm.com" target="_blank" rel="noopener">https://git-scm.com</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ILSVRC2015数据集转VOC2007数据集格式</title>
      <link href="/2018/04/05/machine_learning/ILSVRC2015%E6%95%B0%E6%8D%AE%E9%9B%86%E8%BD%ACVOC2007%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/"/>
      <url>/2018/04/05/machine_learning/ILSVRC2015%E6%95%B0%E6%8D%AE%E9%9B%86%E8%BD%ACVOC2007%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="下载imageNet2015数据集"><a href="#下载imageNet2015数据集" class="headerlink" title="下载imageNet2015数据集"></a>下载imageNet2015数据集</h1><p>image-net官网下载：image-net.org</p><h1 id="VOC2007数据格式介绍"><a href="#VOC2007数据格式介绍" class="headerlink" title="VOC2007数据格式介绍"></a>VOC2007数据格式介绍</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── Annotations</span><br><span class="line">│   ├── 000001.xml</span><br><span class="line">│   └── 000002.xml</span><br><span class="line">|   |__ ...</span><br><span class="line">├── ImageSets</span><br><span class="line">│   └── Main</span><br><span class="line">│       ├── test.txt</span><br><span class="line">│       ├── train.txt</span><br><span class="line">│       └── val.txt</span><br><span class="line">└── JPEGImages</span><br><span class="line">    ├── 000001.jpg</span><br><span class="line">    └── 000002.jpg</span><br><span class="line">    |__ ...</span><br></pre></td></tr></table></figure><p>JPEGImages文件夹中包含了PASCAL VOC所提供的所有的图片信息，包括了训练图片和测试图片。</p><p>Annotations文件夹中存放的是xml格式的标签文件，每一个xml文件都对应于JPEGImages文件夹中的一张图片。</p><p>xml文件的具体格式如下：（对于2007_000392.jpg）:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">folder</span>&gt;</span>VOC2012<span class="tag">&lt;/<span class="name">folder</span>&gt;</span>                           </span><br><span class="line"><span class="tag">&lt;<span class="name">filename</span>&gt;</span>2007_000392.jpg<span class="tag">&lt;/<span class="name">filename</span>&gt;</span>                               //文件名</span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span>                                                           //图像来源（不重要）</span><br><span class="line"><span class="tag">&lt;<span class="name">database</span>&gt;</span>The VOC2007 Database<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span>PASCAL VOC2007<span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span>&gt;</span>flickr<span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">size</span>&gt;</span>                           //图像尺寸（长宽以及通道数）</span><br><span class="line"><span class="tag">&lt;<span class="name">width</span>&gt;</span>500<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">height</span>&gt;</span>332<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">segmented</span>&gt;</span>1<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span>                           //是否用于分割（在图像物体识别中01无所谓）</span><br><span class="line"><span class="tag">&lt;<span class="name">object</span>&gt;</span>                                                           //检测到的物体</span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>horse<span class="tag">&lt;/<span class="name">name</span>&gt;</span>                                         //物体类别</span><br><span class="line"><span class="tag">&lt;<span class="name">pose</span>&gt;</span>Right<span class="tag">&lt;/<span class="name">pose</span>&gt;</span>                                         //拍摄角度</span><br><span class="line"><span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span>                                   //是否被截断（0表示完整）</span><br><span class="line"><span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span>                                   //目标是否难以识别（0表示容易识别）</span><br><span class="line"><span class="tag">&lt;<span class="name">bndbox</span>&gt;</span>                                                   //bounding-box（包含左下角和右上角xy坐标）</span><br><span class="line"><span class="tag">&lt;<span class="name">xmin</span>&gt;</span>100<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ymin</span>&gt;</span>96<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xmax</span>&gt;</span>355<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ymax</span>&gt;</span>324<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span>&gt;</span>                                                           //检测到多个物体</span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>person<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xmin</span>&gt;</span>198<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ymin</span>&gt;</span>58<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xmax</span>&gt;</span>286<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ymax</span>&gt;</span>197<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ImageSets存放的是每一种类型的challenge对应的图像数据。<br>在ImageSets下有四个文件夹：</p><p>其中Action下存放的是人的动作（例如running、jumping等等，这也是VOC challenge的一部分）</p><p>Layout下存放的是具有人体部位的数据（人的head、hand、feet等等，这也是VOC challenge的一部分）</p><p>Main下存放的是图像物体识别的数据，总共分为20类。</p><p>Segmentation下存放的是可用于分割的数据。</p><p>在这里主要考察Main文件夹。</p><p>Main文件夹下包含了20个分类的***_train.txt、***_val.txt和***_trainval.txt。</p><p>这些txt中的内容都差不多如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">000012</span><br><span class="line">000017</span><br><span class="line">000023</span><br><span class="line">000026</span><br><span class="line">000032</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>表示图像的name。</p><h1 id="ILSVRC2015数据集介绍"><a href="#ILSVRC2015数据集介绍" class="headerlink" title="ILSVRC2015数据集介绍"></a>ILSVRC2015数据集介绍</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">├── Annotations</span><br><span class="line">│   └── CLS-LOC</span><br><span class="line">│       └── train</span><br><span class="line">│           ├── n01440764</span><br><span class="line">│           │   ├── n01440764_18.xml</span><br><span class="line">│           │   └── n01440764_37.xml</span><br><span class="line">|           |   |__ ...</span><br><span class="line">│           └── n01443537</span><br><span class="line">│               ├── n01443537_16.xml</span><br><span class="line">│               └── n01443537_2.xml</span><br><span class="line">|               |__ ...</span><br><span class="line">├── Data</span><br><span class="line">│   └── CLS-LOC</span><br><span class="line">│       ├── <span class="built_in">test</span></span><br><span class="line">│       ├── train</span><br><span class="line">│       │   ├── n01440764</span><br><span class="line">│       │   │   ├── n01440764_36.JPEG</span><br><span class="line">│       │   │   └── n01440764_37.JPEG</span><br><span class="line">|       |       |__ ...</span><br><span class="line">│       │   └── n01443537</span><br><span class="line">│       │       ├── n01443537_16.JPEG</span><br><span class="line">│       │       └── n01443537_2.JPEG</span><br><span class="line">|       |       |__ ...</span><br><span class="line">│       └── val</span><br><span class="line">├── ImageSets</span><br><span class="line">│   └── CLS-LOC</span><br><span class="line">│       ├── test.txt</span><br><span class="line">│       ├── train_cls.txt</span><br><span class="line">│       ├── train_loc.txt</span><br><span class="line">│       └── val.txt</span><br><span class="line">└── devkit</span><br><span class="line">    ├── COPYING</span><br><span class="line">    ├── data</span><br><span class="line">    │   └── map_clsloc.txt</span><br><span class="line">    |   |__ ...</span><br><span class="line">    ├── evaluation</span><br><span class="line">    │   └── VOCreadxml.m</span><br><span class="line">    |   |__ ...</span><br><span class="line">    └── readme.txt</span><br></pre></td></tr></table></figure><p>ILSVRC2015_devkit\devkit\data\map_clsloc.txt文件描述了类别对应关系。</p><h1 id="转换方法"><a href="#转换方法" class="headerlink" title="转换方法"></a>转换方法</h1><h2 id="图片JPEG转jpg格式"><a href="#图片JPEG转jpg格式" class="headerlink" title="图片JPEG转jpg格式"></a>图片JPEG转jpg格式</h2><p>VOC2007中的原图片的数据格式为.jpg格式，而ILSVRC2015数据集中的原始图片为.JPEG格式。考虑到有些深度神经网络只支持.jpg格式的图片。因此，首先将.JPEG格式图片转换为.jpg格式的图片。转换代码可参考如下：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">clc;</span><br><span class="line">clear all;</span><br><span class="line"> </span><br><span class="line">maindir = <span class="string">'/Users/xiaoqiangteng/Downloads/imageset/JPEGImages1/'</span>;</span><br><span class="line">subdir =  dir( maindir ); <span class="comment">% 遍历所有子文件夹</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span> : <span class="built_in">length</span>( subdir )</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">isequal</span>( subdir( <span class="built_in">i</span> ).name, <span class="string">'.'</span> ) || ...</span><br><span class="line">        <span class="built_in">isequal</span>( subdir( <span class="built_in">i</span> ).name, <span class="string">'..'</span> ) || ...</span><br><span class="line">        ~subdir( <span class="built_in">i</span> ).isdir )   <span class="comment">% 过滤空文件夹</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">     </span><br><span class="line">    subdirpath = fullfile( maindir, subdir( <span class="built_in">i</span> ).name, <span class="string">'*.JPEG'</span> ); <span class="comment">%subdir( i ).name = 'n00007846'; subdirpath = S:\ImageNet\JPEGImages1\n00007846\*.JPEG;</span></span><br><span class="line">    images = dir( subdirpath );</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span> : <span class="built_in">length</span>( images )</span><br><span class="line">        imagepath = fullfile(maindir, subdir( <span class="built_in">i</span> ).name, images( <span class="built_in">j</span> ).name);</span><br><span class="line">        imgdata = imread( imagepath);</span><br><span class="line">        subdirpath1 = strcat(maindir, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">        subdirpath = strcat(subdirpath1, <span class="string">'/'</span>);</span><br><span class="line">        jpgPath = [subdirpath, images( <span class="built_in">j</span> ).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-5</span>), <span class="string">'.jpg'</span>];</span><br><span class="line">        imwrite(imgdata, jpgPath, <span class="string">'mode'</span>,<span class="string">'lossless'</span>);</span><br><span class="line">        delete(imagepath, images( <span class="built_in">j</span> ).name);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>待解决的问题：</p><p>函数imwrite(imgdata, jpgPath);默认参数会改变图片大小。</p><p>imwrite(imgdata, jpgPath, ‘mode’,’lossless’);加入特定模式后，图片损坏。</p><h2 id="转换XML文件"><a href="#转换XML文件" class="headerlink" title="转换XML文件"></a>转换XML文件</h2><p>参考这篇<a href="http://blog.csdn.net/samylee/article/details/51201744，他是将每个图片的数据写成了一个txt文件，然后用txt转化为xml文件。我模仿这种方法，那么我得先获得txt文件，所以现在的第一步是要将我的imageNet的annotation，即xml文件转化为参考博客所提到的txt文件。" target="_blank" rel="noopener">http://blog.csdn.net/samylee/article/details/51201744，他是将每个图片的数据写成了一个txt文件，然后用txt转化为xml文件。我模仿这种方法，那么我得先获得txt文件，所以现在的第一步是要将我的imageNet的annotation，即xml文件转化为参考博客所提到的txt文件。</a></p><h3 id="XML文件转txt文件"><a href="#XML文件转txt文件" class="headerlink" title="XML文件转txt文件"></a>XML文件转txt文件</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%createtxt.m</span></span><br><span class="line">clc;</span><br><span class="line">clear all;</span><br><span class="line"> </span><br><span class="line">RootPath = <span class="string">'/Users/xiaoqiangteng/Downloads/imageset/'</span>;</span><br><span class="line">[dir_name, count, label] = importDataFiles(RootPath);</span><br><span class="line"></span><br><span class="line">path_image = <span class="string">'/Users/xiaoqiangteng/Downloads/imageset/JPEGImages2/'</span>;<span class="comment">%原始图片文件夹</span></span><br><span class="line">path_xml = <span class="string">'/Users/xiaoqiangteng/Downloads/imageset/Annotations1/'</span>;</span><br><span class="line">path_label = <span class="string">'/Users/xiaoqiangteng/Downloads/imageset/labels/'</span>;<span class="comment">%生成的txt文件夹</span></span><br><span class="line">subdir = dir(path_xml);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">3</span> : <span class="built_in">length</span>( subdir )</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">isequal</span>( subdir( <span class="built_in">i</span> ).name, <span class="string">'.'</span> ) || ...</span><br><span class="line">        <span class="built_in">isequal</span>( subdir( <span class="built_in">i</span> ).name, <span class="string">'..'</span> ) || ...</span><br><span class="line">        ~subdir( <span class="built_in">i</span> ).isdir )   <span class="comment">% 过滤空文件夹</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">      </span><br><span class="line">    subdirpath = fullfile(path_xml, subdir( <span class="built_in">i</span> ).name, <span class="string">'*.xml'</span>);</span><br><span class="line">    xml_files1 = dir( subdirpath );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">%XML文件排序</span></span><br><span class="line">    xml_files2 = [];</span><br><span class="line">    int_xml_files = [];</span><br><span class="line">    int_xml = [];</span><br><span class="line">    xml_files = [];</span><br><span class="line">    length_xml = <span class="built_in">length</span>(xml_files1);</span><br><span class="line">    <span class="keyword">for</span> k = <span class="number">1</span>:<span class="built_in">length</span>(xml_files1)</span><br><span class="line">        xml_files2(k).name = xml_files1(k).name(<span class="number">11</span>:<span class="keyword">end</span><span class="number">-4</span>);</span><br><span class="line">        int_xml_files(k) = str2num(xml_files2(k).name);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    int_xml = <span class="built_in">sort</span>(int_xml_files);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> ii = <span class="number">1</span>:<span class="built_in">length</span>(xml_files1)</span><br><span class="line">        xml_files3 = strcat(subdir( <span class="built_in">i</span> ).name, <span class="string">'_'</span>);</span><br><span class="line">        xml_files4 = strcat(xml_files3, num2str(int_xml(ii)));</span><br><span class="line">        xml_files(ii).name = strcat(xml_files4, <span class="string">'.xml'</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    mkdir(path_label, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">    pathtxt1 = strcat(path_label, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">    pathtxt2 = strcat(pathtxt1, <span class="string">'/'</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">% 遍历XML文件</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span> : <span class="built_in">length</span>(xml_files)</span><br><span class="line">        <span class="built_in">disp</span>(<span class="built_in">j</span>);</span><br><span class="line">         <span class="keyword">try</span></span><br><span class="line">            pathtxt = [pathtxt2 xml_files( <span class="built_in">j</span> ).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-4</span>) <span class="string">'.txt'</span>];</span><br><span class="line">            subdir_xml = fullfile(path_xml, subdir( <span class="built_in">i</span> ).name, xml_files( <span class="built_in">j</span> ).name);</span><br><span class="line">            str = fileread(subdir_xml);</span><br><span class="line">            v = xml_parse( str );</span><br><span class="line">            xmin = v.object.bndbox.xmin;</span><br><span class="line">            ymin = v.object.bndbox.ymin;</span><br><span class="line">            xmax = v.object.bndbox.xmax;</span><br><span class="line">            ymax = v.object.bndbox.ymax;</span><br><span class="line">            filename = v.filename;</span><br><span class="line">            fid = fopen(pathtxt,<span class="string">'wt'</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%s%s'</span>,filename,<span class="string">'.JPEG'</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,<span class="string">' '</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%s'</span>, label&#123;<span class="built_in">i</span><span class="number">-2</span>&#125;);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,<span class="string">' '</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,xmin);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,<span class="string">' '</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,ymin);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,<span class="string">' '</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,xmax);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,<span class="string">' '</span>);</span><br><span class="line">            fprintf(fid,<span class="string">'%c'</span>,ymax);</span><br><span class="line">            fclose(fid);</span><br><span class="line">         <span class="keyword">catch</span></span><br><span class="line"><span class="comment">%             delete_image1 = strcat(path_image, subdir( i ).name);</span></span><br><span class="line"><span class="comment">%             delete_image2 = strcat(delete_image1, '/');</span></span><br><span class="line"><span class="comment">%             delete_image = [delete_image2, xml_files( j ).name(1:end-4), '.JPEG'];</span></span><br><span class="line"><span class="comment">%             delete(delete_image);</span></span><br><span class="line">             delete_xml1 = strcat(path_xml, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">             delete_xml2 = strcat(delete_xml1, <span class="string">'/'</span>);</span><br><span class="line">             delete_xml = [delete_xml2, xml_files( <span class="built_in">j</span> ).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-4</span>), <span class="string">'.xml'</span>];</span><br><span class="line">             delete(delete_xml);</span><br><span class="line">             <span class="built_in">disp</span>(<span class="string">'Wrong'</span>);</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>importDataFiles(RootPath)函数：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[dir_name, count, label]</span>=<span class="title">importDataFiles</span><span class="params">(RootPath)</span></span></span><br><span class="line">DirOutput = dir(fullfile(RootPath));</span><br><span class="line">SimpleName = &#123;DirOutput(<span class="number">3</span>:<span class="keyword">end</span>).name&#125;';</span><br><span class="line">LenSimFile = <span class="built_in">length</span>(SimpleName);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:LenSimFile</span><br><span class="line">    fileName = fullfile(RootPath,SimpleName&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">    <span class="keyword">switch</span> SimpleName&#123;<span class="built_in">i</span>&#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'map_clsloc.txt'</span></span><br><span class="line">            [dir_name, count, label] = textread(fileName,<span class="string">'%s%d%s'</span>);</span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>改代码通过遍历xml文件来生成txt文件。原因在于原始图片文件夹内的图片多余对应的xml文件。</p><p>可能存在的问题：</p><p>（1）以上matlab代码通过使用XML 函数来解析XML文件，即xml_parse()函数。需要先下载该函数的工具包，下载地址：<a href="https://cn.mathworks.com/matlabcentral/fileexchange/4278-xml-toolbox?focused=5055046&amp;tab=function" target="_blank" rel="noopener">https://cn.mathworks.com/matlabcentral/fileexchange/4278-xml-toolbox?focused=5055046&amp;tab=function</a></p><p>但是该工具包在高版本的matlab已不支持，请尝试低版本的Matlab。楼主使用matlab 2014a版本，可运行。</p><p>（2）待解决的问题</p><p>以上代码仅仅支持XML中存在一个object对象。若存在多个object对象，即会报错，运行catch语句块，将不能够读取的xml文件从原文件夹中删除，以此来保证xml文件的数量同txt文件的数量相同。但是，该问题应该很好能够解决。</p><h3 id="TXT转XML"><a href="#TXT转XML" class="headerlink" title="TXT转XML"></a>TXT转XML</h3><p>接下来就可以进行将txt转化为pascal voc格式的xml文件了，在当前目录下创建一个Annotations的文件夹，代码如下：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%writeanno.m</span></span><br><span class="line">clc;</span><br><span class="line">clear all;</span><br><span class="line"> </span><br><span class="line">path_image = <span class="string">'/home/teng/programmings/datasets/imagenet/imagenet/JPEGImages/'</span>;</span><br><span class="line">path_label = <span class="string">'/home/teng/programmings/datasets/imagenet/imagenet/labels/'</span>;</span><br><span class="line">path_xml = <span class="string">'/home/teng/programmings/datasets/imagenet/imagenet/Annotations/'</span>;</span><br><span class="line">subdir = dir(path_label);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">3</span> : <span class="built_in">length</span>( subdir )</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">isequal</span>( subdir( <span class="built_in">i</span> ).name, <span class="string">'.'</span> ) || ...</span><br><span class="line">        <span class="built_in">isequal</span>( subdir( <span class="built_in">i</span> ).name, <span class="string">'..'</span> ) || ...</span><br><span class="line">        ~subdir( <span class="built_in">i</span> ).isdir )</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">      </span><br><span class="line">    subdirpath = fullfile(path_label, subdir( <span class="built_in">i</span> ).name, <span class="string">'*.txt'</span>);</span><br><span class="line">    txt_files = dir( subdirpath );</span><br><span class="line">    </span><br><span class="line">    mkdir(path_xml, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span>:<span class="built_in">length</span>(txt_files)</span><br><span class="line">        <span class="built_in">disp</span>(<span class="built_in">i</span>, <span class="built_in">j</span>)</span><br><span class="line">        path_label_dir1 = strcat(path_label, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">        path_label_dir = strcat(path_label_dir1, <span class="string">'/'</span>);</span><br><span class="line">        msg = textread(strcat(path_label_dir, txt_files(<span class="built_in">j</span>).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-4</span>),<span class="string">'.txt'</span>),<span class="string">'%s'</span>);</span><br><span class="line">        clear rec;</span><br><span class="line">        path_xml_subdir1 = strcat(path_xml, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">        path_xml_subdir = strcat(path_xml_subdir1, <span class="string">'/'</span>);</span><br><span class="line">        path = [path_xml_subdir txt_files(<span class="built_in">j</span>).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-4</span>) <span class="string">'.xml'</span>];</span><br><span class="line">        fid=fopen(path,<span class="string">'w'</span>);</span><br><span class="line">        rec.annotation.folder = <span class="string">'VOC2007'</span>;<span class="comment">%数据集名</span></span><br><span class="line">        rec.annotation.filename = strcat(txt_files(<span class="built_in">j</span>).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-4</span>), <span class="string">'.JPEG'</span>);</span><br><span class="line">        rec.annotation.source.database = <span class="string">'The VOC2007 Database'</span>;    </span><br><span class="line">        rec.annotation.source.annotation = <span class="string">'PASCAL VOC2007'</span>;    </span><br><span class="line">        rec.annotation.source.image = <span class="string">'flickr'</span>;</span><br><span class="line">        rec.annotation.source.flickrid = <span class="string">'0'</span>;</span><br><span class="line">        rec.annotation.owner.flickrid = <span class="string">'I do not know'</span>;    </span><br><span class="line">        rec.annotation.owner.name = <span class="string">'I do not know'</span>;</span><br><span class="line"></span><br><span class="line">        path_image_subdir1 = strcat(path_image, subdir( <span class="built_in">i</span> ).name);</span><br><span class="line">        path_image_subdir = strcat(path_image_subdir1, <span class="string">'/'</span>);</span><br><span class="line">        img = imread([path_image_subdir txt_files(<span class="built_in">j</span>).name(<span class="number">1</span>:<span class="keyword">end</span><span class="number">-4</span>) <span class="string">'.JPEG'</span>]);</span><br><span class="line">        rec.annotation.<span class="built_in">size</span>.width = int2str(<span class="built_in">size</span>(img,<span class="number">2</span>));</span><br><span class="line">        rec.annotation.<span class="built_in">size</span>.height = int2str(<span class="built_in">size</span>(img,<span class="number">1</span>));</span><br><span class="line">        rec.annotation.<span class="built_in">size</span>.depth = int2str(<span class="built_in">size</span>(img,<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        rec.annotation.segmented = <span class="string">'0'</span>;  </span><br><span class="line">        rec.annotation.object.name = msg&#123;<span class="number">2</span>&#125;;   </span><br><span class="line">        rec.annotation.object.pose = <span class="string">'Left'</span>;    </span><br><span class="line">        rec.annotation.object.truncated = <span class="string">'1'</span>;    </span><br><span class="line">        rec.annotation.object.difficult = <span class="string">'0'</span>;    </span><br><span class="line">        rec.annotation.object.bndbox.xmin = msg&#123;<span class="number">3</span>&#125;;<span class="comment">%坐标x1</span></span><br><span class="line">        rec.annotation.object.bndbox.ymin = msg&#123;<span class="number">4</span>&#125;;<span class="comment">%坐标y1</span></span><br><span class="line">        rec.annotation.object.bndbox.xmax = msg&#123;<span class="number">5</span>&#125;;<span class="comment">%坐标x2</span></span><br><span class="line">        rec.annotation.object.bndbox.ymax = msg&#123;<span class="number">6</span>&#125;;<span class="comment">%坐标y2</span></span><br><span class="line">        writexml(fid,rec,<span class="number">0</span>);</span><br><span class="line">        fclose(fid);</span><br><span class="line">    <span class="keyword">end</span>   </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>writexml函数：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%writexml.m</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xml</span> = <span class="title">writexml</span><span class="params">(fid,rec,depth)</span></span></span><br><span class="line"></span><br><span class="line">fn=fieldnames(rec);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(fn)</span><br><span class="line">    f=rec.(fn&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">    <span class="keyword">if</span> ~<span class="built_in">isempty</span>(f)</span><br><span class="line">        <span class="keyword">if</span> isstruct(f)</span><br><span class="line">            <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:<span class="built_in">length</span>(f)            </span><br><span class="line">                fprintf(fid,<span class="string">'%s'</span>,<span class="built_in">repmat</span>(char(<span class="number">9</span>),<span class="number">1</span>,depth));</span><br><span class="line">                a=<span class="built_in">repmat</span>(char(<span class="number">9</span>),<span class="number">1</span>,depth);</span><br><span class="line">                fprintf(fid,<span class="string">'&lt;%s&gt;\n'</span>,fn&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">                writexml(fid,rec.(fn&#123;<span class="built_in">i</span>&#125;)(<span class="built_in">j</span>),depth+<span class="number">1</span>);</span><br><span class="line">                fprintf(fid,<span class="string">'%s'</span>,<span class="built_in">repmat</span>(char(<span class="number">9</span>),<span class="number">1</span>,depth));</span><br><span class="line">                fprintf(fid,<span class="string">'&lt;/%s&gt;\n'</span>,fn&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span> ~iscell(f)</span><br><span class="line">                f=&#123;f&#125;;</span><br><span class="line">            <span class="keyword">end</span>       </span><br><span class="line">            <span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">1</span>:<span class="built_in">length</span>(f)</span><br><span class="line">                fprintf(fid,<span class="string">'%s'</span>,<span class="built_in">repmat</span>(char(<span class="number">9</span>),<span class="number">1</span>,depth));</span><br><span class="line">                fprintf(fid,<span class="string">'&lt;%s&gt;'</span>,fn&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">                <span class="keyword">if</span> ischar(f&#123;<span class="built_in">j</span>&#125;)</span><br><span class="line">                    fprintf(fid,<span class="string">'%s'</span>,f&#123;<span class="built_in">j</span>&#125;);</span><br><span class="line">                <span class="keyword">elseif</span> isnumeric(f&#123;<span class="built_in">j</span>&#125;)&amp;&amp;<span class="built_in">numel</span>(f&#123;<span class="built_in">j</span>&#125;)==<span class="number">1</span></span><br><span class="line">                    fprintf(fid,<span class="string">'%s'</span>,num2str(f&#123;<span class="built_in">j</span>&#125;));</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    error(<span class="string">'unsupported type'</span>);</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                fprintf(fid,<span class="string">'&lt;/%s&gt;\n'</span>,fn&#123;<span class="built_in">i</span>&#125;);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="移动目录内所有文件夹内的文件至上层目录"><a href="#移动目录内所有文件夹内的文件至上层目录" class="headerlink" title="移动目录内所有文件夹内的文件至上层目录"></a>移动目录内所有文件夹内的文件至上层目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">read_dir</span></span>()&#123;</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `ls <span class="variable">$1</span>`       <span class="comment">#注意此处这是两个反引号，表示运行系统命令</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span> ]  <span class="comment">#注意此处之间一定要加上空格，否则会报错</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span><span class="variable">$file</span></span><br><span class="line">read_dir <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">mv <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span> /home/teng/programmings/datasets/imagenet/imagenet/Annotations</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">delete_dir</span></span>()&#123;</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> `ls <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span>$<span class="string">"/"</span>file</span><br><span class="line">rm -rf <span class="variable">$1</span><span class="string">"/"</span><span class="variable">$file</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#读取第一个参数</span></span><br><span class="line">read_dir <span class="variable">$1</span></span><br><span class="line">delete_dir <span class="variable">$1</span></span><br></pre></td></tr></table></figure><p>这一步的目的在于将Annotations文件夹内的所有xml文件置于一个目录下。</p><h2 id="imageSets文件夹"><a href="#imageSets文件夹" class="headerlink" title="imageSets文件夹"></a>imageSets文件夹</h2><p>代码如下：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%createimagesets.m</span></span><br><span class="line">clc;</span><br><span class="line">clear all;</span><br><span class="line">  </span><br><span class="line">file = dir(<span class="string">'/home/teng/programmings/datasets/imagenet/imagenet/Annotations/'</span>);</span><br><span class="line">len = <span class="built_in">length</span>(file)<span class="number">-2</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_trainval=<span class="built_in">sort</span>(randperm(len, <span class="built_in">floor</span>(<span class="number">9</span>*len/<span class="number">10</span>)));<span class="comment">%trainval集占所有数据的9/10，可以根据需要设置</span></span><br><span class="line">num_train=<span class="built_in">sort</span>(num_trainval(randperm(<span class="built_in">length</span>(num_trainval), <span class="built_in">floor</span>(<span class="number">5</span>*<span class="built_in">length</span>(num_trainval)/<span class="number">6</span>))));<span class="comment">%train集占trainval集的5/6，可以根据需要设置</span></span><br><span class="line">num_val=setdiff(num_trainval,num_train);<span class="comment">%trainval集剩下的作为val集</span></span><br><span class="line">num_test=setdiff(<span class="number">1</span>:len,num_trainval);<span class="comment">%所有数据中剩下的作为test集</span></span><br><span class="line">path = <span class="string">'/home/teng/programmings/datasets/imagenet/imagenet/ImageSets/Main/'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fid=fopen(strcat(path, <span class="string">'trainval.txt'</span>),<span class="string">'a+'</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(num_trainval)</span><br><span class="line">    s = sprintf(<span class="string">'%s'</span>,file(num_trainval(<span class="built_in">i</span>)+<span class="number">2</span>).name);</span><br><span class="line">    fprintf(fid,[s(<span class="number">1</span>:<span class="built_in">length</span>(s)<span class="number">-4</span>) <span class="string">'\r\n'</span>]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fclose(fid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fid=fopen(strcat(path, <span class="string">'train.txt'</span>),<span class="string">'a+'</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(num_train)</span><br><span class="line">    s = sprintf(<span class="string">'%s'</span>,file(num_train(<span class="built_in">i</span>)+<span class="number">2</span>).name);</span><br><span class="line">    fprintf(fid,[s(<span class="number">1</span>:<span class="built_in">length</span>(s)<span class="number">-4</span>) <span class="string">'\r\n'</span>]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fclose(fid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fid=fopen(strcat(path, <span class="string">'val.txt'</span>),<span class="string">'a+'</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(num_val)</span><br><span class="line">    s = sprintf(<span class="string">'%s'</span>,file(num_val(<span class="built_in">i</span>)+<span class="number">2</span>).name);</span><br><span class="line">    fprintf(fid,[s(<span class="number">1</span>:<span class="built_in">length</span>(s)<span class="number">-4</span>) <span class="string">'\r\n'</span>]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fclose(fid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fid=fopen(strcat(path, <span class="string">'test.txt'</span>),<span class="string">'a+'</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span>=<span class="number">1</span>:<span class="built_in">length</span>(num_test)</span><br><span class="line">    s = sprintf(<span class="string">'%s'</span>,file(num_test(<span class="built_in">i</span>)+<span class="number">2</span>).name);</span><br><span class="line">    fprintf(fid,[s(<span class="number">1</span>:<span class="built_in">length</span>(s)<span class="number">-4</span>) <span class="string">'\r\n'</span>]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fclose(fid);</span><br></pre></td></tr></table></figure><p>这样所需的文件夹我们都已备齐，将imageSets，Annotations和JPEGiImage文件夹分别放入voc数据集的对应位置，在这之前先将其原来的文件夹删除。</p><h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><ol><li><a href="https://blog.csdn.net/xbcReal/article/details/51259558" target="_blank" rel="noopener">https://blog.csdn.net/xbcReal/article/details/51259558</a></li><li><a href="https://blog.csdn.net/samylee/article/details/51201744" target="_blank" rel="noopener">https://blog.csdn.net/samylee/article/details/51201744</a></li><li><a href="https://blog.csdn.net/sinat_30071459/article/details/50723212" target="_blank" rel="noopener">https://blog.csdn.net/sinat_30071459/article/details/50723212</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 深度学习 </category>
          
          <category> 数据集制作 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 深度学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CMake教程</title>
      <link href="/2018/04/03/programmings/c_plus_plus/CMake%E6%95%99%E7%A8%8B/"/>
      <url>/2018/04/03/programmings/c_plus_plus/CMake%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Cmake入门"><a href="#Cmake入门" class="headerlink" title="Cmake入门"></a>Cmake入门</h1><h2 id="CMake编译原理"><a href="#CMake编译原理" class="headerlink" title="CMake编译原理"></a>CMake编译原理</h2><p>CMake是一种跨平台编译工具，比make更为高级，使用起来要方便得多。CMake主要是编写CMakeLists.txt文件，然后用cmake命令将CMakeLists.txt文件转化为make所需要的makefile文件，最后用make命令编译源码生成可执行程序或共享库（so(shared object)）。因此CMake的编译基本就两个步骤：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>cmake  指向CMakeLists.txt所在的目录，例如cmake .. 表示CMakeLists.txt在当前目录的上一级目录。cmake后会生成很多编译的中间文件以及makefile文件，所以一般建议新建一个新的目录，专门用来编译，例如:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>make根据生成makefile文件，编译程序。</p><h2 id="使用Cmake编译程序"><a href="#使用Cmake编译程序" class="headerlink" title="使用Cmake编译程序"></a>使用Cmake编译程序</h2><h3 id="源码文件介绍"><a href="#源码文件介绍" class="headerlink" title="源码文件介绍"></a>源码文件介绍</h3><p>本文以一个例子入手介绍，即开平方。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── CMakeLists.txt</span><br><span class="line">└── src</span><br><span class="line">    ├── main.cpp</span><br><span class="line">    ├── test_math.cpp</span><br><span class="line">    └── test_math.h</span><br></pre></td></tr></table></figure><p>其中，src目录存放所有的源代码，即test_math.cpp、test_math.h和main.cpp。每个源代码文件内容如下：</p><p>test_math.h:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> TEST4_TEST_MATH_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TEST4_TEST_MATH_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cal_sqrt</span><span class="params">(<span class="keyword">double</span> value)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//TEST4_TEST_MATH_H</span></span></span><br></pre></td></tr></table></figure><p>test_math.cpp:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"test_math.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cal_sqrt</span><span class="params">(<span class="keyword">double</span> value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sqrt</span>(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main.cpp:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"test_math.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> a = <span class="number">49.0</span>;</span><br><span class="line">    <span class="keyword">double</span> b = <span class="number">0.0</span>;</span><br><span class="line">    b = cal_sqrt(a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sqrt result:%f\n"</span>,b);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编写CMakeLists-txt"><a href="#编写CMakeLists-txt" class="headerlink" title="编写CMakeLists.txt"></a>编写CMakeLists.txt</h3><p>CMakeLists.txt文件，如下所示：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>cmake verson，指定cmake版本</span><br><span class="line">cmake_minimum_required(VERSION <span class="number">3.8</span>)</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>project name，指定项目的名称，一般和项目的文件夹名称对应</span><br><span class="line">project(test4)</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>head file path，头文件目录</span><br><span class="line">#INCLUDE_DIRECTORIES(include)</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>source directory，源文件目录</span><br><span class="line">AUX_SOURCE_DIRECTORY(src DIR_SRCS)</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span><span class="built_in">set</span> environment variable，设置环境变量，编译用到的源文件全部都要放到这里，否则编译能够通过，但是执行的时候会出现各种问题，比如<span class="string">"symbol lookup error xxxxx , undefined symbol"</span></span><br><span class="line">SET(TEST_MATH $&#123;DIR_SRCS&#125;)</span><br><span class="line"></span><br><span class="line">#<span class="number">7.</span>add link library，添加可执行文件所需要的库，比如我们用到了libm.so（命名规则：lib+name+.so），就添加该库的名称</span><br><span class="line">#TARGET_LINK_LIBRARIES($&#123;PROJECT_NAME&#125; m)</span><br><span class="line"></span><br><span class="line">#<span class="number">6.</span>add executable file，添加要编译的可执行文件</span><br><span class="line">ADD_EXECUTABLE($&#123;PROJECT_NAME&#125; $&#123;TEST_MATH&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br></pre></td></tr></table></figure><h3 id="编译和运行程序"><a href="#编译和运行程序" class="headerlink" title="编译和运行程序"></a>编译和运行程序</h3><p>由于编译中出现许多中间的文件，因此最好新建一个独立的目录build，在该目录下进行编译，编译步骤如下所示：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>build下生成的目录结构如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">├── CMakeLists.txt</span><br><span class="line">├── cmake-build-debug</span><br><span class="line">│   ├── CMakeCache.txt</span><br><span class="line">│   ├── CMakeFiles</span><br><span class="line">│   │   ├── 3.8.2</span><br><span class="line">│   │   │   ├── CMakeCCompiler.cmake</span><br><span class="line">│   │   │   ├── CMakeCXXCompiler.cmake</span><br><span class="line">│   │   │   ├── CMakeDetermineCompilerABI_C.bin</span><br><span class="line">│   │   │   ├── CMakeDetermineCompilerABI_CXX.bin</span><br><span class="line">│   │   │   ├── CMakeSystem.cmake</span><br><span class="line">│   │   │   ├── CompilerIdC</span><br><span class="line">│   │   │   │   ├── CMakeCCompilerId.c</span><br><span class="line">│   │   │   │   ├── a.out</span><br><span class="line">│   │   │   │   └── tmp</span><br><span class="line">│   │   │   └── CompilerIdCXX</span><br><span class="line">│   │   │       ├── CMakeCXXCompilerId.cpp</span><br><span class="line">│   │   │       ├── a.out</span><br><span class="line">│   │   │       └── tmp</span><br><span class="line">│   │   ├── CMakeDirectoryInformation.cmake</span><br><span class="line">│   │   ├── CMakeOutput.log</span><br><span class="line">│   │   ├── CMakeTmp</span><br><span class="line">│   │   ├── Makefile.cmake</span><br><span class="line">│   │   ├── Makefile2</span><br><span class="line">│   │   ├── TargetDirectories.txt</span><br><span class="line">│   │   ├── clion-environment.txt</span><br><span class="line">│   │   ├── clion-log.txt</span><br><span class="line">│   │   ├── cmake.check_cache</span><br><span class="line">│   │   ├── feature_tests.bin</span><br><span class="line">│   │   ├── feature_tests.c</span><br><span class="line">│   │   ├── feature_tests.cxx</span><br><span class="line">│   │   ├── progress.marks</span><br><span class="line">│   │   └── test4.dir</span><br><span class="line">│   │       ├── CXX.includecache</span><br><span class="line">│   │       ├── DependInfo.cmake</span><br><span class="line">│   │       ├── build.make</span><br><span class="line">│   │       ├── cmake_clean.cmake</span><br><span class="line">│   │       ├── depend.internal</span><br><span class="line">│   │       ├── depend.make</span><br><span class="line">│   │       ├── flags.make</span><br><span class="line">│   │       ├── link.txt</span><br><span class="line">│   │       ├── progress.make</span><br><span class="line">│   │       └── src</span><br><span class="line">│   │           ├── main.cpp.o</span><br><span class="line">│   │           └── test_math.cpp.o</span><br><span class="line">│   ├── Makefile</span><br><span class="line">│   ├── cmake_install.cmake</span><br><span class="line">│   ├── test4</span><br><span class="line">│   └── test4.cbp</span><br><span class="line">└── src</span><br><span class="line">    ├── main.cpp</span><br><span class="line">    ├── test_math.cpp</span><br><span class="line">    └── test_math.h</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://www.cnblogs.com/cv-pr/p/6206921.html" target="_blank" rel="noopener">http://www.cnblogs.com/cv-pr/p/6206921.html</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> C++ </category>
          
          <category> cmake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux-深度学习环境配置-Ubuntu</title>
      <link href="/2018/03/31/machine_learning/linux-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-Ubuntu/"/>
      <url>/2018/03/31/machine_learning/linux-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-Ubuntu/</url>
      
        <content type="html"><![CDATA[<h1 id="Ubuntu16-04-cuda8-0-GPU驱动配置"><a href="#Ubuntu16-04-cuda8-0-GPU驱动配置" class="headerlink" title="Ubuntu16.04 cuda8.0 GPU驱动配置"></a>Ubuntu16.04 cuda8.0 GPU驱动配置</h1><ul><li>ubuntu 16.04 64bit </li><li>显卡：NVIDIA Tesla k40m + 集成显卡</li></ul><h2 id="更换阿里源"><a href="#更换阿里源" class="headerlink" title="更换阿里源"></a>更换阿里源</h2><p>更换之前要先备份之前的源：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/source.list /etc/apt/source.list.bak</span><br></pre></td></tr></table></figure><p>编辑源列表文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim/etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>原来的列表删除，替换：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted</span></span><br><span class="line">deb-src http://archive.ubuntu.com/ubuntu xenial main restricted <span class="comment">#Added by software-properties</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe <span class="comment">#Added by software-properties</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe <span class="comment">#Added by software-properties</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse <span class="comment">#Added by software-properties</span></span><br><span class="line">deb http://archive.canonical.com/ubuntu xenial partner</span><br><span class="line">deb-src http://archive.canonical.com/ubuntu xenial partner</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe <span class="comment">#Added by software-properties</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse</span><br></pre></td></tr></table></figure><p>更新：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure><h2 id="Ubuntu16-04挂载新硬盘并格式化硬盘"><a href="#Ubuntu16-04挂载新硬盘并格式化硬盘" class="headerlink" title="Ubuntu16.04挂载新硬盘并格式化硬盘"></a>Ubuntu16.04挂载新硬盘并格式化硬盘</h2><p>查看硬盘:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure><p>新建分区:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fdisk /dev/sdb</span><br></pre></td></tr></table></figure><p>之后进入command状态，大概是这么操作的：</p><ul><li>输入 m 查看帮助</li><li>输入 p 查看 /dev/sdb 分区的状态</li><li>输入 n 创建sdb这块硬盘的分区</li><li>选 p primary =&gt;输入　p</li><li>Partition number =&gt;分一个区所以输入　1</li><li>其他的默认回车即可</li><li>最后输入 w 保存并退出 Command 状态。</li></ul><p>操作示例:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line"><span class="comment"># n创建分区</span></span><br><span class="line">Partition <span class="built_in">type</span></span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended (container <span class="keyword">for</span> logical partitions)</span><br><span class="line">Select (default p): p</span><br><span class="line"><span class="comment"># p(primary主分区） e(extended拓展分区)</span></span><br><span class="line">Partition number (1-4, default 1): 1</span><br><span class="line"><span class="comment"># 分区号</span></span><br><span class="line">First sector (2048-83886079, default 2048): </span><br><span class="line"><span class="comment"># 默认</span></span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G,T,P&#125; (2048-83886079, default 83886079): </span><br><span class="line"><span class="comment"># 大小，可自定义，保持默认</span></span><br><span class="line">Created a new partition 1 of <span class="built_in">type</span> <span class="string">'Linux'</span> and of size 40 GiB.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"><span class="comment"># 查看分区情况</span></span><br><span class="line">Disk /dev/sdb: 40 GiB, 42949672960 bytes, 83886080 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0xbb6c1792</span><br><span class="line"></span><br><span class="line">Device     Boot Start      End  Sectors Size Id Type</span><br><span class="line">/dev/sdb1        2048 83886079 83884032  40G 83 Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line"><span class="comment"># 保存</span></span><br><span class="line">The partition table has been altered.</span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure><p>在通过查看命令即可查看，新增的硬盘.</p><p>格式化:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkfs.ext4 /dev/sdb1 <span class="comment"># ext4为分区格式</span></span><br></pre></td></tr></table></figure><p>挂载:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /home/data</span><br><span class="line">sudo mount /dev/sdb1 /home/data</span><br></pre></td></tr></table></figure><p>开机自动挂载:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo blkid</span><br></pre></td></tr></table></figure><p>添加UUID到/etc/fstab 添加UUID=63295b70-daec-4253-b659-821f51200be9 /home/data ext4 defaults,errors=remount-ro 0 1到/etc/fstab 其中UUID后面跟sdb1的UUID 重启。</p><h2 id="安装必要的软件"><a href="#安装必要的软件" class="headerlink" title="安装必要的软件"></a>安装必要的软件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install vim git openssh-server</span><br></pre></td></tr></table></figure><h2 id="检查是否正确识别显卡"><a href="#检查是否正确识别显卡" class="headerlink" title="检查是否正确识别显卡"></a>检查是否正确识别显卡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i nvidia</span><br></pre></td></tr></table></figure><h2 id="查看是否已有安装的NVIDIA驱动"><a href="#查看是否已有安装的NVIDIA驱动" class="headerlink" title="查看是否已有安装的NVIDIA驱动"></a>查看是否已有安装的NVIDIA驱动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nvidia</span><br></pre></td></tr></table></figure><h2 id="查看集显驱动"><a href="#查看集显驱动" class="headerlink" title="查看集显驱动"></a>查看集显驱动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nouveau</span><br></pre></td></tr></table></figure><h2 id="禁用nouveau驱动和相关的驱动包"><a href="#禁用nouveau驱动和相关的驱动包" class="headerlink" title="禁用nouveau驱动和相关的驱动包"></a>禁用nouveau驱动和相关的驱动包</h2><p>用编辑器打开blacklist.conf配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure><p>在文件的最后一行加入下面的命令，屏蔽有影响的驱动包（这里有的博客添加了blacklist amd76x_edac，但是经测试后不加也是可以安装成功的）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">blacklist rivafb</span><br><span class="line">blacklist vga16fb</span><br><span class="line">blacklist nouveau</span><br><span class="line">blacklist nvidiafb</span><br><span class="line">blacklist rivatv</span><br><span class="line">options nouveau modeset=0</span><br><span class="line"><span class="built_in">alias</span> nouveau off</span><br><span class="line"><span class="built_in">alias</span> lbm-nouveau off</span><br></pre></td></tr></table></figure><p>禁用 nouveau 内核模块:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$echo</span> options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf</span><br><span class="line"><span class="variable">$sudo</span> update-initramfs -u</span><br></pre></td></tr></table></figure><h2 id="卸载所有安装的nvidia驱动"><a href="#卸载所有安装的nvidia驱动" class="headerlink" title="卸载所有安装的nvidia驱动"></a>卸载所有安装的nvidia驱动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove –purge nvidia*</span><br></pre></td></tr></table></figure><h2 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><h2 id="GPU驱动配置"><a href="#GPU驱动配置" class="headerlink" title="GPU驱动配置"></a>GPU驱动配置</h2><p>根据GPU型号从相应网站下载驱动，例如使用NVIDIA Tesla M60，从<a href="http://www.nvidia.cn/Download/index.aspx?lang=cn" target="_blank" rel="noopener">NVIDIA网站</a>选择对应的型号和操作系统，CUDA Toolkit版本，下载驱动文件，如NVIDIA-Linux-x86_64-375.66.run，运行驱动文件，根据提示安装：</p><h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><p>安装驱动可能需要的依赖(可选):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sudo</span> apt-get update</span><br><span class="line"><span class="variable">$sudo</span> apt-get install dkms build-essential linux-headers-generic</span><br><span class="line"><span class="variable">$sudo</span> gedit ~/.bashrc</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/lib/x86_64-linux-gnu:<span class="variable">$LD_LIBRARY_PATH</span></span><br><span class="line"><span class="variable">$source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>进入命令行界面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Ctrl-Alt+F1 </span><br><span class="line">sudo /etc/init.d/lightdm stop <span class="comment">#关闭当前图形环境令</span></span><br></pre></td></tr></table></figure><p>关闭桌面服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service lightdm stop</span><br></pre></td></tr></table></figure><p>给驱动run文件赋予执行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x NVIDIA-Linux-x86_64-384.66.run</span><br></pre></td></tr></table></figure><p>安装: 注意下面参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ./NVIDIA-Linux-x86_64-384.66.run –no-x-check –no-nouveau-check –no-opengl-files </span><br><span class="line"><span class="comment"># –no-x-check安装驱动时关闭X服务 </span></span><br><span class="line"><span class="comment"># –no-nouveau-check 安装驱动时禁用nouveau </span></span><br><span class="line"><span class="comment"># –no-opengl-files 只安装驱动文件，不安装OpenGL文件</span></span><br></pre></td></tr></table></figure><p>注意：安装CUDA时一定使用runfile文件，这样可以进行选择。不再选择安装驱动，以及在弹出xorg.conf时选择NO.不要使用ubuntu设置中附加驱动中驱动</p><p>报错：</p><p>（1）ERROR: Unable to load the kernel module ‘nvidia.ko’. This happens most frequently when this kernel module was built against the wrong or improperly configured kernel sources, with a version of gcc that differs from the one used to build the target kernel, or if a driver such as rivafb, nvidiafb, or nouveau is present and prevents the NVIDIA kernel module from obtaining ownership of the NVIDIA graphics device(s), or no NVIDIA GPU installed in this system is supported by this NVIDIA Linux graphics driver release.</p><p>解决方法：</p><ul><li>禁用nouveau驱动和相关的驱动</li><li>首先，Ctrl+Alt+F1进入命令提示符界面 </li><li>然后，输入对应的username和passwd进入命令行. </li><li>最后，使用指令sudo service lightdm stop 关闭图形界面，再利用cd指令进入下载好的驱动目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 755 NVIDIA-Linux-x86_64-384.111.run  <span class="comment">#修改权限（否则没有访问权限，无法进行指令安装）</span></span><br><span class="line">sudo ./NVIDIA-Linux-x86_64-384.111.run –no-x-check –no-nouveau-check –no-opengl-files <span class="comment">#安装驱动</span></span><br><span class="line"><span class="comment">#–no-x-check 关闭X服务</span></span><br><span class="line"><span class="comment">#–no-nouveau-check 禁用nouveau</span></span><br><span class="line"><span class="comment">#–no-opengl-files 不安装OpenGL文件</span></span><br><span class="line"><span class="comment">#...安装完成后</span></span><br><span class="line">sudo update-initramfs -u</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>(2) WARNING: Unable to find a suitable destination to install 32-bit compatibility libraries. Your system may not be set up for 32-bit compatibility. 32-bit compatibility files will not be installed; if you wish to install them, re-run the installation and set a valid directory with the —compat32-libdir option.</p><p>解决方法：</p><p>运行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo aptitude install ia32-libs</span><br></pre></td></tr></table></figure><h2 id="安装cuda"><a href="#安装cuda" class="headerlink" title="安装cuda"></a>安装<a href="https://developer.nvidia.com/cuda-80-ga2-download-archive" target="_blank" rel="noopener">cuda</a></h2><p>注意这里下载的是cuda8.0的runfile（local）文件。 </p><p>这里是nvidia给出的官方安装指南（遇到问题时可以查阅) </p><p>下载完cuda8.0后，执行如下语句，运行runfile文件： </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh cuda_8.0.27_linux.run</span><br></pre></td></tr></table></figure><p>因为驱动之前已经安装，这里就不要选择安装驱动。其余的都直接默认或者选择是即可。</p><p>使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/profile</span><br></pre></td></tr></table></figure><p>打开“profile”文件，在末尾处添加（注意不要有空格，不然会报错):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/cuda-8.0/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/cuda-8.0/lib64<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure><p>重启电脑：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure><p>测试cuda的Samples:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/cuda-8.0/samples/1_Utilities/deviceQuery</span><br><span class="line">sudo make</span><br><span class="line">./deviceQuery</span><br></pre></td></tr></table></figure><h1 id="OpenCV3-1配置"><a href="#OpenCV3-1配置" class="headerlink" title="OpenCV3.1配置"></a>OpenCV3.1配置</h1><h2 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line"><span class="comment"># 必须的，gcc编译环境</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</span><br><span class="line"><span class="comment"># 必须的,包括cmake等工具</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev</span><br><span class="line"><span class="comment"># 可选的，看个人需要，总共5M左右</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install libv4l-dev</span><br></pre></td></tr></table></figure><h2 id="下载-源码"><a href="#下载-源码" class="headerlink" title="下载 源码"></a>下载 源码</h2><p><a href="https://opencv.org/releases.html" target="_blank" rel="noopener">OpenCV</a></p><p>或着用git clone：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/opencv310</span><br><span class="line">    <span class="comment"># opencv310为自己建的，源码将放在这里</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Itseez/opencv.git</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Itseez/opencv_contrib.git</span><br></pre></td></tr></table></figure><h2 id="CMake-Opencv源码"><a href="#CMake-Opencv源码" class="headerlink" title="CMake Opencv源码"></a>CMake Opencv源码</h2><p>建立一个编译目录（例如：/build）把cmake后的文件都放在这里边。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/opencv</span><br><span class="line">mkdir build  //建立一个build目录，把cmake的文件都放着里边</span><br><span class="line"><span class="built_in">cd</span> build　　　//进入build目录</span><br></pre></td></tr></table></figure><p>cmake时ippicv_linux_20151201.tgz总是不能成功下载，故cmake之前将./downloads/linux-808b791a6eac9ed78d32a7666804320e 文件拷贝至./opencv-3.1.0/3rdparty/ippicv/ 路径下(先执行一次cmake 命令生成文件路径，在将ippicv_linux_20151201.tgz复制进去) 首先，手动下载<a href="https://raw.githubusercontent.com/Itseez/opencv_3rdparty/81a676001ca8075ada498583e4166079e5744668/ippicv/ippicv_linux_20151201.tgz" target="_blank" rel="noopener">ippicv</a></p><p>然后开始cmake，这里需要注意几个cmake的参数，比较重要。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span> WITH_LIBV4L=ON ..</span><br></pre></td></tr></table></figure><p>切记最后’..’两个点之前要加空格！！</p><h2 id="把代码编译成可执行文件"><a href="#把代码编译成可执行文件" class="headerlink" title="把代码编译成可执行文件"></a>把代码编译成可执行文件</h2><p>这里官方推荐使用多进程编译，推荐七个进程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 报错：</span></span><br><span class="line"><span class="comment"># modules/cudalegacy/src/graphcuts.cpp:120:54: error: </span></span><br><span class="line"><span class="comment"># ‘NppiGraphcutState’ has not been declared</span></span><br><span class="line"><span class="comment"># typedef NppStatus (*init_func_t)(NppiSize oSize, </span></span><br><span class="line"><span class="comment"># NppiGraphcutState** ppState, Npp8u* pDeviceMem);</span></span><br><span class="line"><span class="comment"># 这是因为opecv3.0与cuda8.0不兼容导致的。解决办法： </span></span><br><span class="line"><span class="comment"># 修改 ～/opencv/modules/cudalegacy/src/graphcuts.cpp文件内容</span></span><br><span class="line"><span class="comment"># 将  </span></span><br><span class="line"><span class="comment"># #if !defined (HAVE_CUDA) || defined (CUDA_DISABLER)   </span></span><br><span class="line"><span class="comment"># 改为  </span></span><br><span class="line"><span class="comment"># #if !defined (HAVE_CUDA) || defined (CUDA_DISABLER) || (CUDART_VERSION &gt;= 8000) </span></span><br><span class="line">make -j7 <span class="comment"># 并行运行七个jobs，这一步也在build目录中进行</span></span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo make install</span><br><span class="line"></span><br><span class="line">如果你要在python下运行opencv库的情况下，那就必须安装安装python-opencv</span><br><span class="line">sudo apt-get install python-opencv</span><br></pre></td></tr></table></figure><h2 id="配置库文件路径"><a href="#配置库文件路径" class="headerlink" title="配置库文件路径"></a>配置库文件路径</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">'echo "/usr/local/lib" &gt; /etc/ld.so.conf.d/opencv.conf'</span></span><br><span class="line"><span class="comment">#或者直接打开/etc/ld.so.conf.d/opencv.conf，添加/usr/local/lib</span></span><br><span class="line"><span class="comment">#使配置生效</span></span><br><span class="line">sudo  ldconfig(重要)</span><br></pre></td></tr></table></figure><h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo vim/etc/bash.bashrc   </span><br><span class="line"><span class="comment">#在最后加入以下两行代码</span></span><br><span class="line">PKG_CONFIG_PATH=<span class="variable">$PKG_CONFIG_PATH</span>:/usr/<span class="built_in">local</span>/lib/pkgconfig </span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH  </span><br><span class="line"><span class="comment">#使配置生效</span></span><br><span class="line">sudo <span class="built_in">source</span> /etc/bash.bashrc </span><br><span class="line">（该步骤可能会报错找不到命令，原因是<span class="built_in">source</span>为root命令</span><br><span class="line">su（进入root权限）</span><br></pre></td></tr></table></figure><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkg-config --modversion opencv</span><br><span class="line">pkg-config --cflags opencv</span><br></pre></td></tr></table></figure><h2 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h2><p>我是用python+opencv的，我这里直接运行opencv自带的python的例子程序，TX1自带摄像头不能用，需要使用外接USB摄像头，插入USB接口即可，无需安装驱动，也无需改动测试代码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> &lt;opencv3.1.0_dir&gt;/samples/python/</span><br><span class="line">python video.py</span><br><span class="line">python edge.py</span><br><span class="line">python facedetect.py</span><br></pre></td></tr></table></figure><h1 id="colmap配置"><a href="#colmap配置" class="headerlink" title="colmap配置"></a><a href="https://colmap.github.io/tutorial.html" target="_blank" rel="noopener">colmap</a>配置</h1><p>clone colmap源码到本地：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/colmap/colmap</span><br></pre></td></tr></table></figure><p>安装依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install cmake build-essential libboost-all-dev libeigen3-dev libsuitesparse-dev libfreeimage-dev libgoogle-glog-dev libgflags-dev libglew-dev qtbase5-dev libqt5opengl5-dev</span><br></pre></td></tr></table></figure><p>配置Ceres Solver:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libatlas-base-dev libsuitesparse-dev</span><br><span class="line">git <span class="built_in">clone</span> https://ceres-solver.googlesource.com/ceres-solver</span><br><span class="line"><span class="built_in">cd</span> ceres-solver</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DBUILD_TESTING=OFF -DBUILD_EXAMPLES=OFF</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line"><span class="comment"># 注：如果该安装包无法下载，请离线下载安装，需翻墙</span></span><br></pre></td></tr></table></figure><p>配置和编译colmap:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> path/to/colmap</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make -j8</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>运行colmap:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">colmap -h</span><br><span class="line">colmap gui</span><br></pre></td></tr></table></figure><h1 id="Caffe配置"><a href="#Caffe配置" class="headerlink" title="Caffe配置"></a>Caffe配置</h1><p>安装依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-dev libopencv-dev libhdf5-serial-dev protobuf-compiler</span><br><span class="line">sudo apt-get install --no-install-recommends libboost-all-dev</span><br><span class="line">sudo apt-get install libopenblas-dev liblapack-dev libatlas-base-dev</span><br><span class="line">sudo apt-get install libgflags-dev libgoogle-glog-dev liblmdb-dev</span><br><span class="line">sudo apt-get install git cmake build-essential</span><br></pre></td></tr></table></figure><p>有一定几率安装失败而导致后续步骤出现问题，所以要确保以上依赖包都已安装成功，验证方法就是重新运行安装命令，如验证 git cmake build-essential是否安装成功共则再次运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git cmake build-essential</span><br></pre></td></tr></table></figure><p>安装的路径下 clone ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/BVLC/caffe.git</span><br></pre></td></tr></table></figure><p>进入 caffe ，将 Makefile.config.example 文件复制一份并更名为 Makefile.config ，也可以在 caffe 目录下直接调用以下命令完成复制操作 ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp Makefile.config.example Makefile.config</span><br></pre></td></tr></table></figure><p>复制一份的原因是编译 caffe 时需要的是 Makefile.config 文件，而Makefile.config.example 只是caffe 给出的配置文件例子，不能用来编译 caffe。</p><p>参考我的Makefile.config：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Refer to http://caffe.berkeleyvision.org/installation.html</span></span><br><span class="line"><span class="comment"># Contributions simplifying and improving our build system are welcome!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cuDNN acceleration switch (uncomment to build with cuDNN).</span></span><br><span class="line"><span class="comment"># USE_CUDNN := 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU-only switch (uncomment to build without GPU support).</span></span><br><span class="line"><span class="comment"># CPU_ONLY := 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment to disable IO dependencies and corresponding data layers</span></span><br><span class="line"><span class="comment"># USE_OPENCV := 0</span></span><br><span class="line"><span class="comment"># USE_LEVELDB := 0</span></span><br><span class="line"><span class="comment"># USE_LMDB := 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment to allow MDB_NOLOCK when reading LMDB files (only if necessary)</span></span><br><span class="line"><span class="comment">#You should not set this flag if you will be reading LMDBs with any</span></span><br><span class="line"><span class="comment">#possibility of simultaneous read and write</span></span><br><span class="line"><span class="comment"># ALLOW_LMDB_NOLOCK := 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment if you're using OpenCV 3</span></span><br><span class="line">OPENCV_VERSION := 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># To customize your choice of compiler, uncomment and set the following.</span></span><br><span class="line"><span class="comment"># N.B. the default for Linux is g++ and the default for OSX is clang++</span></span><br><span class="line"><span class="comment"># CUSTOM_CXX := g++</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CUDA directory contains bin/ and lib/ directories that we need.</span></span><br><span class="line">CUDA_DIR := /usr/<span class="built_in">local</span>/cuda</span><br><span class="line"><span class="comment"># On Ubuntu 14.04, if cuda tools are installed via</span></span><br><span class="line"><span class="comment"># "sudo apt-get install nvidia-cuda-toolkit" then use this instead:</span></span><br><span class="line"><span class="comment"># CUDA_DIR := /usr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CUDA architecture setting: going with all of them.</span></span><br><span class="line"><span class="comment"># For CUDA &lt; 6.0, comment the *_50 lines for compatibility.</span></span><br><span class="line">CUDA_ARCH := -gencode arch=compute_20,code=sm_20 \</span><br><span class="line">-gencode arch=compute_20,code=sm_21 \</span><br><span class="line">-gencode arch=compute_30,code=sm_30 \</span><br><span class="line">-gencode arch=compute_35,code=sm_35 \</span><br><span class="line">-gencode arch=compute_50,code=sm_50 \</span><br><span class="line">-gencode arch=compute_50,code=compute_50</span><br><span class="line"></span><br><span class="line"><span class="comment"># BLAS choice:</span></span><br><span class="line"><span class="comment"># atlas for ATLAS (default)</span></span><br><span class="line"><span class="comment"># mkl for MKL</span></span><br><span class="line"><span class="comment"># open for OpenBlas</span></span><br><span class="line">BLAS := open</span><br><span class="line"><span class="comment"># Custom (MKL/ATLAS/OpenBLAS) include and lib directories.</span></span><br><span class="line"><span class="comment"># Leave commented to accept the defaults for your choice of BLAS</span></span><br><span class="line"><span class="comment"># (which should work)!</span></span><br><span class="line"><span class="comment"># BLAS_INCLUDE := /path/to/your/blas</span></span><br><span class="line"><span class="comment"># BLAS_LIB := /path/to/your/blas</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Homebrew puts openblas in a directory that is not on the standard search path</span></span><br><span class="line"><span class="comment"># BLAS_INCLUDE := $(shell brew --prefix openblas)/include</span></span><br><span class="line"><span class="comment"># BLAS_LIB := $(shell brew --prefix openblas)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This is required only if you will compile the matlab interface.</span></span><br><span class="line"><span class="comment"># MATLAB directory should contain the mex binary in /bin.</span></span><br><span class="line"><span class="comment"># MATLAB_DIR := /usr/local</span></span><br><span class="line"><span class="comment"># MATLAB_DIR := /Applications/MATLAB_R2012b.app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> this is required only if you will compile the python interface.</span></span><br><span class="line"><span class="comment"># We need to be able to find Python.h and numpy/arrayobject.h.</span></span><br><span class="line">PYTHON_INCLUDE := /usr/include/python2.7 \</span><br><span class="line">/usr/lib64/python2.7/site-packages/numpy/core/include</span><br><span class="line"><span class="comment"># Anaconda Python distribution is quite popular. Include path:</span></span><br><span class="line"><span class="comment"># Verify anaconda location, sometimes it's in root.</span></span><br><span class="line"><span class="comment"># ANACONDA_HOME := $(HOME)/anaconda</span></span><br><span class="line"><span class="comment"># PYTHON_INCLUDE := $(ANACONDA_HOME)/include \</span></span><br><span class="line"><span class="comment"># $(ANACONDA_HOME)/include/python2.7 \</span></span><br><span class="line"><span class="comment"># $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include \</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># We need to be able to find libpythonX.X.so or .dylib.</span></span><br><span class="line">PYTHON_LIB := /usr/lib</span><br><span class="line"><span class="comment"># PYTHON_LIB := $(ANACONDA_HOME)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Homebrew installs numpy in a non standard path (keg only)</span></span><br><span class="line"><span class="comment"># PYTHON_INCLUDE += $(dir $(shell python -c 'import numpy.core; print(numpy.core.__file__)'))/include</span></span><br><span class="line"><span class="comment"># PYTHON_LIB += $(shell brew --prefix numpy)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to support layers written in Python (will link against Python libs)</span></span><br><span class="line">WITH_PYTHON_LAYER := 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Whatever else you find you need goes here.</span></span><br><span class="line">INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/<span class="built_in">local</span>/include /usr/include/hdf5/serial/</span><br><span class="line">LIBRARY_DIRS := $(PYTHON_LIB) /usr/<span class="built_in">local</span>/lib /usr/lib /usr/lib/x86_64-linux-gnu /usr/lib/x86_64-linux-gnu/hdf5/serial</span><br><span class="line"></span><br><span class="line"><span class="comment"># If Homebrew is installed at a non standard location (for example your home directory) and you use it for general dependencies</span></span><br><span class="line"><span class="comment"># INCLUDE_DIRS += $(shell brew --prefix)/include</span></span><br><span class="line"><span class="comment"># LIBRARY_DIRS += $(shell brew --prefix)/lib</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment to use `pkg-config` to specify OpenCV library paths.</span></span><br><span class="line"><span class="comment"># (Usually not necessary -- OpenCV libraries are normally installed in one of the above $LIBRARY_DIRS.)</span></span><br><span class="line"><span class="comment"># USE_PKG_CONFIG := 1</span></span><br><span class="line"></span><br><span class="line">BUILD_DIR := build</span><br><span class="line">DISTRIBUTE_DIR := distribute</span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment for debugging. Does not work on OSX due to https://github.com/BVLC/caffe/issues/171</span></span><br><span class="line"><span class="comment"># DEBUG := 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The ID of the GPU that 'make runtest' will use to run unit tests.</span></span><br><span class="line">TEST_GPUID := 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># enable pretty build (comment to see full commands)</span></span><br><span class="line">Q ?= @</span><br></pre></td></tr></table></figure><p>可以开始编译了，在 caffe 目录下执行 ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make all -j8</span><br><span class="line">sudo make runtest -j8</span><br><span class="line">sudo make pycaffe -j8 <span class="comment"># 安装 pycaffe notebook 接口环境</span></span><br></pre></td></tr></table></figure><h1 id="darknet配置"><a href="#darknet配置" class="headerlink" title="darknet配置"></a><a href="https://pjreddie.com/darknet/yolo/" target="_blank" rel="noopener">darknet</a>配置</h1><p>环境: Ubuntu16.04 + Titan X + Cuda8.0 + OpenCV3.1 + Python2.7</p><p>请参考前文。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/pjreddie/darknet</span><br><span class="line"><span class="built_in">cd</span> darknet</span><br><span class="line"><span class="comment"># 配置Makefile</span></span><br><span class="line"><span class="comment"># GPU=1</span></span><br><span class="line"><span class="comment"># CUDNN=0</span></span><br><span class="line"><span class="comment"># OPENCV=1</span></span><br><span class="line"><span class="comment"># DEBUG=0</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure><p>可能出现的报错：</p><p>（1）error:/usr/bin/ld: 找不到 -lippicv&lt;/br &gt;<br>collect2: error: ld returned 1 exit status &lt;/br &gt;<br>Makefile:82: recipe for target ‘libdarknet.so’ failed &lt;/br &gt;</p><p>解决方法：找到-lippicv对应的库（libippicv.a），该库位于 安装目录./opencv-3.1.0/3rdparty/ippicv/unpack/ippicv_lnx/lib/intel64文件夹下 ，进入该文件夹下执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo cp sudo cp libippicv.a /usr/<span class="built_in">local</span>/lib/</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">继续执行make 即可。</span><br><span class="line"></span><br><span class="line">（2）找不到nvcc</span><br><span class="line"></span><br><span class="line">解决方法：修改darknet下的Makefile文件，将其中的NVCC=nvcc改为/usr/<span class="built_in">local</span>/cuda-*/bin/nvcc即安装的cuda版本信息</span><br><span class="line"></span><br><span class="line">保存  继续执行make 即可。</span><br><span class="line"></span><br><span class="line">下载权重测试:</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">wget http://pjreddie.com/media/files/yolo.weights  </span><br><span class="line">./darknet yolo <span class="built_in">test</span> cfg/yolo.cfg yolo.weights data/dog.jpg   </span><br><span class="line">./darknet detect cfg/yolo.cfg yolo.weights data/dog.jpg</span><br></pre></td></tr></table></figure><ul><li><a href="https://blog.csdn.net/ch_liu23/article/details/53558549" target="_blank" rel="noopener">YOLOv2训练自己的数据集（VOC格式）</a></li><li><a href="https://blog.csdn.net/jozeeh/article/details/79087311" target="_blank" rel="noopener">YOLOv2目标检测_单目标_训练自己数据全过程（自用）</a></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol><li><a href="https://www.liaohuqiu.net/cn/posts/ssh-public-key-auto-login/" target="_blank" rel="noopener">https://www.liaohuqiu.net/cn/posts/ssh-public-key-auto-login/</a></li><li><a href="https://blog.csdn.net/asukasmallriver/article/details/72927860" target="_blank" rel="noopener">https://blog.csdn.net/asukasmallriver/article/details/72927860</a></li><li><a href="https://blog.csdn.net/u011440558/article/details/78358447" target="_blank" rel="noopener">https://blog.csdn.net/u011440558/article/details/78358447</a></li><li><a href="https://www.mtyun.com/library/how-to-install-caffe-on-centos7" target="_blank" rel="noopener">https://www.mtyun.com/library/how-to-install-caffe-on-centos7</a></li><li><a href="https://blog.csdn.net/qq_28413479/article/details/76377184" target="_blank" rel="noopener">https://blog.csdn.net/qq_28413479/article/details/76377184</a></li><li><a href="https://blog.csdn.net/yhaolpz/article/details/71375762" target="_blank" rel="noopener">https://blog.csdn.net/yhaolpz/article/details/71375762</a></li><li><a href="https://www.jianshu.com/p/10ed332caf07" target="_blank" rel="noopener">https://www.jianshu.com/p/10ed332caf07</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Linux </category>
          
          <category> 环境配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Linux </tag>
            
            <tag> 环境配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深度学习-TensorFlow教程</title>
      <link href="/2018/03/30/machine_learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-TensorFlow%E6%95%99%E7%A8%8B/"/>
      <url>/2018/03/30/machine_learning/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-TensorFlow%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="TensorFlow简介"><a href="#TensorFlow简介" class="headerlink" title="TensorFlow简介"></a>TensorFlow简介</h1><p>TensorFlow是Google开发的一款神经网络的Python外部的结构包, 也是一个采用数据流图来进行数值计算的开源软件库.TensorFlow 让我们可以先绘制计算结构图, 也可以称是一系列可人机交互的计算操作, 然后把编辑好的Python文件 转换成 更高效的C++, 并在后端进行计算.</p><h1 id="TensorFlow安装"><a href="#TensorFlow安装" class="headerlink" title="TensorFlow安装"></a>TensorFlow安装</h1><h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><h3 id="Dock安装"><a href="#Dock安装" class="headerlink" title="Dock安装"></a>Dock安装</h3><p>Docker安装请参考<a href="http://mapstec.com/2018/03/29/%E5%AE%9E%E9%AA%8C%E5%AE%A4GPU%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">实验室GPU服务器部署教程</a></p><p>Docker 需要用户具有 sudo 权限，为了避免每次命令都输入sudo，可以把用户加入 Docker 用户组，参考：<a href="https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user" target="_blank" rel="noopener">docker docs</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h3 id="安装NVIDIA-Docker"><a href="#安装NVIDIA-Docker" class="headerlink" title="安装NVIDIA-Docker"></a>安装NVIDIA-Docker</h3><p>安装完成docker并检查安装正确（能跑出来hello-world）后，如果需要docker容器中有gpu支持，需要再安装NVIDIA-Docker，同样找到并打开该项目的主页：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NVIDIA/nvidia-docker: Build and run Docker containers leveraging NVIDIA GPUs</span><br><span class="line">https://github.com/NVIDIA/nvidia-docker</span><br></pre></td></tr></table></figure><p>可以看到在Quick start小节，根据系统版本执行命令：</p><p>Ubuntu 14.04/16.04/18.04, Debian Jessie/Stretch：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span></span><br><span class="line">docker volume ls -q -f driver=nvidia-docker | xargs -r -I&#123;&#125; -n1 docker ps -q -a -f volume=&#123;&#125; | xargs -r docker rm -f</span><br><span class="line">sudo apt-get purge -y nvidia-docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the package repositories</span></span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | \</span><br><span class="line">  sudo apt-key add -</span><br><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> <span class="variable">$ID</span><span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/<span class="variable">$distribution</span>/nvidia-docker.list | \</span><br><span class="line">  sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install nvidia-docker2 and reload the Docker daemon configuration</span></span><br><span class="line">sudo apt-get install -y nvidia-docker2</span><br><span class="line">sudo pkill -SIGHUP dockerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test nvidia-smi with the latest official CUDA image</span></span><br><span class="line">docker run --runtime=nvidia --rm nvidia/cuda nvidia-smi</span><br></pre></td></tr></table></figure><p>CentOS 7 (docker-ce), RHEL 7.4/7.5 (docker-ce), Amazon Linux 1/2:</p><p>If you are not using the official docker-ce package on CentOS/RHEL, use the next section.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span></span><br><span class="line">docker volume ls -q -f driver=nvidia-docker | xargs -r -I&#123;&#125; -n1 docker ps -q -a -f volume=&#123;&#125; | xargs -r docker rm -f</span><br><span class="line">sudo yum remove nvidia-docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the package repositories</span></span><br><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> <span class="variable">$ID</span><span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-docker/<span class="variable">$distribution</span>/nvidia-docker.repo | \</span><br><span class="line">  sudo tee /etc/yum.repos.d/nvidia-docker.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install nvidia-docker2 and reload the Docker daemon configuration</span></span><br><span class="line">sudo yum install -y nvidia-docker2</span><br><span class="line">sudo pkill -SIGHUP dockerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test nvidia-smi with the latest official CUDA image</span></span><br><span class="line">docker run --runtime=nvidia --rm nvidia/cuda nvidia-smi</span><br></pre></td></tr></table></figure><p>If yum reports a conflict on /etc/docker/daemon.json with the docker package, you need to use the next section instead.</p><p>CentOS 7 (docker), RHEL 7.4/7.5 (docker):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If you have nvidia-docker 1.0 installed: we need to remove it and all existing GPU containers</span></span><br><span class="line">docker volume ls -q -f driver=nvidia-docker | xargs -r -I&#123;&#125; -n1 docker ps -q -a -f volume=&#123;&#125; | xargs -r docker rm -f</span><br><span class="line">sudo yum remove nvidia-docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the package repositories</span></span><br><span class="line">distribution=$(. /etc/os-release;<span class="built_in">echo</span> <span class="variable">$ID</span><span class="variable">$VERSION_ID</span>)</span><br><span class="line">curl -s -L https://nvidia.github.io/nvidia-container-runtime/<span class="variable">$distribution</span>/nvidia-container-runtime.repo | \</span><br><span class="line">  sudo tee /etc/yum.repos.d/nvidia-container-runtime.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the nvidia runtime hook</span></span><br><span class="line">sudo yum install -y nvidia-container-runtime-hook</span><br><span class="line">sudo mkdir -p /usr/libexec/oci/hooks.d</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">'#!/bin/sh\nPATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" exec nvidia-container-runtime-hook "$@"'</span> | \</span><br><span class="line">  sudo tee /usr/libexec/oci/hooks.d/nvidia</span><br><span class="line">sudo chmod +x /usr/libexec/oci/hooks.d/nvidia</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test nvidia-smi with the latest official CUDA image</span></span><br><span class="line"><span class="comment"># You can't use `--runtime=nvidia` with this setup.</span></span><br><span class="line">docker run --rm nvidia/cuda nvidia-smi</span><br></pre></td></tr></table></figure><p>上面最后一条命令是检查是否安装成功，安装成功，则会显示关于GPU的信息。</p><p>然后在执行下面这句，默认用nvdia-docker替代docker命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'alias docker=nvidia-docker'</span> &gt;&gt; ~/.bashrc</span><br><span class="line">bash</span><br></pre></td></tr></table></figure><h3 id="下载使用TensorFlow镜像"><a href="#下载使用TensorFlow镜像" class="headerlink" title="下载使用TensorFlow镜像"></a>下载使用TensorFlow镜像</h3><p>打开dockerhub关于tensorflow的页面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensorflow/tensorflow – Docker Hub</span><br><span class="line">https://hub.docker.com/r/tensorflow/tensorflow/</span><br></pre></td></tr></table></figure><p>根据需要的版本下载tensorflow镜像并开启tensorflow容器：</p><p>CPU版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 8888:8888 tensorflow/tensorflow</span><br></pre></td></tr></table></figure><p>GPU版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-docker run -it -p 8888:8888 tensorflow/tensorflow:latest-gpu</span><br></pre></td></tr></table></figure><p>如何使用,执行以上命令的结果类似如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ nvidia-docker run -it -p 8888:8888 tensorflow/tensorflow:latest-gpu</span><br><span class="line">[I 02:51:21.230 NotebookApp] Writing notebook server cookie secret to /root/.<span class="built_in">local</span>/share/jupyter/runtime/notebook_cookie_secret</span><br><span class="line">[W 02:51:21.242 NotebookApp] WARNING: The notebook server is listening on all IP addresses and not using encryption. This is not recommended.</span><br><span class="line">[I 02:51:21.249 NotebookApp] Serving notebooks from <span class="built_in">local</span> directory: /notebooks</span><br><span class="line">[I 02:51:21.249 NotebookApp] 0 active kernels </span><br><span class="line">[I 02:51:21.249 NotebookApp] The Jupyter Notebook is running at: http://[all ip addresses on your system]:8888/?token=8f90cc7b9ad6ccc4f36f53f347c7a314220bbcb82dd416ea</span><br><span class="line">[I 02:51:21.249 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 02:51:21.249 NotebookApp] </span><br><span class="line">    </span><br><span class="line">    Copy/paste this URL into your browser when you connect <span class="keyword">for</span> the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8888/?token=8f90cc7b9ad6ccc4f36f53f347c7a314220bbcb82dd416ea</span><br><span class="line">[I 02:51:31.832 NotebookApp] 302 GET / (172.17.0.1) 0.74ms</span><br><span class="line">[I 02:51:31.943 NotebookApp] 302 GET /tree? (172.17.0.1) 1.44ms</span><br></pre></td></tr></table></figure><p>其中看到有个网址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8888/?token=8f90cc7b9ad6ccc4f36f53f347c7a314220bbcb82dd416ea</span><br></pre></td></tr></table></figure><p>每个人的网址在token=后面的内容是不一样的，现在我们打开浏览器，输入网址：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8888/</span><br></pre></td></tr></table></figure><p>输入刚刚token后面的值后,点击第一个1_hello_tensorflow.ipynb，然后可以选择执行所有代码.</p><p>常用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image pull library/hello-world</span><br></pre></td></tr></table></figure><p>上面代码中，docker image pull是抓取 image 文件的命令。library/hello-world是 image 文件在仓库里面的位置，其中library是 image 文件所在的组，hello-world是 image 文件的名字。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls</span><br></pre></td></tr></table></figure><p>抓取成功以后，就可以在本机看到这个 image 文件了。运行这个 image 文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run hello-world</span><br></pre></td></tr></table></figure><p>docker container run命令会从 image 文件，生成一个正在运行的容器实例。</p><p>注意，docker container run命令具有自动抓取 image 文件的功能。如果发现本地没有指定的 image 文件，就会从仓库自动抓取。因此，前面的docker image pull命令并不是必需的步骤。</p><p>有些容器不会自动终止，因为提供的是服务。比如，安装运行 Ubuntu 的 image，就可以在命令行体验 Ubuntu 系统。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container run -it ubuntu bash</span><br></pre></td></tr></table></figure><p>对于那些不会自动终止的容器，必须使用docker container kill 命令手动终止。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container <span class="built_in">kill</span> [containID]</span><br></pre></td></tr></table></figure><p>image 文件生成的容器实例，本身也是一个文件，称为容器文件。也就是说，一旦容器生成，就会同时存在两个文件： image 文件和容器文件。而且关闭容器并不会删除容器文件，只是容器停止运行而已。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出本机正在运行的容器</span></span><br><span class="line">$ docker container ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出本机所有容器，包括终止运行的容器</span></span><br><span class="line">$ docker container ls --all</span><br></pre></td></tr></table></figure><p>上面命令的输出结果之中，包括容器的 ID。很多地方都需要提供这个 ID，比如上一节终止容器运行的docker container kill命令。</p><p>终止运行的容器文件，依然会占据硬盘空间，可以使用docker container rm命令删除。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker container rm [containerID]</span><br></pre></td></tr></table></figure><p>运行上面的命令之后，再使用docker container ls —all命令，就会发现被删除的容器文件已经消失了。</p><p>创建tensorflow docker容器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker container run --name [name] -it -p 8888:8888 tensorflow/tensorflow:latest-gpu /bin/bash</span><br><span class="line"><span class="comment"># [name]-- 容器的名字</span></span><br><span class="line"><span class="comment"># -it -- 保留命令行运行</span></span><br><span class="line"><span class="comment"># -p 8888:8888 —— 将本地的8888端口和http://localhost:8888/映射</span></span><br><span class="line"><span class="comment"># tensorflow/tensorflow:latest-gpu ：默认是tensorflow/tensorflow:latest,指定使用的镜像</span></span><br></pre></td></tr></table></figure><p>启动docker：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start [name]</span><br></pre></td></tr></table></figure><p>进入docker:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker attach [name]</span><br></pre></td></tr></table></figure><p>重命名docker:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rename  old_name new_name</span><br></pre></td></tr></table></figure><h3 id="如何进入正在执行的-docker-container"><a href="#如何进入正在执行的-docker-container" class="headerlink" title="如何进入正在执行的 docker container"></a>如何进入正在执行的 docker container</h3><h4 id="docker-attach"><a href="#docker-attach" class="headerlink" title="docker attach"></a>docker attach</h4><p>这个是官方提供的一种方法。</p><p>测试，首先启动一个container:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -i -t ubuntu bash</span><br><span class="line">root@4556f5ad6067:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>不要退出，打开另一个终端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">4556f5ad6067        ubuntu:14.04        <span class="string">"bash"</span>              45 seconds ago      Up 43 seconds                           jolly_ardinghelli</span><br><span class="line"></span><br><span class="line">$ docker attach 4556f5ad6067</span><br><span class="line">root@4556f5ad6067:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这样就连接进去了。这时候如果我们输入一些命令，就能看到在两个终端都有显示和输出。这种方式有比较大的局限性，如果知道了entrypoint或者有程序正在执行，通过docker attach进入之后是不能执行操作的，一个终端退出之后整个container就终止了。不推荐使用这种方式。</p><h4 id="lxc-attach"><a href="#lxc-attach" class="headerlink" title="lxc-attach"></a>lxc-attach</h4><p>如果使用这种方式，首先要保证docker是以lxc方式启动的，具体可以这样做：</p><p>修改/etc/default/docker增加DOCKER_OPTS=”-e lxc”</p><p>重启docker服务sudo service docker restart</p><p>启动container的方式和之前一样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -i -t ubuntu bash</span><br><span class="line">root@e7f01f0ff598:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>进入container可以这样：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">e7f01f0ff598        ubuntu:14.04        <span class="string">"bash"</span>              17 seconds ago      Up 15 seconds                           grave_jones</span><br><span class="line"></span><br><span class="line">$ ps aux | grep e7f01f0ff598</span><br><span class="line">root     23691  0.0  0.0  43140  1876 pts/9    Ss   21:47   0:00 lxc-start -n e7f01f0ff598c80d70a996135c98fbaeddc6daa61436bbbfa735233e8b6f8ebe -f /var/lib/docker/containers/e7f01f0ff598c80d70a996135c98fbaeddc6daa61436bbbfa735233e8b6f8ebe/config.lxc -- /.dockerinit -g 172.17.42.1 -i 172.17.0.3/16 -mtu 1500 -- bash</span><br><span class="line">ma6174   23756  0.0  0.0  13428   928 pts/12   S+   21:47   0:00 grep --color=auto e7f01f0ff598</span><br><span class="line"></span><br><span class="line">$ sudo lxc-attach -n e7f01f0ff598c80d70a996135c98fbaeddc6daa61436bbbfa735233e8b6f8ebe</span><br><span class="line">root@e7f01f0ff598:/<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这种方式还是很方便的。前提是需要重启docker服务以lxc的方式执行，进入container之后会有一个终端可以执行命令，不影响正在执行的程序。</p><h4 id="nsenter"><a href="#nsenter" class="headerlink" title="nsenter"></a>nsenter</h4><p>如果docker不是以lxc方式启动的，这时候还想进入一个正在执行的container的话，可以考虑使用nsenter</p><p>这个程序的安装方式很独特，使用docker进行安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -v /usr/<span class="built_in">local</span>/bin:/target jpetazzo/nsenter</span><br></pre></td></tr></table></figure><p>使用方法也很简单，首先你要进入的container的PID：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ PID=$(docker inspect --format &#123;&#123;.State.Pid&#125;&#125; &lt;container_name_or_ID&gt;)</span><br></pre></td></tr></table></figure><p>然后就可以用这个命令进入container了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nsenter --target <span class="variable">$PID</span> --mount --uts --ipc --net --pid</span><br></pre></td></tr></table></figure><p>为了使用方便可以写一个脚本自动完成：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat /bin/docker_enter</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sudo nsenter --target `docker inspect --format &#123;&#123;.State.Pid&#125;&#125; <span class="variable">$1</span>` --mount --uts --ipc --net --pid bash</span><br></pre></td></tr></table></figure><p>这样每次要进入某个container只需要执行docker_enter <container_name_or_id>就可以了。</container_name_or_id></p><h4 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h4><p>这个原理也很简单，在container里面启动ssh服务，然后通过ssh的方式去登陆到container里面，不推荐这种方式，主要是配置ssh登陆比较繁琐，开启ssh服务也会耗费资源，完全没有必要。</p><h3 id="TensorFlow安装方式一"><a href="#TensorFlow安装方式一" class="headerlink" title="TensorFlow安装方式一"></a>TensorFlow安装方式一</h3><ol><li><p>下载镜像</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tensorflow/tensorflow</span><br></pre></td></tr></table></figure></li><li><p>创建Tensorflow容器</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name my-tensorflow -it -p 8888:8888 -v ~/tensorflow:/<span class="built_in">test</span>/data tensorflow/tensorflow</span><br><span class="line"><span class="comment"># --name：创建的容器名，即my-tensorflow</span></span><br><span class="line"><span class="comment"># -it：保留命令行运行</span></span><br><span class="line"><span class="comment"># p 8888:8888：将本地的8888端口和http://localhost:8888/映射</span></span><br><span class="line"><span class="comment"># -v ~/tensorflow:/test/data:将本地的~/tensorflow挂载到容器内的/# test/data下</span></span><br><span class="line"><span class="comment"># tensorflow/tensorflow ：默认是tensorflow/tensorflow:latest,指定使用的镜像</span></span><br></pre></td></tr></table></figure></li><li><p>拷贝带token的URL在浏览器打开</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://[all ip addresses on your system]:8888/?token=649d7cab1734e01db75b6c2b476ea87aa0b24dde56662a27</span><br></pre></td></tr></table></figure></li><li><p>显示Jupyter Notebook，Jupyter Notebook（此前被称为 IPython notebook）是一个交互式笔记本。示例中已经显示了Tensorflow的入门教程，点开一个可以看见。</p></li><li><p>关闭容器</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop my-tensortflow</span><br></pre></td></tr></table></figure></li><li><p>再次打开</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start my-tensortflow</span><br></pre></td></tr></table></figure></li></ol><h3 id="TensorFlow安装方式二"><a href="#TensorFlow安装方式二" class="headerlink" title="TensorFlow安装方式二"></a>TensorFlow安装方式二</h3><ol><li><p>下载镜像</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tensorflow/tensorflow</span><br></pre></td></tr></table></figure></li><li><p>创建Tensorflow容器</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name bash_tensorflow tensorflow/tensorflow /bin/bash</span><br><span class="line"><span class="comment"># 这样我们就创建了名为bash_tensorflow的容器</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>start命令启动容器</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start bash_tensorflow</span><br></pre></td></tr></table></figure></li><li><p>再连接上容器</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker attach bash_tensorflow</span><br><span class="line"><span class="comment"># 可以看到我们用终端连接上了容器，和操作Linux一样了。</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Pip安装"><a href="#Pip安装" class="headerlink" title="Pip安装"></a>Pip安装</h2><h3 id="Linux-和-MacOS"><a href="#Linux-和-MacOS" class="headerlink" title="Linux 和 MacOS"></a>Linux 和 MacOS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu/Linux 64-位 系统的执行代码:</span></span><br><span class="line">$ sudo apt-get install python-pip python-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mac OS X 系统的执行代码:</span></span><br><span class="line">$ sudo easy_install --upgrade pip</span><br><span class="line">$ sudo easy_install --upgrade six</span><br></pre></td></tr></table></figure><ol><li><p>CPU 版</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python 2+ 的用户:</span></span><br><span class="line">$ pip install tensorflow</span><br><span class="line"></span><br><span class="line"><span class="comment"># python 3+ 的用户:</span></span><br><span class="line">$ pip3 install tensorflow</span><br></pre></td></tr></table></figure></li><li><p>GPU 版</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install libcupti-dev</span><br><span class="line">$ sudo apt-get install python-pip python-dev   <span class="comment"># for Python 2.7</span></span><br><span class="line">$ sudo apt-get install python3-pip python3-dev <span class="comment"># for Python 3.n</span></span><br><span class="line">$ pip install tensorflow      <span class="comment"># Python 2.7; CPU support (no GPU support)</span></span><br><span class="line">$ pip3 install tensorflow     <span class="comment"># Python 3.n; CPU support (no GPU support)</span></span><br><span class="line">$ pip install tensorflow-gpu  <span class="comment"># Python 2.7;  GPU support</span></span><br><span class="line">$ pip3 install tensorflow-gpu <span class="comment"># Python 3.n; GPU support</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>测试</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow</span><br></pre></td></tr></table></figure></li></ol><h1 id="TensorFlow-教程"><a href="#TensorFlow-教程" class="headerlink" title="TensorFlow 教程"></a>TensorFlow 教程</h1><h2 id="Session-会话控制"><a href="#Session-会话控制" class="headerlink" title="Session 会话控制"></a>Session 会话控制</h2><p>参考：</p><ul><li><a href="https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/2-3-session/" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/2-3-session/</a></li></ul><p>Session 是 Tensorflow 为了控制,和输出文件的执行的语句. 运行 session.run() 可以获得你要得知的运算结果, 或者是你所要运算的部分.</p><p>例子讲解：建立两个 matrix ,输出两个 matrix 矩阵相乘的结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># create two matrixes</span></span><br><span class="line"></span><br><span class="line">matrix1 = tf.constant([[<span class="number">3</span>,<span class="number">3</span>]])</span><br><span class="line">matrix2 = tf.constant([[<span class="number">2</span>],</span><br><span class="line">                       [<span class="number">2</span>]])</span><br><span class="line">product = tf.matmul(matrix1,matrix2)</span><br></pre></td></tr></table></figure><p>因为 product 不是直接计算的步骤, 所以我们会要使用 Session 来激活 product 并得到计算结果. 有两种形式使用会话控制 Session 。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># method 1</span></span><br><span class="line">sess = tf.Session()</span><br><span class="line">result = sess.run(product)</span><br><span class="line">print(result)</span><br><span class="line">sess.close()</span><br><span class="line"><span class="comment"># [[12]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># method 2</span></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    result2 = sess.run(product)</span><br><span class="line">    print(result2)</span><br><span class="line"><span class="comment"># [[12]]</span></span><br></pre></td></tr></table></figure><h2 id="Variable-变量"><a href="#Variable-变量" class="headerlink" title="Variable 变量"></a>Variable 变量</h2><p>参考：</p><ul><li><a href="https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/2-4-variable/" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/2-4-variable/</a></li></ul><p>在 Tensorflow 中，定义了某字符串是变量，它才是变量。定义语法： state = tf.Variable()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">state = tf.Variable(<span class="number">0</span>, name=<span class="string">'counter'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义常量 one</span></span><br><span class="line">one = tf.constant(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义加法步骤 (注: 此步并没有直接计算)</span></span><br><span class="line">new_value = tf.add(state, one)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 State 更新成 new_value</span></span><br><span class="line">update = tf.assign(state, new_value)</span><br></pre></td></tr></table></figure><p>如果你在 Tensorflow 中设定了变量，那么初始化变量是最重要的！！所以定义了变量以后, 一定要定义 init = tf.initialize_all_variables() .</p><p>到这里变量还是没有被激活，需要再在 sess 里, sess.run(init) , 激活 init 这一步.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果定义 Variable, 就一定要 initialize</span></span><br><span class="line"><span class="comment"># init = tf.initialize_all_variables() # tf 马上就要废弃这种写法</span></span><br><span class="line">init = tf.global_variables_initializer()  <span class="comment"># 替换成这样就好</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用 Session</span></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        sess.run(update)</span><br><span class="line">        print(sess.run(state))</span><br></pre></td></tr></table></figure><p>注意：直接 print(state) 不起作用！！</p><p>一定要把 sess 的指针指向 state 再进行 print 才能得到想要的结果！</p><h2 id="Placeholder-传入值"><a href="#Placeholder-传入值" class="headerlink" title="Placeholder 传入值"></a>Placeholder 传入值</h2><p>参考：</p><ul><li><a href="https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/2-5-placeholde/" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/2-5-placeholde/</a></li></ul><p>placeholder 是 Tensorflow 中的占位符，暂时储存变量.</p><p>Tensorflow 如果想要从外部传入data, 那就需要用到 tf.placeholder(), 然后以这种形式传输数据 sess.run(<strong>*, feed_dict={input: </strong>}).</p><p>示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment">#在 Tensorflow 中需要定义 placeholder 的 type ，一般为 float32 形式</span></span><br><span class="line">input1 = tf.placeholder(tf.float32)</span><br><span class="line">input2 = tf.placeholder(tf.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mul = multiply 是将input1和input2 做乘法运算，并输出为 output </span></span><br><span class="line">ouput = tf.multiply(input1, input2)</span><br></pre></td></tr></table></figure><p>接下来, 传值的工作交给了 sess.run() , 需要传入的值放在了feed_dict={} 并一一对应每一个 input. placeholder 与 feed_dict={} 是绑定在一起出现的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    print(sess.run(ouput, feed_dict=&#123;input1: [<span class="number">7.</span>], input2: [<span class="number">2.</span>]&#125;))</span><br><span class="line"><span class="comment"># [ 14.]</span></span><br></pre></td></tr></table></figure><h2 id="建造神经网络"><a href="#建造神经网络" class="headerlink" title="建造神经网络"></a>建造神经网络</h2><p>参考：</p><ul><li><a href="https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/3-2-create-NN/" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/3-2-create-NN/</a></li></ul><h3 id="add-layer-功能"><a href="#add-layer-功能" class="headerlink" title="add_layer 功能"></a>add_layer 功能</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_layer</span><span class="params">(inputs, in_size, out_size, activation_function=None)</span>:</span></span><br><span class="line">    Weights = tf.Variable(tf.random_normal([in_size, out_size]))</span><br><span class="line">    biases = tf.Variable(tf.zeros([<span class="number">1</span>, out_size]) + <span class="number">0.1</span>)</span><br><span class="line">    Wx_plus_b = tf.matmul(inputs, Weights) + biases</span><br><span class="line">    <span class="keyword">if</span> activation_function <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        outputs = Wx_plus_b</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        outputs = activation_function(Wx_plus_b)</span><br><span class="line">    <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure><h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p>构建所需的数据。 这里的x_data和y_data并不是严格的一元二次函数的关系，因为我们多加了一个noise,这样看起来会更像真实情况。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x_data = np.linspace(<span class="number">-1</span>,<span class="number">1</span>,<span class="number">300</span>, dtype=np.float32)[:, np.newaxis]</span><br><span class="line">noise = np.random.normal(<span class="number">0</span>, <span class="number">0.05</span>, x_data.shape).astype(np.float32)</span><br><span class="line">y_data = np.square(x_data) - <span class="number">0.5</span> + noise</span><br></pre></td></tr></table></figure><p>利用占位符定义我们所需的神经网络的输入。 tf.placeholder()就是代表占位符，这里的None代表无论输入有多少都可以，因为输入只有一个特征，所以这里是1。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xs = tf.placeholder(tf.float32, [<span class="keyword">None</span>, <span class="number">1</span>])</span><br><span class="line">ys = tf.placeholder(tf.float32, [<span class="keyword">None</span>, <span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>接下来，我们就可以开始定义神经层了。 通常神经层都包括输入层、隐藏层和输出层。这里的输入层只有一个属性， 所以我们就只有一个输入；隐藏层我们可以自己假设，这里我们假设隐藏层有10个神经元； 输出层和输入层的结构是一样的，所以我们的输出层也是只有一层。 所以，我们构建的是——输入层1个、隐藏层10个、输出层1个的神经网络。</p><h3 id="搭建网络"><a href="#搭建网络" class="headerlink" title="搭建网络"></a>搭建网络</h3><p>利用之前的add_layer()函数，这里使用 Tensorflow 自带的激励函数tf.nn.relu。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l1 = add_layer(xs, <span class="number">1</span>, <span class="number">10</span>, activation_function=tf.nn.relu)</span><br></pre></td></tr></table></figure><p>接着，定义输出层。此时的输入就是隐藏层的输出——l1，输入有10层（隐藏层的输出层），输出有1层。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prediction = add_layer(l1, <span class="number">10</span>, <span class="number">1</span>, activation_function=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure><p>计算预测值prediction和真实值的误差，对二者差的平方求和再取平均。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loss = tf.reduce_mean(tf.reduce_sum(tf.square(ys - prediction),</span><br><span class="line">                     reduction_indices=[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><p>接下来，是很关键的一步，如何让机器学习提升它的准确率。tf.train.GradientDescentOptimizer()中的值通常都小于1，这里取的是0.1，代表以0.1的效率来最小化误差loss。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_step = tf.train.GradientDescentOptimizer(<span class="number">0.1</span>).minimize(loss)</span><br></pre></td></tr></table></figure><p>使用变量时，都要对它进行初始化，这是必不可少的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># init = tf.initialize_all_variables() # tf 马上就要废弃这种写法</span></span><br><span class="line">init = tf.global_variables_initializer()  <span class="comment"># 替换成这样就好</span></span><br></pre></td></tr></table></figure><p>定义Session，并用 Session 来执行 init 初始化步骤。 （注意：在tensorflow中，只有session.run()才会执行我们定义的运算。）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sess = tf.Session()</span><br><span class="line">sess.run(init)</span><br></pre></td></tr></table></figure><h3 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h3><p>机器学习的内容是train_step, 用 Session 来 run 每一次 training 的数据，逐步提升神经网络的预测准确性。 (注意：当运算要用到placeholder时，就需要feed_dict这个字典来指定输入。)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">    <span class="comment"># training</span></span><br><span class="line">    sess.run(train_step, feed_dict=&#123;xs: x_data, ys: y_data&#125;)</span><br></pre></td></tr></table></figure><p>每50步我们输出一下机器学习的误差。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> i % <span class="number">50</span> == <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># to see the step improvement</span></span><br><span class="line">    print(sess.run(loss, feed_dict=&#123;xs: x_data, ys: y_data&#125;))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.021204619</span></span><br><span class="line"><span class="number">0.009980676</span></span><br><span class="line"><span class="number">0.007174721</span></span><br><span class="line"><span class="number">0.006633012</span></span><br><span class="line"><span class="number">0.00622975</span></span><br><span class="line"><span class="number">0.005894037</span></span><br><span class="line"><span class="number">0.005621146</span></span><br><span class="line"><span class="number">0.0053801737</span></span><br><span class="line"><span class="number">0.00519997</span></span><br><span class="line"><span class="number">0.005050111</span></span><br><span class="line"><span class="number">0.004922069</span></span><br><span class="line"><span class="number">0.0048095705</span></span><br><span class="line"><span class="number">0.0047140927</span></span><br><span class="line"><span class="number">0.0046234317</span></span><br><span class="line"><span class="number">0.0045334958</span></span><br><span class="line"><span class="number">0.0044504963</span></span><br><span class="line"><span class="number">0.004378309</span></span><br><span class="line"><span class="number">0.0043256846</span></span><br><span class="line"><span class="number">0.0042802156</span></span><br><span class="line"><span class="number">0.0042369063</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 深度学习 </category>
          
          <category> TF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 深度学习 </tag>
            
            <tag> TF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>实验室GPU服务器部署教程</title>
      <link href="/2018/03/29/machine_learning/%E5%AE%9E%E9%AA%8C%E5%AE%A4GPU%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/"/>
      <url>/2018/03/29/machine_learning/%E5%AE%9E%E9%AA%8C%E5%AE%A4GPU%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a><a href="https://docs.docker.com/install/linux/ubuntu/" target="_blank" rel="noopener">Docker</a> 安装</h1><p>参考：<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#set-up-the-repository" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/ubuntu/#set-up-the-repository</a></p><ol><li><p>Prerequisites</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">To install Docker CE, you need the 64-bit version of one of these Ubuntu versions:</span><br><span class="line"></span><br><span class="line">Artful 17.10 (Docker CE 17.11 Edge and higher only)</span><br><span class="line">Xenial 16.04 (LTS)</span><br><span class="line">Trusty 14.04 (LTS)</span><br></pre></td></tr></table></figure></li><li><p>Uninstall old versions</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker docker-engine docker.io</span><br></pre></td></tr></table></figure></li><li><p>Install Docker CE</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get update</span><br><span class="line"><span class="comment"># Install packages to allow apt to use a repository over HTTPS</span></span><br><span class="line">$ sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    software-properties-common</span><br><span class="line"><span class="comment"># Add Docker’s official GPG key:</span></span><br><span class="line">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">$ sudo apt-key fingerprint 0EBFCD88</span><br><span class="line"><span class="comment"># Use the following command to set up the stable repository.</span></span><br><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br><span class="line">$ sudo apt-get update</span><br><span class="line"><span class="comment"># Install the latest version of Docker CE</span></span><br><span class="line">$ sudo apt-get install docker-ce</span><br><span class="line"><span class="comment"># Verify that Docker CE is installed correctly by running the hello-world image.</span></span><br><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>UPGRADE DOCKER CE</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>Uninstall Docker CE</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get purge docker-ce</span><br><span class="line">$ sudo rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure></li></ol><h1 id="Docker-备份、恢复和迁移"><a href="#Docker-备份、恢复和迁移" class="headerlink" title="Docker 备份、恢复和迁移"></a>Docker 备份、恢复和迁移</h1><h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>首先，为了备份Docker中的容器，我们会想看看我们想要备份的容器列表。要达成该目的，我们需要在我们运行着Docker引擎，并已创建了容器的Linux机器中运行 docker ps 命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps</span></span><br></pre></td></tr></table></figure><p>在此之后，我们要选择我们想要备份的容器，然后去创建该容器的快照。我们可以使用 docker commit 命令来创建快照。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker commit -p 30b8f18f20b4 container-backup</span></span><br></pre></td></tr></table></figure><p>该命令会生成一个作为Docker镜像的容器快照，我们可以通过运行 docker images 命令来查看Docker镜像，如下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br></pre></td></tr></table></figure><p>正如我们所看见的，上面做的快照已经作为Docker镜像保存了。现在，为了备份该快照，我们有两个选择，一个是我们可以登录进Docker注册中心，并推送该镜像；另一个是我们可以将Docker镜像打包成tar包备份，以供今后使用。</p><p>如果我们想要在<a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker注册中心</a>上传或备份镜像，我们只需要运行 docker login 命令来登录进Docker注册中心，然后推送所需的镜像即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker login</span></span><br><span class="line"><span class="comment"># docker tag a25ddfec4d2a arunpyasi/container-backup:test</span></span><br><span class="line"><span class="comment"># docker push arunpyasi/container-backup</span></span><br></pre></td></tr></table></figure><p>如果我们不想备份到docker注册中心，而是想要将此镜像保存在本地机器中，以供日后使用，那么我们可以将其作为tar包备份。要完成该操作，我们需要运行以下 docker save 命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker save -o ~/container-backup.tar container-backup</span></span><br></pre></td></tr></table></figure><p>要验证tar包是否已经生成，我们只需要在保存tar包的目录中运行 ls 命令即可。</p><h2 id="恢复容器"><a href="#恢复容器" class="headerlink" title="恢复容器"></a>恢复容器</h2><p>接下来，在我们成功备份了我们的Docker容器后，我们现在来恢复这些制作了Docker镜像快照的容器。如果我们已经在注册中心推送了这些Docker镜像，那么我们仅仅需要把那个Docker镜像拖回并直接运行即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull arunpyasi/container-backup:test</span></span><br></pre></td></tr></table></figure><p>但是，如果我们将这些Docker镜像作为tar包文件备份到了本地，那么我们只要使用 docker load 命令，后面加上tar包的备份路径，就可以加载该Docker镜像了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker load -i ~/container-backup.tar</span></span><br></pre></td></tr></table></figure><p>现在，为了确保这些Docker镜像已经加载成功，我们来运行 docker images 命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker images</span></span><br></pre></td></tr></table></figure><p>在镜像被加载后，我们将用加载的镜像去运行Docker容器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -d -p 80:80 container-backup</span></span><br></pre></td></tr></table></figure><h2 id="迁移Docker容器"><a href="#迁移Docker容器" class="headerlink" title="迁移Docker容器"></a>迁移Docker容器</h2><p>迁移容器同时涉及到了上面两个操作，备份和恢复。我们可以将任何一个Docker容器从一台机器迁移到另一台机器。在迁移过程中，首先我们将把容器备份为Docker镜像快照。然后，该Docker镜像或者是被推送到了Docker注册中心，或者被作为tar包文件保存到了本地。如果我们将镜像推送到了Docker注册中心，我们简单地从任何我们想要的机器上使用 docker run 命令来恢复并运行该容器。但是，如果我们将镜像打包成tar包备份到了本地，我们只需要拷贝或移动该镜像到我们想要的机器上，加载该镜像并运行需要的容器即可。</p><h1 id="Docker-SSH-访问"><a href="#Docker-SSH-访问" class="headerlink" title="Docker SSH 访问"></a>Docker SSH 访问</h1><p>假设我们已经pull了一个docker 镜像，如下图所示的tensorflow/tensorflow。</p><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name my-tensorflow -it -p 8888:8888 -v ~/tensorflow:/<span class="built_in">test</span>/data tensorflow/tensorflow</span><br><span class="line"><span class="comment"># --name：创建的容器名，即my-tensorflow</span></span><br><span class="line"><span class="comment"># -it：保留命令行运行</span></span><br><span class="line"><span class="comment"># p 8888:8888：将本地的8888端口和http://localhost:8888/映射</span></span><br><span class="line"><span class="comment"># -v ~/tensorflow:/test/data:将本地的~/tensorflow挂载到容器内的/# test/data下</span></span><br><span class="line"><span class="comment"># tensorflow/tensorflow ：默认是tensorflow/tensorflow:latest,指定使用的镜像</span></span><br></pre></td></tr></table></figure></code></pre><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name tf tensorflow/tensorflow /bin/bash</span><br><span class="line"><span class="comment"># 这样我们就创建了名为tf的容器</span></span><br><span class="line">docker start tf</span><br><span class="line">docker attach tf</span><br></pre></td></tr></table></figure><h2 id="修改容器的root密码"><a href="#修改容器的root密码" class="headerlink" title="修改容器的root密码"></a>修改容器的root密码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get install vim -y</span><br><span class="line">apt-get install openssh-server -y</span><br><span class="line">apt-get install passwd</span><br><span class="line">passwd root</span><br></pre></td></tr></table></figure><h2 id="修改ssh配置"><a href="#修改ssh配置" class="headerlink" title="修改ssh配置"></a>修改ssh配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 修改PermitRootLogin yes  </span></span><br><span class="line">UsePAM no</span><br></pre></td></tr></table></figure><h2 id="启动ssh服务"><a href="#启动ssh服务" class="headerlink" title="启动ssh服务"></a>启动ssh服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service ssh start</span><br></pre></td></tr></table></figure><h2 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><h2 id="提交容器成为新的镜像"><a href="#提交容器成为新的镜像" class="headerlink" title="提交容器成为新的镜像"></a>提交容器成为新的镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如叫做ubuntu-ssh，输入docker commit 容器ID ubuntu-ssh</span><br></pre></td></tr></table></figure><h2 id="启动这个镜像的容器，并映射本地的一个闲置的端口"><a href="#启动这个镜像的容器，并映射本地的一个闲置的端口" class="headerlink" title="启动这个镜像的容器，并映射本地的一个闲置的端口"></a>启动这个镜像的容器，并映射本地的一个闲置的端口</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 50001:22 tf-ssh /bin/bash</span><br></pre></td></tr></table></figure><h2 id="ssh登录"><a href="#ssh登录" class="headerlink" title="ssh登录"></a>ssh登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@127.0.0.1 -p 50001</span><br></pre></td></tr></table></figure><h2 id="Docker后台运行"><a href="#Docker后台运行" class="headerlink" title="Docker后台运行"></a>Docker后台运行</h2><h1 id="阿里云加速器设置"><a href="#阿里云加速器设置" class="headerlink" title="阿里云加速器设置"></a>阿里云加速器设置</h1><p>由于官方Docker Hub网络速度较慢，这里使用阿里云提供的<a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>. 需要配置阿里云加速器，官方说明如下：</p><ol><li><p>针对Docker客户端版本大于1.10的用户： </p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</span></span><br><span class="line">$ sudo mkdir -p /etc/docker</span><br><span class="line">$ sudo tee /etc/docker/daemon.json &lt;&lt;-‘EOF’ </span><br><span class="line">  &#123; </span><br><span class="line">  “registry-mirrors”: [“https://fird1mfg.mirror.aliyuncs.com“] </span><br><span class="line">  &#125; </span><br><span class="line">  EOF</span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">$ sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>针对Docker客户的版本小于等于1.10的用户或者想配置启动参数，可以使用下面的命令将配置添加到docker daemon的启动参数中.</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu 12.04 14.04的用户:</span></span><br><span class="line">$ <span class="built_in">echo</span> “DOCKER_OPTS=/”<span class="variable">$DOCKER_OPTS</span> –registry-mirror=https://fird1mfg.mirror.aliyuncs.com/”” | sudo tee -a /etc/default/docker</span><br><span class="line">$ sudo service docker restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 15.04 16.04的用户</span></span><br><span class="line">$ sudo mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line">$ sudo tee /etc/systemd/system/docker.service.d/mirror.conf &lt;&lt;-‘EOF’ </span><br><span class="line">[Service] </span><br><span class="line">ExecStart=/usr/bin/docker daemon -H fd:// –registry-mirror=https://fird1mfg.mirror.aliyuncs.com </span><br><span class="line">EOF</span><br><span class="line">$ sudo systemctl daemon-reload</span><br><span class="line">$ sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li></ol><h1 id="NVIDIA-Docker安装"><a href="#NVIDIA-Docker安装" class="headerlink" title="NVIDIA-Docker安装"></a><a href="https://github.com/NVIDIA/nvidia-docker/wiki" target="_blank" rel="noopener">NVIDIA-Docker</a>安装</h1><ol><li><p>Prerequisties</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GNU/Linux x86_64 with kernel version &gt; 3.10 </span><br><span class="line">Docker &gt;= 1.9 (official docker-engine, docker-ce or docker-ee only) </span><br><span class="line">NVIDIA GPU with Architecture &gt; Fermi (2.1) </span><br><span class="line">NVIDIA drivers &gt;= 340.29 with binary nvidia-modprobe (驱动版本与CUDA计算能力相关)</span><br></pre></td></tr></table></figure></li><li><p>CUDA与NVIDIA driver安装 <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener">cuda</a></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">处理NVIDIA-Docker依赖项 NVIDIA drivers &gt;= 340.29 with binary nvidia-modprobe 要求. </span><br><span class="line">根据显卡，下载对应版本的CUDA并进行安装.</span><br></pre></td></tr></table></figure></li><li><p>NVIDIA-Docker安装</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Install nvidia-docker and nvidia-docker-plugin</span></span><br><span class="line"></span><br><span class="line">wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1-1_amd64.deb</span><br><span class="line">sudo dpkg -i /tmp/nvidia-docker*.deb &amp;&amp; rm /tmp/nvidia-docker*.deb</span><br><span class="line"><span class="comment">#Test nvidia-smi</span></span><br><span class="line"></span><br><span class="line">sudo nvidia-docker run –rm nvidia/cuda nvidia-smi</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>默认用nvdia-docker替代docker命令：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'alias docker=nvidia-docker'</span> &gt;&gt; ~/.bashrc</span><br><span class="line">bash</span><br></pre></td></tr></table></figure></li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol><li><a href="https://jingyan.baidu.com/article/a3aad71aa180e7b1fa009676.html" target="_blank" rel="noopener">https://jingyan.baidu.com/article/a3aad71aa180e7b1fa009676.html</a></li><li><a href="https://github.com/ufoym/deepo#Installation" target="_blank" rel="noopener">https://github.com/ufoym/deepo#Installation</a></li><li><a href="https://hub.docker.com/r/ufoym/deepo/" target="_blank" rel="noopener">https://hub.docker.com/r/ufoym/deepo/</a></li><li><a href="https://github.com/fatedier/frp/blob/master/README_zh.md#frp-%E7%9A%84%E4%BD%9C%E7%94%A8" target="_blank" rel="noopener">https://github.com/fatedier/frp/blob/master/README_zh.md#frp-%E7%9A%84%E4%BD%9C%E7%94%A8</a></li><li><a href="https://ranpox.github.io/2018/01/14/notification-of-gpu-server/" target="_blank" rel="noopener">https://ranpox.github.io/2018/01/14/notification-of-gpu-server/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> 深度学习 </category>
          
          <category> 环境配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> 深度学习 </tag>
            
            <tag> 环境配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python多线程教程</title>
      <link href="/2018/03/26/programmings/python/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%99%E7%A8%8B/"/>
      <url>/2018/03/26/programmings/python/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="什么多线程"><a href="#什么多线程" class="headerlink" title="什么多线程"></a>什么多线程</h1><p>多线程是加速程序计算的有效方式</p><h2 id="添加线程-Thread"><a href="#添加线程-Thread" class="headerlink" title="添加线程 Thread"></a>添加线程 Thread</h2><ul><li>导入模块</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br></pre></td></tr></table></figure><ul><li>获取已激活的线程数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">threading.active_count()</span><br></pre></td></tr></table></figure><ul><li>查看所有线程信息</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">threading.enumerate()</span><br></pre></td></tr></table></figure><ul><li>查看现在正在运行的线程</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">threading.current_thread()</span><br></pre></td></tr></table></figure><ul><li>添加线程</li></ul><p>threading.Thread()接收参数target代表这个线程要完成的任务，需自行定义</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_job</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'This is a thread of %s'</span> % threading.current_thread())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    thread = threading.Thread(target=thread_job,)   <span class="comment"># 定义线程 </span></span><br><span class="line">    thread.start()  <span class="comment"># 让线程开始工作</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="join-功能"><a href="#join-功能" class="headerlink" title="join 功能"></a>join 功能</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thread_job</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"T1 start\n"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        time.sleep(<span class="number">0.1</span>) <span class="comment"># 任务间隔0.1s</span></span><br><span class="line">    print(<span class="string">"T1 finish\n"</span>)</span><br><span class="line"></span><br><span class="line">added_thread = threading.Thread(target=thread_job, name=<span class="string">'T1'</span>)</span><br><span class="line">added_thread.start()</span><br><span class="line">print(<span class="string">"all done\n"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">thread_1.start() <span class="comment"># start T1</span></span><br><span class="line">thread_2.start() <span class="comment"># start T2</span></span><br><span class="line">thread_2.join() <span class="comment"># join for T2</span></span><br><span class="line">thread_1.join() <span class="comment"># join for T1</span></span><br><span class="line">print(<span class="string">"all done\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">T1 start</span></span><br><span class="line"><span class="string">T2 start</span></span><br><span class="line"><span class="string">T2 finish</span></span><br><span class="line"><span class="string">T1 finish</span></span><br><span class="line"><span class="string">all done</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><h2 id="储存进程结果-Queue"><a href="#储存进程结果-Queue" class="headerlink" title="储存进程结果 Queue"></a>储存进程结果 Queue</h2><ul><li>导入线程,队列的标准模块</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br></pre></td></tr></table></figure><ul><li>定义一个被多线程调用的函数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job</span><span class="params">(l,q)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range (len(l)):</span><br><span class="line">        l[i] = l[i]**<span class="number">2</span></span><br><span class="line">    q.put(l)   <span class="comment">#多线程调用的函数不能用return返回值</span></span><br></pre></td></tr></table></figure><p>完整的代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job</span><span class="params">(l,q)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range (len(l)):</span><br><span class="line">        l[i] = l[i]**<span class="number">2</span></span><br><span class="line">    q.put(l)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multithreading</span><span class="params">()</span>:</span></span><br><span class="line">    q =Queue()</span><br><span class="line">    threads = []</span><br><span class="line">    data = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>],[<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        t = threading.Thread(target=job,args=(data[i],q))</span><br><span class="line">        t.start()</span><br><span class="line">        threads.append(t)</span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        results.append(q.get())</span><br><span class="line">    print(results)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name___==<span class="string">'__main__'</span>:</span><br><span class="line">    multithreading()</span><br></pre></td></tr></table></figure><h2 id="线程锁-Lock"><a href="#线程锁-Lock" class="headerlink" title="线程锁 Lock"></a>线程锁 Lock</h2><ul><li>不使用 Lock 的情况</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> A</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        A+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">'job1'</span>,A)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> A</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        A+=<span class="number">10</span></span><br><span class="line">        print(<span class="string">'job2'</span>,A)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">'__main__'</span>:</span><br><span class="line">    lock=threading.Lock()</span><br><span class="line">    A=<span class="number">0</span></span><br><span class="line">    t1=threading.Thread(target=job1)</span><br><span class="line">    t2=threading.Thread(target=job2)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br></pre></td></tr></table></figure><p>运行结果:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">job1job2 <span class="number">11</span></span><br><span class="line">job2 <span class="number">21</span></span><br><span class="line">job2 <span class="number">31</span></span><br><span class="line">job2 <span class="number">41</span></span><br><span class="line">job2 <span class="number">51</span></span><br><span class="line">job2 <span class="number">61</span></span><br><span class="line">job2 <span class="number">71</span></span><br><span class="line">job2 <span class="number">81</span></span><br><span class="line">job2 <span class="number">91</span></span><br><span class="line">job2 <span class="number">101</span></span><br><span class="line"> <span class="number">1</span></span><br><span class="line">job1 <span class="number">102</span></span><br><span class="line">job1 <span class="number">103</span></span><br><span class="line">job1 <span class="number">104</span></span><br><span class="line">job1 <span class="number">105</span></span><br><span class="line">job1 <span class="number">106</span></span><br><span class="line">job1 <span class="number">107</span></span><br><span class="line">job1 <span class="number">108</span></span><br><span class="line">job1 <span class="number">109</span></span><br><span class="line">job1 <span class="number">110</span></span><br></pre></td></tr></table></figure><ul><li>使用 Lock 的情况</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> A,lock</span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        A+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">'job1'</span>,A)</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> A,lock</span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        A+=<span class="number">10</span></span><br><span class="line">        print(<span class="string">'job2'</span>,A)</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">'__main__'</span>:</span><br><span class="line">    lock=threading.Lock()</span><br><span class="line">    A=<span class="number">0</span></span><br><span class="line">    t1=threading.Thread(target=job1)</span><br><span class="line">    t2=threading.Thread(target=job2)</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br></pre></td></tr></table></figure><p>运行结果:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">job1 <span class="number">1</span></span><br><span class="line">job1 <span class="number">2</span></span><br><span class="line">job1 <span class="number">3</span></span><br><span class="line">job1 <span class="number">4</span></span><br><span class="line">job1 <span class="number">5</span></span><br><span class="line">job1 <span class="number">6</span></span><br><span class="line">job1 <span class="number">7</span></span><br><span class="line">job1 <span class="number">8</span></span><br><span class="line">job1 <span class="number">9</span></span><br><span class="line">job1 <span class="number">10</span></span><br><span class="line">job2 <span class="number">20</span></span><br><span class="line">job2 <span class="number">30</span></span><br><span class="line">job2 <span class="number">40</span></span><br><span class="line">job2 <span class="number">50</span></span><br><span class="line">job2 <span class="number">60</span></span><br><span class="line">job2 <span class="number">70</span></span><br><span class="line">job2 <span class="number">80</span></span><br><span class="line">job2 <span class="number">90</span></span><br><span class="line">job2 <span class="number">100</span></span><br><span class="line">job2 <span class="number">110</span></span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://morvanzhou.github.io/tutorials/python-basic/threading/" target="_blank" rel="noopener">https://morvanzhou.github.io/tutorials/python-basic/threading/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Python </category>
          
          <category> 多线程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python-Numpy和Pandas教程</title>
      <link href="/2018/03/26/programmings/python/Python-Numpy%E5%92%8CPandas%E6%95%99%E7%A8%8B/"/>
      <url>/2018/03/26/programmings/python/Python-Numpy%E5%92%8CPandas%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="安装-numpy和pandas"><a href="#安装-numpy和pandas" class="headerlink" title="安装 numpy和pandas"></a>安装 numpy和pandas</h1><p><a href="http://www.numpy.org/" target="_blank" rel="noopener">numpy</a> 和 <a href="https://pandas.pydata.org/" target="_blank" rel="noopener">pandas</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install numpy</span><br><span class="line">sudo pip install pandas</span><br></pre></td></tr></table></figure><h1 id="Numpy教程"><a href="#Numpy教程" class="headerlink" title="Numpy教程"></a>Numpy教程</h1><h2 id="Numpy-属性"><a href="#Numpy-属性" class="headerlink" title="Numpy 属性"></a>Numpy 属性</h2><ul><li>ndim：维度</li><li>shape：行数和列数</li><li>size：元素个数</li></ul><h2 id="Numpy-的创建-array"><a href="#Numpy-的创建-array" class="headerlink" title="Numpy 的创建 array"></a>Numpy 的创建 array</h2><ul><li>array：创建数组</li><li>dtype：指定数据类型</li><li>zeros：创建数据全为0</li><li>ones：创建数据全为1</li><li>empty：创建数据接近0</li><li>arrange：按指定范围创建数据</li><li>linspace：创建线段</li></ul><h2 id="Numpy-基础运算"><a href="#Numpy-基础运算" class="headerlink" title="Numpy 基础运算"></a>Numpy 基础运算</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a=np.array([<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>])   <span class="comment"># array([10, 20, 30, 40])</span></span><br><span class="line">b=np.arange(<span class="number">4</span>)              <span class="comment"># array([0, 1, 2, 3])</span></span><br></pre></td></tr></table></figure><ul><li>减法</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=a-b  <span class="comment"># array([10, 19, 28, 37])</span></span><br></pre></td></tr></table></figure><ul><li>加法</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=a+b   <span class="comment"># array([10, 21, 32, 43])</span></span><br></pre></td></tr></table></figure><ul><li>乘法</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=a*b   <span class="comment"># array([  0,  20,  60, 120])</span></span><br></pre></td></tr></table></figure><p>有所不同的是，在Numpy中，想要求出矩阵中各个元素的乘方需要依赖双星符号 **</p><ul><li>乘法</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=b**<span class="number">2</span>  <span class="comment"># array([0, 1, 4, 9])</span></span><br></pre></td></tr></table></figure><ul><li>三角函数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="number">10</span>*np.sin(a)  <span class="comment"># cos tan</span></span><br><span class="line"><span class="comment"># array([-5.44021111,  9.12945251, -9.88031624,  7.4511316 ])</span></span><br></pre></td></tr></table></figure><ul><li>逻辑判断</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(b&lt;<span class="number">3</span>)  </span><br><span class="line"><span class="comment"># array([ True,  True,  True, False], dtype=bool)</span></span><br></pre></td></tr></table></figure><p>上述运算均是建立在一维矩阵，即只有一行的矩阵上面的计算，如果我们想要对多行多维度的矩阵进行操作，需要对开始的脚本进行一些修改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a=np.array([[<span class="number">1</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>]])</span><br><span class="line">b=np.arange(<span class="number">4</span>).reshape((<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># array([[1, 1],</span></span><br><span class="line"><span class="comment">#       [0, 1]])</span></span><br><span class="line"></span><br><span class="line">print(b)</span><br><span class="line"><span class="comment"># array([[0, 1],</span></span><br><span class="line"><span class="comment">#       [2, 3]])</span></span><br></pre></td></tr></table></figure><p>此时构造出来的矩阵a和b便是2行2列的，其中 reshape 操作是对矩阵的形状进行重构， 其重构的形状便是括号中给出的数字。</p><ul><li>矩阵乘法运算</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c_dot = np.dot(a,b)</span><br><span class="line"><span class="comment"># array([[2, 4],</span></span><br><span class="line"><span class="comment">#       [2, 3]])</span></span><br><span class="line">c_dot_2 = a.dot(b)</span><br><span class="line"><span class="comment"># array([[2, 4],</span></span><br><span class="line"><span class="comment">#       [2, 3]])</span></span><br></pre></td></tr></table></figure><ul><li>特定运算<ul><li>求和：np.sum(A)</li><li>最小值：np.min(A)</li><li>最大值：np.max(A)</li><li>最小值索引：np.argmin(A)</li><li>最大值索引：np.argmax(A)</li><li>平均值：np.mean(A)</li><li>中位数：np.medium(A)</li><li>累加：np.cumsum(A)</li><li>累差：np.diff(A)</li><li>非零数：np.nonzero(A)</li><li>排序：np.sort(A)</li><li>矩阵反向（转置）：np.transpose(A)或A.T</li><li>截断：np.clip(A,5,9) # 小于5为5，大于9为9</li></ul></li></ul><h2 id="Numpy-索引"><a href="#Numpy-索引" class="headerlink" title="Numpy 索引"></a>Numpy 索引</h2><h3 id="一维索引"><a href="#一维索引" class="headerlink" title="一维索引"></a>一维索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">A = np.arange(<span class="number">3</span>,<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># array([3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14])</span></span><br><span class="line">         </span><br><span class="line">print(A[<span class="number">3</span>])    <span class="comment"># 6</span></span><br></pre></td></tr></table></figure><h3 id="二维索引"><a href="#二维索引" class="headerlink" title="二维索引"></a>二维索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(A[<span class="number">1</span>][<span class="number">1</span>])      <span class="comment"># 8</span></span><br></pre></td></tr></table></figure><p>这一脚本中的flatten是一个展开性质的函数，将多维的矩阵进行展开成1行的数列。而flat是一个迭代器，本身是一个object属性。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">A = np.arange(<span class="number">3</span>,<span class="number">15</span>).reshape((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">         </span><br><span class="line">print(A.flatten())   </span><br><span class="line"><span class="comment"># array([3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> A.flat:</span><br><span class="line">    print(item)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line">……</span><br><span class="line"><span class="comment"># 14</span></span><br></pre></td></tr></table></figure><h2 id="Numpy-array-合并"><a href="#Numpy-array-合并" class="headerlink" title="Numpy array 合并"></a>Numpy array 合并</h2><ul><li>上下合并 - np.vstack()</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">A = np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">B = np.array([<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>])</span><br><span class="line">         </span><br><span class="line">print(np.vstack((A,B)))    <span class="comment"># vertical stack</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[[1,1,1]</span></span><br><span class="line"><span class="string"> [2,2,2]]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><ul><li>左右合并 - np.hstack()</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">D = np.hstack((A,B))       <span class="comment"># horizontal stack</span></span><br><span class="line"></span><br><span class="line">print(D)</span><br><span class="line"><span class="comment"># [1,1,1,2,2,2]</span></span><br><span class="line"></span><br><span class="line">print(A.shape,D.shape)</span><br><span class="line"><span class="comment"># (3,) (6,)</span></span><br></pre></td></tr></table></figure><ul><li>转置操作 - np.newaxis()</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">print(A[np.newaxis,:])</span><br><span class="line"><span class="comment"># [[1 1 1]]</span></span><br><span class="line"></span><br><span class="line">print(A[np.newaxis,:].shape)</span><br><span class="line"><span class="comment"># (1,3)</span></span><br><span class="line"></span><br><span class="line">print(A[:,np.newaxis])</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[[1]</span></span><br><span class="line"><span class="string">[1]</span></span><br><span class="line"><span class="string">[1]]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(A[:,np.newaxis].shape)</span><br><span class="line"><span class="comment"># (3,1)</span></span><br></pre></td></tr></table></figure><p>此时我们便将具有3个元素的array转换为了1行3列以及3行1列的矩阵了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">A = np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>])[:,np.newaxis]</span><br><span class="line">B = np.array([<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>])[:,np.newaxis]</span><br><span class="line">         </span><br><span class="line">C = np.vstack((A,B))   <span class="comment"># vertical stack</span></span><br><span class="line">D = np.hstack((A,B))   <span class="comment"># horizontal stack</span></span><br><span class="line"></span><br><span class="line">print(D)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[[1 2]</span></span><br><span class="line"><span class="string">[1 2]</span></span><br><span class="line"><span class="string">[1 2]]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(A.shape,D.shape)</span><br><span class="line"><span class="comment"># (3,1) (3,2)</span></span><br></pre></td></tr></table></figure><ul><li>合并操作需要针对多个矩阵或序列 - np.concatenate()</li></ul><p>当你的合并操作需要针对多个矩阵或序列时，借助concatenate函数可能会让你使用起来比前述的函数更加方便：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">C = np.concatenate((A,B,B,A),axis=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">print(C)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">array([[1],</span></span><br><span class="line"><span class="string">       [1],</span></span><br><span class="line"><span class="string">       [1],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [2],</span></span><br><span class="line"><span class="string">       [1],</span></span><br><span class="line"><span class="string">       [1],</span></span><br><span class="line"><span class="string">       [1]])</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">D = np.concatenate((A,B,B,A),axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(D)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">array([[1, 2, 2, 1],</span></span><br><span class="line"><span class="string">       [1, 2, 2, 1],</span></span><br><span class="line"><span class="string">       [1, 2, 2, 1]])</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>axis参数很好的控制了矩阵的纵向或是横向打印，相比较vstack和hstack函数显得更加方便。</p><h2 id="Numpy-array-分割"><a href="#Numpy-array-分割" class="headerlink" title="Numpy array 分割"></a>Numpy array 分割</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">print(A)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">array([[ 0,  1,  2,  3],</span></span><br><span class="line"><span class="string">    [ 4,  5,  6,  7],</span></span><br><span class="line"><span class="string">    [ 8,  9, 10, 11]])</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><ul><li>纵向分割</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(np.split(A, <span class="number">2</span>, axis=<span class="number">1</span>))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[array([[0, 1],</span></span><br><span class="line"><span class="string">        [4, 5],</span></span><br><span class="line"><span class="string">        [8, 9]]), array([[ 2,  3],</span></span><br><span class="line"><span class="string">        [ 6,  7],</span></span><br><span class="line"><span class="string">        [10, 11]])]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><ul><li>横向分割</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(np.split(A, <span class="number">3</span>, axis=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [array([[0, 1, 2, 3]]), array([[4, 5, 6, 7]]), array([[ 8,  9, 10, 11]])]</span></span><br></pre></td></tr></table></figure><ul><li>错误的分割 </li></ul><p>范例的Array只有4列，只能等量对分，因此输入以上程序代码后Python就会报错。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(np.split(A, <span class="number">3</span>, axis=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ValueError: array split does not result in an equal division</span></span><br></pre></td></tr></table></figure><ul><li>不等量的分割</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">print(np.array_split(A, <span class="number">3</span>, axis=<span class="number">1</span>))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[array([[0, 1],</span></span><br><span class="line"><span class="string">        [4, 5],</span></span><br><span class="line"><span class="string">        [8, 9]]), array([[ 2],</span></span><br><span class="line"><span class="string">        [ 6],</span></span><br><span class="line"><span class="string">        [10]]), array([[ 3],</span></span><br><span class="line"><span class="string">        [ 7],</span></span><br><span class="line"><span class="string">        [11]])]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><ul><li>其他的分割方式</li></ul><p>在Numpy里还有np.vsplit()与横np.hsplit()方式可用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">print(np.vsplit(A, <span class="number">3</span>)) <span class="comment">#等于 print(np.split(A, 3, axis=0))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [array([[0, 1, 2, 3]]), array([[4, 5, 6, 7]]), array([[ 8,  9, 10, 11]])]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(np.hsplit(A, <span class="number">2</span>)) <span class="comment">#等于 print(np.split(A, 2, axis=1))</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[array([[0, 1],</span></span><br><span class="line"><span class="string">       [4, 5],</span></span><br><span class="line"><span class="string">       [8, 9]]), array([[ 2,  3],</span></span><br><span class="line"><span class="string">        [ 6,  7],</span></span><br><span class="line"><span class="string">        [10, 11]])]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><h2 id="Numpy-copy-amp-deep-copy"><a href="#Numpy-copy-amp-deep-copy" class="headerlink" title="Numpy copy &amp; deep copy"></a>Numpy copy &amp; deep copy</h2><ul><li>copy() 的赋值方式没有关联性</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b = a.copy()    <span class="comment"># deep copy</span></span><br><span class="line">print(b)        <span class="comment"># array([11, 22, 33,  3])</span></span><br><span class="line">a[<span class="number">3</span>] = <span class="number">44</span></span><br><span class="line">print(a)        <span class="comment"># array([11, 22, 33, 44])</span></span><br><span class="line">print(b)        <span class="comment"># array([11, 22, 33,  3])</span></span><br></pre></td></tr></table></figure><h1 id="Pandas-教程"><a href="#Pandas-教程" class="headerlink" title="Pandas 教程"></a>Pandas 教程</h1><h2 id="Numpy-和-Pandas-有什么不同"><a href="#Numpy-和-Pandas-有什么不同" class="headerlink" title="Numpy 和 Pandas 有什么不同"></a>Numpy 和 Pandas 有什么不同</h2><p>如果用 python 的列表和字典来作比较, 那么可以说 Numpy 是列表形式的，没有数值标签，而 Pandas 就是字典形式。Pandas是基于Numpy构建的，让Numpy为中心的应用变得更加简单。</p><ul><li>Series</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,np.nan,<span class="number">44</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">print(s)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">0     1.0</span></span><br><span class="line"><span class="string">1     3.0</span></span><br><span class="line"><span class="string">2     6.0</span></span><br><span class="line"><span class="string">3     NaN</span></span><br><span class="line"><span class="string">4    44.0</span></span><br><span class="line"><span class="string">5     1.0</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>Series的字符串表现形式为：索引在左边，值在右边。由于我们没有为数据指定索引。于是会自动创建一个0到N-1（N为长度）的整数型索引。</p><ul><li>DataFrame</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dates = pd.date_range(<span class="string">'20160101'</span>,periods=<span class="number">6</span>)</span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">6</span>,<span class="number">4</span>),index=dates,columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line"></span><br><span class="line">print(df)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">                   a         b         c         d</span></span><br><span class="line"><span class="string">2016-01-01 -0.253065 -2.071051 -0.640515  0.613663</span></span><br><span class="line"><span class="string">2016-01-02 -1.147178  1.532470  0.989255 -0.499761</span></span><br><span class="line"><span class="string">2016-01-03  1.221656 -2.390171  1.862914  0.778070</span></span><br><span class="line"><span class="string">2016-01-04  1.473877 -0.046419  0.610046  0.204672</span></span><br><span class="line"><span class="string">2016-01-05 -1.584752 -0.700592  1.487264 -1.778293</span></span><br><span class="line"><span class="string">2016-01-06  0.633675 -1.414157 -0.277066 -0.442545</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>DataFrame是一个表格型的数据结构，它包含有一组有序的列，每列可以是不同的值类型（数值，字符串，布尔值等）。DataFrame既有行索引也有列索引， 它可以被看做由Series组成的大字典。</p><ul><li>DataFrame 的一些简单运用</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">print(df[<span class="string">'b'</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">2016-01-01   -2.071051</span></span><br><span class="line"><span class="string">2016-01-02    1.532470</span></span><br><span class="line"><span class="string">2016-01-03   -2.390171</span></span><br><span class="line"><span class="string">2016-01-04   -0.046419</span></span><br><span class="line"><span class="string">2016-01-05   -0.700592</span></span><br><span class="line"><span class="string">2016-01-06   -1.414157</span></span><br><span class="line"><span class="string">Freq: D, Name: b, dtype: float64</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>我们在创建一组没有给定行标签和列标签的数据 df1:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>)))</span><br><span class="line">print(df1)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">   0  1   2   3</span></span><br><span class="line"><span class="string">0  0  1   2   3</span></span><br><span class="line"><span class="string">1  4  5   6   7</span></span><br><span class="line"><span class="string">2  8  9  10  11</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>默认的从0开始 index. 还有一种生成 df 的方法, 如下 df2:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">df2 = pd.DataFrame(&#123;<span class="string">'A'</span> : <span class="number">1.</span>,</span><br><span class="line">                    <span class="string">'B'</span> : pd.Timestamp(<span class="string">'20130102'</span>),</span><br><span class="line">                    <span class="string">'C'</span> : pd.Series(<span class="number">1</span>,index=list(range(<span class="number">4</span>)),dtype=<span class="string">'float32'</span>),</span><br><span class="line">                    <span class="string">'D'</span> : np.array([<span class="number">3</span>] * <span class="number">4</span>,dtype=<span class="string">'int32'</span>),</span><br><span class="line">                    <span class="string">'E'</span> : pd.Categorical([<span class="string">"test"</span>,<span class="string">"train"</span>,<span class="string">"test"</span>,<span class="string">"train"</span>]),</span><br><span class="line">                    <span class="string">'F'</span> : <span class="string">'foo'</span>&#125;)</span><br><span class="line">                    </span><br><span class="line">print(df2)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">     A          B    C  D      E    F</span></span><br><span class="line"><span class="string">0  1.0 2013-01-02  1.0  3   test  foo</span></span><br><span class="line"><span class="string">1  1.0 2013-01-02  1.0  3  train  foo</span></span><br><span class="line"><span class="string">2  1.0 2013-01-02  1.0  3   test  foo</span></span><br><span class="line"><span class="string">3  1.0 2013-01-02  1.0  3  train  foo</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>这种方法能对每一列的数据进行特殊对待. 如果想要查看数据中的类型, 我们可以用 dtype 这个属性:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">print(df2.dtypes)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">df2.dtypes</span></span><br><span class="line"><span class="string">A           float64</span></span><br><span class="line"><span class="string">B    datetime64[ns]</span></span><br><span class="line"><span class="string">C           float32</span></span><br><span class="line"><span class="string">D             int32</span></span><br><span class="line"><span class="string">E          category</span></span><br><span class="line"><span class="string">F            object</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>如果想看对列的序号:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(df2.index)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Int64Index([0, 1, 2, 3], dtype='int64')</span></span><br></pre></td></tr></table></figure><p>同样, 每种数据的名称也能看到:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(df2.columns)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Index(['A', 'B', 'C', 'D', 'E', 'F'], dtype='object')</span></span><br></pre></td></tr></table></figure><p>果只想看所有df2的值:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print(df2.values)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">array([[1.0, Timestamp('2013-01-02 00:00:00'), 1.0, 3, 'test', 'foo'],</span></span><br><span class="line"><span class="string">       [1.0, Timestamp('2013-01-02 00:00:00'), 1.0, 3, 'train', 'foo'],</span></span><br><span class="line"><span class="string">       [1.0, Timestamp('2013-01-02 00:00:00'), 1.0, 3, 'test', 'foo'],</span></span><br><span class="line"><span class="string">       [1.0, Timestamp('2013-01-02 00:00:00'), 1.0, 3, 'train', 'foo']], dtype=object)</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>想知道数据的总结, 可以用 describe():</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df2.describe()</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">         A    C    D</span></span><br><span class="line"><span class="string">count  4.0  4.0  4.0</span></span><br><span class="line"><span class="string">mean   1.0  1.0  3.0</span></span><br><span class="line"><span class="string">std    0.0  0.0  0.0</span></span><br><span class="line"><span class="string">min    1.0  1.0  3.0</span></span><br><span class="line"><span class="string">25%    1.0  1.0  3.0</span></span><br><span class="line"><span class="string">50%    1.0  1.0  3.0</span></span><br><span class="line"><span class="string">75%    1.0  1.0  3.0</span></span><br><span class="line"><span class="string">max    1.0  1.0  3.0</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>如果想翻转数据, transpose:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">print(df2.T)</span><br><span class="line"></span><br><span class="line"><span class="string">"""                   </span></span><br><span class="line"><span class="string">0                    1                    2  \</span></span><br><span class="line"><span class="string">A                    1                    1                    1   </span></span><br><span class="line"><span class="string">B  2013-01-02 00:00:00  2013-01-02 00:00:00  2013-01-02 00:00:00   </span></span><br><span class="line"><span class="string">C                    1                    1                    1   </span></span><br><span class="line"><span class="string">D                    3                    3                    3   </span></span><br><span class="line"><span class="string">E                 test                train                 test   </span></span><br><span class="line"><span class="string">F                  foo                  foo                  foo   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                     3  </span></span><br><span class="line"><span class="string">A                    1  </span></span><br><span class="line"><span class="string">B  2013-01-02 00:00:00  </span></span><br><span class="line"><span class="string">C                    1  </span></span><br><span class="line"><span class="string">D                    3  </span></span><br><span class="line"><span class="string">E                train  </span></span><br><span class="line"><span class="string">F                  foo  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>如果想对数据的 index 进行排序并输出:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">print(df2.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">     F      E  D    C          B    A</span></span><br><span class="line"><span class="string">0  foo   test  3  1.0 2013-01-02  1.0</span></span><br><span class="line"><span class="string">1  foo  train  3  1.0 2013-01-02  1.0</span></span><br><span class="line"><span class="string">2  foo   test  3  1.0 2013-01-02  1.0</span></span><br><span class="line"><span class="string">3  foo  train  3  1.0 2013-01-02  1.0</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">如果是对数据 值 排序输出:</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">print(df2.sort_values(by=<span class="string">'B'</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">     A          B    C  D      E    F</span></span><br><span class="line"><span class="string">0  1.0 2013-01-02  1.0  3   test  foo</span></span><br><span class="line"><span class="string">1  1.0 2013-01-02  1.0  3  train  foo</span></span><br><span class="line"><span class="string">2  1.0 2013-01-02  1.0  3   test  foo</span></span><br><span class="line"><span class="string">3  1.0 2013-01-02  1.0  3  train  foo</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>参考：</p><ul><li><a href="https://morvanzhou.github.io/tutorials/data-manipulation/np-pd/3-1-pd-intro/" target="_blank" rel="noopener">Pandas 基本介绍</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux入门教程</title>
      <link href="/2018/03/25/programmings/linux/linux%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/"/>
      <url>/2018/03/25/programmings/linux/linux%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux入门教程"><a href="#Linux入门教程" class="headerlink" title="Linux入门教程"></a>Linux入门教程</h1><h2 id="SSH-远程连接-Linux"><a href="#SSH-远程连接-Linux" class="headerlink" title="SSH 远程连接 Linux"></a>SSH 远程连接 Linux</h2><h3 id="Linux端配置"><a href="#Linux端配置" class="headerlink" title="Linux端配置"></a>Linux端配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure><p>查看IP地址：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure></p><h3 id="Mac端配置"><a href="#Mac端配置" class="headerlink" title="Mac端配置"></a>Mac端配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 用户名@IP地址 <span class="comment">#输入密码确认</span></span><br></pre></td></tr></table></figure><h3 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h3><p>Mac端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -f <span class="built_in">test</span> -C <span class="string">"test-key"</span> <span class="comment"># 一直回车</span></span><br><span class="line">cat test.pub <span class="comment"># 查看公钥内容</span></span><br></pre></td></tr></table></figure><p>配置公钥到服务器：将公钥内容添加到服务器的~/.ssh/authorized_keys 文件中.</p><p>例子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp   /home/yourname/.ssh/authorized_keys yourname@192.168.38.58:/home/yourname/.ssh/</span><br></pre></td></tr></table></figure><p>alias 实现命令快速登陆：做好配置之后，通过ssh可以直接登录了。对经常登录的服务器，可以将ssh登录命令的alias加到 ~/.bash_profile文件中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.bash_profile | grep 101</span><br><span class="line"><span class="built_in">alias</span> to-101=<span class="string">'ssh huqiu@192.168.154.101'</span></span><br></pre></td></tr></table></figure><p>登录的时候:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ to-101</span><br></pre></td></tr></table></figure><p>无法登录一般的原因：</p><ul><li><p>客户端的私钥和公钥文件位置必须位于 ~/.ssh 下。</p></li><li><p>确保双方 ~/.ssh 目录，父目录，公钥私钥，authorized_keys 文件的权限对当前用户至少要有执行权限，对其他用户最多只能有执行权限。</p></li><li><p>注意git登录，要求对公钥和私钥以及config文件，其他用户不能有任何权限。</p></li><li><p>服务器端 ~/.ssh/authorized_keys 文件名确保没错 :).</p></li></ul><p>ssh-copy-id：ssh-copy-id 是一个小脚本，你可以用这个小脚本完成以上工作。这个脚本在linux系统上一般都有。</p><p><a href="https://www.liaohuqiu.net/cn/posts/ssh-keygen-abc/" target="_blank" rel="noopener">ssh-keygen 基本用法</a></p><p>1) 使用 ssh-keygen 时，请先进入到 ~/.ssh 目录，不存在的话，请先创建。并且保证 ~/.ssh 以及所有父目录的权限不能大于 711</p><p>2) 使用 ssh-kengen 会在~/.ssh/目录下生成两个文件，不指定文件名和密钥类型的时候，默认生成的两个文件是：</p><ul><li>id_rsa</li><li>id_rsa.pub</li></ul><p>第一个是私钥文件，第二个是公钥文件。</p><p>生成ssh key的时候，可以通过 -f 选项指定生成文件的文件名，如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -f <span class="built_in">test</span>   -C <span class="string">"test key"</span> <span class="comment"># test - 文件名，"test key" - 备注</span></span><br></pre></td></tr></table></figure><h3 id="SSH-config"><a href="#SSH-config" class="headerlink" title="SSH config"></a>SSH config</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Host example                       <span class="comment"># 关键词</span></span><br><span class="line">HostName example.com           <span class="comment"># 主机地址</span></span><br><span class="line">User root                      <span class="comment"># 用户名</span></span><br><span class="line">IdentityFile ~/.ssh/id_ecdsa <span class="comment"># 认证文件</span></span><br><span class="line">Port 22                      <span class="comment"># 指定端口</span></span><br><span class="line">ControlMaster auto</span><br><span class="line">ControlPath /tmp/%r@%h:%p</span><br></pre></td></tr></table></figure><h1 id="OpenCV3-1配置"><a href="#OpenCV3-1配置" class="headerlink" title="OpenCV3.1配置"></a>OpenCV3.1配置</h1><h2 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line"><span class="comment"># 必须的，gcc编译环境</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</span><br><span class="line"><span class="comment"># 必须的,包括cmake等工具</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev</span><br><span class="line"><span class="comment"># 可选的，看个人需要，总共5M左右</span></span><br><span class="line"></span><br><span class="line">sudo apt-get install libv4l-dev</span><br></pre></td></tr></table></figure><h2 id="下载-源码"><a href="#下载-源码" class="headerlink" title="下载 源码"></a>下载 源码</h2><p><a href="https://opencv.org/releases.html" target="_blank" rel="noopener">OpenCV</a></p><p>或着用git clone：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/opencv310</span><br><span class="line">    <span class="comment"># opencv310为自己建的，源码将放在这里</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Itseez/opencv.git</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Itseez/opencv_contrib.git</span><br></pre></td></tr></table></figure><h2 id="CMake-Opencv源码"><a href="#CMake-Opencv源码" class="headerlink" title="CMake Opencv源码"></a>CMake Opencv源码</h2><p>建立一个编译目录（例如：/build）把cmake后的文件都放在这里边。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/opencv</span><br><span class="line">mkdir build  //建立一个build目录，把cmake的文件都放着里边</span><br><span class="line"><span class="built_in">cd</span> build　　　//进入build目录</span><br></pre></td></tr></table></figure><p>cmake时ippicv_linux_20151201.tgz总是不能成功下载，故cmake之前将./downloads/linux-808b791a6eac9ed78d32a7666804320e 文件拷贝至./opencv-3.1.0/3rdparty/ippicv/ 路径下(先执行一次cmake 命令生成文件路径，在将ippicv_linux_20151201.tgz复制进去) ippicv_linux_20151201.tgz下载链接:链接: <a href="https://pan.baidu.com/s/1jBBPxXX_NqCodS5bAln4-g" target="_blank" rel="noopener">https://pan.baidu.com/s/1jBBPxXX_NqCodS5bAln4-g</a> 密码: x4sn</p><p>然后开始cmake，这里需要注意几个cmake的参数，比较重要。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span> WITH_LIBV4L=ON ..</span><br></pre></td></tr></table></figure><p>切记最后’..’两个点之前要加空格！！</p><h2 id="把代码编译成可执行文件"><a href="#把代码编译成可执行文件" class="headerlink" title="把代码编译成可执行文件"></a>把代码编译成可执行文件</h2><p>这里官方推荐使用多进程编译，推荐七个进程：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j7 <span class="comment"># 并行运行七个jobs，这一步也在build目录中进行</span></span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo make install</span><br><span class="line"></span><br><span class="line">如果你要在python下运行opencv库的情况下，那就必须安装安装python-opencv</span><br><span class="line">sudo apt-get install python-opencv</span><br></pre></td></tr></table></figure><h2 id="配置库文件路径"><a href="#配置库文件路径" class="headerlink" title="配置库文件路径"></a>配置库文件路径</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">'echo "/usr/local/lib" &gt; /etc/ld.so.conf.d/opencv.conf'</span></span><br><span class="line"><span class="comment">#或者直接打开/etc/ld.so.conf.d/opencv.conf，添加/usr/local/lib</span></span><br><span class="line"><span class="comment">#使配置生效</span></span><br><span class="line">sudo  ldconfig(重要)</span><br></pre></td></tr></table></figure><h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo vim/etc/bash.bashrc   </span><br><span class="line"><span class="comment">#在最后加入以下两行代码</span></span><br><span class="line">PKG_CONFIG_PATH=<span class="variable">$PKG_CONFIG_PATH</span>:/usr/<span class="built_in">local</span>/lib/pkgconfig </span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH  </span><br><span class="line"><span class="comment">#使配置生效</span></span><br><span class="line">sudo <span class="built_in">source</span> /etc/bash.bashrc </span><br><span class="line">（该步骤可能会报错找不到命令，原因是<span class="built_in">source</span>为root命令</span><br><span class="line">su（进入root权限）</span><br></pre></td></tr></table></figure><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkg-config --modversion opencv</span><br><span class="line">pkg-config --cflags opencv</span><br></pre></td></tr></table></figure><h2 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h2><p>我是用python+opencv的，我这里直接运行opencv自带的python的例子程序，TX1自带摄像头不能用，需要使用外接USB摄像头，插入USB接口即可，无需安装驱动，也无需改动测试代码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> &lt;opencv3.1.0_dir&gt;/samples/python/</span><br><span class="line">python video.py</span><br><span class="line">python edge.py</span><br><span class="line">python facedetect.py</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol><li><a href="https://www.liaohuqiu.net/cn/posts/ssh-public-key-auto-login/" target="_blank" rel="noopener">https://www.liaohuqiu.net/cn/posts/ssh-public-key-auto-login/</a></li><li><a href="https://blog.csdn.net/asukasmallriver/article/details/72927860" target="_blank" rel="noopener">https://blog.csdn.net/asukasmallriver/article/details/72927860</a></li><li><a href="https://blog.csdn.net/u011440558/article/details/78358447" target="_blank" rel="noopener">https://blog.csdn.net/u011440558/article/details/78358447</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
          <category> Linux </category>
          
          <category> 入门 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程 </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/2018/03/24/categories/"/>
      <url>/2018/03/24/categories/</url>
      
        <content type="html"><![CDATA[<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><ul><li><p><font color="“blue”"><strong>编程: programming</strong></font></p><ul><li>C++</li><li>Java</li><li>Python</li><li>Matlab</li><li>Android</li><li>Linux</li><li>Git</li><li>Latex</li><li>PHP</li><li>IOS</li><li>数据库</li><li>网络编程</li><li>多线程</li><li>QT编程</li><li>MarkDown</li><li>DP<ul><li>Caffe</li><li>TF</li><li>PyTorch</li></ul></li><li>数据结构</li><li>算法</li></ul></li><li><p><font color="“blue”"><strong>学术: science</strong></font></p><ul><li>计算机视觉<ul><li>ICCV</li><li>CVPR</li><li>ECCV</li></ul></li><li>移动计算<ul><li>MobiCom</li><li>SigComm</li><li>InfoCom</li><li>NSDI</li><li>SenSys</li><li>PerCom</li><li>UbiComp</li></ul></li><li>机器学习&amp;深度学习<ul><li>AAAI</li><li>IJCAI</li></ul></li></ul></li><li><p><font color="“blue”"><strong>理论: theory</strong></font></p><ul><li>计算机视觉</li><li>移动计算</li><li>数学</li><li>优化算法</li><li>机器学习</li></ul></li><li><p><font color="“blue”"><strong>其他: other</strong></font></p><ul><li>Hexo博客</li><li>生活</li></ul></li></ul><h1 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h1><ul><li>论文</li><li>理论</li><li>其他</li><li>等等</li></ul>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
          <category> categories </category>
          
      </categories>
      
      
        <tags>
            
            <tag> categories </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于hexo+github免费搭建个人博客</title>
      <link href="/2018/03/04/others/%E5%9F%BA%E4%BA%8EHexo+GitHub%20Pages%20%E5%85%8D%E8%B4%B9%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/2018/03/04/others/%E5%9F%BA%E4%BA%8EHexo+GitHub%20Pages%20%E5%85%8D%E8%B4%B9%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Hexo简介"><a href="#1-Hexo简介" class="headerlink" title="1. Hexo简介"></a>1. Hexo简介</h1><p>Hexo是一款基于Node.js的静态博客框架，依赖少易于安装使用，可以方便的生成静态网页托管在GitHub和Heroku上，是搭建博客的首选框架。这里我们选用的是GitHub。Hexo同时也是GitHub上的开源项目，参见：<a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">hexojs/hexo</a> 如果想要更加全面的了解Hexo，可以到其官网 <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 了解更多的细节，因为Hexo的创建者是台湾人，对中文的支持很友好，可以选择中文进行查看。</p><h1 id="2-环境配置"><a href="#2-环境配置" class="headerlink" title="2. 环境配置"></a>2. 环境配置</h1><h2 id="2-1-本机环境配置"><a href="#2-1-本机环境配置" class="headerlink" title="2.1 本机环境配置"></a>2.1 本机环境配置</h2><ol><li><p>安装Node.js</p><p> 下载<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">Node.js</a>,注意安装Node.js会包含环境变量及npm的安装，安装后，检测Node.js是否安装成功，在命令行中输入 node -v. 检测npm是否安装成功，在命令行中输入npm -v</p></li><li><p>安装Hexo</p></li></ol><ul><li><p>Hexo就是我们的个人博客网站的框架， 这里需要自己在电脑常里创建一个文件夹，可以命名为Blog，Hexo框架与以后你自己发布的网页都在这个文件夹中。创建好后，进入文件夹中,使用npm命令安装Hexo，输入：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo <span class="comment">#等待一会就会完成下载安装。</span></span><br><span class="line">hexo init <span class="comment">#该命令会在目标文件夹内建立网站所需要的所有文件</span></span><br><span class="line">npm install <span class="comment">#安装依赖包</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>到这里本地博客就搭建好了。执行以下命令（在你博客的对应文件夹路径下）:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate <span class="comment"># Or hexo g</span></span><br><span class="line">hexo server   <span class="comment"># Or hexo s</span></span><br></pre></td></tr></table></figure></li><li><p>在浏览器输入<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a> 就可以进行查看了。当然这个博客是本地的，别人是无法访问的，之后我们需要部署到GitHub上。常用的Hexo 命令:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g <span class="comment">#安装Hexo</span></span><br><span class="line">npm update hexo -g <span class="comment">#升级</span></span><br><span class="line">hexo init <span class="comment">#初始化博客</span></span><br><span class="line"><span class="comment"># 命令简写</span></span><br><span class="line">hexo n <span class="string">"我的博客"</span> == hexo new <span class="string">"我的博客"</span> <span class="comment">#新建文章</span></span><br><span class="line">hexo g == hexo generate <span class="comment">#生成</span></span><br><span class="line">hexo s == hexo server <span class="comment">#启动服务预览</span></span><br><span class="line">hexo d == hexo deploy <span class="comment">#部署</span></span><br><span class="line">hexo server <span class="comment">#Hexo会监视文件变动并自动更新，无须重启服务器</span></span><br><span class="line">hexo server -s <span class="comment">#静态模式</span></span><br><span class="line">hexo server -p 5000 <span class="comment">#更改端口</span></span><br><span class="line">hexo server -i 192.168.1.1 <span class="comment">#自定义 IP</span></span><br><span class="line">hexo clean <span class="comment">#清除缓存，若是网页正常情况下可以忽略这条命令</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="2-2-git环境配置"><a href="#2-2-git环境配置" class="headerlink" title="2.2 git环境配置"></a>2.2 git环境配置</h2><ol><li><p>注册Github账号并新建仓库</p><ul><li>注册过程就不多说了，注册完成之后需要新建一个仓库。需要注意的是新创建的仓库的名字，必须是username.github.io。例如我的username是XXX，那么新创建的仓库的名字便是XXX.github.io。</li></ul></li><li><p>配置SSH Key</p></li></ol><ul><li><p>这一步不是必须的，配置SSH Key的话之后每次更新博客就不用都输入用户名和密码，可以方便一些。</p><p>  (1)检查本机上是否已经存在SSH Key。打开终端，输入如下命令：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> .ssh</span><br><span class="line">ls -la</span><br></pre></td></tr></table></figure><p>  检查终端输出的文件列表中是否已经存在id_rsa.pub 或 id_dsa.pub 文件，如果文件已经存在，则直接进入第三步。</p><p>  (2)创建一个SSH Key。在终端输入如下命令:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">"your_email@example.com"</span></span><br></pre></td></tr></table></figure><pre><code>  按下回车，让你输入文件名，直接回车会创建使用默认文件名的文件(推荐使用默认文件名)，然后会提示你输入两次密码，可以为空。</code></pre><p>  (3)添加SSH Key到Github</p><pre><code>  如果你没有指定文件名（也就是使用的默认文件名），那么你的.ssh文件夹下，应该有一个id_rsa.pub文件了，打开该文件，复制里面的文本。然后登录Github，点击右上角头像右边的三角图标，点击Settings，然后在左边菜单栏点击SSH and GPG keys，点击New SSH key，Title 随便填一个，在Key栏填入你复制的内容，点击Add SSH key，就添加成功了。</code></pre><p>  (4)检验SSH Key是否配置成功。在终端输入如下命令:</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure></li></ul><pre><code>    如果出现:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Are you sure you want to <span class="built_in">continue</span> connecting (yes/no)?</span><br></pre></td></tr></table></figure>    请输入yes再按回车。如果最后出现:<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi username! You<span class="string">'ve successfully authenticated, but GitHub does not provide shell access.</span></span><br></pre></td></tr></table></figure>    就说明你的SSH Key配置成功了。</code></pre><h2 id="2-3-同步本地博客到Github"><a href="#2-3-同步本地博客到Github" class="headerlink" title="2.3 同步本地博客到Github"></a>2.3 同步本地博客到Github</h2><ol><li><p>上面只是在本地预览，接下来要做的就是就是推送网站，也就是发布网站，让我们的网站可以被更多的人访问。在设置之前，需要解释一个概念，在blog根目录里的_config.yml文件称为站点配置文件.</p></li><li><p>我们的Hexo与GitHub关联起来，打开站点的配置文件_config.yml，翻到最后修改为：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy: </span><br><span class="line">type: git</span><br><span class="line">repo: 这里填入你之前在GitHub上创建仓库的完整路径，记得加上 .git</span><br><span class="line">branch: master参考如下：</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>例子：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line">deploy:</span><br><span class="line"><span class="built_in">type</span>: git</span><br><span class="line">repo: https://github.com/xiaoqiangteng/xiaoqiangteng.github.io.git</span><br><span class="line">brabch: master</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>保存站点配置文件。其实就是给hexo d 这个命令做相应的配置，让hexo知道你要把blog部署在哪个位置，很显然，我们部署在我们GitHub的仓库里。最后安装Git部署插件，输入命令：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></li></ul><ol><li><p>这时，我们分别输入三条命令：</p>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean </span><br><span class="line">hexo g </span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure></li></ol><pre><code>其实第三条的 hexo d 就是部署网站命令，d是deploy的缩写。完成后，打开浏览器，在地址栏输入你的放置个人网站的仓库路径</code></pre><ol><li><p>发布新的博客</p><ul><li><p>既然博客已经搭建好了，那么不发几篇博文有就没有意义了，使用下面的命令来新建一篇叫做”brightloong”的文章。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">'brightloong'</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><pre><code>- 命令执行之后，你会在你文件博客根目录的source/_post目录下找到你刚刚新建的md后缀的文件，hexo博客是使用markdown语法来书写的，如果不熟悉markdown语法可以快速的看一下[markdown](https://www.appinn.com/markdown/)语法说明.&gt; 注意：在冒号后面一定要加上一个空格，否则在生成静态文件的时候会报错，并且也不能将其成功推送到github。<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: brightloong #文章标题</span><br><span class="line">date: 2017-02-24 12:03:12 #创建时间</span><br><span class="line">tags: #文章标签，如果有多个标签可以使用[1,2,3]的形式，还有其他形式自己摸索吧</span><br><span class="line">---</span><br><span class="line"><span class="section">#这之后是正文</span></span><br></pre></td></tr></table></figure>- 文章编写好之后，只用以下命令生成静态文件并推送到github上，执行完成后打开自己的博客页面，是不是发现刚刚编写的文章出现了；如果你想删除某一篇文章，那么在source/_post目录下找到对应的文章将其删除后，同样执行一下命令就OK了。</code></pre><ol><li><p>站点配置文件_config.yml</p><ul><li><p>站点配置文件_config.yml是在你博客保存目录的根目录下，注意将它与主题配置文件进行区分，我使用的主题是Next主题。下面我先介绍下站点配置文件，我将一些主要的配置做了注释，如果你想了解更多的配置的含义和作用，请访问<a href="https://hexo.io/docs/configuration.html" target="_blank" rel="noopener">Hexo官方教程</a>查看。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">BrightLoong's</span> <span class="string">Blog</span> <span class="comment">#博客的标题</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="comment">#子标题</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">Remember</span> <span class="string">what</span> <span class="string">should</span> <span class="string">be</span> <span class="string">remembered,</span> <span class="string">and</span> <span class="string">forget</span> <span class="string">what</span> <span class="string">should</span> <span class="string">be</span> <span class="string">forgotten.Alter</span> <span class="string">what</span> <span class="string">is</span> <span class="string">changeable,</span> <span class="string">and</span> <span class="string">accept</span> <span class="string">what</span> <span class="string">is</span> <span class="string">mutable.</span> <span class="comment">#博客描述，可以是一段你喜欢的话，也可以是你博客的描述，只要你开心就好。</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">BrightLoong</span> <span class="comment">#作者</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-Hans</span> <span class="comment">#语言（我使用的是简体中文）</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="comment">#时区（默认使用电脑时间）</span></span><br><span class="line"><span class="comment">##之下的保持默认就好，没有什么需要更改的</span></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' #and root as '/child/'</span></span><br><span class="line"><span class="attr">url:</span> <span class="attr">https://brightloong.github.io</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"><span class="comment"># Directory</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span> <span class="comment">#source目录</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span> <span class="comment">#标签目录</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span> </span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span> <span class="comment">#分类目录</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></span><br><span class="line"><span class="attr">skip_render:</span> <span class="string">static/**</span> <span class="comment">#注意这个属性（跳过渲染），你暂时不用配置，我之后会讲到，这个也是我遇到的坑</span></span><br><span class="line"><span class="comment">##之下的保持默认就好，没有什么需要更改的</span></span><br><span class="line"><span class="comment"># Writing</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span> <span class="comment"># File name of new posts</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line"><span class="attr">external_link:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  line_number:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  auto_detect:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  tab_replace:</span></span><br><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line"><span class="comment"># Date / Time format</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></span><br><span class="line"><span class="attr">time_format:</span> <span class="attr">HH:mm:ss</span></span><br><span class="line"><span class="comment"># Pagination</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line"><span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></span><br><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span> <span class="comment">#你设置的主题，接下来我会说到这个</span></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repository:</span> <span class="attr">https://github.com/BrightLoong/BrightLoong.github.io.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h1 id="3-设置专属域名"><a href="#3-设置专属域名" class="headerlink" title="3. 设置专属域名"></a>3. 设置专属域名</h1><p>博客搭建好后，我们可以通过之前设置好的GitHub仓库地址来访问，比如：<a href="http://XXX.github.io，而且GitHub是免费替我们托管的的，如果我们想要设置自己的专属的域名，我们可以去阿里云购买域名，我们点击添加记录，设置主机记录为@，类型为A，到IP" target="_blank" rel="noopener">http://XXX.github.io，而且GitHub是免费替我们托管的的，如果我们想要设置自己的专属的域名，我们可以去阿里云购买域名，我们点击添加记录，设置主机记录为@，类型为A，到IP</a> 192.30.252.153（固定值）。按照如上设置完成之后， 可能不会立即生效，等个几分钟，在./source目录下新建文件CNAME（没有后缀名），文件中写上我们要绑定的域名，例如: XXX.com.部署到GitHub上。这时就可以通过<a href="http://XXX.com访问。" target="_blank" rel="noopener">http://XXX.com访问。</a></p><p>GitHub Pages默认是支持https的，即我们可通常<a href="https://XXX.github.io来访问博客。如果想要实现自定义域名访问，需要将自定义域名正确解析到XXX.github.io中。" target="_blank" rel="noopener">https://XXX.github.io来访问博客。如果想要实现自定义域名访问，需要将自定义域名正确解析到XXX.github.io中。</a></p><h1 id="4-Hexo配置"><a href="#4-Hexo配置" class="headerlink" title="4. Hexo配置"></a>4. Hexo配置</h1><h2 id="4-1-主题设置"><a href="#4-1-主题设置" class="headerlink" title="4.1 主题设置"></a>4.1 主题设置</h2><p>搭建自己的博客，最吸引人的莫过于那千变万化的主题了，大家可以在<a href="https://hexo.io/themes/" target="_blank" rel="noopener">Hexo官网</a>上看到无数漂亮、大方、简洁的主题。本人使用的是简洁的<a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">Next主题</a>，你可以选择你喜欢的下载下来，将其解压放入themes目录中，比如我的目录是.\themes，然后修改我在上面提到的站点配置文件中的theme属性，为你刚刚放入themes目录中文件的名字（最好是对解压文件修改一个名字，否则名字可能会比较长，我把我下载下来的主题改文了next）,做完这些之后并不代表你完成了，你还需要参考你所下载的主题所说的配置步骤进行相关的配置，由于不同的主题配置过程也尽不相同，大家根据自己下载的主题去配置，我在这里只说我使用的Next主题如何配置。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">next</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：从下面开始所说的都是Next主题的相关配置。</p></blockquote><p>如果你使用的和我一样，也是Next的主题，那么你最好还是看官方提供<a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">Next使用文档</a>，并且文档是中文版的,我也仅仅是讲一些容易被忽略的配置，以及我使用的配置，以及在使用过程中遇到的问题;至于如何更换头像，添加分类和标签页面、切换主题样式（Next主题包含3中样式）之类的，大家还是照着官方的做更好。</p><ol><li><p>配置网站图标 </p><p> 如何让网站前能显示自己想要的图标，我当时也是找了很久，最后发现是在主题配置文件（我的是F:\myblog\themes\next_config.yml）的最前面，有一个favicon属性，我把一个名字叫favicon.ico的图片放到了F:\myblog\source下，然后配置如下：</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favicon:</span> <span class="string">/favicon.ico</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>首页显示阅读全文按钮</p><p> 首页的文章是不是默认展开了，显示出了整篇文章，怎么才能显示出如下的阅读全文的按钮。在主题配置文件中找到auto_excerpt属性进行配置:</p> <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#改写为true</span></span><br><span class="line"><span class="attr">   length:</span> <span class="number">150</span> <span class="comment">#默认展示的高度</span></span><br></pre></td></tr></table></figure></li></ol><pre><code>你也可以在自己的博文中添加\&lt;!--more--&gt;来决定在首页展示到什么位置（我就喜欢用这种方式），这个标签后的内容就不会展示到首页啦。</code></pre><h2 id="4-2-修改文章内链接文本样式"><a href="#4-2-修改文章内链接文本样式" class="headerlink" title="4.2 修改文章内链接文本样式"></a>4.2 修改文章内链接文本样式</h2><p>修改文件 themes\next\source\css_common\components\post\post.styl，在末尾添加如下css样式，：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 文章内链接文本样式</span><br><span class="line"><span class="selector-class">.post-body</span> <span class="selector-tag">p</span> <span class="selector-tag">a</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0593d3</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#0593d3</span>;</span><br><span class="line">  &amp;:hover &#123;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-id">#fc6423</span>;</span><br><span class="line">    <span class="selector-tag">border-bottom</span>: <span class="selector-tag">none</span>;</span><br><span class="line">    <span class="selector-tag">border-bottom</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#fc6423</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中选择.post-body 是为了不影响标题，选择 p 是为了不影响首页“阅读全文”的显示样式,颜色可以自己定义。</p><h2 id="4-3-字数统计和阅读时长设置"><a href="#4-3-字数统计和阅读时长设置" class="headerlink" title="4.3 字数统计和阅读时长设置"></a>4.3 字数统计和阅读时长设置</h2><ul><li>安装插件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-symbols-count-time --save</span><br></pre></td></tr></table></figure><ul><li>然后修改主题配置文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">symbols_count_time:</span><br><span class="line">    separated_meta: <span class="literal">true</span>   ＃显示属性名称,设为<span class="literal">false</span>后只显示图标和统计数字,不显示属性的文字</span><br><span class="line">    item_text_post: <span class="literal">true</span>   ＃显示属性名称,设为<span class="literal">false</span>后只显示图标和统计数字,不显示属性的文字</span><br><span class="line">    item_text_total: <span class="literal">true</span> ＃底部footer是否显示字数统计属性文字(如站点总字数,站点阅读时长 ≈ 1 分钟)</span><br><span class="line">    awl: 4     ＃计算字数的一个设置,没设置过</span><br><span class="line">    wpm: 275  ＃一分钟阅读的字数</span><br></pre></td></tr></table></figure><ul><li><p>站点配置文件中添加如下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">symbols_count_time:</span><br><span class="line"> <span class="comment">#文章内是否显示</span></span><br><span class="line">  symbols: <span class="literal">true</span></span><br><span class="line">  time: <span class="literal">true</span></span><br><span class="line"> <span class="comment"># 网页底部是否显示</span></span><br><span class="line">  total_symbols: <span class="literal">true</span></span><br><span class="line">  total_time: <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="4-4-添加站点访问计数"><a href="#4-4-添加站点访问计数" class="headerlink" title="4.4 添加站点访问计数"></a>4.4 添加站点访问计数</h2><ul><li><p>安装脚本</p><p>打开 <strong>themes/next/layout/_partial/footer.swig</strong>，将下面这段代码添加到里面：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">&lt;script async src=<span class="string">"https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;span id=<span class="string">"busuanzi_container_site_pv"</span> style=<span class="string">'display:none'</span>&gt;</span><br><span class="line">    本站总访问量 &lt;span id=<span class="string">"busuanzi_value_site_pv"</span>&gt;&lt;/span&gt; 次</span><br><span class="line">    &lt;span class=<span class="string">"post-meta-divider"</span>&gt;|&lt;/span&gt;</span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;span id=<span class="string">"busuanzi_container_site_uv"</span> style=<span class="string">'display:none'</span>&gt;</span><br><span class="line">    有&lt;span id=<span class="string">"busuanzi_value_site_uv"</span>&gt;&lt;/span&gt;人看过我的博客啦</span><br><span class="line">&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>插入的位置：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-28-153017.png" alt="image-20190728233014614"></p></li></ul><ul><li>打开 <strong>themes/next/layout/post.swig</strong>，这个文件是文章的模板，给render方法传入参数（对应刚才添加的<code>is_pv</code>字段）</li></ul><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-28-153306.png" alt="image-20190728233304559"></p><ul><li><p>再打开 <strong>themes/next/layout/index.swig</strong>，这个文件是首页的模板，给render方法传入参数（对应刚才添加的is_pv字段）</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-28-153538.png" alt="image-20190728233537104"></p></li></ul><h1 id="5-外链设置"><a href="#5-外链设置" class="headerlink" title="5. 外链设置"></a>5. 外链设置</h1><p>最初使用七牛云作为图床外链，由于其测试域名回收，导致大部分外链失效。隧抛弃七牛云，开始寻找稳定可靠的图床外链存储服务。</p><h2 id="5-1-购买阿里云对象存储服务"><a href="#5-1-购买阿里云对象存储服务" class="headerlink" title="5.1 购买阿里云对象存储服务"></a>5.1 购买阿里云对象存储服务</h2><p>访问<a href="https://www.aliyun.com/product/oss?spm=5176.12825654.eofdhaal5.81.e9392c4ao0cQj6" target="_blank" rel="noopener">阿里云OSS对象云存储</a>站点，创建Bucket。所谓的Bucket类似于一个存储空间，可以将自己要存储的对象放在该空间里，例如图片。阿里云OSS服务根据该空间的存储大小进行收费。当然，其收费的服务不仅仅是存储空间大小，还包括流量等费用，后续会提及。</p><p>创建Bucket时，需要填写Bucket名称，自定义的。所属区域，例如香港。存储类型，例如标准存储。</p><p>如果不购买阿里云OSS服务流量包，其收费默认是按量收费，即用多少收取对应的费用。当然，也可以购买流量包。一般而言，流量包相对便宜些。</p><p>关于流量包的使用。购买后从控制台OSS对象存储处即可看到购买的流量包。无需关联。当OSS收取服务费用时，会检测相应的流量包。如果流量包满足使用条件，则自动从流量包中抵扣。</p><h2 id="5-2-上传对象至阿里云OSS服务"><a href="#5-2-上传对象至阿里云OSS服务" class="headerlink" title="5.2 上传对象至阿里云OSS服务"></a>5.2 上传对象至阿里云OSS服务</h2><p>1）进入创建的Bucket中，点击文件管理，创建文件夹。</p><p>2）上传图片至相应位置，即可生成外链。</p><h2 id="5-3-阿里云OSS绑定域名"><a href="#5-3-阿里云OSS绑定域名" class="headerlink" title="5.3 阿里云OSS绑定域名"></a>5.3 阿里云OSS绑定域名</h2><p>1）在bucket 的域名管理中绑定域名。</p><p>2）进入域名解析界面，对域名进行解析。</p><p>首先进入OSS概览页面，找到外网访问地址。</p><p>其次，进入域名解析界面，添加如下设置：</p><p>记录类型：CNAME</p><p>主机记录：oss</p><p>记录值：为外网访问地址。</p><h2 id="5-4-使用iPic实现快速上传图片"><a href="#5-4-使用iPic实现快速上传图片" class="headerlink" title="5.4 使用iPic实现快速上传图片"></a>5.4 使用iPic实现快速上传图片</h2><p>iPic下载和配置地址：<a href="https://toolinbox.net/iPic/" target="_blank" rel="noopener">https://toolinbox.net/iPic/</a></p><p>其中，阿里云OSS服务开启”公共读”权限，使得复制的外链可直接使用。</p><p>在<a href="https://typora.io/" target="_blank" rel="noopener">Typora</a>中配置iPic上传图片。在Typora中进行如下配置：</p><p><img src="https://toddler.oss-cn-hongkong.aliyuncs.com/images/2019-07-28-150811.png" alt="image-20190728230801412"></p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo使用攻略-添加分类标签和搜索功能</title>
      <link href="/2018/03/04/others/Hexo%E4%BD%BF%E7%94%A8%E6%94%BB%E7%95%A5-%E6%B7%BB%E5%8A%A0%E5%88%86%E7%B1%BB%E5%8F%8A%E6%A0%87%E7%AD%BE/"/>
      <url>/2018/03/04/others/Hexo%E4%BD%BF%E7%94%A8%E6%94%BB%E7%95%A5-%E6%B7%BB%E5%8A%A0%E5%88%86%E7%B1%BB%E5%8F%8A%E6%A0%87%E7%AD%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="Hexo使用攻略-添加分类及标签"><a href="#Hexo使用攻略-添加分类及标签" class="headerlink" title="Hexo使用攻略-添加分类及标签"></a>Hexo使用攻略-添加分类及标签</h1><h2 id="创建“分类”选项"><a href="#创建“分类”选项" class="headerlink" title="创建“分类”选项"></a>创建“分类”选项</h2><h3 id="生成“分类”页并添加tpye属性"><a href="#生成“分类”页并添加tpye属性" class="headerlink" title="生成“分类”页并添加tpye属性"></a>生成“分类”页并添加tpye属性</h3><p>打开命令行，进入博客所在文件夹。执行命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page categories</span><br></pre></td></tr></table></figure><p>成功后会提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/Documents/blog/source/categories/index.md</span><br></pre></td></tr></table></figure></p><p>根据上面的路径，找到index.md这个文件，打开后默认内容是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>保存并关闭文件。</p><h3 id="给文章添加“categories”属性"><a href="#给文章添加“categories”属性" class="headerlink" title="给文章添加“categories”属性"></a>给文章添加“categories”属性</h3><p>打开需要添加分类的文章，为其添加categories属性。下方的categories: web前端表示添加这篇文章到“web前端”这个分类。注意：hexo一篇文章只能属于一个分类，也就是说如果在“- web前端”下方添加“-xxx”，hexo不会产生两个分类，而是把分类嵌套（即该文章属于 “- web前端”下的 “-xxx ”分类）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: jQuery对表单的操作及更多应用</span><br><span class="line">date: 2017-05-26 12:12:57</span><br><span class="line">categories: </span><br><span class="line">- web前端</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>至此，成功给文章添加分类，点击首页的“分类”可以看到该分类下的所有文章。当然，只有添加了categories: xxx的文章才会被收录到首页的“分类”中。</p><p>注意：如果有启用多说 或者 Disqus 评论，默认页面也会带有评论。需要关闭的话，请添加字段 comments 并将值设置为 false，如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: 分类</span><br><span class="line">date: 2014-12-22 12:39:04</span><br><span class="line">type: &quot;categories&quot;</span><br><span class="line">comments: false</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>或</p><h3 id="设置分类列表"><a href="#设置分类列表" class="headerlink" title="设置分类列表"></a>设置分类列表</h3><p>在我们编辑文章的时候，直接在categories:项填写属于哪个分类，但如果分类是中文的时候，路径也会包含中文。<br>比如分类我们设置的是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">categories: 编程</span><br></pre></td></tr></table></figure><p>那在生成页面后，分类列表就会出现编程这个选项，他的访问路径是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">那在生成页面后，分类列表就会出现编程这个选项，他的访问路径是：</span><br></pre></td></tr></table></figure><p>如果我们想要把路径名和分类名分别设置，需要怎么办呢？</p><p>打开根目录下的配置文件_config.yml，找到如下位置做更改：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Category &amp; Tag</span><br><span class="line">default_category: uncategorized</span><br><span class="line">category_map:</span><br><span class="line">编程: programming</span><br><span class="line">生活: life</span><br><span class="line">其他: other</span><br><span class="line">tag_map:</span><br></pre></td></tr></table></figure><p>在这里category_map:是设置分类的地方，每行一个分类，冒号前面是分类名称，后面是访问路径。</p><p>可以提前在这里设置好一些分类，当编辑的文章填写了对应的分类名时，就会自动的按照对应的路径来访问。</p><h2 id="创建“标签”选项"><a href="#创建“标签”选项" class="headerlink" title="创建“标签”选项"></a>创建“标签”选项</h2><h3 id="生成“标签”页并添加tpye属性"><a href="#生成“标签”页并添加tpye属性" class="headerlink" title="生成“标签”页并添加tpye属性"></a>生成“标签”页并添加tpye属性</h3><p>打开命令行，进入博客所在文件夹。执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page tags</span><br></pre></td></tr></table></figure><p>成功后会提示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INFO  Created: ~/Documents/blog/source/tags/index.md</span><br></pre></td></tr></table></figure><p>根据上面的路径，找到index.md这个文件，打开后默认内容是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2017-05-27 14:22:08</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>添加type: “tags”到内容中，添加后是这样的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章分类</span><br><span class="line">date: 2017-05-27 13:47:40</span><br><span class="line">type: &quot;tags&quot;</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>保存并关闭文件。</p><h3 id="给文章添加“tags”属性"><a href="#给文章添加“tags”属性" class="headerlink" title="给文章添加“tags”属性"></a>给文章添加“tags”属性</h3><p>打开需要添加标签的文章，为其添加tags属性。下方的tags:下方的- jQuery - 表格<br>- 表单验证就是这篇文章的标签了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: jQuery对表单的操作及更多应用</span><br><span class="line">date: 2017-05-26 12:12:57</span><br><span class="line">categories: </span><br><span class="line">- web前端</span><br><span class="line">tags:</span><br><span class="line">- jQuery</span><br><span class="line">- 表格</span><br><span class="line">- 表单验证</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>至此，成功给文章添加分类，点击首页的“标签”可以看到该标签下的所有文章。当然，只有添加了tags: xxx的文章才会被收录到首页的“标签”中。</p><h2 id="新建页面的模板"><a href="#新建页面的模板" class="headerlink" title="新建页面的模板"></a>新建页面的模板</h2><p>打开scaffolds/post.md文件，在tages:上面加入categories:,保存后，重新执行hexo n ‘name’命令，会发现新建的页面里有categories:项了。</p><p>scaffolds目录下，是新建页面的模板，执行新建命令时，是根据这里的模板页来完成的，所以可以在这里根据你自己的需求添加一些默认值。</p><h2 id="菜单中添加链接"><a href="#菜单中添加链接" class="headerlink" title="菜单中添加链接"></a>菜单中添加链接</h2><p>编辑主题的 _config.yml ，将 menu 中的 categories: /categories 注释去掉，如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: /</span><br><span class="line">  categories: /categories</span><br><span class="line">  archives: /archives</span><br><span class="line">  tags: /tags</span><br></pre></td></tr></table></figure><p>在主题配置文件中添加分类选项</p><p>在主题配置文件:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">themes/_config.yml</span><br></pre></td></tr></table></figure><p>中添加以下代码（#号后为注释内容）:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  主页: /</span><br><span class="line">  所有文章: /archives</span><br><span class="line">  技巧经验: /categories/技巧经验     # 博客首页展示文本： 访问路径/自定义归档名称</span><br><span class="line">  资料总结: /categories/资料总结</span><br></pre></td></tr></table></figure><h1 id="Hexo使用攻略-搜索功能"><a href="#Hexo使用攻略-搜索功能" class="headerlink" title="Hexo使用攻略-搜索功能"></a>Hexo使用攻略-搜索功能</h1><p>1）用 hexo-generator-search 生成索引</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
